<!DOCTYPE html>
<html lang="en">

<!-- Mirrored from simpleisbetterthancomplex.com/series/2017/10/02/a-complete-beginners-guide-to-django-part-5.html by HTTrack Website Copier/3.x [XR&CO'2014], Fri, 03 Sep 2021 12:41:06 GMT -->
<head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta name="ir-site-verification-token" value="-233745807">
<title>A Complete Beginner's Guide to Django - Part 5</title>
<meta name="description" content="In this tutorial, we are going to learn more about protecting views against unauthorized users and how to access the authenticated user in the views and form...">
<link href="https://fonts.googleapis.com/css?family=Raleway:400,300,500,600,700" rel="stylesheet" type="text/css">
<link rel="stylesheet" href="../../../../css/main71de.css?v=34">
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">
<link rel="canonical" href="a-complete-beginners-guide-to-django-part-5.html">
<link rel="alternate" type="application/rss+xml" title="Simple is Better Than Complex" href="../../../../feed.xml" />
<link rel="icon" type="image/png" href="../../../../favicon.png">
<link rel="mask-icon" href="../../../../safari-pinned-tab.svg" color="#5bbad5">
<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.2/jquery.min.js"></script>
<script src="../../../../js/site7b30.js?v=4"></script>

  <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','http://www.google-analytics.com/analytics.js','ga');
    ga('create', 'UA-42049022-10', 'auto');
    ga('send', 'pageview');
  </script>
  <script>
    $(function () {
      $("#ad").on("click", "#carbonads .carbon-wrap a", function () {
        var page_id = 'a-complete-beginners-guide-to-django-part-5.html';
        ga('send', 'event', 'carbonads', 'click', page_id, {
          'transport': 'beacon'
        });
      });
    });
  </script>
  <script>
  !function(f,b,e,v,n,t,s){if(f.fbq)return;n=f.fbq=function(){n.callMethod?
  n.callMethod.apply(n,arguments):n.queue.push(arguments)};if(!f._fbq)f._fbq=n;
  n.push=n;n.loaded=!0;n.version='2.0';n.queue=[];t=b.createElement(e);t.async=!0;
  t.src=v;s=b.getElementsByTagName(e)[0];s.parentNode.insertBefore(t,s)}(window,
  document,'script','https://connect.facebook.net/en_US/fbevents.js');
  fbq('init', '1689711451348257');
  fbq('track', 'PageView');
  </script>
  <noscript><img height="1" width="1" style="display:none" alt="PageView"
  src="https://www.facebook.com/tr?id=1689711451348257&amp;ev=PageView&amp;noscript=1"
  /></noscript>
  <script data-ad-client="ca-pub-5430683801108011" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>


  <meta property="og:title" content="A Complete Beginner's Guide to Django - Part 5">
<meta property="og:url" content="https://simpleisbetterthancomplex.com/series/2017/10/02/a-complete-beginners-guide-to-django-part-5.html">
<meta property="og:image" content="https://simpleisbetterthancomplex.com/media/series/beginners-guide/1.11/part-5/thumbnail.jpg">
<meta property="og:description" content="In this tutorial, we are going to learn more about protecting views against unauthorized users and how to access the authenticated user in the views and form...">
<meta property="og:site_name" content="Simple is Better Than Complex">
<meta property="og:locale" content="en_US">

  <meta property="article:published_time" content="2017-10-02T08:00:00+03:00">
  <meta property="article:author" content="https://facebook.com/vitorfs">

<meta property="fb:admins" content="100000024295617">
<meta property="fb:app_id" content="1645747765697865">

<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:site" content="vitorfs">
<meta name="twitter:creator" content="vitorfs">
<meta name="twitter:title" content="A Complete Beginner's Guide to Django - Part 5">
<meta name="twitter:description" content="In this tutorial, we are going to learn more about protecting views against unauthorized users and how to access the authenticated user in the views and forms. We are also going to implement the to...">
<meta name="twitter:image" content="https://simpleisbetterthancomplex.com/media/series/beginners-guide/1.11/part-5/thumbnail.jpg">
<meta name="p:domain_verify" content="e262845cb18e4c68b0cff535a0eaea5d">
  <meta property="og:type" content="article">
  
    <meta property="article:tag" content="python">
  
    <meta property="article:tag" content="django">
  
    <meta property="article:tag" content="guide">
  
    <meta property="article:tag" content="beginners">
  
    <meta property="article:tag" content="orm">
  
    <meta property="article:tag" content="migrations">
  
</head>
<body>
  <div id="top" style="visibility: hidden"></div>
<header>
  <div class="container">
    <ul class="menu menu-right">
      <li class="menu-item">
        <a href="../../../../search/index.html">
          <span class="fa fa-search"></span>
        </a>
      </li>
      <li class="toggle-menu">
        <a href="javascript:void(0);">
          <span class="fa fa-bars"></span>
        </a>
      </li>
    </ul>
    <ul class="menu menu-left">
      <li class="logo">
        <a href="../../../../index.html" style="font-weight: 900">simple<span class="brand">is</span>better<span class="brand">than</span>complex</a>
      </li>
      <li class="menu-item">
        <a href="../../../../index.html">
          <span class="fa fa-home" style="margin-right: 3px"></span>
          Home
        </a>
      </li>
      <li class="menu-item">
        <a href="../../../../archive/index.html">
          <span class="fa fa-archive" style="margin-right: 3px"></span>
          Articles
        </a>
      </li>
      <li class="menu-item">
        <a href="../../../../videos/index.html">
          <span class="fa fa-video-camera" style="margin-right: 3px"></span>
          Videos
        </a>
      </li>
      <li class="menu-item">
        <a href="../../../index.html">
          <span class="fa fa-book" style="margin-right: 3px"></span>
          Series
        </a>
      </li>
      <li class="menu-item">
        <a href="../../../../snippets/index.html">
          <span class="fa fa-code" style="margin-right: 3px"></span>
          Snippets
        </a>
      </li>
      <li class="menu-item">
        <a href="../../../../sponsor/index.html">
          <span class="fa fa-bullhorn" style="margin-right: 3px"></span>
          Sponsor
        </a>
      </li>
      <li class="menu-item">
        <a href="../../../../feed.xml" target="_blank">
          <span class="fa fa-rss" style="margin-right: 3px"></span>
          RSS
        </a>
      </li>
      <li class="menu-item">
        <a href="https://colossus.simpleisbetterthancomplex.com/subscribe/d2320a41-0378-4aa8-8f4e-5bb1ffcd521d/" class="brand" target="_blank">
          <span class="fa fa-send" style="margin-right: 3px"></span> Subscribe
        </a>
      </li>
      <li class="menu-item hidden-mobile">
        <a href="../../../../search/index.html">
          <span class="fa fa-search"></span> Search
        </a>
      </li>
    </ul>
  </div>
</header>

  <div class="container">
    <div class="row">
      <div class="twelve columns post">
        <div class="card post-author">
  <div class="author-picture">
    <img src="../../../../img/picture.jpg" alt="Vitor Freitas">
  </div>
  <div class="author-info">
    <p class="name">By <strong>Vitor Freitas</strong></p>
    <a href="https://www.digitalocean.com/?refcode=074832454ff1&amp;utm_campaign=Referral_Invite&amp;utm_medium=Referral_Program&amp;utm_source=badge" class="powered-by-do">
      <img src="https://web-platforms.sfo2.cdn.digitaloceanspaces.com/WWW/Badge 1.svg" alt="DigitalOcean Referral Badge">
    </a>
    <p class="bio">
      I'm a passionate software developer and researcher. I write about Python, Django and Web Development on a weekly basis. <a href="../../../../about/index.html" rel="author">Read more</a>.
    </p>
    <p class="contact">
      <a href="https://www.youtube.com/VitorFreitas" rel="me noopener" target="_blank" title="YouTube"><i class="fa fa-youtube-play"></i></a>
      <a href="https://github.com/vitorfs" rel="me noopener" target="_blank" title="GitHub"><i class="fa fa-github"></i></a>
      <a href="https://twitter.com/vitorfs" rel="me noopener" target="_blank" title="Twitter"><i class="fa fa-twitter"></i></a>
      <a href="https://facebook.com/vitorfs" rel="me noopener" target="_blank" title="Facebook"><i class="fa fa-facebook-official"></i></a>
      <a href="https://linkedin.com/in/vitorfs" rel="me noopener" target="_blank" title="LinkedIn"><i class="fa fa-linkedin-square"></i></a>
      <a href="https://instagram.com/vitorfs" rel="me noopener" target="_blank" title="Instagram"><i class="fa fa-instagram"></i></a>
      <a href="../../../../contact/index.html" title="Contact"><i class="fa fa-envelope"></i></a>
    </p>
  </div>
  
  
</div>

      </div>
    </div>
    <div id="main-content" class="row">
      <div id="seriesSideBar" class="three columns">
        <div class="card">
          
            <div id="ad">
              <script async type="text/javascript" src="http://cdn.carbonads.com/carbon.js?serve=CKYIEKQM&amp;placement=simpleisbetterthancomplexcom" id="_carbonads_js"></script>
            </div>
          
          <nav id="platformSideBar" class="platform js-set-platform" style="margin-bottom: 2rem; display: none; font-size: 1.2rem">
            <a href="javascript:void(0);" data-platform="mac" title="Set platform to Mac"><i class="fa fa-apple"></i> Mac</a>
            <a href="javascript:void(0);" data-platform="windows" title="Set platform to Windows"><i class="fa fa-windows"></i> Win</a>
            <a href="javascript:void(0);" data-platform="linux" title="Set platform to Linux"><i class="fa fa-linux"></i> Linux</a>
          </nav>
          <h5>Table of Contents</h5>
          <ul>
            
              <li><a href="#introduction">Introduction</a></li>
              
            
              <li><a href="#protecting-views">Protecting Views</a></li>
              
                <li style="padding-left: 1.5rem; font-size: 1.4rem; margin-bottom: 0.25rem">
                  <a href="#configuring-login-next-redirect">
                    Configuring Login Next Redirect
                  </a>
                </li>
              
                <li style="padding-left: 1.5rem; font-size: 1.4rem; margin-bottom: 0.25rem">
                  <a href="#login-required-tests">
                    Login Required Tests
                  </a>
                </li>
              
            
              <li><a href="#accessing-the-authenticated-user">Accessing the Authenticated User</a></li>
              
            
              <li><a href="#topic-posts-view">Topic Posts View</a></li>
              
            
              <li><a href="#reply-post-view">Reply Post View</a></li>
              
            
              <li><a href="#querysets">QuerySets</a></li>
              
            
              <li><a href="#migrations">Migrations</a></li>
              
            
              <li><a href="#conclusions">Conclusions</a></li>
              
            
          </ul>
          <hr style="margin: 1.5rem 0;">
          <ul style="font-size: 1.4rem">
            <li><a href="#top"><i class="fa fa-arrow-up" style="margin-right: .2rem"></i> scroll to top</a></li>
            <li><a href="#comments"><i class="fa fa-comments" style="margin-right: .2rem"></i> go to comments</a></li>
            <li><a href="../../../beginners-guide/1.11/index.html"><i class="fa fa-list" style="margin-right: .2rem"></i> go to series index</a></li>
          </ul>
        </div>
      </div>
      <div class="nine columns content post" style="float:right">
        <div class="card">
          
  <h5 class="post-category">
    
      series
    
  </h5>
  <hr class="dashed">

<h3 class="post-title">A Complete Beginner's Guide to Django - Part 5</h3>
<ul class="post-meta">
  <li>
    <i class="fa fa-calendar"></i> Oct 2, 2017
  </li>
  <li>
    <i class="fa fa-clock-o"></i>
    37 minutes read
  </li>
  <li>
    <i class="fa fa-comments"></i>
    <a href="#disqus_thread" data-disqus-identifier="/series/2017/10/02/a-complete-beginners-guide-to-django-part-5">comments</a>
  </li>
  <li>
    <i class="fa fa-eye"></i>
    <span class="ga-page-views" data-ga-identifier="a-complete-beginners-guide-to-django-part-5.html"></span> views
  </li>
  
    <li>
      <i class="fa fa-book"></i>
      <a href="../../../beginners-guide/1.11/index.html">Part 5 of 7</a>
    </li>
  
  
</ul>

  <div class="post-featured-image">
    <img src="../../../../media/series/beginners-guide/1.11/part-5/featured.jpg" alt="A Complete Beginner's Guide to Django - Part 5" class="featured-image">
    
  </div>


          <div class="row" style="margin-bottom: 2rem;">
            <div class="five columns">
              <nav id="platformArticle" class="platform js-set-platform">
                <a href="javascript:void(0);" data-platform="mac" title="Set platform to Mac"><i class="fa fa-apple"></i> Mac</a>
                <a href="javascript:void(0);" data-platform="windows" title="Set platform to Windows"><i class="fa fa-windows"></i> Windows</a>
                <a href="javascript:void(0);" data-platform="linux" title="Set platform to Linux"><i class="fa fa-linux"></i> Linux</a>

              </nav>
            </div>
            <div class="three columns">
              <nav class="platform">
                <a href="../../../beginners-guide/1.11/index.html" class="series-nav">Series 5/7</a>
              </nav>
            </div>
            <div class="four columns versions">
              
                <img src="https://img.shields.io/badge/python-3.6.2-brightgreen.svg" alt="Python 3.6.2">
              
              
                <img src="https://img.shields.io/badge/django-1.11.4-brightgreen.svg" alt="Django 1.11.4">
              
            </div>
          </div>

          <article>
            <h4 id="introduction">Introduction</h4>

<p>Welcome to the 5th part of the tutorial series! In this tutorial, we are going to learn more about protecting views
against unauthorized users and how to access the authenticated user in the views and forms. We are also going to
implement the topic posts listing view and the reply view. Finally, we are going to explore some features of Django
ORM and have a brief introduction to migrations.</p>

<hr />

<h4 id="protecting-views">Protecting Views</h4>

<p>We have to start protecting our views against non-authorized users. So far we have the following view to start new
posts:</p>

<p><img src="../../../../media/series/beginners-guide/1.11/part-5/topics-1.png" alt="Topics view not logged in" /></p>

<p>In the picture above the user is not logged in, and even though they can see the page and the form.</p>

<p>Django has a built-in <em>view decorator</em> to avoid that issue:</p>

<p><strong>boards/views.py</strong>
<small><a href="https://gist.github.com/vitorfs/4d3334a0daa9e7a872653a22ff39320a#file-models-py-L19" target="_blank" rel="noopener nofollow">(view complete file contents)</a></small></p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="kn">from</span> <span class="nn">django.contrib.auth.decorators</span> <span class="kn">import</span> <span class="n">login_required</span>

<span class="nd">@login_required</span>
<span class="k">def</span> <span class="nf">new_topic</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">pk</span><span class="p">):</span>
    <span class="c"># ...</span></code></pre></figure>

<p>From now on, if the user is not authenticated they will be redirected to the login page:</p>

<p><img src="../../../../media/series/beginners-guide/1.11/part-5/login-required.png" alt="Login required redirect" /></p>

<p>Notice the query string <strong>?next=/boards/1/new/</strong>. We can improve the log in template to make use of the <strong>next</strong>
variable and improve the user experience.</p>

<h5 id="configuring-login-next-redirect">Configuring Login Next Redirect</h5>

<p><strong>templates/login.html</strong>
<small><a href="https://gist.github.com/vitorfs/1ab597fe18e2dc56028f7aa8c3b588b3#file-login-html-L13" target="_blank" rel="noopener nofollow">(view complete file contents)</a></small></p>

<figure class="highlight"><pre><code class="language-django" data-lang="django"><span class="nt">&lt;form</span> <span class="na">method=</span><span class="s">"post"</span> <span class="na">novalidate</span><span class="nt">&gt;</span>
  <span class="cp">{%</span> <span class="nv">csrf_token</span> <span class="cp">%}</span>
  <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"hidden"</span> <span class="na">name=</span><span class="s">"next"</span> <span class="na">value=</span><span class="s">"</span><span class="cp">{{</span> <span class="nv">next</span> <span class="cp">}}</span><span class="s">"</span><span class="nt">&gt;</span>
  <span class="cp">{%</span> <span class="k">include</span> <span class="s1">'includes/form.html'</span> <span class="cp">%}</span>
  <span class="nt">&lt;button</span> <span class="na">type=</span><span class="s">"submit"</span> <span class="na">class=</span><span class="s">"btn btn-primary btn-block"</span><span class="nt">&gt;</span>Log in<span class="nt">&lt;/button&gt;</span>
<span class="nt">&lt;/form&gt;</span></code></pre></figure>

<p>Then if we try to log in now, the application will direct us back to where we were.</p>

<p><img src="../../../../media/series/beginners-guide/1.11/part-5/Pixton_Comic_Magic.png" alt="Magic" /></p>

<p>So the <strong>next</strong> parameter is part of a built-in functionality.</p>

<h5 id="login-required-tests">Login Required Tests</h5>

<p>Let’s now add a test case to make sure this view is protected by the <code class="highlighter-rouge">@login_required</code> decorator. But first, let’s do
some refactoring in the <strong>boards/tests/test_views.py</strong> file.</p>

<p>Let’s split the <strong>test_views.py</strong> into three files:</p>

<ul>
  <li><strong>test_view_home.py</strong> will include the <strong>HomeTests</strong> class <small><a href="https://gist.github.com/vitorfs/6ac3aad244c856d418f18890efcb4a7e#file-test_view_home-py" target="_blank" rel="noopener nofollow">(view complete file contents)</a></small></li>
  <li><strong>test_view_board_topics.py</strong> will include the <strong>BoardTopicsTests</strong> class <small><a href="https://gist.github.com/vitorfs/6ac3aad244c856d418f18890efcb4a7e#file-test_view_board_topics-py" target="_blank" rel="noopener nofollow">(view complete file contents)</a></small></li>
  <li><strong>test_view_new_topic.py</strong> will include the <strong>NewTopicTests</strong> class <small><a href="https://gist.github.com/vitorfs/6ac3aad244c856d418f18890efcb4a7e#file-test_view_new_topic-py" target="_blank" rel="noopener nofollow">(view complete file contents)</a></small></li>
</ul>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash">myproject/
 |-- myproject/
 |    |-- accounts/
 |    |-- boards/
 |    |    |-- migrations/
 |    |    |-- templatetags/
 |    |    |-- tests/
 |    |    |    |-- __init__.py
 |    |    |    |-- test_templatetags.py
 |    |    |    |-- test_view_home.py          &lt;-- here
 |    |    |    |-- test_view_board_topics.py  &lt;-- here
 |    |    |    +-- test_view_new_topic.py     &lt;-- and here
 |    |    |-- __init__.py
 |    |    |-- admin.py
 |    |    |-- apps.py
 |    |    |-- models.py
 |    |    +-- views.py
 |    |-- myproject/
 |    |-- static/
 |    |-- templates/
 |    |-- db.sqlite3
 |    +-- manage.py
 +-- venv/</code></pre></figure>

<p>Run the tests to make sure everything is working.</p>

<p>New let’s add a new test case in the <strong>test_view_new_topic.py</strong> to check if the view is decorated with
<code class="highlighter-rouge">@login_required</code>:</p>

<p><strong>boards/tests/test_view_new_topic.py</strong>
<small><a href="https://gist.github.com/vitorfs/13e75451396d76354b476edaefadbdab#file-test_view_new_topic-py-L84" target="_blank" rel="noopener nofollow">(view complete file contents)</a></small></p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="kn">from</span> <span class="nn">django.test</span> <span class="kn">import</span> <span class="n">TestCase</span>
<span class="kn">from</span> <span class="nn">django.urls</span> <span class="kn">import</span> <span class="n">reverse</span>
<span class="kn">from</span> <span class="nn">..models</span> <span class="kn">import</span> <span class="n">Board</span>

<span class="k">class</span> <span class="nc">LoginRequiredNewTopicTests</span><span class="p">(</span><span class="n">TestCase</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">setUp</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">Board</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s">'Django'</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="s">'Django board.'</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">url</span> <span class="o">=</span> <span class="n">reverse</span><span class="p">(</span><span class="s">'new_topic'</span><span class="p">,</span> <span class="n">kwargs</span><span class="o">=</span><span class="p">{</span><span class="s">'pk'</span><span class="p">:</span> <span class="mi">1</span><span class="p">})</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">url</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">test_redirection</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">login_url</span> <span class="o">=</span> <span class="n">reverse</span><span class="p">(</span><span class="s">'login'</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertRedirects</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">response</span><span class="p">,</span> <span class="s">'{login_url}?next={url}'</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">login_url</span><span class="o">=</span><span class="n">login_url</span><span class="p">,</span> <span class="n">url</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">url</span><span class="p">))</span></code></pre></figure>

<p>In the test case above we are trying to make a request to the <strong>new topic</strong> view without being authenticated. The
expected result is for the request be redirected to the login view.</p>

<hr />

<h4 id="accessing-the-authenticated-user">Accessing the Authenticated User</h4>

<p>Now we can improve the <strong>new_topic</strong> view and this time set the proper user, instead of just querying the database
and picking the first user. That code was temporary because we had no way to authenticate the user. But now we can do
better:</p>

<p><strong>boards/views.py</strong>
<small><a href="https://gist.github.com/vitorfs/483936caca4618dc275545ad2dfbef24#file-views-py-L19" target="_blank" rel="noopener nofollow">(view complete file contents)</a></small></p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="kn">from</span> <span class="nn">django.contrib.auth.decorators</span> <span class="kn">import</span> <span class="n">login_required</span>
<span class="kn">from</span> <span class="nn">django.shortcuts</span> <span class="kn">import</span> <span class="n">get_object_or_404</span><span class="p">,</span> <span class="n">redirect</span><span class="p">,</span> <span class="n">render</span>

<span class="kn">from</span> <span class="nn">.forms</span> <span class="kn">import</span> <span class="n">NewTopicForm</span>
<span class="kn">from</span> <span class="nn">.models</span> <span class="kn">import</span> <span class="n">Board</span><span class="p">,</span> <span class="n">Post</span>

<span class="nd">@login_required</span>
<span class="k">def</span> <span class="nf">new_topic</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">pk</span><span class="p">):</span>
    <span class="n">board</span> <span class="o">=</span> <span class="n">get_object_or_404</span><span class="p">(</span><span class="n">Board</span><span class="p">,</span> <span class="n">pk</span><span class="o">=</span><span class="n">pk</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">method</span> <span class="o">==</span> <span class="s">'POST'</span><span class="p">:</span>
        <span class="n">form</span> <span class="o">=</span> <span class="n">NewTopicForm</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">POST</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">form</span><span class="o">.</span><span class="n">is_valid</span><span class="p">():</span>
            <span class="n">topic</span> <span class="o">=</span> <span class="n">form</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">commit</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
            <span class="n">topic</span><span class="o">.</span><span class="n">board</span> <span class="o">=</span> <span class="n">board</span>
            <span class="n">topic</span><span class="o">.</span><span class="n">starter</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">user</span>  <span class="c"># &lt;- here</span>
            <span class="n">topic</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
            <span class="n">Post</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">create</span><span class="p">(</span>
                <span class="n">message</span><span class="o">=</span><span class="n">form</span><span class="o">.</span><span class="n">cleaned_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">'message'</span><span class="p">),</span>
                <span class="n">topic</span><span class="o">=</span><span class="n">topic</span><span class="p">,</span>
                <span class="n">created_by</span><span class="o">=</span><span class="n">request</span><span class="o">.</span><span class="n">user</span>  <span class="c"># &lt;- and here</span>
            <span class="p">)</span>
            <span class="k">return</span> <span class="n">redirect</span><span class="p">(</span><span class="s">'board_topics'</span><span class="p">,</span> <span class="n">pk</span><span class="o">=</span><span class="n">board</span><span class="o">.</span><span class="n">pk</span><span class="p">)</span>  <span class="c"># TODO: redirect to the created topic page</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">form</span> <span class="o">=</span> <span class="n">NewTopicForm</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">render</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s">'new_topic.html'</span><span class="p">,</span> <span class="p">{</span><span class="s">'board'</span><span class="p">:</span> <span class="n">board</span><span class="p">,</span> <span class="s">'form'</span><span class="p">:</span> <span class="n">form</span><span class="p">})</span></code></pre></figure>

<p>We can do a quick test here by adding a new topic:</p>

<p><img src="../../../../media/series/beginners-guide/1.11/part-5/topics-2.png" alt="New topic" /></p>

<hr />

<h4 id="topic-posts-view">Topic Posts View</h4>

<p>Let’s take the time now to implement the posts listing page, accordingly to the wireframe below:</p>

<p><img src="../../../../media/series/beginners-guide/1.11/part-5/wireframe-posts.png" alt="Wireframe Posts" /></p>

<p>First, we need a route:</p>

<p><strong>myproject/urls.py</strong>
<small><a href="https://gist.github.com/vitorfs/aede6d3b7dc3494cf0df48f796075403#file-urls-py-L38" target="_blank" rel="noopener nofollow">(view complete file contents)</a></small></p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">url</span><span class="p">(</span><span class="s">r'^boards/(?P&lt;pk&gt;</span><span class="err">\</span><span class="s">d+)/topics/(?P&lt;topic_pk&gt;</span><span class="err">\</span><span class="s">d+)/$'</span><span class="p">,</span> <span class="n">views</span><span class="o">.</span><span class="n">topic_posts</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s">'topic_posts'</span><span class="p">),</span></code></pre></figure>

<p>Observe that now we are dealing with two keyword arguments: <code class="highlighter-rouge">pk</code> which is used to identify the Board, and now we have
the <code class="highlighter-rouge">topic_pk</code> which is used to identify which topic to retrieve from the database.</p>

<p>The matching view would be like this:</p>

<p><strong>boards/views.py</strong>
<small><a href="https://gist.github.com/vitorfs/3d73ef25a01eceea07ef3ad8538437cf#file-views-py-L39" target="_blank" rel="noopener nofollow">(view complete file contents)</a></small></p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="kn">from</span> <span class="nn">django.shortcuts</span> <span class="kn">import</span> <span class="n">get_object_or_404</span><span class="p">,</span> <span class="n">render</span>
<span class="kn">from</span> <span class="nn">.models</span> <span class="kn">import</span> <span class="n">Topic</span>

<span class="k">def</span> <span class="nf">topic_posts</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">pk</span><span class="p">,</span> <span class="n">topic_pk</span><span class="p">):</span>
    <span class="n">topic</span> <span class="o">=</span> <span class="n">get_object_or_404</span><span class="p">(</span><span class="n">Topic</span><span class="p">,</span> <span class="n">board__pk</span><span class="o">=</span><span class="n">pk</span><span class="p">,</span> <span class="n">pk</span><span class="o">=</span><span class="n">topic_pk</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">render</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s">'topic_posts.html'</span><span class="p">,</span> <span class="p">{</span><span class="s">'topic'</span><span class="p">:</span> <span class="n">topic</span><span class="p">})</span></code></pre></figure>

<p>Note that we are indirectly retrieving the current board. Remember that the topic model is related to the board model,
so we can access the current board. You will see in the next snippet:</p>

<p><strong>templates/topic_posts.html</strong>
<small><a href="https://gist.github.com/vitorfs/17e583f4f0068850c5929bd307dd436a" target="_blank" rel="noopener nofollow">(view complete file contents)</a></small></p>

<figure class="highlight"><pre><code class="language-django" data-lang="django"><span class="cp">{%</span> <span class="k">extends</span> <span class="s1">'base.html'</span> <span class="cp">%}</span>

<span class="cp">{%</span> <span class="k">block</span> <span class="nv">title</span> <span class="cp">%}{{</span> <span class="nv">topic.subject</span> <span class="cp">}}{%</span> <span class="k">endblock</span> <span class="cp">%}</span>

<span class="cp">{%</span> <span class="k">block</span> <span class="nv">breadcrumb</span> <span class="cp">%}</span>
  <span class="nt">&lt;li</span> <span class="na">class=</span><span class="s">"breadcrumb-item"</span><span class="nt">&gt;&lt;a</span> <span class="na">href=</span><span class="s">"</span><span class="cp">{%</span> <span class="nv">url</span> <span class="s1">'home'</span> <span class="cp">%}</span><span class="s">"</span><span class="nt">&gt;</span>Boards<span class="nt">&lt;/a&gt;&lt;/li&gt;</span>
  <span class="nt">&lt;li</span> <span class="na">class=</span><span class="s">"breadcrumb-item"</span><span class="nt">&gt;&lt;a</span> <span class="na">href=</span><span class="s">"</span><span class="cp">{%</span> <span class="nv">url</span> <span class="s1">'board_topics'</span> <span class="nv">topic.board.pk</span> <span class="cp">%}</span><span class="s">"</span><span class="nt">&gt;</span><span class="cp">{{</span> <span class="nv">topic.board.name</span> <span class="cp">}}</span><span class="nt">&lt;/a&gt;&lt;/li&gt;</span>
  <span class="nt">&lt;li</span> <span class="na">class=</span><span class="s">"breadcrumb-item active"</span><span class="nt">&gt;</span><span class="cp">{{</span> <span class="nv">topic.subject</span> <span class="cp">}}</span><span class="nt">&lt;/li&gt;</span>
<span class="cp">{%</span> <span class="k">endblock</span> <span class="cp">%}</span>

<span class="cp">{%</span> <span class="k">block</span> <span class="nv">content</span> <span class="cp">%}</span>

<span class="cp">{%</span> <span class="k">endblock</span> <span class="cp">%}</span></code></pre></figure>

<p>Observe that now instead of using <code class="highlighter-rouge">board.name</code> in the template, we are navigating through the topic properties, using
<code class="highlighter-rouge">topic.board.name</code>.</p>

<p><img src="../../../../media/series/beginners-guide/1.11/part-5/posts-1.png" alt="Posts" /></p>

<p>Now let’s create a new test file for the <strong>topic_posts</strong> view:</p>

<p><strong>boards/tests/test_view_topic_posts.py</strong></p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="kn">from</span> <span class="nn">django.contrib.auth.models</span> <span class="kn">import</span> <span class="n">User</span>
<span class="kn">from</span> <span class="nn">django.test</span> <span class="kn">import</span> <span class="n">TestCase</span>
<span class="kn">from</span> <span class="nn">django.urls</span> <span class="kn">import</span> <span class="n">resolve</span><span class="p">,</span> <span class="n">reverse</span>

<span class="kn">from</span> <span class="nn">..models</span> <span class="kn">import</span> <span class="n">Board</span><span class="p">,</span> <span class="n">Post</span><span class="p">,</span> <span class="n">Topic</span>
<span class="kn">from</span> <span class="nn">..views</span> <span class="kn">import</span> <span class="n">topic_posts</span>


<span class="k">class</span> <span class="nc">TopicPostsTests</span><span class="p">(</span><span class="n">TestCase</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">setUp</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">board</span> <span class="o">=</span> <span class="n">Board</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s">'Django'</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="s">'Django board.'</span><span class="p">)</span>
        <span class="n">user</span> <span class="o">=</span> <span class="n">User</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">create_user</span><span class="p">(</span><span class="n">username</span><span class="o">=</span><span class="s">'john'</span><span class="p">,</span> <span class="n">email</span><span class="o">=</span><span class="s">'john@doe.com'</span><span class="p">,</span> <span class="n">password</span><span class="o">=</span><span class="s">'123'</span><span class="p">)</span>
        <span class="n">topic</span> <span class="o">=</span> <span class="n">Topic</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">subject</span><span class="o">=</span><span class="s">'Hello, world'</span><span class="p">,</span> <span class="n">board</span><span class="o">=</span><span class="n">board</span><span class="p">,</span> <span class="n">starter</span><span class="o">=</span><span class="n">user</span><span class="p">)</span>
        <span class="n">Post</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">message</span><span class="o">=</span><span class="s">'Lorem ipsum dolor sit amet'</span><span class="p">,</span> <span class="n">topic</span><span class="o">=</span><span class="n">topic</span><span class="p">,</span> <span class="n">created_by</span><span class="o">=</span><span class="n">user</span><span class="p">)</span>
        <span class="n">url</span> <span class="o">=</span> <span class="n">reverse</span><span class="p">(</span><span class="s">'topic_posts'</span><span class="p">,</span> <span class="n">kwargs</span><span class="o">=</span><span class="p">{</span><span class="s">'pk'</span><span class="p">:</span> <span class="n">board</span><span class="o">.</span><span class="n">pk</span><span class="p">,</span> <span class="s">'topic_pk'</span><span class="p">:</span> <span class="n">topic</span><span class="o">.</span><span class="n">pk</span><span class="p">})</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">test_status_code</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">response</span><span class="o">.</span><span class="n">status_code</span><span class="p">,</span> <span class="mi">200</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">test_view_function</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">view</span> <span class="o">=</span> <span class="n">resolve</span><span class="p">(</span><span class="s">'/boards/1/topics/1/'</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">view</span><span class="o">.</span><span class="n">func</span><span class="p">,</span> <span class="n">topic_posts</span><span class="p">)</span></code></pre></figure>

<p>Note that the test setup is starting to get more complex. We can create mixins or an abstract class to reuse the code
as needed. We can also use a third party library to setup some test data, to reduce the boilerplate code.</p>

<p>Also, by now we already have a significant amount of tests, and it’s gradually starting to run slower. We can instruct
the test suite just to run tests from a given app:</p>

<figure class="highlight"><pre><code class="language-text" data-lang="text">python manage.py test boards</code></pre></figure>

<figure class="highlight"><pre><code class="language-text" data-lang="text">Creating test database for alias 'default'...
System check identified no issues (0 silenced).
.......................
----------------------------------------------------------------------
Ran 23 tests in 1.246s

OK
Destroying test database for alias 'default'...</code></pre></figure>

<p>We could also run only a specific test file:</p>

<figure class="highlight"><pre><code class="language-text" data-lang="text">python manage.py test boards.tests.test_view_topic_posts</code></pre></figure>

<figure class="highlight"><pre><code class="language-text" data-lang="text">Creating test database for alias 'default'...
System check identified no issues (0 silenced).
..
----------------------------------------------------------------------
Ran 2 tests in 0.129s

OK
Destroying test database for alias 'default'...</code></pre></figure>

<p>Or just a specific test case:</p>

<figure class="highlight"><pre><code class="language-text" data-lang="text">python manage.py test boards.tests.test_view_topic_posts.TopicPostsTests.test_status_code</code></pre></figure>

<figure class="highlight"><pre><code class="language-text" data-lang="text">Creating test database for alias 'default'...
System check identified no issues (0 silenced).
.
----------------------------------------------------------------------
Ran 1 test in 0.100s

OK
Destroying test database for alias 'default'...</code></pre></figure>

<p>Cool, right?</p>

<p>Let’s keep moving forward.</p>

<p>Inside the <strong>topic_posts.html</strong>, we can create a for loop iterating over the topic posts:</p>

<p><strong>templates/topic_posts.html</strong></p>

<figure class="highlight"><pre><code class="language-django" data-lang="django"><span class="cp">{%</span> <span class="k">extends</span> <span class="s1">'base.html'</span> <span class="cp">%}</span>

<span class="cp">{%</span> <span class="nv">load</span> <span class="nv">static</span> <span class="cp">%}</span>

<span class="cp">{%</span> <span class="k">block</span> <span class="nv">title</span> <span class="cp">%}{{</span> <span class="nv">topic.subject</span> <span class="cp">}}{%</span> <span class="k">endblock</span> <span class="cp">%}</span>

<span class="cp">{%</span> <span class="k">block</span> <span class="nv">breadcrumb</span> <span class="cp">%}</span>
  <span class="nt">&lt;li</span> <span class="na">class=</span><span class="s">"breadcrumb-item"</span><span class="nt">&gt;&lt;a</span> <span class="na">href=</span><span class="s">"</span><span class="cp">{%</span> <span class="nv">url</span> <span class="s1">'home'</span> <span class="cp">%}</span><span class="s">"</span><span class="nt">&gt;</span>Boards<span class="nt">&lt;/a&gt;&lt;/li&gt;</span>
  <span class="nt">&lt;li</span> <span class="na">class=</span><span class="s">"breadcrumb-item"</span><span class="nt">&gt;&lt;a</span> <span class="na">href=</span><span class="s">"</span><span class="cp">{%</span> <span class="nv">url</span> <span class="s1">'board_topics'</span> <span class="nv">topic.board.pk</span> <span class="cp">%}</span><span class="s">"</span><span class="nt">&gt;</span><span class="cp">{{</span> <span class="nv">topic.board.name</span> <span class="cp">}}</span><span class="nt">&lt;/a&gt;&lt;/li&gt;</span>
  <span class="nt">&lt;li</span> <span class="na">class=</span><span class="s">"breadcrumb-item active"</span><span class="nt">&gt;</span><span class="cp">{{</span> <span class="nv">topic.subject</span> <span class="cp">}}</span><span class="nt">&lt;/li&gt;</span>
<span class="cp">{%</span> <span class="k">endblock</span> <span class="cp">%}</span>

<span class="cp">{%</span> <span class="k">block</span> <span class="nv">content</span> <span class="cp">%}</span>

  <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"mb-4"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">"#"</span> <span class="na">class=</span><span class="s">"btn btn-primary"</span> <span class="na">role=</span><span class="s">"button"</span><span class="nt">&gt;</span>Reply<span class="nt">&lt;/a&gt;</span>
  <span class="nt">&lt;/div&gt;</span>

  <span class="cp">{%</span> <span class="k">for</span> <span class="nv">post</span> <span class="ow">in</span> <span class="nv">topic.posts.all</span> <span class="cp">%}</span>
    <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"card mb-2"</span><span class="nt">&gt;</span>
      <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"card-body p-3"</span><span class="nt">&gt;</span>
        <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"row"</span><span class="nt">&gt;</span>
          <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"col-2"</span><span class="nt">&gt;</span>
            <span class="nt">&lt;img</span> <span class="na">src=</span><span class="s">"</span><span class="cp">{%</span> <span class="nv">static</span> <span class="s1">'img/avatar.svg'</span> <span class="cp">%}</span><span class="s">"</span> <span class="na">alt=</span><span class="s">"</span><span class="cp">{{</span> <span class="nv">post.created_by.username</span> <span class="cp">}}</span><span class="s">"</span> <span class="na">class=</span><span class="s">"w-100"</span><span class="nt">&gt;</span>
            <span class="nt">&lt;small&gt;</span>Posts: <span class="cp">{{</span> <span class="nv">post.created_by.posts.count</span> <span class="cp">}}</span><span class="nt">&lt;/small&gt;</span>
          <span class="nt">&lt;/div&gt;</span>
          <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"col-10"</span><span class="nt">&gt;</span>
            <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"row mb-3"</span><span class="nt">&gt;</span>
              <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"col-6"</span><span class="nt">&gt;</span>
                <span class="nt">&lt;strong</span> <span class="na">class=</span><span class="s">"text-muted"</span><span class="nt">&gt;</span><span class="cp">{{</span> <span class="nv">post.created_by.username</span> <span class="cp">}}</span><span class="nt">&lt;/strong&gt;</span>
              <span class="nt">&lt;/div&gt;</span>
              <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"col-6 text-right"</span><span class="nt">&gt;</span>
                <span class="nt">&lt;small</span> <span class="na">class=</span><span class="s">"text-muted"</span><span class="nt">&gt;</span><span class="cp">{{</span> <span class="nv">post.created_at</span> <span class="cp">}}</span><span class="nt">&lt;/small&gt;</span>
              <span class="nt">&lt;/div&gt;</span>
            <span class="nt">&lt;/div&gt;</span>
            <span class="cp">{{</span> <span class="nv">post.message</span> <span class="cp">}}</span>
            <span class="cp">{%</span> <span class="k">if</span> <span class="nv">post.created_by</span> <span class="o">==</span> <span class="nv">user</span> <span class="cp">%}</span>
              <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"mt-3"</span><span class="nt">&gt;</span>
                <span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">"#"</span> <span class="na">class=</span><span class="s">"btn btn-primary btn-sm"</span> <span class="na">role=</span><span class="s">"button"</span><span class="nt">&gt;</span>Edit<span class="nt">&lt;/a&gt;</span>
              <span class="nt">&lt;/div&gt;</span>
            <span class="cp">{%</span> <span class="k">endif</span> <span class="cp">%}</span>
          <span class="nt">&lt;/div&gt;</span>
        <span class="nt">&lt;/div&gt;</span>
      <span class="nt">&lt;/div&gt;</span>
    <span class="nt">&lt;/div&gt;</span>
  <span class="cp">{%</span> <span class="k">endfor</span> <span class="cp">%}</span>

<span class="cp">{%</span> <span class="k">endblock</span> <span class="cp">%}</span></code></pre></figure>

<p><img src="../../../../media/series/beginners-guide/1.11/part-5/posts-2.png" alt="Posts" /></p>

<p>Since right now we don’t have a way to upload a user picture, let’s just have an empty image.</p>

<p>I downloaded a free image from <a href="https://www.iconfinder.com/search/?q=user&amp;license=2&amp;price=free" target="_blank" rel="noopener">IconFinder</a>
and saved in the <strong>static/img</strong> folder of the project.</p>

<p>We still haven’t really explored Django’s ORM, but the code <code class="highlighter-rouge"><span class="p">{</span><span class="err">{</span><span class="w"> </span><span class="err">post.created_by.posts.count</span><span class="w"> </span><span class="p">}</span><span class="err">}</span></code>
is executing a <code class="highlighter-rouge">select count</code> in the database. Even though the result is correct, it is a bad approach. Right now it’s
causing several unnecessary queries in the database. But hey, don’t worry about that right now. Let’s focus on how
we interact with the application. Later on, we are going to improve this code, and how to diagnose heavy queries.</p>

<p>Another interesting point here is that we are testing if the current post belongs to the authenticated user:
<code class="highlighter-rouge"><span class="p">{</span><span class="err">%</span><span class="w"> </span><span class="err">if</span><span class="w"> </span><span class="err">post.created_by</span><span class="w"> </span><span class="err">==</span><span class="w"> </span><span class="err">user</span><span class="w"> </span><span class="err">%</span><span class="p">}</span></code>. And we are only showing the edit button for the owner of the
post.</p>

<p>Since we now have the URL route to the topic posts listing, update the <strong>topics.html</strong> template with the link:</p>

<p><strong>templates/topics.html</strong>
<small><a href="https://gist.github.com/vitorfs/cb4b7c9ff382ddeafb4114d0c84b3869" target="_blank" rel="noopener nofollow">(view complete file contents)</a></small></p>

<figure class="highlight"><pre><code class="language-django" data-lang="django"><span class="cp">{%</span> <span class="k">for</span> <span class="nv">topic</span> <span class="ow">in</span> <span class="nv">board.topics.all</span> <span class="cp">%}</span>
  <span class="nt">&lt;tr&gt;</span>
    <span class="nt">&lt;td&gt;&lt;a</span> <span class="na">href=</span><span class="s">"</span><span class="cp">{%</span> <span class="nv">url</span> <span class="s1">'topic_posts'</span> <span class="nv">board.pk</span> <span class="nv">topic.pk</span> <span class="cp">%}</span><span class="s">"</span><span class="nt">&gt;</span><span class="cp">{{</span> <span class="nv">topic.subject</span> <span class="cp">}}</span><span class="nt">&lt;/a&gt;&lt;/td&gt;</span>
    <span class="nt">&lt;td&gt;</span><span class="cp">{{</span> <span class="nv">topic.starter.username</span> <span class="cp">}}</span><span class="nt">&lt;/td&gt;</span>
    <span class="nt">&lt;td&gt;</span>0<span class="nt">&lt;/td&gt;</span>
    <span class="nt">&lt;td&gt;</span>0<span class="nt">&lt;/td&gt;</span>
    <span class="nt">&lt;td&gt;</span><span class="cp">{{</span> <span class="nv">topic.last_updated</span> <span class="cp">}}</span><span class="nt">&lt;/td&gt;</span>
  <span class="nt">&lt;/tr&gt;</span>
<span class="cp">{%</span> <span class="k">endfor</span> <span class="cp">%}</span></code></pre></figure>

<hr />

<h4 id="reply-post-view">Reply Post View</h4>

<p>Let’s implement now the reply post view so that we can add more data and progress with the implementation and tests.</p>

<p><img src="../../../../media/series/beginners-guide/1.11/part-5/wireframe-reply.png" alt="Reply Wireframes" /></p>

<p>New URL route:</p>

<p><strong>myproject/urls.py</strong>
<small><a href="https://gist.github.com/vitorfs/71a5f9f39202edfbab9bacf11844548b#file-urls-py-L39" target="_blank" rel="noopener nofollow">(view complete file contents)</a></small></p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">url</span><span class="p">(</span><span class="s">r'^boards/(?P&lt;pk&gt;</span><span class="err">\</span><span class="s">d+)/topics/(?P&lt;topic_pk&gt;</span><span class="err">\</span><span class="s">d+)/reply/$'</span><span class="p">,</span> <span class="n">views</span><span class="o">.</span><span class="n">reply_topic</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s">'reply_topic'</span><span class="p">),</span></code></pre></figure>

<p>Create a new form for the post reply:</p>

<p><strong>boards/forms.py</strong>
<small><a href="https://gist.github.com/vitorfs/3dd5ed2b3e27b4c12886e9426acf8fda#file-forms-py-L20" target="_blank" rel="noopener nofollow">(view complete file contents)</a></small></p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="kn">from</span> <span class="nn">django</span> <span class="kn">import</span> <span class="n">forms</span>
<span class="kn">from</span> <span class="nn">.models</span> <span class="kn">import</span> <span class="n">Post</span>

<span class="k">class</span> <span class="nc">PostForm</span><span class="p">(</span><span class="n">forms</span><span class="o">.</span><span class="n">ModelForm</span><span class="p">):</span>
    <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
        <span class="n">model</span> <span class="o">=</span> <span class="n">Post</span>
        <span class="n">fields</span> <span class="o">=</span> <span class="p">[</span><span class="s">'message'</span><span class="p">,</span> <span class="p">]</span></code></pre></figure>

<p>A new view protected by <code class="highlighter-rouge">@login_required</code> and with a simple form processing logic:</p>

<p><strong>boards/views.py</strong>
<small><a href="https://gist.github.com/vitorfs/9e3811d9b11958b4106d99d9243efa71#file-views-py-L45" target="_blank" rel="noopener nofollow">(view complete file contents)</a></small></p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="kn">from</span> <span class="nn">django.contrib.auth.decorators</span> <span class="kn">import</span> <span class="n">login_required</span>
<span class="kn">from</span> <span class="nn">django.shortcuts</span> <span class="kn">import</span> <span class="n">get_object_or_404</span><span class="p">,</span> <span class="n">redirect</span><span class="p">,</span> <span class="n">render</span>
<span class="kn">from</span> <span class="nn">.forms</span> <span class="kn">import</span> <span class="n">PostForm</span>
<span class="kn">from</span> <span class="nn">.models</span> <span class="kn">import</span> <span class="n">Topic</span>

<span class="nd">@login_required</span>
<span class="k">def</span> <span class="nf">reply_topic</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">pk</span><span class="p">,</span> <span class="n">topic_pk</span><span class="p">):</span>
    <span class="n">topic</span> <span class="o">=</span> <span class="n">get_object_or_404</span><span class="p">(</span><span class="n">Topic</span><span class="p">,</span> <span class="n">board__pk</span><span class="o">=</span><span class="n">pk</span><span class="p">,</span> <span class="n">pk</span><span class="o">=</span><span class="n">topic_pk</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">method</span> <span class="o">==</span> <span class="s">'POST'</span><span class="p">:</span>
        <span class="n">form</span> <span class="o">=</span> <span class="n">PostForm</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">POST</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">form</span><span class="o">.</span><span class="n">is_valid</span><span class="p">():</span>
            <span class="n">post</span> <span class="o">=</span> <span class="n">form</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">commit</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
            <span class="n">post</span><span class="o">.</span><span class="n">topic</span> <span class="o">=</span> <span class="n">topic</span>
            <span class="n">post</span><span class="o">.</span><span class="n">created_by</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">user</span>
            <span class="n">post</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
            <span class="k">return</span> <span class="n">redirect</span><span class="p">(</span><span class="s">'topic_posts'</span><span class="p">,</span> <span class="n">pk</span><span class="o">=</span><span class="n">pk</span><span class="p">,</span> <span class="n">topic_pk</span><span class="o">=</span><span class="n">topic_pk</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">form</span> <span class="o">=</span> <span class="n">PostForm</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">render</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s">'reply_topic.html'</span><span class="p">,</span> <span class="p">{</span><span class="s">'topic'</span><span class="p">:</span> <span class="n">topic</span><span class="p">,</span> <span class="s">'form'</span><span class="p">:</span> <span class="n">form</span><span class="p">})</span></code></pre></figure>

<p>Also take the time to update the return redirect of the <strong>new_topic</strong> view function (marked with the comment
<strong># TODO</strong>).</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="nd">@login_required</span>
<span class="k">def</span> <span class="nf">new_topic</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">pk</span><span class="p">):</span>
    <span class="n">board</span> <span class="o">=</span> <span class="n">get_object_or_404</span><span class="p">(</span><span class="n">Board</span><span class="p">,</span> <span class="n">pk</span><span class="o">=</span><span class="n">pk</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">method</span> <span class="o">==</span> <span class="s">'POST'</span><span class="p">:</span>
        <span class="n">form</span> <span class="o">=</span> <span class="n">NewTopicForm</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">POST</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">form</span><span class="o">.</span><span class="n">is_valid</span><span class="p">():</span>
            <span class="n">topic</span> <span class="o">=</span> <span class="n">form</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">commit</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
            <span class="c"># code suppressed ...</span>
            <span class="k">return</span> <span class="n">redirect</span><span class="p">(</span><span class="s">'topic_posts'</span><span class="p">,</span> <span class="n">pk</span><span class="o">=</span><span class="n">pk</span><span class="p">,</span> <span class="n">topic_pk</span><span class="o">=</span><span class="n">topic</span><span class="o">.</span><span class="n">pk</span><span class="p">)</span>  <span class="c"># &lt;- here</span>
    <span class="c"># code suppressed ...</span></code></pre></figure>

<p>Very important: in the view <strong>reply_topic</strong> we are using <code class="highlighter-rouge">topic_pk</code> because we are referring to the keyword argument
of the function, in the view <strong>new_topic</strong> we are using <code class="highlighter-rouge">topic.pk</code> because a <code class="highlighter-rouge">topic</code> is an object (Topic model
instance) and <code class="highlighter-rouge">.pk</code> we are accessing the <code class="highlighter-rouge">pk</code> property of the Topic model instance. Small detail, big difference.</p>

<p>The first version of our template:</p>

<p><strong>templates/reply_topic.html</strong></p>

<figure class="highlight"><pre><code class="language-django" data-lang="django"><span class="cp">{%</span> <span class="k">extends</span> <span class="s1">'base.html'</span> <span class="cp">%}</span>

<span class="cp">{%</span> <span class="nv">load</span> <span class="nv">static</span> <span class="cp">%}</span>

<span class="cp">{%</span> <span class="k">block</span> <span class="nv">title</span> <span class="cp">%}</span>Post a reply<span class="cp">{%</span> <span class="k">endblock</span> <span class="cp">%}</span>

<span class="cp">{%</span> <span class="k">block</span> <span class="nv">breadcrumb</span> <span class="cp">%}</span>
  <span class="nt">&lt;li</span> <span class="na">class=</span><span class="s">"breadcrumb-item"</span><span class="nt">&gt;&lt;a</span> <span class="na">href=</span><span class="s">"</span><span class="cp">{%</span> <span class="nv">url</span> <span class="s1">'home'</span> <span class="cp">%}</span><span class="s">"</span><span class="nt">&gt;</span>Boards<span class="nt">&lt;/a&gt;&lt;/li&gt;</span>
  <span class="nt">&lt;li</span> <span class="na">class=</span><span class="s">"breadcrumb-item"</span><span class="nt">&gt;&lt;a</span> <span class="na">href=</span><span class="s">"</span><span class="cp">{%</span> <span class="nv">url</span> <span class="s1">'board_topics'</span> <span class="nv">topic.board.pk</span> <span class="cp">%}</span><span class="s">"</span><span class="nt">&gt;</span><span class="cp">{{</span> <span class="nv">topic.board.name</span> <span class="cp">}}</span><span class="nt">&lt;/a&gt;&lt;/li&gt;</span>
  <span class="nt">&lt;li</span> <span class="na">class=</span><span class="s">"breadcrumb-item"</span><span class="nt">&gt;&lt;a</span> <span class="na">href=</span><span class="s">"</span><span class="cp">{%</span> <span class="nv">url</span> <span class="s1">'topic_posts'</span> <span class="nv">topic.board.pk</span> <span class="nv">topic.pk</span> <span class="cp">%}</span><span class="s">"</span><span class="nt">&gt;</span><span class="cp">{{</span> <span class="nv">topic.subject</span> <span class="cp">}}</span><span class="nt">&lt;/a&gt;&lt;/li&gt;</span>
  <span class="nt">&lt;li</span> <span class="na">class=</span><span class="s">"breadcrumb-item active"</span><span class="nt">&gt;</span>Post a reply<span class="nt">&lt;/li&gt;</span>
<span class="cp">{%</span> <span class="k">endblock</span> <span class="cp">%}</span>

<span class="cp">{%</span> <span class="k">block</span> <span class="nv">content</span> <span class="cp">%}</span>

  <span class="nt">&lt;form</span> <span class="na">method=</span><span class="s">"post"</span> <span class="na">class=</span><span class="s">"mb-4"</span><span class="nt">&gt;</span>
    <span class="cp">{%</span> <span class="nv">csrf_token</span> <span class="cp">%}</span>
    <span class="cp">{%</span> <span class="k">include</span> <span class="s1">'includes/form.html'</span> <span class="cp">%}</span>
    <span class="nt">&lt;button</span> <span class="na">type=</span><span class="s">"submit"</span> <span class="na">class=</span><span class="s">"btn btn-success"</span><span class="nt">&gt;</span>Post a reply<span class="nt">&lt;/button&gt;</span>
  <span class="nt">&lt;/form&gt;</span>

  <span class="cp">{%</span> <span class="k">for</span> <span class="nv">post</span> <span class="ow">in</span> <span class="nv">topic.posts.all</span> <span class="cp">%}</span>
    <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"card mb-2"</span><span class="nt">&gt;</span>
      <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"card-body p-3"</span><span class="nt">&gt;</span>
        <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"row mb-3"</span><span class="nt">&gt;</span>
          <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"col-6"</span><span class="nt">&gt;</span>
            <span class="nt">&lt;strong</span> <span class="na">class=</span><span class="s">"text-muted"</span><span class="nt">&gt;</span><span class="cp">{{</span> <span class="nv">post.created_by.username</span> <span class="cp">}}</span><span class="nt">&lt;/strong&gt;</span>
          <span class="nt">&lt;/div&gt;</span>
          <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"col-6 text-right"</span><span class="nt">&gt;</span>
            <span class="nt">&lt;small</span> <span class="na">class=</span><span class="s">"text-muted"</span><span class="nt">&gt;</span><span class="cp">{{</span> <span class="nv">post.created_at</span> <span class="cp">}}</span><span class="nt">&lt;/small&gt;</span>
          <span class="nt">&lt;/div&gt;</span>
        <span class="nt">&lt;/div&gt;</span>
        <span class="cp">{{</span> <span class="nv">post.message</span> <span class="cp">}}</span>
      <span class="nt">&lt;/div&gt;</span>
    <span class="nt">&lt;/div&gt;</span>
  <span class="cp">{%</span> <span class="k">endfor</span> <span class="cp">%}</span>

<span class="cp">{%</span> <span class="k">endblock</span> <span class="cp">%}</span></code></pre></figure>

<p><img src="../../../../media/series/beginners-guide/1.11/part-5/reply.png" alt="Reply form" /></p>

<p>Then after posting a reply, the user is redirected back to the topic posts:</p>

<p><img src="../../../../media/series/beginners-guide/1.11/part-5/posts-3.png" alt="Topic posts" /></p>

<p>We could now change the starter post, so to give it more emphasis in the page:</p>

<p><strong>templates/topic_posts.html</strong>
<small><a href="https://gist.github.com/vitorfs/3e4ad94ac3ae9d72194af4006d4aeaff#file-topic_posts-html-L20" target="_blank" rel="noopener nofollow">(view complete file contents)</a></small></p>

<figure class="highlight"><pre><code class="language-django" data-lang="django"><span class="cp">{%</span> <span class="k">for</span> <span class="nv">post</span> <span class="ow">in</span> <span class="nv">topic.posts.all</span> <span class="cp">%}</span>
  <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"card mb-2 </span><span class="cp">{%</span> <span class="k">if</span> <span class="nv">forloop.first</span> <span class="cp">%}</span><span class="s">border-dark</span><span class="cp">{%</span> <span class="k">endif</span> <span class="cp">%}</span><span class="s">"</span><span class="nt">&gt;</span>
    <span class="cp">{%</span> <span class="k">if</span> <span class="nv">forloop.first</span> <span class="cp">%}</span>
      <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"card-header text-white bg-dark py-2 px-3"</span><span class="nt">&gt;</span><span class="cp">{{</span> <span class="nv">topic.subject</span> <span class="cp">}}</span><span class="nt">&lt;/div&gt;</span>
    <span class="cp">{%</span> <span class="k">endif</span> <span class="cp">%}</span>
    <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"card-body p-3"</span><span class="nt">&gt;</span>
      <span class="c">&lt;!-- code suppressed --&gt;</span>
    <span class="nt">&lt;/div&gt;</span>
  <span class="nt">&lt;/div&gt;</span>
<span class="cp">{%</span> <span class="k">endfor</span> <span class="cp">%}</span></code></pre></figure>

<p><img src="../../../../media/series/beginners-guide/1.11/part-5/posts-4.png" alt="Topic posts" /></p>

<p>Now for the tests, pretty standard, just like we have been doing so far. Create a new file <strong>test_view_reply_topic.py</strong>
inside the <strong>boards/tests</strong> folder:</p>

<p><strong>boards/tests/test_view_reply_topic.py</strong>
<small><a href="https://gist.github.com/vitorfs/7148fcb95075fb6641e638214b751cf1" target="_blank" rel="noopener nofollow">(view complete file contents)</a></small></p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="kn">from</span> <span class="nn">django.contrib.auth.models</span> <span class="kn">import</span> <span class="n">User</span>
<span class="kn">from</span> <span class="nn">django.test</span> <span class="kn">import</span> <span class="n">TestCase</span>
<span class="kn">from</span> <span class="nn">django.urls</span> <span class="kn">import</span> <span class="n">reverse</span>
<span class="kn">from</span> <span class="nn">..models</span> <span class="kn">import</span> <span class="n">Board</span><span class="p">,</span> <span class="n">Post</span><span class="p">,</span> <span class="n">Topic</span>
<span class="kn">from</span> <span class="nn">..views</span> <span class="kn">import</span> <span class="n">reply_topic</span>

<span class="k">class</span> <span class="nc">ReplyTopicTestCase</span><span class="p">(</span><span class="n">TestCase</span><span class="p">):</span>
    <span class="s">'''
    Base test case to be used in all `reply_topic` view tests
    '''</span>
    <span class="k">def</span> <span class="nf">setUp</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">board</span> <span class="o">=</span> <span class="n">Board</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s">'Django'</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="s">'Django board.'</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">username</span> <span class="o">=</span> <span class="s">'john'</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">password</span> <span class="o">=</span> <span class="s">'123'</span>
        <span class="n">user</span> <span class="o">=</span> <span class="n">User</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">create_user</span><span class="p">(</span><span class="n">username</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">username</span><span class="p">,</span> <span class="n">email</span><span class="o">=</span><span class="s">'john@doe.com'</span><span class="p">,</span> <span class="n">password</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">password</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">topic</span> <span class="o">=</span> <span class="n">Topic</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">subject</span><span class="o">=</span><span class="s">'Hello, world'</span><span class="p">,</span> <span class="n">board</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">board</span><span class="p">,</span> <span class="n">starter</span><span class="o">=</span><span class="n">user</span><span class="p">)</span>
        <span class="n">Post</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">message</span><span class="o">=</span><span class="s">'Lorem ipsum dolor sit amet'</span><span class="p">,</span> <span class="n">topic</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">topic</span><span class="p">,</span> <span class="n">created_by</span><span class="o">=</span><span class="n">user</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">url</span> <span class="o">=</span> <span class="n">reverse</span><span class="p">(</span><span class="s">'reply_topic'</span><span class="p">,</span> <span class="n">kwargs</span><span class="o">=</span><span class="p">{</span><span class="s">'pk'</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">board</span><span class="o">.</span><span class="n">pk</span><span class="p">,</span> <span class="s">'topic_pk'</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">topic</span><span class="o">.</span><span class="n">pk</span><span class="p">})</span>

<span class="k">class</span> <span class="nc">LoginRequiredReplyTopicTests</span><span class="p">(</span><span class="n">ReplyTopicTestCase</span><span class="p">):</span>
    <span class="c"># ...</span>

<span class="k">class</span> <span class="nc">ReplyTopicTests</span><span class="p">(</span><span class="n">ReplyTopicTestCase</span><span class="p">):</span>
    <span class="c"># ...</span>

<span class="k">class</span> <span class="nc">SuccessfulReplyTopicTests</span><span class="p">(</span><span class="n">ReplyTopicTestCase</span><span class="p">):</span>
    <span class="c"># ...</span>

<span class="k">class</span> <span class="nc">InvalidReplyTopicTests</span><span class="p">(</span><span class="n">ReplyTopicTestCase</span><span class="p">):</span>
    <span class="c"># ...</span></code></pre></figure>

<p>The essence here is the custom test case class <strong>ReplyTopicTestCase</strong>. Then all the four classes will extend this
test case.</p>

<p>First, we test if the view is protected with the <code class="highlighter-rouge">@login_required</code> decorator, then check the HTML inputs, status code.
Finally, we test a valid and an invalid form submission.</p>

<hr />

<h4 id="querysets">QuerySets</h4>

<p>Let’s take the time now to explore some of the models’ API functionalities a little bit. First, let’s improve the
home view:</p>

<p><img src="../../../../media/series/beginners-guide/1.11/part-5/boards-1.png" alt="Boards" /></p>

<p>We have three tasks here:</p>

<ul>
  <li>Display the posts count of the board;</li>
  <li>Display the topics count of the board;</li>
  <li>Display the last user who posted something and the date and time.</li>
</ul>

<p>Let’s play with the Python terminal first, before we jump into the implementation.</p>

<p>Since we are going to try things out in the Python terminal, it’s a good idea to define a <code class="highlighter-rouge">__str__</code> method for all
our models.</p>

<p><strong>boards/models.py</strong>
<small><a href="https://gist.github.com/vitorfs/9524eb42005697fbb79836285b50b1f4" target="_blank" rel="noopener nofollow">(view complete file contents)</a></small></p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="kn">from</span> <span class="nn">django.db</span> <span class="kn">import</span> <span class="n">models</span>
<span class="kn">from</span> <span class="nn">django.utils.text</span> <span class="kn">import</span> <span class="n">Truncator</span>

<span class="k">class</span> <span class="nc">Board</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="c"># ...</span>
    <span class="k">def</span> <span class="nf">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span>

<span class="k">class</span> <span class="nc">Topic</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="c"># ...</span>
    <span class="k">def</span> <span class="nf">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">subject</span>

<span class="k">class</span> <span class="nc">Post</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="c"># ...</span>
    <span class="k">def</span> <span class="nf">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">truncated_message</span> <span class="o">=</span> <span class="n">Truncator</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">message</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">truncated_message</span><span class="o">.</span><span class="n">chars</span><span class="p">(</span><span class="mi">30</span><span class="p">)</span></code></pre></figure>

<p>In the Post model we are using the <strong>Truncator</strong> utility class. It’s a convenient way to truncate long strings into
an arbitrary string size (here we are using 30).</p>

<p>Now let’s open the Python shell terminal:</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">python</span> <span class="n">manage</span><span class="o">.</span><span class="n">py</span> <span class="n">shell</span>

<span class="c"># First get a board instance from the database</span>
<span class="n">board</span> <span class="o">=</span> <span class="n">Board</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s">'Django'</span><span class="p">)</span></code></pre></figure>

<p>The easiest of the three tasks is to get the current topics count, because the Topic and Board are directly related:</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">board</span><span class="o">.</span><span class="n">topics</span><span class="o">.</span><span class="nb">all</span><span class="p">()</span>
<span class="o">&lt;</span><span class="n">QuerySet</span> <span class="p">[</span><span class="o">&lt;</span><span class="n">Topic</span><span class="p">:</span> <span class="n">Hello</span> <span class="n">everyone</span><span class="err">!</span><span class="o">&gt;</span><span class="p">,</span> <span class="o">&lt;</span><span class="n">Topic</span><span class="p">:</span> <span class="n">Test</span><span class="o">&gt;</span><span class="p">,</span> <span class="o">&lt;</span><span class="n">Topic</span><span class="p">:</span> <span class="n">Testing</span> <span class="n">a</span> <span class="n">new</span> <span class="n">post</span><span class="o">&gt;</span><span class="p">,</span> <span class="o">&lt;</span><span class="n">Topic</span><span class="p">:</span> <span class="n">Hi</span><span class="o">&gt;</span><span class="p">]</span><span class="o">&gt;</span>

<span class="n">board</span><span class="o">.</span><span class="n">topics</span><span class="o">.</span><span class="n">count</span><span class="p">()</span>
<span class="mi">4</span></code></pre></figure>

<p>That’s about it.</p>

<p>Now the number of <em>posts</em> within a <em>board</em> is a little bit trickier because Post is not directly related to Board.</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="kn">from</span> <span class="nn">boards.models</span> <span class="kn">import</span> <span class="n">Post</span>

<span class="n">Post</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="nb">all</span><span class="p">()</span>
<span class="o">&lt;</span><span class="n">QuerySet</span> <span class="p">[</span><span class="o">&lt;</span><span class="n">Post</span><span class="p">:</span> <span class="n">This</span> <span class="ow">is</span> <span class="n">my</span> <span class="n">first</span> <span class="n">topic</span><span class="o">..</span> <span class="p">:</span><span class="o">-</span><span class="p">)</span><span class="o">&gt;</span><span class="p">,</span> <span class="o">&lt;</span><span class="n">Post</span><span class="p">:</span> <span class="n">test</span><span class="o">.&gt;</span><span class="p">,</span> <span class="o">&lt;</span><span class="n">Post</span><span class="p">:</span> <span class="n">Hi</span> <span class="n">everyone</span><span class="err">!</span><span class="o">&gt;</span><span class="p">,</span>
  <span class="o">&lt;</span><span class="n">Post</span><span class="p">:</span> <span class="n">New</span> <span class="n">test</span> <span class="n">here</span><span class="err">!</span><span class="o">&gt;</span><span class="p">,</span> <span class="o">&lt;</span><span class="n">Post</span><span class="p">:</span> <span class="n">Testing</span> <span class="n">the</span> <span class="n">new</span> <span class="n">reply</span> <span class="n">feature</span><span class="err">!</span><span class="o">&gt;</span><span class="p">,</span> <span class="o">&lt;</span><span class="n">Post</span><span class="p">:</span> <span class="n">Lorem</span> <span class="n">ipsum</span> <span class="n">dolor</span> <span class="n">sit</span> <span class="n">amet</span><span class="p">,</span><span class="o">...&gt;</span><span class="p">,</span>
  <span class="o">&lt;</span><span class="n">Post</span><span class="p">:</span> <span class="n">hi</span> <span class="n">there</span><span class="o">&gt;</span><span class="p">,</span> <span class="o">&lt;</span><span class="n">Post</span><span class="p">:</span> <span class="n">test</span><span class="o">&gt;</span><span class="p">,</span> <span class="o">&lt;</span><span class="n">Post</span><span class="p">:</span> <span class="n">Testing</span><span class="o">..&gt;</span><span class="p">,</span> <span class="o">&lt;</span><span class="n">Post</span><span class="p">:</span> <span class="n">some</span> <span class="n">reply</span><span class="o">&gt;</span><span class="p">,</span> <span class="o">&lt;</span><span class="n">Post</span><span class="p">:</span> <span class="n">Random</span> <span class="n">random</span><span class="o">.&gt;</span>
<span class="p">]</span><span class="o">&gt;</span>

<span class="n">Post</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">count</span><span class="p">()</span>
<span class="mi">11</span></code></pre></figure>

<p>Here we have 11 posts. But not all of them belongs to the “Django” board.</p>

<p>Here is how we can filter it:</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="kn">from</span> <span class="nn">boards.models</span> <span class="kn">import</span> <span class="n">Board</span><span class="p">,</span> <span class="n">Post</span>

<span class="n">board</span> <span class="o">=</span> <span class="n">Board</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s">'Django'</span><span class="p">)</span>

<span class="n">Post</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="nb">filter</span><span class="p">(</span><span class="n">topic__board</span><span class="o">=</span><span class="n">board</span><span class="p">)</span>
<span class="o">&lt;</span><span class="n">QuerySet</span> <span class="p">[</span><span class="o">&lt;</span><span class="n">Post</span><span class="p">:</span> <span class="n">This</span> <span class="ow">is</span> <span class="n">my</span> <span class="n">first</span> <span class="n">topic</span><span class="o">..</span> <span class="p">:</span><span class="o">-</span><span class="p">)</span><span class="o">&gt;</span><span class="p">,</span> <span class="o">&lt;</span><span class="n">Post</span><span class="p">:</span> <span class="n">test</span><span class="o">.&gt;</span><span class="p">,</span> <span class="o">&lt;</span><span class="n">Post</span><span class="p">:</span> <span class="n">hi</span> <span class="n">there</span><span class="o">&gt;</span><span class="p">,</span>
  <span class="o">&lt;</span><span class="n">Post</span><span class="p">:</span> <span class="n">Hi</span> <span class="n">everyone</span><span class="err">!</span><span class="o">&gt;</span><span class="p">,</span> <span class="o">&lt;</span><span class="n">Post</span><span class="p">:</span> <span class="n">Lorem</span> <span class="n">ipsum</span> <span class="n">dolor</span> <span class="n">sit</span> <span class="n">amet</span><span class="p">,</span><span class="o">...&gt;</span><span class="p">,</span> <span class="o">&lt;</span><span class="n">Post</span><span class="p">:</span> <span class="n">New</span> <span class="n">test</span> <span class="n">here</span><span class="err">!</span><span class="o">&gt;</span><span class="p">,</span>
  <span class="o">&lt;</span><span class="n">Post</span><span class="p">:</span> <span class="n">Testing</span> <span class="n">the</span> <span class="n">new</span> <span class="n">reply</span> <span class="n">feature</span><span class="err">!</span><span class="o">&gt;</span>
<span class="p">]</span><span class="o">&gt;</span>

<span class="n">Post</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="nb">filter</span><span class="p">(</span><span class="n">topic__board</span><span class="o">=</span><span class="n">board</span><span class="p">)</span><span class="o">.</span><span class="n">count</span><span class="p">()</span>
<span class="mi">7</span></code></pre></figure>

<p>The double underscores <code class="highlighter-rouge">topic__board</code> is used to navigate through the models’ relationships. Under the hoods, Django
builds the bridge between the Board - Topic - Post, and build a SQL query to retrieve just the posts that belong to
a specific board.</p>

<p>Now our last mission is to identify the last post.</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="c"># order by the `created_at` field, getting the most recent first</span>
<span class="n">Post</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="nb">filter</span><span class="p">(</span><span class="n">topic__board</span><span class="o">=</span><span class="n">board</span><span class="p">)</span><span class="o">.</span><span class="n">order_by</span><span class="p">(</span><span class="s">'-created_at'</span><span class="p">)</span>
<span class="o">&lt;</span><span class="n">QuerySet</span> <span class="p">[</span><span class="o">&lt;</span><span class="n">Post</span><span class="p">:</span> <span class="n">testing</span><span class="o">&gt;</span><span class="p">,</span> <span class="o">&lt;</span><span class="n">Post</span><span class="p">:</span> <span class="n">new</span> <span class="n">post</span><span class="o">&gt;</span><span class="p">,</span> <span class="o">&lt;</span><span class="n">Post</span><span class="p">:</span> <span class="n">hi</span> <span class="n">there</span><span class="o">&gt;</span><span class="p">,</span> <span class="o">&lt;</span><span class="n">Post</span><span class="p">:</span> <span class="n">Lorem</span> <span class="n">ipsum</span> <span class="n">dolor</span> <span class="n">sit</span> <span class="n">amet</span><span class="p">,</span><span class="o">...&gt;</span><span class="p">,</span>
  <span class="o">&lt;</span><span class="n">Post</span><span class="p">:</span> <span class="n">Testing</span> <span class="n">the</span> <span class="n">new</span> <span class="n">reply</span> <span class="n">feature</span><span class="err">!</span><span class="o">&gt;</span><span class="p">,</span> <span class="o">&lt;</span><span class="n">Post</span><span class="p">:</span> <span class="n">New</span> <span class="n">test</span> <span class="n">here</span><span class="err">!</span><span class="o">&gt;</span><span class="p">,</span> <span class="o">&lt;</span><span class="n">Post</span><span class="p">:</span> <span class="n">Hi</span> <span class="n">everyone</span><span class="err">!</span><span class="o">&gt;</span><span class="p">,</span>
  <span class="o">&lt;</span><span class="n">Post</span><span class="p">:</span> <span class="n">test</span><span class="o">.&gt;</span><span class="p">,</span> <span class="o">&lt;</span><span class="n">Post</span><span class="p">:</span> <span class="n">This</span> <span class="ow">is</span> <span class="n">my</span> <span class="n">first</span> <span class="n">topic</span><span class="o">..</span> <span class="p">:</span><span class="o">-</span><span class="p">)</span><span class="o">&gt;</span>
<span class="p">]</span><span class="o">&gt;</span>

<span class="c"># we can use the `first()` method to just grab the result that interest us</span>
<span class="n">Post</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="nb">filter</span><span class="p">(</span><span class="n">topic__board</span><span class="o">=</span><span class="n">board</span><span class="p">)</span><span class="o">.</span><span class="n">order_by</span><span class="p">(</span><span class="s">'-created_at'</span><span class="p">)</span><span class="o">.</span><span class="n">first</span><span class="p">()</span>
<span class="o">&lt;</span><span class="n">Post</span><span class="p">:</span> <span class="n">testing</span><span class="o">&gt;</span></code></pre></figure>

<p>Sweet. Now we can implement it.</p>

<p><strong>boards/models.py</strong>
<small><a href="https://gist.github.com/vitorfs/74077336decd75292082752eb8405ad3" target="_blank" rel="noopener nofollow">(view complete file contents)</a></small></p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="kn">from</span> <span class="nn">django.db</span> <span class="kn">import</span> <span class="n">models</span>

<span class="k">class</span> <span class="nc">Board</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">name</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span> <span class="n">unique</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="n">description</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span>

    <span class="k">def</span> <span class="nf">get_posts_count</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">Post</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="nb">filter</span><span class="p">(</span><span class="n">topic__board</span><span class="o">=</span><span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">count</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">get_last_post</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">Post</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="nb">filter</span><span class="p">(</span><span class="n">topic__board</span><span class="o">=</span><span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">order_by</span><span class="p">(</span><span class="s">'-created_at'</span><span class="p">)</span><span class="o">.</span><span class="n">first</span><span class="p">()</span></code></pre></figure>

<p>Observe that we are using <code class="highlighter-rouge">self</code>, because this method will be used by a Board instance. So that means we are using
this instance to filter the QuerySet.</p>

<p>Now we can improve the home HTML template to display this brand new information:</p>

<p><strong>templates/home.html</strong></p>

<figure class="highlight"><pre><code class="language-django" data-lang="django"><span class="cp">{%</span> <span class="k">extends</span> <span class="s1">'base.html'</span> <span class="cp">%}</span>

<span class="cp">{%</span> <span class="k">block</span> <span class="nv">breadcrumb</span> <span class="cp">%}</span>
  <span class="nt">&lt;li</span> <span class="na">class=</span><span class="s">"breadcrumb-item active"</span><span class="nt">&gt;</span>Boards<span class="nt">&lt;/li&gt;</span>
<span class="cp">{%</span> <span class="k">endblock</span> <span class="cp">%}</span>

<span class="cp">{%</span> <span class="k">block</span> <span class="nv">content</span> <span class="cp">%}</span>
  <span class="nt">&lt;table</span> <span class="na">class=</span><span class="s">"table"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;thead</span> <span class="na">class=</span><span class="s">"thead-inverse"</span><span class="nt">&gt;</span>
      <span class="nt">&lt;tr&gt;</span>
        <span class="nt">&lt;th&gt;</span>Board<span class="nt">&lt;/th&gt;</span>
        <span class="nt">&lt;th&gt;</span>Posts<span class="nt">&lt;/th&gt;</span>
        <span class="nt">&lt;th&gt;</span>Topics<span class="nt">&lt;/th&gt;</span>
        <span class="nt">&lt;th&gt;</span>Last Post<span class="nt">&lt;/th&gt;</span>
      <span class="nt">&lt;/tr&gt;</span>
    <span class="nt">&lt;/thead&gt;</span>
    <span class="nt">&lt;tbody&gt;</span>
      <span class="cp">{%</span> <span class="k">for</span> <span class="nv">board</span> <span class="ow">in</span> <span class="nv">boards</span> <span class="cp">%}</span>
        <span class="nt">&lt;tr&gt;</span>
          <span class="nt">&lt;td&gt;</span>
            <span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">"</span><span class="cp">{%</span> <span class="nv">url</span> <span class="s1">'board_topics'</span> <span class="nv">board.pk</span> <span class="cp">%}</span><span class="s">"</span><span class="nt">&gt;</span><span class="cp">{{</span> <span class="nv">board.name</span> <span class="cp">}}</span><span class="nt">&lt;/a&gt;</span>
            <span class="nt">&lt;small</span> <span class="na">class=</span><span class="s">"text-muted d-block"</span><span class="nt">&gt;</span><span class="cp">{{</span> <span class="nv">board.description</span> <span class="cp">}}</span><span class="nt">&lt;/small&gt;</span>
          <span class="nt">&lt;/td&gt;</span>
          <span class="nt">&lt;td</span> <span class="na">class=</span><span class="s">"align-middle"</span><span class="nt">&gt;</span>
            <span class="cp">{{</span> <span class="nv">board.get_posts_count</span> <span class="cp">}}</span>
          <span class="nt">&lt;/td&gt;</span>
          <span class="nt">&lt;td</span> <span class="na">class=</span><span class="s">"align-middle"</span><span class="nt">&gt;</span>
            <span class="cp">{{</span> <span class="nv">board.topics.count</span> <span class="cp">}}</span>
          <span class="nt">&lt;/td&gt;</span>
          <span class="nt">&lt;td</span> <span class="na">class=</span><span class="s">"align-middle"</span><span class="nt">&gt;</span>
            <span class="cp">{%</span> <span class="k">with</span> <span class="nv">post</span><span class="err">=</span><span class="nv">board.get_last_post</span> <span class="cp">%}</span>
              <span class="nt">&lt;small&gt;</span>
                <span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">"</span><span class="cp">{%</span> <span class="nv">url</span> <span class="s1">'topic_posts'</span> <span class="nv">board.pk</span> <span class="nv">post.topic.pk</span> <span class="cp">%}</span><span class="s">"</span><span class="nt">&gt;</span>
                  By <span class="cp">{{</span> <span class="nv">post.created_by.username</span> <span class="cp">}}</span> at <span class="cp">{{</span> <span class="nv">post.created_at</span> <span class="cp">}}</span>
                <span class="nt">&lt;/a&gt;</span>
              <span class="nt">&lt;/small&gt;</span>
            <span class="cp">{%</span> <span class="k">endwith</span> <span class="cp">%}</span>
          <span class="nt">&lt;/td&gt;</span>
        <span class="nt">&lt;/tr&gt;</span>
      <span class="cp">{%</span> <span class="k">endfor</span> <span class="cp">%}</span>
    <span class="nt">&lt;/tbody&gt;</span>
  <span class="nt">&lt;/table&gt;</span>
<span class="cp">{%</span> <span class="k">endblock</span> <span class="cp">%}</span></code></pre></figure>

<p>And that’s the result for now:</p>

<p><img src="../../../../media/series/beginners-guide/1.11/part-5/boards-2.png" alt="Boards" /></p>

<p>Run the tests:</p>

<figure class="highlight"><pre><code class="language-text" data-lang="text">python manage.py test</code></pre></figure>

<figure class="highlight"><pre><code class="language-text" data-lang="text">Creating test database for alias 'default'...
System check identified no issues (0 silenced).
.......................................................EEE......................
======================================================================
ERROR: test_home_url_resolves_home_view (boards.tests.test_view_home.HomeTests)
----------------------------------------------------------------------
django.urls.exceptions.NoReverseMatch: Reverse for 'topic_posts' with arguments '(1, '')' not found. 1 pattern(s) tried: ['boards/(?P&lt;pk&gt;\\d+)/topics/(?P&lt;topic_pk&gt;\\d+)/$']

======================================================================
ERROR: test_home_view_contains_link_to_topics_page (boards.tests.test_view_home.HomeTests)
----------------------------------------------------------------------
django.urls.exceptions.NoReverseMatch: Reverse for 'topic_posts' with arguments '(1, '')' not found. 1 pattern(s) tried: ['boards/(?P&lt;pk&gt;\\d+)/topics/(?P&lt;topic_pk&gt;\\d+)/$']

======================================================================
ERROR: test_home_view_status_code (boards.tests.test_view_home.HomeTests)
----------------------------------------------------------------------
django.urls.exceptions.NoReverseMatch: Reverse for 'topic_posts' with arguments '(1, '')' not found. 1 pattern(s) tried: ['boards/(?P&lt;pk&gt;\\d+)/topics/(?P&lt;topic_pk&gt;\\d+)/$']

----------------------------------------------------------------------
Ran 80 tests in 5.663s

FAILED (errors=3)
Destroying test database for alias 'default'...</code></pre></figure>

<p>It seems like we have a problem with our implementation here. The application is crashing if there are no posts.</p>

<p><strong>templates/home.html</strong></p>

<figure class="highlight"><pre><code class="language-django" data-lang="django"><span class="cp">{%</span> <span class="k">with</span> <span class="nv">post</span><span class="err">=</span><span class="nv">board.get_last_post</span> <span class="cp">%}</span>
  <span class="cp">{%</span> <span class="k">if</span> <span class="nv">post</span> <span class="cp">%}</span>
    <span class="nt">&lt;small&gt;</span>
      <span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">"</span><span class="cp">{%</span> <span class="nv">url</span> <span class="s1">'topic_posts'</span> <span class="nv">board.pk</span> <span class="nv">post.topic.pk</span> <span class="cp">%}</span><span class="s">"</span><span class="nt">&gt;</span>
        By <span class="cp">{{</span> <span class="nv">post.created_by.username</span> <span class="cp">}}</span> at <span class="cp">{{</span> <span class="nv">post.created_at</span> <span class="cp">}}</span>
      <span class="nt">&lt;/a&gt;</span>
    <span class="nt">&lt;/small&gt;</span>
  <span class="cp">{%</span> <span class="k">else</span> <span class="cp">%}</span>
    <span class="nt">&lt;small</span> <span class="na">class=</span><span class="s">"text-muted"</span><span class="nt">&gt;</span>
      <span class="nt">&lt;em&gt;</span>No posts yet.<span class="nt">&lt;/em&gt;</span>
    <span class="nt">&lt;/small&gt;</span>
  <span class="cp">{%</span> <span class="k">endif</span> <span class="cp">%}</span>
<span class="cp">{%</span> <span class="k">endwith</span> <span class="cp">%}</span></code></pre></figure>

<p>Run the tests again:</p>

<figure class="highlight"><pre><code class="language-text" data-lang="text">python manage.py test</code></pre></figure>

<figure class="highlight"><pre><code class="language-text" data-lang="text">Creating test database for alias 'default'...
System check identified no issues (0 silenced).
................................................................................
----------------------------------------------------------------------
Ran 80 tests in 5.630s

OK
Destroying test database for alias 'default'...</code></pre></figure>

<p>I added a new board with no messages just to check the “empty message”:</p>

<p><img src="../../../../media/series/beginners-guide/1.11/part-5/boards-3.png" alt="Boards" /></p>

<p>Now it’s time to improve the topics listing view.</p>

<p><img src="../../../../media/series/beginners-guide/1.11/part-5/topics-3.png" alt="Topics" /></p>

<p>I will show you another way to include the count, this time to the number of replies, in a more effective way.</p>

<p>As usual, let’s try first with the Python shell:</p>

<figure class="highlight"><pre><code class="language-text" data-lang="text">python manage.py shell</code></pre></figure>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="kn">from</span> <span class="nn">django.db.models</span> <span class="kn">import</span> <span class="n">Count</span>
<span class="kn">from</span> <span class="nn">boards.models</span> <span class="kn">import</span> <span class="n">Board</span>

<span class="n">board</span> <span class="o">=</span> <span class="n">Board</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s">'Django'</span><span class="p">)</span>

<span class="n">topics</span> <span class="o">=</span> <span class="n">board</span><span class="o">.</span><span class="n">topics</span><span class="o">.</span><span class="n">order_by</span><span class="p">(</span><span class="s">'-last_updated'</span><span class="p">)</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="n">replies</span><span class="o">=</span><span class="n">Count</span><span class="p">(</span><span class="s">'posts'</span><span class="p">))</span>

<span class="k">for</span> <span class="n">topic</span> <span class="ow">in</span> <span class="n">topics</span><span class="p">:</span>
    <span class="k">print</span><span class="p">(</span><span class="n">topic</span><span class="o">.</span><span class="n">replies</span><span class="p">)</span>

<span class="mi">2</span>
<span class="mi">4</span>
<span class="mi">2</span>
<span class="mi">1</span></code></pre></figure>

<p>Here we are using the <code class="highlighter-rouge">annotate</code> QuerySet method to generate a new “column” on the fly. This new column, which will
be translated into a property, accessible via <code class="highlighter-rouge">topic.replies</code> contain the count of posts a given topic has.</p>

<p>We can do just a minor fix because the replies should not consider the starter topic (which is also a Post instance).</p>

<p>So here is how we do it:</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">topics</span> <span class="o">=</span> <span class="n">board</span><span class="o">.</span><span class="n">topics</span><span class="o">.</span><span class="n">order_by</span><span class="p">(</span><span class="s">'-last_updated'</span><span class="p">)</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="n">replies</span><span class="o">=</span><span class="n">Count</span><span class="p">(</span><span class="s">'posts'</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>

<span class="k">for</span> <span class="n">topic</span> <span class="ow">in</span> <span class="n">topics</span><span class="p">:</span>
    <span class="k">print</span><span class="p">(</span><span class="n">topic</span><span class="o">.</span><span class="n">replies</span><span class="p">)</span>

<span class="mi">1</span>
<span class="mi">3</span>
<span class="mi">1</span>
<span class="mi">0</span></code></pre></figure>

<p>Cool, right?</p>

<p><strong>boards/views.py</strong>
<small><a href="https://gist.github.com/vitorfs/f22b493b3e076aba9351c9d98f547f5e#file-views-py-L14" target="_blank" rel="noopener nofollow">(view complete file contents)</a></small></p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="kn">from</span> <span class="nn">django.db.models</span> <span class="kn">import</span> <span class="n">Count</span>
<span class="kn">from</span> <span class="nn">django.shortcuts</span> <span class="kn">import</span> <span class="n">get_object_or_404</span><span class="p">,</span> <span class="n">render</span>
<span class="kn">from</span> <span class="nn">.models</span> <span class="kn">import</span> <span class="n">Board</span>

<span class="k">def</span> <span class="nf">board_topics</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">pk</span><span class="p">):</span>
    <span class="n">board</span> <span class="o">=</span> <span class="n">get_object_or_404</span><span class="p">(</span><span class="n">Board</span><span class="p">,</span> <span class="n">pk</span><span class="o">=</span><span class="n">pk</span><span class="p">)</span>
    <span class="n">topics</span> <span class="o">=</span> <span class="n">board</span><span class="o">.</span><span class="n">topics</span><span class="o">.</span><span class="n">order_by</span><span class="p">(</span><span class="s">'-last_updated'</span><span class="p">)</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="n">replies</span><span class="o">=</span><span class="n">Count</span><span class="p">(</span><span class="s">'posts'</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">render</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s">'topics.html'</span><span class="p">,</span> <span class="p">{</span><span class="s">'board'</span><span class="p">:</span> <span class="n">board</span><span class="p">,</span> <span class="s">'topics'</span><span class="p">:</span> <span class="n">topics</span><span class="p">})</span></code></pre></figure>

<p><strong>templates/topics.html</strong>
<small><a href="https://gist.github.com/vitorfs/1a2235f05f436c92025dc86028c22fc4#file-topics-html-L28" target="_blank" rel="noopener nofollow">(view complete file contents)</a></small></p>

<figure class="highlight"><pre><code class="language-django" data-lang="django"><span class="cp">{%</span> <span class="k">for</span> <span class="nv">topic</span> <span class="ow">in</span> <span class="nv">topics</span> <span class="cp">%}</span>
  <span class="nt">&lt;tr&gt;</span>
    <span class="nt">&lt;td&gt;&lt;a</span> <span class="na">href=</span><span class="s">"</span><span class="cp">{%</span> <span class="nv">url</span> <span class="s1">'topic_posts'</span> <span class="nv">board.pk</span> <span class="nv">topic.pk</span> <span class="cp">%}</span><span class="s">"</span><span class="nt">&gt;</span><span class="cp">{{</span> <span class="nv">topic.subject</span> <span class="cp">}}</span><span class="nt">&lt;/a&gt;&lt;/td&gt;</span>
    <span class="nt">&lt;td&gt;</span><span class="cp">{{</span> <span class="nv">topic.starter.username</span> <span class="cp">}}</span><span class="nt">&lt;/td&gt;</span>
    <span class="nt">&lt;td&gt;</span><span class="cp">{{</span> <span class="nv">topic.replies</span> <span class="cp">}}</span><span class="nt">&lt;/td&gt;</span>
    <span class="nt">&lt;td&gt;</span>0<span class="nt">&lt;/td&gt;</span>
    <span class="nt">&lt;td&gt;</span><span class="cp">{{</span> <span class="nv">topic.last_updated</span> <span class="cp">}}</span><span class="nt">&lt;/td&gt;</span>
  <span class="nt">&lt;/tr&gt;</span>
<span class="cp">{%</span> <span class="k">endfor</span> <span class="cp">%}</span></code></pre></figure>

<p><img src="../../../../media/series/beginners-guide/1.11/part-5/topics-4.png" alt="Topics" /></p>

<p>Next step now is to fix the <em>views</em> count. But for that, we will need to create a new field.</p>

<hr />

<h4 id="migrations">Migrations</h4>

<p>Migration is a fundamental part of Web development with Django. It’s how we evolve our application’s models keeping
the models’ files synchronized with the database.</p>

<p>When we first run the command <code class="highlighter-rouge">python manage.py migrate</code> Django grab all migration files and generate the database
schema.</p>

<p>When Django applies a migration, it has a special table called <strong>django_migrations</strong>. In this table, Django registers
all the applied migrations.</p>

<p>So if we try to run the command again:</p>

<figure class="highlight"><pre><code class="language-text" data-lang="text">python manage.py migrate</code></pre></figure>

<figure class="highlight"><pre><code class="language-text" data-lang="text">Operations to perform:
  Apply all migrations: admin, auth, boards, contenttypes, sessions
Running migrations:
  No migrations to apply.</code></pre></figure>

<p>Django will know there’s nothing to do.</p>

<p>Let’s create a migration by adding a new field to the Topic model:</p>

<p><strong>boards/models.py</strong>
<small><a href="https://gist.github.com/vitorfs/816f47aa4df8e7b157df75e0ff209aac#file-models-py-L25" target="_blank" rel="noopener nofollow">(view complete file contents)</a></small></p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="k">class</span> <span class="nc">Topic</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">subject</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">255</span><span class="p">)</span>
    <span class="n">last_updated</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">DateTimeField</span><span class="p">(</span><span class="n">auto_now_add</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="n">board</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">ForeignKey</span><span class="p">(</span><span class="n">Board</span><span class="p">,</span> <span class="n">related_name</span><span class="o">=</span><span class="s">'topics'</span><span class="p">)</span>
    <span class="n">starter</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">ForeignKey</span><span class="p">(</span><span class="n">User</span><span class="p">,</span> <span class="n">related_name</span><span class="o">=</span><span class="s">'topics'</span><span class="p">)</span>
    <span class="n">views</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">PositiveIntegerField</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>  <span class="c"># &lt;- here</span>

    <span class="k">def</span> <span class="nf">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">subject</span></code></pre></figure>

<p>Here we added a <code class="highlighter-rouge">PositiveIntegerField</code>. Since this field is going to store the number of page views, a negative page
view wouldn’t make sense.</p>

<p>Before we can use our new field, we have to update the database schema. Execute the <code class="highlighter-rouge">makemigrations</code> command:</p>

<figure class="highlight"><pre><code class="language-text" data-lang="text">python manage.py makemigrations

Migrations for 'boards':
  boards/migrations/0003_topic_views.py
    - Add field views to topic</code></pre></figure>

<p>The <code class="highlighter-rouge">makemigrations</code> command automatically generated the <strong>0003_topic_views.py</strong> file, which will be used to modify the
database, adding the <strong>views</strong> field.</p>

<p>Now apply the migration by running the command <code class="highlighter-rouge">migrate</code>:</p>

<figure class="highlight"><pre><code class="language-text" data-lang="text">python manage.py migrate

Operations to perform:
  Apply all migrations: admin, auth, boards, contenttypes, sessions
Running migrations:
  Applying boards.0003_topic_views... OK</code></pre></figure>

<p>Now we can use it to keep track of the number of views a given topic is receiving:</p>

<p><strong>boards/views.py</strong>
<small><a href="https://gist.github.com/vitorfs/c0c97c1e050204d9152c59b4da2f9305#file-views-py-L41" target="_blank" rel="noopener nofollow">(view complete file contents)</a></small></p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="kn">from</span> <span class="nn">django.shortcuts</span> <span class="kn">import</span> <span class="n">get_object_or_404</span><span class="p">,</span> <span class="n">render</span>
<span class="kn">from</span> <span class="nn">.models</span> <span class="kn">import</span> <span class="n">Topic</span>

<span class="k">def</span> <span class="nf">topic_posts</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">pk</span><span class="p">,</span> <span class="n">topic_pk</span><span class="p">):</span>
    <span class="n">topic</span> <span class="o">=</span> <span class="n">get_object_or_404</span><span class="p">(</span><span class="n">Topic</span><span class="p">,</span> <span class="n">board__pk</span><span class="o">=</span><span class="n">pk</span><span class="p">,</span> <span class="n">pk</span><span class="o">=</span><span class="n">topic_pk</span><span class="p">)</span>
    <span class="n">topic</span><span class="o">.</span><span class="n">views</span> <span class="o">+=</span> <span class="mi">1</span>
    <span class="n">topic</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">render</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s">'topic_posts.html'</span><span class="p">,</span> <span class="p">{</span><span class="s">'topic'</span><span class="p">:</span> <span class="n">topic</span><span class="p">})</span></code></pre></figure>

<p><strong>templates/topics.html</strong>
<small><a href="https://gist.github.com/vitorfs/70ebb1a06e1044387943ee83bafcd526" target="_blank" rel="noopener nofollow">(view complete file contents)</a></small></p>

<figure class="highlight"><pre><code class="language-django" data-lang="django"><span class="cp">{%</span> <span class="k">for</span> <span class="nv">topic</span> <span class="ow">in</span> <span class="nv">topics</span> <span class="cp">%}</span>
  <span class="nt">&lt;tr&gt;</span>
    <span class="nt">&lt;td&gt;&lt;a</span> <span class="na">href=</span><span class="s">"</span><span class="cp">{%</span> <span class="nv">url</span> <span class="s1">'topic_posts'</span> <span class="nv">board.pk</span> <span class="nv">topic.pk</span> <span class="cp">%}</span><span class="s">"</span><span class="nt">&gt;</span><span class="cp">{{</span> <span class="nv">topic.subject</span> <span class="cp">}}</span><span class="nt">&lt;/a&gt;&lt;/td&gt;</span>
    <span class="nt">&lt;td&gt;</span><span class="cp">{{</span> <span class="nv">topic.starter.username</span> <span class="cp">}}</span><span class="nt">&lt;/td&gt;</span>
    <span class="nt">&lt;td&gt;</span><span class="cp">{{</span> <span class="nv">topic.replies</span> <span class="cp">}}</span><span class="nt">&lt;/td&gt;</span>
    <span class="nt">&lt;td&gt;</span><span class="cp">{{</span> <span class="nv">topic.views</span> <span class="cp">}}</span><span class="nt">&lt;/td&gt;</span>  <span class="c">&lt;!-- here --&gt;</span>
    <span class="nt">&lt;td&gt;</span><span class="cp">{{</span> <span class="nv">topic.last_updated</span> <span class="cp">}}</span><span class="nt">&lt;/td&gt;</span>
  <span class="nt">&lt;/tr&gt;</span>
<span class="cp">{%</span> <span class="k">endfor</span> <span class="cp">%}</span></code></pre></figure>

<p>Now open a topic and refresh the page a few times, and see if it’s counting the page views:</p>

<p><img src="../../../../media/series/beginners-guide/1.11/part-5/posts-5.png" alt="Posts" /></p>

<hr />

<h4 id="conclusions">Conclusions</h4>

<p>In this tutorial, we made some progress in the development of the Web boards functionalities. There are a few things
left to implement: the edit post view, the “my account” view for the user to update their names, etc. After those two
views, we are going to enable markdown in the posts and implement pagination in both topic listing and topic replies
listing.</p>

<p>The next tutorial will be focused on using class-based views to solve those problems. And after that, we are going to
learn how to deploy our application to a Web server.</p>

<p>I hope you enjoyed the fifth part of this tutorial series! The sixth part is coming out next week, on Oct 9, 2017.
If you would like to get notified when the fifth part is out, you can <a href="https://colossus.simpleisbetterthancomplex.com/subscribe/d2320a41-0378-4aa8-8f4e-5bb1ffcd521d/" target="_blank">subscribe to our mailing list</a>.</p>

<p>The source code of the project is available on GitHub. The current state of the project can be found under the release
tag <strong>v0.5-lw</strong>. The link below will take you to the right place:</p>

<p><a href="https://github.com/sibtc/django-beginners-guide/tree/v0.5-lw" target="_blank">https://github.com/sibtc/django-beginners-guide/tree/v0.5-lw</a></p>

<hr />

<div class="popular-posts">
  <div class="row">
    <div class="six columns">
      <a href="../../09/25/a-complete-beginners-guide-to-django-part-4.html" style="text-decoration: none">
        <img src="../../../../media/series/beginners-guide/1.11/part-4/featured.jpg" alt="A Complete Beginner's Guide to Django - Part 4" title="A Complete Beginner's Guide to Django - Part 4" />
        <h5 style="margin-top: 1rem;">← Part 4 - Authentication</h5>
      </a>
    </div>
    <div class="six columns">
      <a href="../09/a-complete-beginners-guide-to-django-part-6.html" style="text-decoration: none">
        <img src="../../../../media/series/beginners-guide/1.11/part-6/featured.jpg" alt="A Complete Beginner's Guide to Django - Part 6" title="A Complete Beginner's Guide to Django - Part 6" />
        <h5 style="text-align: right; margin-top: 1rem;">Part 6 - Class-Based Views →</h5>
      </a>
    </div>
  </div>
</div>

          </article>

          <hr class="dashed">
<div class="row">
  <div class="six columns post-tags" style="padding-top: 4px">
    
      <a href="../../../../tag/python/index.html"><span class="tag">python</span></a>
    
      <a href="../../../../tag/django/index.html"><span class="tag">django</span></a>
    
      <a href="../../../../tag/guide/index.html"><span class="tag">guide</span></a>
    
      <a href="../../../../tag/beginners/index.html"><span class="tag">beginners</span></a>
    
      <a href="../../../../tag/orm/index.html"><span class="tag">orm</span></a>
    
      <a href="../../../../tag/migrations/index.html"><span class="tag">migrations</span></a>
    
  </div>
  <div class="six columns post-share">
    <div class="social">
  Share this post
  <a href="http://vk.com/share.php?url=http://sibt.co/2yjBTpu"
     rel="nofollow"
     target="_blank"
     title="Share on VK">
    <i class="fa fa-vk"></i>
  </a>
  <a href="https://twitter.com/intent/tweet?text=A%20Complete%20Beginner's%20Guide%20to%20Django%20-%20Part%205&amp;url=http://sibt.co/2yRfblE&amp;via=vitorfs&amp;related=vitorfs"
     rel="nofollow"
     target="_blank"
     title="Share on Twitter">
    <i class="fa fa-twitter"></i>
  </a>
  <a href="https://www.facebook.com/sharer/sharer.php?app_id=1645747765697865&amp;u=http://sibt.co/2ySFY0S"
     rel="nofollow"
     target="_blank"
     title="Share on Facebook">
    <i class="fa fa-facebook"></i>
  </a>
  <a href="http://www.linkedin.com/shareArticle?mini=true&amp;url=http://sibt.co/2yRjbmg&amp;title=A%20Complete%20Beginner's%20Guide%20to%20Django%20-%20Part%205&amp;summary=In%20this%20tutorial,%20we%20are%20going%20to%20learn%20more%20about%20protecting%20views%20against%20unauthorized%20users%20and%20how%20to%20access%20the%20authenticated%20user%20in%20the%20views%20and%20forms.%20We%20are%20also%20going%20to%20implement%20the%20to...&amp;source=https://simpleisbetterthancomplex.com"
     rel="nofollow"
     target="_blank"
     title="Share on LinkedIn">
    <i class="fa fa-linkedin"></i>
  </a>
</div>

  </div>
</div>

        </div>

        <div class="card">
          
  <div id="comments">
    <div id="disqus_thread"></div>
    <script>
      var disqus_config = function () {
        this.page.url = 'a-complete-beginners-guide-to-django-part-5.html';
        this.page.identifier = '/series/2017/10/02/a-complete-beginners-guide-to-django-part-5';
      };
      (function() {
      var d = document, s = d.createElement('script');
      s.src = 'http://simpleisbetterthancomplex.disqus.com/embed.js';
      s.setAttribute('data-timestamp', +new Date());
      (d.head || d.body).appendChild(s);
      })();
    </script>
    <script id="dsq-count-scr" src="http://simpleisbetterthancomplex.disqus.com/count.js" async></script>
    <noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript>
  </div>


        </div>
      </div>
    </div>
  </div>

  <div class="container post post-footer">
    <div class="card subscribe">
  <form action="https://colossus.simpleisbetterthancomplex.com/subscribe/d2320a41-0378-4aa8-8f4e-5bb1ffcd521d/" method="post" target="_blank" novalidate>
    <h4>
      <span class="fa fa-send" style="margin-right: 5px"></span> Subscribe to our Mailing List
    </h4>
    <h5>Receive updates from the Blog!</h5>
    <div class="row">
      <div class="eight columns">
        <input class="u-full-width" placeholder="Your email address" type="email" name="email">
      </div>
      <div class="four columns">
        <button type="submit" class="u-full-width">Subscribe</button>
      </div>
    </div>
  </form>
</div>

    <div class="card popular-posts">
  <h4>Popular Posts</h4>
  <div class="row">
    
      <div class="four columns">
        <a href="../../../../tutorial/2016/07/22/how-to-extend-django-user-model.html">
          <img src="../../../../media/2016-07-22-how-to-extend-django-user-model/featured-post-image.jpg" alt="How to Extend Django User Model" title="How to Extend Django User Model">
          How to Extend Django User Model
        </a>
      </div>
    
      <div class="four columns">
        <a href="../../../../tutorial/2016/05/11/how-to-setup-ssl-certificate-on-nginx-for-django-application.html">
          <img src="../../../../media/2016-05-11-how-to-setup-ssl-certificate-on-nginx-for-django-application/featured-post-image.jpg" alt="How to Setup a SSL Certificate on Nginx for a Django Application" title="How to Setup a SSL Certificate on Nginx for a Django Application">
          How to Setup a SSL Certificate on Nginx for a Django Application
        </a>
      </div>
    
      <div class="four columns">
        <a href="../../../../tutorial/2016/10/14/how-to-deploy-to-digital-ocean.html">
          <img src="../../../../media/2016/10/featured-do.jpg" alt="How to Deploy a Django Application to Digital Ocean" title="How to Deploy a Django Application to Digital Ocean">
          How to Deploy a Django Application to Digital Ocean
        </a>
      </div>
    
  </div>
</div>

  </div>

  <footer>
  <div class="container">
    <ul>
      <li>© 2015-2021 simple complex</li>
      <li><a rel="license noopener" href="https://creativecommons.org/licenses/by-nc-sa/3.0/" target="_blank">cc by-nc-sa 3.0</a></li>
      <li>//</li>
      <li><a href="../../../../about/index.html" rel="author">about</a></li>
      <li><a href="../../../../contact/index.html">contact</a></li>
      <li><a href="../../../../faq/index.html">faq</a></li>
      <li><a href="../../../../cookies/index.html">cookies</a></li>
      <li><a href="../../../../privacy/index.html">privacy policy</a></li>
    </ul>
  </div>
</footer>
<div class="overlay"></div>

  
  <script id="ga-page-views" src="../../../../js/page-views.js" async></script>
  <script src="http://z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=1d8c6a0f-2136-49ad-b0b3-0b09662b7e28"></script>


<style>
.related-posts .row {
  display: grid;
  grid-gap: 20px;
  grid-template-columns: repeat(3, 1fr);
}

.related-posts .four.columns {
  width: 100%;
}
</style>

<script>
_bsa.init('recommended', 'CK7I4KJJ', 'placement:simpleisbetterthancomplexcom',
    {
      target: '.related-posts .columns',
      template: `
<div class="four columns">
<a href="##link##" rel="noopener nofollow">
<img src="##smallImage##" alt="##title##" title="##title##">[Sponsored] ##title##</a>
</div>
      `
    }
  );
</script>

<script type="application/ld+json">
{
  "@context": "http://schema.org",
  "@type": "BlogPosting",
  "mainEntityOfPage": "https://simpleisbetterthancomplex.com/series/2017/10/02/a-complete-beginners-guide-to-django-part-5.html",
  "headline": "A Complete Beginner's Guide to Django - Part 5",
  "image": {
    "@type": "ImageObject",
    "url": "https://simpleisbetterthancomplex.com/media/series/beginners-guide/1.11/part-5/featured.jpg",
    "height": 370,
    "width": 960
  },
  "datePublished": "2017-10-02T08:00:00+03:00",
  "dateModified": "2017-10-02T08:00:00+03:00",
  "author": {
    "@type": "Person",
    "name": "Vitor Freitas"
  },
   "publisher": {
    "@type": "Organization",
    "name": "Simple is Better Than Complex",
    "logo": {
      "@type": "ImageObject",
      "url": "https://simpleisbetterthancomplex.com/img/gplus_logo.png",
      "height": 60,
      "width": 600
    }
  },
  "description": "In this tutorial, we are going to learn more about protecting views against unauthorized users and how to access the authenticated user in the views and forms. We are also going to implement the to..."
}
</script>

  <script src="../../../../js/affix.js"></script>
  <script src="../../../../js/jquery.waypoints.min.js"></script>
  <script src="../../../../js/inview.min.js"></script>
  <script>
    $(function () {
      var sidebarMaxHeight = $(window).height() - 90;
      if (sidebarMaxHeight > 600) {
        $('head').append('<style type="text/css">@media (min-width: 1200px) {#seriesSideBar.affix div.card { max-height: '+sidebarMaxHeight+'px!important; }}</style>');
      }

      /* sidebar affix */
      $("#seriesSideBar").affix({
        offset: {
          top: $("#seriesSideBar").offset().top - 50,
          bottom: function () {
            return ($("footer").outerHeight(true) + $(".post-footer").outerHeight(true));
          }
        }
      });

      /* sidebar scrollspy */
      var headers = Array();
      var trackContents = function (el) {
        var inview = new Waypoint.Inview({
          element: el,
          enter: function(direction) {
            $("#seriesSideBar ul li a").removeClass("active");
            $("#seriesSideBar ul li a[href='#" + this.element.id + "']").addClass("active");
          },
          exit: function(direction) {
            if (direction == "up") {
              var index = headers.indexOf(this.element.id);
              $("#seriesSideBar ul li a").removeClass("active");
              if (index > 0) {
                $("#seriesSideBar ul li a[href='#" + headers[index - 1] + "']").addClass("active");
              }
            }
          }
        });
      };
      $("article h4, article h5").each(function () {
        trackContents(this);
        headers.push(this.id);
      });

      /* article default os */
      var os = getOS();
      $("nav.platform a[data-platform='" + os + "']").addClass("active");
      $("body").addClass("platform-" + os);

      $(".js-set-platform a").click(function () {
        var $btn = $(this);
        var $body = $("body");
        var platform = $btn.attr("data-platform");
        var platformClass = "platform-" + platform;
        $body.removeClass("platform-mac platform-windows platform-linux");
        $body.addClass(platformClass);
        $("nav.platform a").removeClass("active");
        $("nav.platform a[data-platform='" + platform + "']").addClass("active");
      });

      var platformInview = new Waypoint.Inview({
        element: $("#platformArticle")[0],
        enter: function(direction) {
          $("#platformSideBar").hide();
        },
        exit: function(direction) {
          if (direction == "up") {
            $("#platformSideBar").hide();
          }
          else {
            $("#platformSideBar").show();
          }
        }
      });

    });
  </script>
  <noscript><style type="text/css">body article div.platform-windows { display: block!important; }</style></noscript>
  
</body>

<!-- Mirrored from simpleisbetterthancomplex.com/series/2017/10/02/a-complete-beginners-guide-to-django-part-5.html by HTTrack Website Copier/3.x [XR&CO'2014], Fri, 03 Sep 2021 12:41:24 GMT -->
</html>

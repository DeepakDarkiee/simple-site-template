<!DOCTYPE html>
<html lang="en">

<!-- Mirrored from simpleisbetterthancomplex.com/series/2017/10/09/a-complete-beginners-guide-to-django-part-6.html by HTTrack Website Copier/3.x [XR&CO'2014], Fri, 03 Sep 2021 12:40:50 GMT -->
<head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta name="ir-site-verification-token" value="-233745807">
<title>A Complete Beginner's Guide to Django - Part 6</title>
<meta name="description" content="Welcome to the sixth part of the tutorial series! In this tutorial, we are going to explore in great detail the Class-Based Views. We are also going to refac...">
<link href="https://fonts.googleapis.com/css?family=Raleway:400,300,500,600,700" rel="stylesheet" type="text/css">
<link rel="stylesheet" href="../../../../css/main71de.css?v=34">
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">
<link rel="canonical" href="a-complete-beginners-guide-to-django-part-6.html">
<link rel="alternate" type="application/rss+xml" title="Simple is Better Than Complex" href="../../../../feed.xml" />
<link rel="icon" type="image/png" href="../../../../favicon.png">
<link rel="mask-icon" href="../../../../safari-pinned-tab.svg" color="#5bbad5">
<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.2/jquery.min.js"></script>
<script src="../../../../js/site7b30.js?v=4"></script>

  <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','http://www.google-analytics.com/analytics.js','ga');
    ga('create', 'UA-42049022-10', 'auto');
    ga('send', 'pageview');
  </script>
  <script>
    $(function () {
      $("#ad").on("click", "#carbonads .carbon-wrap a", function () {
        var page_id = 'a-complete-beginners-guide-to-django-part-6.html';
        ga('send', 'event', 'carbonads', 'click', page_id, {
          'transport': 'beacon'
        });
      });
    });
  </script>
  <script>
  !function(f,b,e,v,n,t,s){if(f.fbq)return;n=f.fbq=function(){n.callMethod?
  n.callMethod.apply(n,arguments):n.queue.push(arguments)};if(!f._fbq)f._fbq=n;
  n.push=n;n.loaded=!0;n.version='2.0';n.queue=[];t=b.createElement(e);t.async=!0;
  t.src=v;s=b.getElementsByTagName(e)[0];s.parentNode.insertBefore(t,s)}(window,
  document,'script','https://connect.facebook.net/en_US/fbevents.js');
  fbq('init', '1689711451348257');
  fbq('track', 'PageView');
  </script>
  <noscript><img height="1" width="1" style="display:none" alt="PageView"
  src="https://www.facebook.com/tr?id=1689711451348257&amp;ev=PageView&amp;noscript=1"
  /></noscript>
  <script data-ad-client="ca-pub-5430683801108011" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>


  <meta property="og:title" content="A Complete Beginner's Guide to Django - Part 6">
<meta property="og:url" content="https://simpleisbetterthancomplex.com/series/2017/10/09/a-complete-beginners-guide-to-django-part-6.html">
<meta property="og:image" content="https://simpleisbetterthancomplex.com/media/series/beginners-guide/1.11/part-6/thumbnail.jpg">
<meta property="og:description" content="Welcome to the sixth part of the tutorial series! In this tutorial, we are going to explore in great detail the Class-Based Views. We are also going to refac...">
<meta property="og:site_name" content="Simple is Better Than Complex">
<meta property="og:locale" content="en_US">

  <meta property="article:published_time" content="2017-10-09T08:00:00+03:00">
  <meta property="article:author" content="https://facebook.com/vitorfs">

<meta property="fb:admins" content="100000024295617">
<meta property="fb:app_id" content="1645747765697865">

<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:site" content="vitorfs">
<meta name="twitter:creator" content="vitorfs">
<meta name="twitter:title" content="A Complete Beginner's Guide to Django - Part 6">
<meta name="twitter:description" content="Welcome to the sixth part of the tutorial series! In this tutorial, we are going to explore in great detail the Class-Based Views. We are also going to refactor some of the existing views so to tak...">
<meta name="twitter:image" content="https://simpleisbetterthancomplex.com/media/series/beginners-guide/1.11/part-6/thumbnail.jpg">
<meta name="p:domain_verify" content="e262845cb18e4c68b0cff535a0eaea5d">
  <meta property="og:type" content="article">
  
    <meta property="article:tag" content="python">
  
    <meta property="article:tag" content="django">
  
    <meta property="article:tag" content="guide">
  
    <meta property="article:tag" content="beginners">
  
    <meta property="article:tag" content="views">
  
    <meta property="article:tag" content="cbv">
  
    <meta property="article:tag" content="gcbv">
  
</head>
<body>
  <div id="top" style="visibility: hidden"></div>
<header>
  <div class="container">
    <ul class="menu menu-right">
      <li class="menu-item">
        <a href="../../../../search/index.html">
          <span class="fa fa-search"></span>
        </a>
      </li>
      <li class="toggle-menu">
        <a href="javascript:void(0);">
          <span class="fa fa-bars"></span>
        </a>
      </li>
    </ul>
    <ul class="menu menu-left">
      <li class="logo">
        <a href="../../../../index.html" style="font-weight: 900">simple<span class="brand">is</span>better<span class="brand">than</span>complex</a>
      </li>
      <li class="menu-item">
        <a href="../../../../index.html">
          <span class="fa fa-home" style="margin-right: 3px"></span>
          Home
        </a>
      </li>
      <li class="menu-item">
        <a href="../../../../archive/index.html">
          <span class="fa fa-archive" style="margin-right: 3px"></span>
          Articles
        </a>
      </li>
      <li class="menu-item">
        <a href="../../../../videos/index.html">
          <span class="fa fa-video-camera" style="margin-right: 3px"></span>
          Videos
        </a>
      </li>
      <li class="menu-item">
        <a href="../../../index.html">
          <span class="fa fa-book" style="margin-right: 3px"></span>
          Series
        </a>
      </li>
      <li class="menu-item">
        <a href="../../../../snippets/index.html">
          <span class="fa fa-code" style="margin-right: 3px"></span>
          Snippets
        </a>
      </li>
      <li class="menu-item">
        <a href="../../../../sponsor/index.html">
          <span class="fa fa-bullhorn" style="margin-right: 3px"></span>
          Sponsor
        </a>
      </li>
      <li class="menu-item">
        <a href="../../../../feed.xml" target="_blank">
          <span class="fa fa-rss" style="margin-right: 3px"></span>
          RSS
        </a>
      </li>
      <li class="menu-item">
        <a href="https://colossus.simpleisbetterthancomplex.com/subscribe/d2320a41-0378-4aa8-8f4e-5bb1ffcd521d/" class="brand" target="_blank">
          <span class="fa fa-send" style="margin-right: 3px"></span> Subscribe
        </a>
      </li>
      <li class="menu-item hidden-mobile">
        <a href="../../../../search/index.html">
          <span class="fa fa-search"></span> Search
        </a>
      </li>
    </ul>
  </div>
</header>

  <div class="container">
    <div class="row">
      <div class="twelve columns post">
        <div class="card post-author">
  <div class="author-picture">
    <img src="../../../../img/picture.jpg" alt="Vitor Freitas">
  </div>
  <div class="author-info">
    <p class="name">By <strong>Vitor Freitas</strong></p>
    <a href="https://www.digitalocean.com/?refcode=074832454ff1&amp;utm_campaign=Referral_Invite&amp;utm_medium=Referral_Program&amp;utm_source=badge" class="powered-by-do">
      <img src="https://web-platforms.sfo2.cdn.digitaloceanspaces.com/WWW/Badge 1.svg" alt="DigitalOcean Referral Badge">
    </a>
    <p class="bio">
      I'm a passionate software developer and researcher. I write about Python, Django and Web Development on a weekly basis. <a href="../../../../about/index.html" rel="author">Read more</a>.
    </p>
    <p class="contact">
      <a href="https://www.youtube.com/VitorFreitas" rel="me noopener" target="_blank" title="YouTube"><i class="fa fa-youtube-play"></i></a>
      <a href="https://github.com/vitorfs" rel="me noopener" target="_blank" title="GitHub"><i class="fa fa-github"></i></a>
      <a href="https://twitter.com/vitorfs" rel="me noopener" target="_blank" title="Twitter"><i class="fa fa-twitter"></i></a>
      <a href="https://facebook.com/vitorfs" rel="me noopener" target="_blank" title="Facebook"><i class="fa fa-facebook-official"></i></a>
      <a href="https://linkedin.com/in/vitorfs" rel="me noopener" target="_blank" title="LinkedIn"><i class="fa fa-linkedin-square"></i></a>
      <a href="https://instagram.com/vitorfs" rel="me noopener" target="_blank" title="Instagram"><i class="fa fa-instagram"></i></a>
      <a href="../../../../contact/index.html" title="Contact"><i class="fa fa-envelope"></i></a>
    </p>
  </div>
  
  
</div>

      </div>
    </div>
    <div id="main-content" class="row">
      <div id="seriesSideBar" class="three columns">
        <div class="card">
          
            <div id="ad">
              <script async type="text/javascript" src="http://cdn.carbonads.com/carbon.js?serve=CKYIEKQM&amp;placement=simpleisbetterthancomplexcom" id="_carbonads_js"></script>
            </div>
          
          <nav id="platformSideBar" class="platform js-set-platform" style="margin-bottom: 2rem; display: none; font-size: 1.2rem">
            <a href="javascript:void(0);" data-platform="mac" title="Set platform to Mac"><i class="fa fa-apple"></i> Mac</a>
            <a href="javascript:void(0);" data-platform="windows" title="Set platform to Windows"><i class="fa fa-windows"></i> Win</a>
            <a href="javascript:void(0);" data-platform="linux" title="Set platform to Linux"><i class="fa fa-linux"></i> Linux</a>
          </nav>
          <h5>Table of Contents</h5>
          <ul>
            
              <li><a href="#introduction">Introduction</a></li>
              
            
              <li><a href="#views-strategies">Views Strategies</a></li>
              
                <li style="padding-left: 1.5rem; font-size: 1.4rem; margin-bottom: 0.25rem">
                  <a href="#function-based-view">
                    Function-Based View
                  </a>
                </li>
              
                <li style="padding-left: 1.5rem; font-size: 1.4rem; margin-bottom: 0.25rem">
                  <a href="#class-based-view">
                    Class-Based View
                  </a>
                </li>
              
                <li style="padding-left: 1.5rem; font-size: 1.4rem; margin-bottom: 0.25rem">
                  <a href="#generic-class-based-view">
                    Generic Class-Based View
                  </a>
                </li>
              
            
              <li><a href="#update-view">Update View</a></li>
              
                <li style="padding-left: 1.5rem; font-size: 1.4rem; margin-bottom: 0.25rem">
                  <a href="#testing-the-update-view">
                    Testing The Update View
                  </a>
                </li>
              
            
              <li><a href="#list-view">List View</a></li>
              
                <li style="padding-left: 1.5rem; font-size: 1.4rem; margin-bottom: 0.25rem">
                  <a href="#pagination">
                    Pagination
                  </a>
                </li>
              
                <li style="padding-left: 1.5rem; font-size: 1.4rem; margin-bottom: 0.25rem">
                  <a href="#fbv-pagination">
                    FBV Pagination
                  </a>
                </li>
              
                <li style="padding-left: 1.5rem; font-size: 1.4rem; margin-bottom: 0.25rem">
                  <a href="#gcbv-pagination">
                    GCBV Pagination
                  </a>
                </li>
              
                <li style="padding-left: 1.5rem; font-size: 1.4rem; margin-bottom: 0.25rem">
                  <a href="#reusable-pagination-template">
                    Reusable Pagination Template
                  </a>
                </li>
              
            
              <li><a href="#my-account-view">My Account View</a></li>
              
            
              <li><a href="#adding-markdown">Adding Markdown</a></li>
              
            
              <li><a href="#humanize">Humanize</a></li>
              
            
              <li><a href="#gravatar">Gravatar</a></li>
              
            
              <li><a href="#final-adjustments">Final Adjustments</a></li>
              
            
              <li><a href="#conclusions">Conclusions</a></li>
              
            
          </ul>
          <hr style="margin: 1.5rem 0;">
          <ul style="font-size: 1.4rem">
            <li><a href="#top"><i class="fa fa-arrow-up" style="margin-right: .2rem"></i> scroll to top</a></li>
            <li><a href="#comments"><i class="fa fa-comments" style="margin-right: .2rem"></i> go to comments</a></li>
            <li><a href="../../../beginners-guide/1.11/index.html"><i class="fa fa-list" style="margin-right: .2rem"></i> go to series index</a></li>
          </ul>
        </div>
      </div>
      <div class="nine columns content post" style="float:right">
        <div class="card">
          
  <h5 class="post-category">
    
      series
    
  </h5>
  <hr class="dashed">

<h3 class="post-title">A Complete Beginner's Guide to Django - Part 6</h3>
<ul class="post-meta">
  <li>
    <i class="fa fa-calendar"></i> Oct 9, 2017
  </li>
  <li>
    <i class="fa fa-clock-o"></i>
    59 minutes read
  </li>
  <li>
    <i class="fa fa-comments"></i>
    <a href="#disqus_thread" data-disqus-identifier="/series/2017/10/09/a-complete-beginners-guide-to-django-part-6">comments</a>
  </li>
  <li>
    <i class="fa fa-eye"></i>
    <span class="ga-page-views" data-ga-identifier="a-complete-beginners-guide-to-django-part-6.html"></span> views
  </li>
  
    <li>
      <i class="fa fa-book"></i>
      <a href="../../../beginners-guide/1.11/index.html">Part 6 of 7</a>
    </li>
  
  
</ul>

  <div class="post-featured-image">
    <img src="../../../../media/series/beginners-guide/1.11/part-6/featured.jpg" alt="A Complete Beginner's Guide to Django - Part 6" class="featured-image">
    
  </div>


          <div class="row" style="margin-bottom: 2rem;">
            <div class="five columns">
              <nav id="platformArticle" class="platform js-set-platform">
                <a href="javascript:void(0);" data-platform="mac" title="Set platform to Mac"><i class="fa fa-apple"></i> Mac</a>
                <a href="javascript:void(0);" data-platform="windows" title="Set platform to Windows"><i class="fa fa-windows"></i> Windows</a>
                <a href="javascript:void(0);" data-platform="linux" title="Set platform to Linux"><i class="fa fa-linux"></i> Linux</a>

              </nav>
            </div>
            <div class="three columns">
              <nav class="platform">
                <a href="../../../beginners-guide/1.11/index.html" class="series-nav">Series 6/7</a>
              </nav>
            </div>
            <div class="four columns versions">
              
                <img src="https://img.shields.io/badge/python-3.6.2-brightgreen.svg" alt="Python 3.6.2">
              
              
                <img src="https://img.shields.io/badge/django-1.11.4-brightgreen.svg" alt="Django 1.11.4">
              
            </div>
          </div>

          <article>
            <h4 id="introduction">Introduction</h4>

<p>Welcome to the sixth part of the tutorial series! In this tutorial, we are going to explore in great detail the
Class-Based Views. We are also going to refactor some of the existing views so to take advantage of the built-in
Generic Class-Based Views.</p>

<p>There are many other topics that we are going to touch with this tutorial, such as how to work with pagination,
how to work with Markdown and how to add a simple editor. We are also going to explore a built-in package called
Humanize, which is used to give a “human touch” to the data.</p>

<p>Alright, folks! Let’s implement some code. We have plenty of work to do today!</p>

<hr />

<h4 id="views-strategies">Views Strategies</h4>

<p>At the end of the day, all Django views are <em>functions</em>. Even class-based views (CBV). Behind the scenes, it does all
the magic and ends up returning a view function.</p>

<p>Class-based views were introduced to make it easier for developers to reuse and extend views. There are many benefits
of using them, such as the extendability, the ability to use O.O. techniques such as multiple inheritances, the handling
of HTTP methods are done in separate methods, rather than using conditional branching, and there are also the
Generic Class-Based Views (GCBV).</p>

<p>Before we move forward, let’s clarify what those three terms mean:</p>

<ul>
  <li>Function-Based Views (FBV)</li>
  <li>Class-Based Views (CBV)</li>
  <li>Generic Class-Based Views (GCBV)</li>
</ul>

<p>A FBV is the simplest representation of a Django view: it’s just a function that receives an <strong>HttpRequest</strong> object and
returns an <strong>HttpResponse</strong>.</p>

<p>A CBV is every Django view defined as a Python class that extends the <code class="highlighter-rouge">django.views.generic.View</code> abstract class. A
CBV essentially is a class that wraps a FBV. CBVs are great to extend and reuse code.</p>

<p>GCBVs are built-in CBVs that solve specific problems such as listing views, create, update, and delete views.</p>

<p>Below we are going to explore some examples of the different implementation strategies.</p>

<h5 id="function-based-view">Function-Based View</h5>

<p><strong>views.py</strong></p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="k">def</span> <span class="nf">new_post</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">method</span> <span class="o">==</span> <span class="s">'POST'</span><span class="p">:</span>
        <span class="n">form</span> <span class="o">=</span> <span class="n">PostForm</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">POST</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">form</span><span class="o">.</span><span class="n">is_valid</span><span class="p">():</span>
            <span class="n">form</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
            <span class="k">return</span> <span class="n">redirect</span><span class="p">(</span><span class="s">'post_list'</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">form</span> <span class="o">=</span> <span class="n">PostForm</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">render</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s">'new_post.html'</span><span class="p">,</span> <span class="p">{</span><span class="s">'form'</span><span class="p">:</span> <span class="n">form</span><span class="p">})</span></code></pre></figure>

<p><strong>urls.py</strong></p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">urlpatterns</span> <span class="o">=</span> <span class="p">[</span>
    <span class="n">url</span><span class="p">(</span><span class="s">r'^new_post/$'</span><span class="p">,</span> <span class="n">views</span><span class="o">.</span><span class="n">new_post</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s">'new_post'</span><span class="p">),</span>
<span class="p">]</span></code></pre></figure>

<h5 id="class-based-view">Class-Based View</h5>

<p>A CBV is a view that extends the <strong>View</strong> class. The main difference here is that the requests are handled inside class
methods named after the HTTP methods, such as <strong>get</strong>, <strong>post</strong>, <strong>put</strong>, <strong>head</strong>, etc.</p>

<p>So, here we don’t need to do a conditional to check if the request is a <strong>POST</strong> or if it’s a <strong>GET</strong>. The code goes
straight to the right method. This logic is handled internally in the <strong>View</strong> class.</p>

<p><strong>views.py</strong></p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="kn">from</span> <span class="nn">django.views.generic</span> <span class="kn">import</span> <span class="n">View</span>

<span class="k">class</span> <span class="nc">NewPostView</span><span class="p">(</span><span class="n">View</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">post</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">):</span>
        <span class="n">form</span> <span class="o">=</span> <span class="n">PostForm</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">POST</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">form</span><span class="o">.</span><span class="n">is_valid</span><span class="p">():</span>
            <span class="n">form</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
            <span class="k">return</span> <span class="n">redirect</span><span class="p">(</span><span class="s">'post_list'</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">render</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s">'new_post.html'</span><span class="p">,</span> <span class="p">{</span><span class="s">'form'</span><span class="p">:</span> <span class="n">form</span><span class="p">})</span>

    <span class="k">def</span> <span class="nf">get</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">):</span>
        <span class="n">form</span> <span class="o">=</span> <span class="n">PostForm</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">render</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s">'new_post.html'</span><span class="p">,</span> <span class="p">{</span><span class="s">'form'</span><span class="p">:</span> <span class="n">form</span><span class="p">})</span></code></pre></figure>

<p>The way we refer to the CBVs in the <strong>urls.py</strong> module is a little bit different:</p>

<p><strong>urls.py</strong></p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">urlpatterns</span> <span class="o">=</span> <span class="p">[</span>
    <span class="n">url</span><span class="p">(</span><span class="s">r'^new_post/$'</span><span class="p">,</span> <span class="n">views</span><span class="o">.</span><span class="n">NewPostView</span><span class="o">.</span><span class="n">as_view</span><span class="p">(),</span> <span class="n">name</span><span class="o">=</span><span class="s">'new_post'</span><span class="p">),</span>
<span class="p">]</span></code></pre></figure>

<p>Here we need to use the <code class="highlighter-rouge">as_view()</code> class method, which returns a view function to the url patterns. In some cases, we
can also feed the <code class="highlighter-rouge">as_view()</code> with some keyword arguments, so to customize the behavior of the CBV, just like we did
with some of the authentication views to customize the templates.</p>

<p>Anyway, the good thing about CBV is that we can add more methods, and perhaps do something like this:</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="kn">from</span> <span class="nn">django.views.generic</span> <span class="kn">import</span> <span class="n">View</span>

<span class="k">class</span> <span class="nc">NewPostView</span><span class="p">(</span><span class="n">View</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">render</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">render</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s">'new_post.html'</span><span class="p">,</span> <span class="p">{</span><span class="s">'form'</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">form</span><span class="p">})</span>

    <span class="k">def</span> <span class="nf">post</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">form</span> <span class="o">=</span> <span class="n">PostForm</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">POST</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">form</span><span class="o">.</span><span class="n">is_valid</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">form</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
            <span class="k">return</span> <span class="n">redirect</span><span class="p">(</span><span class="s">'post_list'</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">render</span><span class="p">(</span><span class="n">request</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">get</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">form</span> <span class="o">=</span> <span class="n">PostForm</span><span class="p">()</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">render</span><span class="p">(</span><span class="n">request</span><span class="p">)</span></code></pre></figure>

<p>It’s also possible to create some generic views that accomplish some tasks so that we can reuse it across the project.</p>

<p>But that’s pretty much all you need to know about CBVs. Simple as that.</p>

<h5 id="generic-class-based-view">Generic Class-Based View</h5>

<p>Now about the GCBV. That’s a different story. As I mentioned earlier, those views are built-in CBVs for common use
cases. Their implementation makes heavy usage of multiple inheritances (mixins) and other O.O. strategies.</p>

<p>They are very flexible and can save many hours of work. But in the beginning, it can be difficult to work with them.</p>

<p>When I first started working with Django, I found GCBV hard to work with. At first, it’s hard to tell what is going on,
because the code flow is not obvious, as there is good chunk of code hidden in the parent classes. The documentation
is a little bit challenging to follow too, mostly because the attributes and methods are sometimes spread across eight
parent classes. When working with GCBV, it’s always good to have the <a href="https://ccbv.co.uk/" target="_blank" rel="noopener">ccbv.co.uk</a>
opened for quick reference. No worries, we are going to explore it together.</p>

<p>Now let’s see a GCBV example.</p>

<p><strong>views.py</strong></p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="kn">from</span> <span class="nn">django.views.generic</span> <span class="kn">import</span> <span class="n">CreateView</span>

<span class="k">class</span> <span class="nc">NewPostView</span><span class="p">(</span><span class="n">CreateView</span><span class="p">):</span>
    <span class="n">model</span> <span class="o">=</span> <span class="n">Post</span>
    <span class="n">form_class</span> <span class="o">=</span> <span class="n">PostForm</span>
    <span class="n">success_url</span> <span class="o">=</span> <span class="n">reverse_lazy</span><span class="p">(</span><span class="s">'post_list'</span><span class="p">)</span>
    <span class="n">template_name</span> <span class="o">=</span> <span class="s">'new_post.html'</span></code></pre></figure>

<p>Here we are using a generic view used to create model objects. It does all the form processing and save the object
if the form is valid.</p>

<p>Since it’s a CBV, we refer to it in the <strong>urls.py</strong> the same way as any other CBV:</p>

<p><strong>urls.py</strong></p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">urlpatterns</span> <span class="o">=</span> <span class="p">[</span>
    <span class="n">url</span><span class="p">(</span><span class="s">r'^new_post/$'</span><span class="p">,</span> <span class="n">views</span><span class="o">.</span><span class="n">NewPostView</span><span class="o">.</span><span class="n">as_view</span><span class="p">(),</span> <span class="n">name</span><span class="o">=</span><span class="s">'new_post'</span><span class="p">),</span>
<span class="p">]</span></code></pre></figure>

<p>Other examples of GCBVs are <strong>DetailView</strong>, <strong>DeleteView</strong>, <strong>FormView</strong>, <strong>UpdateView</strong>, <strong>ListView</strong>.</p>

<hr />

<h4 id="update-view">Update View</h4>

<p>Let’s get back to the implementation of our project. This time we are going to use a GCBV to implement the
<strong>edit post</strong> view:</p>

<p><img src="../../../../media/series/beginners-guide/1.11/part-6/edit.png" alt="Edit post" /></p>

<p><strong>boards/views.py</strong>
<small><a href="https://gist.github.com/vitorfs/376657085570a3dedf7e5f6e6fffc5e3#file-views-py-L66" target="_blank" rel="noopener nofollow">(view complete file contents)</a></small></p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="kn">from</span> <span class="nn">django.shortcuts</span> <span class="kn">import</span> <span class="n">redirect</span>
<span class="kn">from</span> <span class="nn">django.views.generic</span> <span class="kn">import</span> <span class="n">UpdateView</span>
<span class="kn">from</span> <span class="nn">django.utils</span> <span class="kn">import</span> <span class="n">timezone</span>

<span class="k">class</span> <span class="nc">PostUpdateView</span><span class="p">(</span><span class="n">UpdateView</span><span class="p">):</span>
    <span class="n">model</span> <span class="o">=</span> <span class="n">Post</span>
    <span class="n">fields</span> <span class="o">=</span> <span class="p">(</span><span class="s">'message'</span><span class="p">,</span> <span class="p">)</span>
    <span class="n">template_name</span> <span class="o">=</span> <span class="s">'edit_post.html'</span>
    <span class="n">pk_url_kwarg</span> <span class="o">=</span> <span class="s">'post_pk'</span>
    <span class="n">context_object_name</span> <span class="o">=</span> <span class="s">'post'</span>

    <span class="k">def</span> <span class="nf">form_valid</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">form</span><span class="p">):</span>
        <span class="n">post</span> <span class="o">=</span> <span class="n">form</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">commit</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
        <span class="n">post</span><span class="o">.</span><span class="n">updated_by</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">user</span>
        <span class="n">post</span><span class="o">.</span><span class="n">updated_at</span> <span class="o">=</span> <span class="n">timezone</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>
        <span class="n">post</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">redirect</span><span class="p">(</span><span class="s">'topic_posts'</span><span class="p">,</span> <span class="n">pk</span><span class="o">=</span><span class="n">post</span><span class="o">.</span><span class="n">topic</span><span class="o">.</span><span class="n">board</span><span class="o">.</span><span class="n">pk</span><span class="p">,</span> <span class="n">topic_pk</span><span class="o">=</span><span class="n">post</span><span class="o">.</span><span class="n">topic</span><span class="o">.</span><span class="n">pk</span><span class="p">)</span></code></pre></figure>

<p>With the <strong>UpdateView</strong> and the <strong>CreateView</strong>, we have the option to either define <strong>form_class</strong> or the <strong>fields</strong>
attribute. In the example above we are using the <strong>fields</strong> attribute to create a model form on-the-fly. Internally,
Django will use a model form factory to compose a form of the <strong>Post</strong> model. Since it’s a very simple form with just
the <strong>message</strong> field, we can afford to work like this. But for complex form definitions, it’s better to define a model
form externally and refer to it here.</p>

<p>The <strong>pk_url_kwarg</strong> will be used to identify the name of the keyword argument used to retrieve the <strong>Post</strong> object.
It’s the same as we define in the <strong>urls.py</strong>.</p>

<p>If we don’t set the <strong>context_object_name</strong> attribute, the <strong>Post</strong> object will be available in the template as
“object.” So, here we are using the <strong>context_object_name</strong> to rename it to <strong>post</strong> instead. You will see how we are
using it in the template below.</p>

<p>In this particular example, we had to override the <strong>form_valid()</strong> method so as to set some extra fields such as the
<strong>updated_by</strong> and <strong>updated_at</strong>. You can see what the base <strong>form_valid()</strong> method looks like here:
<a href="https://ccbv.co.uk/projects/Django/1.11/django.views.generic.edit/UpdateView/#form_valid" target="_blank" rel="noopener">UpdateView#form_valid</a>.</p>

<p><strong>myproject/urls.py</strong>
<small><a href="https://gist.github.com/vitorfs/376657085570a3dedf7e5f6e6fffc5e3#file-urls-py-L40" target="_blank" rel="noopener nofollow">(view complete file contents)</a></small></p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="kn">from</span> <span class="nn">django.conf.urls</span> <span class="kn">import</span> <span class="n">url</span>
<span class="kn">from</span> <span class="nn">boards</span> <span class="kn">import</span> <span class="n">views</span>

<span class="n">urlpatterns</span> <span class="o">=</span> <span class="p">[</span>
    <span class="c"># ...</span>
    <span class="n">url</span><span class="p">(</span><span class="s">r'^boards/(?P&lt;pk&gt;</span><span class="err">\</span><span class="s">d+)/topics/(?P&lt;topic_pk&gt;</span><span class="err">\</span><span class="s">d+)/posts/(?P&lt;post_pk&gt;</span><span class="err">\</span><span class="s">d+)/edit/$'</span><span class="p">,</span>
        <span class="n">views</span><span class="o">.</span><span class="n">PostUpdateView</span><span class="o">.</span><span class="n">as_view</span><span class="p">(),</span> <span class="n">name</span><span class="o">=</span><span class="s">'edit_post'</span><span class="p">),</span>
<span class="p">]</span></code></pre></figure>

<p>Now we can add the link to the edit page:</p>

<p><strong>templates/topic_posts.html</strong>
<small><a href="https://gist.github.com/vitorfs/589d31af9d06c5b21ec9b1623be0c357#file-topic_posts-html-L40" target="_blank" rel="noopener nofollow">(view complete file contents)</a></small></p>

<figure class="highlight"><pre><code class="language-django" data-lang="django"><span class="cp">{%</span> <span class="k">if</span> <span class="nv">post.created_by</span> <span class="o">==</span> <span class="nv">user</span> <span class="cp">%}</span>
  <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"mt-3"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">"</span><span class="cp">{%</span> <span class="nv">url</span> <span class="s1">'edit_post'</span> <span class="nv">post.topic.board.pk</span> <span class="nv">post.topic.pk</span> <span class="nv">post.pk</span> <span class="cp">%}</span><span class="s">"</span>
       <span class="na">class=</span><span class="s">"btn btn-primary btn-sm"</span>
       <span class="na">role=</span><span class="s">"button"</span><span class="nt">&gt;</span>Edit<span class="nt">&lt;/a&gt;</span>
  <span class="nt">&lt;/div&gt;</span>
<span class="cp">{%</span> <span class="k">endif</span> <span class="cp">%}</span></code></pre></figure>

<p><strong>templates/edit_post.html</strong>
<small><a href="https://gist.github.com/vitorfs/376657085570a3dedf7e5f6e6fffc5e3#file-edit_post-html" target="_blank" rel="noopener nofollow">(view complete file contents)</a></small></p>

<figure class="highlight"><pre><code class="language-django" data-lang="django"><span class="cp">{%</span> <span class="k">extends</span> <span class="s1">'base.html'</span> <span class="cp">%}</span>

<span class="cp">{%</span> <span class="k">block</span> <span class="nv">title</span> <span class="cp">%}</span>Edit post<span class="cp">{%</span> <span class="k">endblock</span> <span class="cp">%}</span>

<span class="cp">{%</span> <span class="k">block</span> <span class="nv">breadcrumb</span> <span class="cp">%}</span>
  <span class="nt">&lt;li</span> <span class="na">class=</span><span class="s">"breadcrumb-item"</span><span class="nt">&gt;&lt;a</span> <span class="na">href=</span><span class="s">"</span><span class="cp">{%</span> <span class="nv">url</span> <span class="s1">'home'</span> <span class="cp">%}</span><span class="s">"</span><span class="nt">&gt;</span>Boards<span class="nt">&lt;/a&gt;&lt;/li&gt;</span>
  <span class="nt">&lt;li</span> <span class="na">class=</span><span class="s">"breadcrumb-item"</span><span class="nt">&gt;&lt;a</span> <span class="na">href=</span><span class="s">"</span><span class="cp">{%</span> <span class="nv">url</span> <span class="s1">'board_topics'</span> <span class="nv">post.topic.board.pk</span> <span class="cp">%}</span><span class="s">"</span><span class="nt">&gt;</span><span class="cp">{{</span> <span class="nv">post.topic.board.name</span> <span class="cp">}}</span><span class="nt">&lt;/a&gt;&lt;/li&gt;</span>
  <span class="nt">&lt;li</span> <span class="na">class=</span><span class="s">"breadcrumb-item"</span><span class="nt">&gt;&lt;a</span> <span class="na">href=</span><span class="s">"</span><span class="cp">{%</span> <span class="nv">url</span> <span class="s1">'topic_posts'</span> <span class="nv">post.topic.board.pk</span> <span class="nv">post.topic.pk</span> <span class="cp">%}</span><span class="s">"</span><span class="nt">&gt;</span><span class="cp">{{</span> <span class="nv">post.topic.subject</span> <span class="cp">}}</span><span class="nt">&lt;/a&gt;&lt;/li&gt;</span>
  <span class="nt">&lt;li</span> <span class="na">class=</span><span class="s">"breadcrumb-item active"</span><span class="nt">&gt;</span>Edit post<span class="nt">&lt;/li&gt;</span>
<span class="cp">{%</span> <span class="k">endblock</span> <span class="cp">%}</span>

<span class="cp">{%</span> <span class="k">block</span> <span class="nv">content</span> <span class="cp">%}</span>
  <span class="nt">&lt;form</span> <span class="na">method=</span><span class="s">"post"</span> <span class="na">class=</span><span class="s">"mb-4"</span> <span class="na">novalidate</span><span class="nt">&gt;</span>
    <span class="cp">{%</span> <span class="nv">csrf_token</span> <span class="cp">%}</span>
    <span class="cp">{%</span> <span class="k">include</span> <span class="s1">'includes/form.html'</span> <span class="cp">%}</span>
    <span class="nt">&lt;button</span> <span class="na">type=</span><span class="s">"submit"</span> <span class="na">class=</span><span class="s">"btn btn-success"</span><span class="nt">&gt;</span>Save changes<span class="nt">&lt;/button&gt;</span>
    <span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">"</span><span class="cp">{%</span> <span class="nv">url</span> <span class="s1">'topic_posts'</span> <span class="nv">post.topic.board.pk</span> <span class="nv">post.topic.pk</span> <span class="cp">%}</span><span class="s">"</span> <span class="na">class=</span><span class="s">"btn btn-outline-secondary"</span> <span class="na">role=</span><span class="s">"button"</span><span class="nt">&gt;</span>Cancel<span class="nt">&lt;/a&gt;</span>
  <span class="nt">&lt;/form&gt;</span>
<span class="cp">{%</span> <span class="k">endblock</span> <span class="cp">%}</span></code></pre></figure>

<p>Observe now how we are navigating through the post object: <strong>post.topic.board.pk</strong>. If we didn’t set the
<strong>context_object_name</strong> to <strong>post</strong>, it would be available as: <strong>object.topic.board.pk</strong>. Got it?</p>

<p><img src="../../../../media/series/beginners-guide/1.11/part-6/edit-1.png" alt="Edit post" /></p>

<h5 id="testing-the-update-view">Testing The Update View</h5>

<p>Create a new test file named <strong>test_view_edit_post.py</strong> inside the <strong>boards/tests</strong> folder. Clicking on the link below
you will see many routine tests, just like we have been doing in this tutorial. So I will just highlight the new parts
here:</p>

<p><strong>boards/tests/test_view_edit_post.py</strong>
<small><a href="https://gist.github.com/vitorfs/286917ce31687732eba4e545fc3cbdea" target="_blank" rel="noopener nofollow">(view complete file contents)</a></small></p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="kn">from</span> <span class="nn">django.contrib.auth.models</span> <span class="kn">import</span> <span class="n">User</span>
<span class="kn">from</span> <span class="nn">django.test</span> <span class="kn">import</span> <span class="n">TestCase</span>
<span class="kn">from</span> <span class="nn">django.urls</span> <span class="kn">import</span> <span class="n">reverse</span>
<span class="kn">from</span> <span class="nn">..models</span> <span class="kn">import</span> <span class="n">Board</span><span class="p">,</span> <span class="n">Post</span><span class="p">,</span> <span class="n">Topic</span>
<span class="kn">from</span> <span class="nn">..views</span> <span class="kn">import</span> <span class="n">PostUpdateView</span>

<span class="k">class</span> <span class="nc">PostUpdateViewTestCase</span><span class="p">(</span><span class="n">TestCase</span><span class="p">):</span>
    <span class="s">'''
    Base test case to be used in all `PostUpdateView` view tests
    '''</span>
    <span class="k">def</span> <span class="nf">setUp</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">board</span> <span class="o">=</span> <span class="n">Board</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s">'Django'</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="s">'Django board.'</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">username</span> <span class="o">=</span> <span class="s">'john'</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">password</span> <span class="o">=</span> <span class="s">'123'</span>
        <span class="n">user</span> <span class="o">=</span> <span class="n">User</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">create_user</span><span class="p">(</span><span class="n">username</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">username</span><span class="p">,</span> <span class="n">email</span><span class="o">=</span><span class="s">'john@doe.com'</span><span class="p">,</span> <span class="n">password</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">password</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">topic</span> <span class="o">=</span> <span class="n">Topic</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">subject</span><span class="o">=</span><span class="s">'Hello, world'</span><span class="p">,</span> <span class="n">board</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">board</span><span class="p">,</span> <span class="n">starter</span><span class="o">=</span><span class="n">user</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">post</span> <span class="o">=</span> <span class="n">Post</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">message</span><span class="o">=</span><span class="s">'Lorem ipsum dolor sit amet'</span><span class="p">,</span> <span class="n">topic</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">topic</span><span class="p">,</span> <span class="n">created_by</span><span class="o">=</span><span class="n">user</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">url</span> <span class="o">=</span> <span class="n">reverse</span><span class="p">(</span><span class="s">'edit_post'</span><span class="p">,</span> <span class="n">kwargs</span><span class="o">=</span><span class="p">{</span>
            <span class="s">'pk'</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">board</span><span class="o">.</span><span class="n">pk</span><span class="p">,</span>
            <span class="s">'topic_pk'</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">topic</span><span class="o">.</span><span class="n">pk</span><span class="p">,</span>
            <span class="s">'post_pk'</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">post</span><span class="o">.</span><span class="n">pk</span>
        <span class="p">})</span>

<span class="k">class</span> <span class="nc">LoginRequiredPostUpdateViewTests</span><span class="p">(</span><span class="n">PostUpdateViewTestCase</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">test_redirection</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="s">'''
        Test if only logged in users can edit the posts
        '''</span>
        <span class="n">login_url</span> <span class="o">=</span> <span class="n">reverse</span><span class="p">(</span><span class="s">'login'</span><span class="p">)</span>
        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">url</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertRedirects</span><span class="p">(</span><span class="n">response</span><span class="p">,</span> <span class="s">'{login_url}?next={url}'</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">login_url</span><span class="o">=</span><span class="n">login_url</span><span class="p">,</span> <span class="n">url</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">url</span><span class="p">))</span>

<span class="k">class</span> <span class="nc">UnauthorizedPostUpdateViewTests</span><span class="p">(</span><span class="n">PostUpdateViewTestCase</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">setUp</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="s">'''
        Create a new user different from the one who posted
        '''</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">setUp</span><span class="p">()</span>
        <span class="n">username</span> <span class="o">=</span> <span class="s">'jane'</span>
        <span class="n">password</span> <span class="o">=</span> <span class="s">'321'</span>
        <span class="n">user</span> <span class="o">=</span> <span class="n">User</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">create_user</span><span class="p">(</span><span class="n">username</span><span class="o">=</span><span class="n">username</span><span class="p">,</span> <span class="n">email</span><span class="o">=</span><span class="s">'jane@doe.com'</span><span class="p">,</span> <span class="n">password</span><span class="o">=</span><span class="n">password</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">login</span><span class="p">(</span><span class="n">username</span><span class="o">=</span><span class="n">username</span><span class="p">,</span> <span class="n">password</span><span class="o">=</span><span class="n">password</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">url</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">test_status_code</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="s">'''
        A topic should be edited only by the owner.
        Unauthorized users should get a 404 response (Page Not Found)
        '''</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">response</span><span class="o">.</span><span class="n">status_code</span><span class="p">,</span> <span class="mi">404</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">PostUpdateViewTests</span><span class="p">(</span><span class="n">PostUpdateViewTestCase</span><span class="p">):</span>
    <span class="c"># ...</span>

<span class="k">class</span> <span class="nc">SuccessfulPostUpdateViewTests</span><span class="p">(</span><span class="n">PostUpdateViewTestCase</span><span class="p">):</span>
    <span class="c"># ...</span>

<span class="k">class</span> <span class="nc">InvalidPostUpdateViewTests</span><span class="p">(</span><span class="n">PostUpdateViewTestCase</span><span class="p">):</span>
    <span class="c"># ...</span></code></pre></figure>

<p>For now, the important parts are: <strong>PostUpdateViewTestCase</strong> is a class we defined to be reused across the other
test cases. It’s just the basic setup, creating users, topic, boards, and so on.</p>

<p>The class <strong>LoginRequiredPostUpdateViewTests</strong> will test if the view is protected with the <code class="highlighter-rouge">@login_required</code>
decorator. That is if only authenticated users can access the edit page.</p>

<p>The class <strong>UnauthorizedPostUpdateViewTests</strong> creates a new user, different from the one who posted and tries to
access the edit page. The application should only authorize the owner of the post to edit it.</p>

<p>Let’s run the tests:</p>

<figure class="highlight"><pre><code class="language-text" data-lang="text">python manage.py test boards.tests.test_view_edit_post</code></pre></figure>

<figure class="highlight"><pre><code class="language-text" data-lang="text">Creating test database for alias 'default'...
System check identified no issues (0 silenced).
..F.......F
======================================================================
FAIL: test_redirection (boards.tests.test_view_edit_post.LoginRequiredPostUpdateViewTests)
----------------------------------------------------------------------
...
AssertionError: 200 != 302 : Response didn't redirect as expected: Response code was 200 (expected 302)

======================================================================
FAIL: test_status_code (boards.tests.test_view_edit_post.UnauthorizedPostUpdateViewTests)
----------------------------------------------------------------------
...
AssertionError: 200 != 404

----------------------------------------------------------------------
Ran 11 tests in 1.360s

FAILED (failures=2)
Destroying test database for alias 'default'...</code></pre></figure>

<p>First, let’s fix the problem with the <code class="highlighter-rouge">@login_required</code> decorator. The way we use view decorators on class-based views
is a little bit different. We need an extra import:</p>

<p><strong>boards/views.py</strong>
<small><a href="https://gist.github.com/vitorfs/826a6d421ebbeb80a0aee8e1b9b70398#file-views-py-L67" target="_blank" rel="noopener nofollow">(view complete file contents)</a></small></p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="kn">from</span> <span class="nn">django.contrib.auth.decorators</span> <span class="kn">import</span> <span class="n">login_required</span>
<span class="kn">from</span> <span class="nn">django.shortcuts</span> <span class="kn">import</span> <span class="n">redirect</span>
<span class="kn">from</span> <span class="nn">django.views.generic</span> <span class="kn">import</span> <span class="n">UpdateView</span>
<span class="kn">from</span> <span class="nn">django.utils</span> <span class="kn">import</span> <span class="n">timezone</span>
<span class="kn">from</span> <span class="nn">django.utils.decorators</span> <span class="kn">import</span> <span class="n">method_decorator</span>
<span class="kn">from</span> <span class="nn">.models</span> <span class="kn">import</span> <span class="n">Post</span>

<span class="nd">@method_decorator</span><span class="p">(</span><span class="n">login_required</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s">'dispatch'</span><span class="p">)</span>
<span class="k">class</span> <span class="nc">PostUpdateView</span><span class="p">(</span><span class="n">UpdateView</span><span class="p">):</span>
    <span class="n">model</span> <span class="o">=</span> <span class="n">Post</span>
    <span class="n">fields</span> <span class="o">=</span> <span class="p">(</span><span class="s">'message'</span><span class="p">,</span> <span class="p">)</span>
    <span class="n">template_name</span> <span class="o">=</span> <span class="s">'edit_post.html'</span>
    <span class="n">pk_url_kwarg</span> <span class="o">=</span> <span class="s">'post_pk'</span>
    <span class="n">context_object_name</span> <span class="o">=</span> <span class="s">'post'</span>

    <span class="k">def</span> <span class="nf">form_valid</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">form</span><span class="p">):</span>
        <span class="n">post</span> <span class="o">=</span> <span class="n">form</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">commit</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
        <span class="n">post</span><span class="o">.</span><span class="n">updated_by</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">user</span>
        <span class="n">post</span><span class="o">.</span><span class="n">updated_at</span> <span class="o">=</span> <span class="n">timezone</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>
        <span class="n">post</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">redirect</span><span class="p">(</span><span class="s">'topic_posts'</span><span class="p">,</span> <span class="n">pk</span><span class="o">=</span><span class="n">post</span><span class="o">.</span><span class="n">topic</span><span class="o">.</span><span class="n">board</span><span class="o">.</span><span class="n">pk</span><span class="p">,</span> <span class="n">topic_pk</span><span class="o">=</span><span class="n">post</span><span class="o">.</span><span class="n">topic</span><span class="o">.</span><span class="n">pk</span><span class="p">)</span></code></pre></figure>

<p>We can’t decorate the class directly with the <code class="highlighter-rouge">@login_required</code> decorator. We have to use the utility
<code class="highlighter-rouge">@method_decorator</code>, and pass a decorator (or a list of decorators) and tell which method should be decorated. In
class-based views it’s common to decorate the <strong>dispatch</strong> method. It’s an internal method Django use (defined inside
the View class). All requests pass through this method, so it’s safe to decorate it.</p>

<p>Run the tests:</p>

<figure class="highlight"><pre><code class="language-text" data-lang="text">python manage.py test boards.tests.test_view_edit_post</code></pre></figure>

<figure class="highlight"><pre><code class="language-text" data-lang="text">Creating test database for alias 'default'...
System check identified no issues (0 silenced).
..........F
======================================================================
FAIL: test_status_code (boards.tests.test_view_edit_post.UnauthorizedPostUpdateViewTests)
----------------------------------------------------------------------
...
AssertionError: 200 != 404

----------------------------------------------------------------------
Ran 11 tests in 1.353s

FAILED (failures=1)
Destroying test database for alias 'default'...</code></pre></figure>

<p>Okay! We fixed the <code class="highlighter-rouge">@login_required</code> problem. Now we have to deal with the other users editing any posts problem.</p>

<p>The easiest way to solve this problem is by overriding the <code class="highlighter-rouge">get_queryset</code> method of the <strong>UpdateView</strong>. You can see
what the original method looks like here <a href="https://ccbv.co.uk/projects/Django/1.11/django.views.generic.edit/UpdateView/#get_queryset" target="_blank" rel="noopener">UpdateView#get_queryset</a>.</p>

<p><strong>boards/views.py</strong>
<small><a href="https://gist.github.com/vitorfs/667d8439ecf05e58f14fcc74672e48da" target="_blank" rel="noopener nofollow">(view complete file contents)</a></small></p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="nd">@method_decorator</span><span class="p">(</span><span class="n">login_required</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s">'dispatch'</span><span class="p">)</span>
<span class="k">class</span> <span class="nc">PostUpdateView</span><span class="p">(</span><span class="n">UpdateView</span><span class="p">):</span>
    <span class="n">model</span> <span class="o">=</span> <span class="n">Post</span>
    <span class="n">fields</span> <span class="o">=</span> <span class="p">(</span><span class="s">'message'</span><span class="p">,</span> <span class="p">)</span>
    <span class="n">template_name</span> <span class="o">=</span> <span class="s">'edit_post.html'</span>
    <span class="n">pk_url_kwarg</span> <span class="o">=</span> <span class="s">'post_pk'</span>
    <span class="n">context_object_name</span> <span class="o">=</span> <span class="s">'post'</span>

    <span class="k">def</span> <span class="nf">get_queryset</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">queryset</span> <span class="o">=</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">get_queryset</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">queryset</span><span class="o">.</span><span class="nb">filter</span><span class="p">(</span><span class="n">created_by</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">user</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">form_valid</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">form</span><span class="p">):</span>
        <span class="n">post</span> <span class="o">=</span> <span class="n">form</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">commit</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
        <span class="n">post</span><span class="o">.</span><span class="n">updated_by</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">user</span>
        <span class="n">post</span><span class="o">.</span><span class="n">updated_at</span> <span class="o">=</span> <span class="n">timezone</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>
        <span class="n">post</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">redirect</span><span class="p">(</span><span class="s">'topic_posts'</span><span class="p">,</span> <span class="n">pk</span><span class="o">=</span><span class="n">post</span><span class="o">.</span><span class="n">topic</span><span class="o">.</span><span class="n">board</span><span class="o">.</span><span class="n">pk</span><span class="p">,</span> <span class="n">topic_pk</span><span class="o">=</span><span class="n">post</span><span class="o">.</span><span class="n">topic</span><span class="o">.</span><span class="n">pk</span><span class="p">)</span></code></pre></figure>

<p>With the line <code class="highlighter-rouge">queryset = super().get_queryset()</code> we are reusing the <code class="highlighter-rouge">get_queryset</code> method from the parent class, that
is, the <strong>UpateView</strong> class. Then, we are adding an extra filter to the queryset, which is filtering the post using
the logged in user, available inside the <strong>request</strong> object.</p>

<p>Test it again:</p>

<figure class="highlight"><pre><code class="language-text" data-lang="text">python manage.py test boards.tests.test_view_edit_post</code></pre></figure>

<figure class="highlight"><pre><code class="language-text" data-lang="text">Creating test database for alias 'default'...
System check identified no issues (0 silenced).
...........
----------------------------------------------------------------------
Ran 11 tests in 1.321s

OK
Destroying test database for alias 'default'...</code></pre></figure>

<p>All good!</p>

<hr />

<h4 id="list-view">List View</h4>

<p>We could refactor some of our existing views to take advantage of the CBV capabilities. Take the home page for example.
We are just grabbing all the boards from the database and listing it in the HTML:</p>

<p><strong>boards/views.py</strong></p>

<figure class="highlight"><pre><code class="language-django" data-lang="django">from django.shortcuts import render
from .models import Board

def home(request):
    boards = Board.objects.all()
    return render(request, 'home.html', {'boards': boards})</code></pre></figure>

<p>Here is how we could rewrite it using a GCBV for models listing:</p>

<p><strong>boards/views.py</strong>
<small><a href="https://gist.github.com/vitorfs/5e248d9a4499e2a796c6ffee9cbb1125#file-views-py-L12" target="_blank" rel="noopener nofollow">(view complete file contents)</a></small></p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="kn">from</span> <span class="nn">django.views.generic</span> <span class="kn">import</span> <span class="n">ListView</span>
<span class="kn">from</span> <span class="nn">.models</span> <span class="kn">import</span> <span class="n">Board</span>

<span class="k">class</span> <span class="nc">BoardListView</span><span class="p">(</span><span class="n">ListView</span><span class="p">):</span>
    <span class="n">model</span> <span class="o">=</span> <span class="n">Board</span>
    <span class="n">context_object_name</span> <span class="o">=</span> <span class="s">'boards'</span>
    <span class="n">template_name</span> <span class="o">=</span> <span class="s">'home.html'</span></code></pre></figure>

<p>Then we have to change the reference in the <strong>urls.py</strong> module:</p>

<p><strong>myproject/urls.py</strong>
<small><a href="https://gist.github.com/vitorfs/a0a826233d95a4cc53a75afc441db1e9#file-urls-py-L10" target="_blank" rel="noopener nofollow">(view complete file contents)</a></small></p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="kn">from</span> <span class="nn">django.conf.urls</span> <span class="kn">import</span> <span class="n">url</span>
<span class="kn">from</span> <span class="nn">boards</span> <span class="kn">import</span> <span class="n">views</span>

<span class="n">urlpatterns</span> <span class="o">=</span> <span class="p">[</span>
    <span class="n">url</span><span class="p">(</span><span class="s">r'^$'</span><span class="p">,</span> <span class="n">views</span><span class="o">.</span><span class="n">BoardListView</span><span class="o">.</span><span class="n">as_view</span><span class="p">(),</span> <span class="n">name</span><span class="o">=</span><span class="s">'home'</span><span class="p">),</span>
    <span class="c"># ...</span>
<span class="p">]</span></code></pre></figure>

<p>If we check the homepage we will see that nothing really changed, everything is working as expected. But we have to
tweak our tests a little bit because now we are dealing with a class-based view:</p>

<p><strong>boards/tests/test_view_home.py</strong>
<small><a href="https://gist.github.com/vitorfs/e17216ce3d92110cf7e005ce3288c587" target="_blank" rel="noopener nofollow">(view complete file contents)</a></small></p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="kn">from</span> <span class="nn">django.test</span> <span class="kn">import</span> <span class="n">TestCase</span>
<span class="kn">from</span> <span class="nn">django.urls</span> <span class="kn">import</span> <span class="n">resolve</span>
<span class="kn">from</span> <span class="nn">..views</span> <span class="kn">import</span> <span class="n">BoardListView</span>

<span class="k">class</span> <span class="nc">HomeTests</span><span class="p">(</span><span class="n">TestCase</span><span class="p">):</span>
    <span class="c"># ...</span>
    <span class="k">def</span> <span class="nf">test_home_url_resolves_home_view</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">view</span> <span class="o">=</span> <span class="n">resolve</span><span class="p">(</span><span class="s">'/'</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">view</span><span class="o">.</span><span class="n">func</span><span class="o">.</span><span class="n">view_class</span><span class="p">,</span> <span class="n">BoardListView</span><span class="p">)</span></code></pre></figure>

<h5 id="pagination">Pagination</h5>

<p>We can very easily implement pagination with class-based views. But first I wanted to do a pagination by hand, so that
we can explore better the mechanics behind it, so it doesn’t look like magic.</p>

<p>It wouldn’t really make sense to paginate the boards listing view because we do not expect to have many boards. But
definitely the topics listing and the posts listing need some pagination.</p>

<p>From now on, we will be working on the <strong>board_topics</strong> view.</p>

<p>First, let’s add some volume of posts. We could just use the application’s user interface and add several posts, or
open the Python shell and write a small script to do it for us:</p>

<figure class="highlight"><pre><code class="language-text" data-lang="text">python manage.py shell</code></pre></figure>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="kn">from</span> <span class="nn">django.contrib.auth.models</span> <span class="kn">import</span> <span class="n">User</span>
<span class="kn">from</span> <span class="nn">boards.models</span> <span class="kn">import</span> <span class="n">Board</span><span class="p">,</span> <span class="n">Topic</span><span class="p">,</span> <span class="n">Post</span>

<span class="n">user</span> <span class="o">=</span> <span class="n">User</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">first</span><span class="p">()</span>

<span class="n">board</span> <span class="o">=</span> <span class="n">Board</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s">'Django'</span><span class="p">)</span>

<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">100</span><span class="p">):</span>
    <span class="n">subject</span> <span class="o">=</span> <span class="s">'Topic test #{}'</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
    <span class="n">topic</span> <span class="o">=</span> <span class="n">Topic</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">subject</span><span class="o">=</span><span class="n">subject</span><span class="p">,</span> <span class="n">board</span><span class="o">=</span><span class="n">board</span><span class="p">,</span> <span class="n">starter</span><span class="o">=</span><span class="n">user</span><span class="p">)</span>
    <span class="n">Post</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">message</span><span class="o">=</span><span class="s">'Lorem ipsum...'</span><span class="p">,</span> <span class="n">topic</span><span class="o">=</span><span class="n">topic</span><span class="p">,</span> <span class="n">created_by</span><span class="o">=</span><span class="n">user</span><span class="p">)</span></code></pre></figure>

<p><img src="../../../../media/series/beginners-guide/1.11/part-6/topics.png" alt="Topics" /></p>

<p>Good, now we have some data to play with.</p>

<p>Before we jump into the code, let’s experiment a little bit more with the Python shell:</p>

<figure class="highlight"><pre><code class="language-text" data-lang="text">python manage.py shell</code></pre></figure>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="kn">from</span> <span class="nn">boards.models</span> <span class="kn">import</span> <span class="n">Topic</span>

<span class="c"># All the topics in the app</span>
<span class="n">Topic</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">count</span><span class="p">()</span>
<span class="mi">107</span>

<span class="c"># Just the topics in the Django board</span>
<span class="n">Topic</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="nb">filter</span><span class="p">(</span><span class="n">board__name</span><span class="o">=</span><span class="s">'Django'</span><span class="p">)</span><span class="o">.</span><span class="n">count</span><span class="p">()</span>
<span class="mi">104</span>

<span class="c"># Let's save this queryset into a variable to paginate it</span>
<span class="n">queryset</span> <span class="o">=</span> <span class="n">Topic</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="nb">filter</span><span class="p">(</span><span class="n">board__name</span><span class="o">=</span><span class="s">'Django'</span><span class="p">)</span><span class="o">.</span><span class="n">order_by</span><span class="p">(</span><span class="s">'-last_updated'</span><span class="p">)</span></code></pre></figure>

<p>It’s very important always define an ordering to a <strong>QuerySet</strong> you are going to paginate! Otherwise, it can give you
inconsistent results.</p>

<p>Now let’s import the <strong>Paginator</strong> utility:</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="kn">from</span> <span class="nn">django.core.paginator</span> <span class="kn">import</span> <span class="n">Paginator</span>

<span class="n">paginator</span> <span class="o">=</span> <span class="n">Paginator</span><span class="p">(</span><span class="n">queryset</span><span class="p">,</span> <span class="mi">20</span><span class="p">)</span></code></pre></figure>

<p>Here we are telling Django to paginate our <strong>QuerySet</strong> in pages of 20 each. Now let’s explore some of the paginator
properties:</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="c"># count the number of elements in the paginator</span>
<span class="n">paginator</span><span class="o">.</span><span class="n">count</span>
<span class="mi">104</span>

<span class="c"># total number of pages</span>
<span class="c"># 104 elements, paginating 20 per page gives you 6 pages</span>
<span class="c"># where the last page will have only 4 elements</span>
<span class="n">paginator</span><span class="o">.</span><span class="n">num_pages</span>
<span class="mi">6</span>

<span class="c"># range of pages that can be used to iterate and create the</span>
<span class="c"># links to the pages in the template</span>
<span class="n">paginator</span><span class="o">.</span><span class="n">page_range</span>
<span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">7</span><span class="p">)</span>

<span class="c"># returns a Page instance</span>
<span class="n">paginator</span><span class="o">.</span><span class="n">page</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
<span class="o">&lt;</span><span class="n">Page</span> <span class="mi">2</span> <span class="n">of</span> <span class="mi">6</span><span class="o">&gt;</span>

<span class="n">page</span> <span class="o">=</span> <span class="n">paginator</span><span class="o">.</span><span class="n">page</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>

<span class="nb">type</span><span class="p">(</span><span class="n">page</span><span class="p">)</span>
<span class="n">django</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">paginator</span><span class="o">.</span><span class="n">Page</span>

<span class="nb">type</span><span class="p">(</span><span class="n">paginator</span><span class="p">)</span>
<span class="n">django</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">paginator</span><span class="o">.</span><span class="n">Paginator</span></code></pre></figure>

<p>Here we have to pay attention because if we try to get a page that doesn’t exist, the Paginator will throw an
exception:</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">paginator</span><span class="o">.</span><span class="n">page</span><span class="p">(</span><span class="mi">7</span><span class="p">)</span>
<span class="n">EmptyPage</span><span class="p">:</span> <span class="n">That</span> <span class="n">page</span> <span class="n">contains</span> <span class="n">no</span> <span class="n">results</span></code></pre></figure>

<p>Or if we try to pass an arbitrary parameter, which is not a page number:</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">paginator</span><span class="o">.</span><span class="n">page</span><span class="p">(</span><span class="s">'abc'</span><span class="p">)</span>
<span class="n">PageNotAnInteger</span><span class="p">:</span> <span class="n">That</span> <span class="n">page</span> <span class="n">number</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">an</span> <span class="n">integer</span></code></pre></figure>

<p>We have to keep those details in mind when designing the user interface.</p>

<p>Now let’s explore the attributes and methods offered by the <strong>Page</strong> class a little bit:</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">page</span> <span class="o">=</span> <span class="n">paginator</span><span class="o">.</span><span class="n">page</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

<span class="c"># Check if there is another page after this one</span>
<span class="n">page</span><span class="o">.</span><span class="n">has_next</span><span class="p">()</span>
<span class="bp">True</span>

<span class="c"># If there is no previous page, that means this one is the first page</span>
<span class="n">page</span><span class="o">.</span><span class="n">has_previous</span><span class="p">()</span>
<span class="bp">False</span>

<span class="n">page</span><span class="o">.</span><span class="n">has_other_pages</span><span class="p">()</span>
<span class="bp">True</span>

<span class="n">page</span><span class="o">.</span><span class="n">next_page_number</span><span class="p">()</span>
<span class="mi">2</span>

<span class="c"># Take care here, since there is no previous page,</span>
<span class="c"># if we call the method `previous_page_number() we will get an exception:</span>
<span class="n">page</span><span class="o">.</span><span class="n">previous_page_number</span><span class="p">()</span>
<span class="n">EmptyPage</span><span class="p">:</span> <span class="n">That</span> <span class="n">page</span> <span class="n">number</span> <span class="ow">is</span> <span class="n">less</span> <span class="n">than</span> <span class="mi">1</span></code></pre></figure>

<h5 id="fbv-pagination">FBV Pagination</h5>

<p>Here is how we do it using regular function-based views:</p>

<p><strong>boards/views.py</strong>
<small><a href="https://gist.github.com/vitorfs/16f0ac257439245fa6645af259d8846f#file-views-py-L19" target="_blank" rel="noopener nofollow">(view complete file contents)</a></small></p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="kn">from</span> <span class="nn">django.db.models</span> <span class="kn">import</span> <span class="n">Count</span>
<span class="kn">from</span> <span class="nn">django.core.paginator</span> <span class="kn">import</span> <span class="n">Paginator</span><span class="p">,</span> <span class="n">EmptyPage</span><span class="p">,</span> <span class="n">PageNotAnInteger</span>
<span class="kn">from</span> <span class="nn">django.shortcuts</span> <span class="kn">import</span> <span class="n">get_object_or_404</span><span class="p">,</span> <span class="n">render</span>
<span class="kn">from</span> <span class="nn">django.views.generic</span> <span class="kn">import</span> <span class="n">ListView</span>
<span class="kn">from</span> <span class="nn">.models</span> <span class="kn">import</span> <span class="n">Board</span>

<span class="k">def</span> <span class="nf">board_topics</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">pk</span><span class="p">):</span>
    <span class="n">board</span> <span class="o">=</span> <span class="n">get_object_or_404</span><span class="p">(</span><span class="n">Board</span><span class="p">,</span> <span class="n">pk</span><span class="o">=</span><span class="n">pk</span><span class="p">)</span>
    <span class="n">queryset</span> <span class="o">=</span> <span class="n">board</span><span class="o">.</span><span class="n">topics</span><span class="o">.</span><span class="n">order_by</span><span class="p">(</span><span class="s">'-last_updated'</span><span class="p">)</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="n">replies</span><span class="o">=</span><span class="n">Count</span><span class="p">(</span><span class="s">'posts'</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">page</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">GET</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">'page'</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

    <span class="n">paginator</span> <span class="o">=</span> <span class="n">Paginator</span><span class="p">(</span><span class="n">queryset</span><span class="p">,</span> <span class="mi">20</span><span class="p">)</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="n">topics</span> <span class="o">=</span> <span class="n">paginator</span><span class="o">.</span><span class="n">page</span><span class="p">(</span><span class="n">page</span><span class="p">)</span>
    <span class="k">except</span> <span class="n">PageNotAnInteger</span><span class="p">:</span>
        <span class="c"># fallback to the first page</span>
        <span class="n">topics</span> <span class="o">=</span> <span class="n">paginator</span><span class="o">.</span><span class="n">page</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
    <span class="k">except</span> <span class="n">EmptyPage</span><span class="p">:</span>
        <span class="c"># probably the user tried to add a page number</span>
        <span class="c"># in the url, so we fallback to the last page</span>
        <span class="n">topics</span> <span class="o">=</span> <span class="n">paginator</span><span class="o">.</span><span class="n">page</span><span class="p">(</span><span class="n">paginator</span><span class="o">.</span><span class="n">num_pages</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">render</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s">'topics.html'</span><span class="p">,</span> <span class="p">{</span><span class="s">'board'</span><span class="p">:</span> <span class="n">board</span><span class="p">,</span> <span class="s">'topics'</span><span class="p">:</span> <span class="n">topics</span><span class="p">})</span></code></pre></figure>

<p>Now the trick part is to render the pages correctly using the Bootstrap 4 pagination component. But take the time
to read the code and see if it makes sense for you. We are using here all the methods we played with before. And here
in that context, <code class="highlighter-rouge">topics</code> is no longer a QuerySet but a <code class="highlighter-rouge">paginator.Page</code> instance.</p>

<p>Right after the topics HTML table, we can render the pagination component:</p>

<p><strong>templates/topics.html</strong>
<small><a href="https://gist.github.com/vitorfs/3101a1bd72125aeb45829659a5532bc6" target="_blank" rel="noopener nofollow">(view complete file contents)</a></small></p>

<figure class="highlight"><pre><code class="language-django" data-lang="django"><span class="cp">{%</span> <span class="k">if</span> <span class="nv">topics.has_other_pages</span> <span class="cp">%}</span>
  <span class="nt">&lt;nav</span> <span class="na">aria-label=</span><span class="s">"Topics pagination"</span> <span class="na">class=</span><span class="s">"mb-4"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;ul</span> <span class="na">class=</span><span class="s">"pagination"</span><span class="nt">&gt;</span>
      <span class="cp">{%</span> <span class="k">if</span> <span class="nv">topics.has_previous</span> <span class="cp">%}</span>
        <span class="nt">&lt;li</span> <span class="na">class=</span><span class="s">"page-item"</span><span class="nt">&gt;</span>
          <span class="nt">&lt;a</span> <span class="na">class=</span><span class="s">"page-link"</span> <span class="na">href=</span><span class="s">"?page=</span><span class="cp">{{</span> <span class="nv">topics.previous_page_number</span> <span class="cp">}}</span><span class="s">"</span><span class="nt">&gt;</span>Previous<span class="nt">&lt;/a&gt;</span>
        <span class="nt">&lt;/li&gt;</span>
      <span class="cp">{%</span> <span class="k">else</span> <span class="cp">%}</span>
        <span class="nt">&lt;li</span> <span class="na">class=</span><span class="s">"page-item disabled"</span><span class="nt">&gt;</span>
          <span class="nt">&lt;span</span> <span class="na">class=</span><span class="s">"page-link"</span><span class="nt">&gt;</span>Previous<span class="nt">&lt;/span&gt;</span>
        <span class="nt">&lt;/li&gt;</span>
      <span class="cp">{%</span> <span class="k">endif</span> <span class="cp">%}</span>

      <span class="cp">{%</span> <span class="k">for</span> <span class="nv">page_num</span> <span class="ow">in</span> <span class="nv">topics.paginator.page_range</span> <span class="cp">%}</span>
        <span class="cp">{%</span> <span class="k">if</span> <span class="nv">topics.</span><span class="nb">number</span> <span class="o">==</span> <span class="nv">page_num</span> <span class="cp">%}</span>
          <span class="nt">&lt;li</span> <span class="na">class=</span><span class="s">"page-item active"</span><span class="nt">&gt;</span>
            <span class="nt">&lt;span</span> <span class="na">class=</span><span class="s">"page-link"</span><span class="nt">&gt;</span>
              <span class="cp">{{</span> <span class="nv">page_num</span> <span class="cp">}}</span>
              <span class="nt">&lt;span</span> <span class="na">class=</span><span class="s">"sr-only"</span><span class="nt">&gt;</span>(current)<span class="nt">&lt;/span&gt;</span>
            <span class="nt">&lt;/span&gt;</span>
          <span class="nt">&lt;/li&gt;</span>
        <span class="cp">{%</span> <span class="k">else</span> <span class="cp">%}</span>
          <span class="nt">&lt;li</span> <span class="na">class=</span><span class="s">"page-item"</span><span class="nt">&gt;</span>
            <span class="nt">&lt;a</span> <span class="na">class=</span><span class="s">"page-link"</span> <span class="na">href=</span><span class="s">"?page=</span><span class="cp">{{</span> <span class="nv">page_num</span> <span class="cp">}}</span><span class="s">"</span><span class="nt">&gt;</span><span class="cp">{{</span> <span class="nv">page_num</span> <span class="cp">}}</span><span class="nt">&lt;/a&gt;</span>
          <span class="nt">&lt;/li&gt;</span>
        <span class="cp">{%</span> <span class="k">endif</span> <span class="cp">%}</span>
      <span class="cp">{%</span> <span class="k">endfor</span> <span class="cp">%}</span>

      <span class="cp">{%</span> <span class="k">if</span> <span class="nv">topics.has_next</span> <span class="cp">%}</span>
        <span class="nt">&lt;li</span> <span class="na">class=</span><span class="s">"page-item"</span><span class="nt">&gt;</span>
          <span class="nt">&lt;a</span> <span class="na">class=</span><span class="s">"page-link"</span> <span class="na">href=</span><span class="s">"?page=</span><span class="cp">{{</span> <span class="nv">topics.next_page_number</span> <span class="cp">}}</span><span class="s">"</span><span class="nt">&gt;</span>Next<span class="nt">&lt;/a&gt;</span>
        <span class="nt">&lt;/li&gt;</span>
      <span class="cp">{%</span> <span class="k">else</span> <span class="cp">%}</span>
        <span class="nt">&lt;li</span> <span class="na">class=</span><span class="s">"page-item disabled"</span><span class="nt">&gt;</span>
          <span class="nt">&lt;span</span> <span class="na">class=</span><span class="s">"page-link"</span><span class="nt">&gt;</span>Next<span class="nt">&lt;/span&gt;</span>
        <span class="nt">&lt;/li&gt;</span>
      <span class="cp">{%</span> <span class="k">endif</span> <span class="cp">%}</span>
    <span class="nt">&lt;/ul&gt;</span>
  <span class="nt">&lt;/nav&gt;</span>
<span class="cp">{%</span> <span class="k">endif</span> <span class="cp">%}</span></code></pre></figure>

<p><img src="../../../../media/series/beginners-guide/1.11/part-6/paginate.png" alt="Pagination" /></p>

<h5 id="gcbv-pagination">GCBV Pagination</h5>

<p>Below, the same implementation but this time using the <strong>ListView</strong>.</p>

<p><strong>boards/views.py</strong>
<small><a href="https://gist.github.com/vitorfs/323173bc56dec48fd83caf983d459421#file-views-py-L19" target="_blank" rel="noopener nofollow">(view complete file contents)</a></small></p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="k">class</span> <span class="nc">TopicListView</span><span class="p">(</span><span class="n">ListView</span><span class="p">):</span>
    <span class="n">model</span> <span class="o">=</span> <span class="n">Topic</span>
    <span class="n">context_object_name</span> <span class="o">=</span> <span class="s">'topics'</span>
    <span class="n">template_name</span> <span class="o">=</span> <span class="s">'topics.html'</span>
    <span class="n">paginate_by</span> <span class="o">=</span> <span class="mi">20</span>

    <span class="k">def</span> <span class="nf">get_context_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">kwargs</span><span class="p">[</span><span class="s">'board'</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">board</span>
        <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">get_context_data</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">get_queryset</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">board</span> <span class="o">=</span> <span class="n">get_object_or_404</span><span class="p">(</span><span class="n">Board</span><span class="p">,</span> <span class="n">pk</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">'pk'</span><span class="p">))</span>
        <span class="n">queryset</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">board</span><span class="o">.</span><span class="n">topics</span><span class="o">.</span><span class="n">order_by</span><span class="p">(</span><span class="s">'-last_updated'</span><span class="p">)</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="n">replies</span><span class="o">=</span><span class="n">Count</span><span class="p">(</span><span class="s">'posts'</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">queryset</span></code></pre></figure>

<p>While using pagination with class-based views, the way we interact with the paginator in the template is a little bit
different. It will make available the following variables in the template: <strong>paginator</strong>, <strong>page_obj</strong>,
<strong>is_paginated</strong>, <strong>object_list</strong>, and also a variable with the name we defined in the <strong>context_object_name</strong>. In our
case this extra variable will be named <strong>topics</strong>, and it will be equivalent to <strong>object_list</strong>.</p>

<p>Now about the whole <strong>get_context_data</strong> thing, well, that’s how we add stuff to the request context when extending a
GCBV.</p>

<p>But the main point here is the <strong>paginate_by</strong> attribute. In some cases, just by adding it will be enough.</p>

<p>Remember to update the <strong>urls.py</strong>:</p>

<p><strong>myproject/urls.py</strong>
<small><a href="https://gist.github.com/vitorfs/61f5345b7cf8b006b2901a61b8f8e348#file-urls-py-L37" target="_blank" rel="noopener nofollow">(view complete file contents)</a></small></p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="kn">from</span> <span class="nn">django.conf.urls</span> <span class="kn">import</span> <span class="n">url</span>
<span class="kn">from</span> <span class="nn">boards</span> <span class="kn">import</span> <span class="n">views</span>

<span class="n">urlpatterns</span> <span class="o">=</span> <span class="p">[</span>
    <span class="c"># ...</span>
    <span class="n">url</span><span class="p">(</span><span class="s">r'^boards/(?P&lt;pk&gt;</span><span class="err">\</span><span class="s">d+)/$'</span><span class="p">,</span> <span class="n">views</span><span class="o">.</span><span class="n">TopicListView</span><span class="o">.</span><span class="n">as_view</span><span class="p">(),</span> <span class="n">name</span><span class="o">=</span><span class="s">'board_topics'</span><span class="p">),</span>
<span class="p">]</span></code></pre></figure>

<p>Now let’s fix the template:</p>

<p><strong>templates/topics.html</strong>
<small><a href="https://gist.github.com/vitorfs/65095aa3eda78bafd22d5e2f94086d40#file-topics-html-L40" target="_blank" rel="noopener nofollow">(view complete file contents)</a></small></p>

<figure class="highlight"><pre><code class="language-django" data-lang="django"><span class="cp">{%</span> <span class="k">block</span> <span class="nv">content</span> <span class="cp">%}</span>
  <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"mb-4"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">"</span><span class="cp">{%</span> <span class="nv">url</span> <span class="s1">'new_topic'</span> <span class="nv">board.pk</span> <span class="cp">%}</span><span class="s">"</span> <span class="na">class=</span><span class="s">"btn btn-primary"</span><span class="nt">&gt;</span>New topic<span class="nt">&lt;/a&gt;</span>
  <span class="nt">&lt;/div&gt;</span>

  <span class="nt">&lt;table</span> <span class="na">class=</span><span class="s">"table mb-4"</span><span class="nt">&gt;</span>
    <span class="c">&lt;!-- table content suppressed --&gt;</span>
  <span class="nt">&lt;/table&gt;</span>

  <span class="cp">{%</span> <span class="k">if</span> <span class="nv">is_paginated</span> <span class="cp">%}</span>
    <span class="nt">&lt;nav</span> <span class="na">aria-label=</span><span class="s">"Topics pagination"</span> <span class="na">class=</span><span class="s">"mb-4"</span><span class="nt">&gt;</span>
      <span class="nt">&lt;ul</span> <span class="na">class=</span><span class="s">"pagination"</span><span class="nt">&gt;</span>
        <span class="cp">{%</span> <span class="k">if</span> <span class="nv">page_obj.has_previous</span> <span class="cp">%}</span>
          <span class="nt">&lt;li</span> <span class="na">class=</span><span class="s">"page-item"</span><span class="nt">&gt;</span>
            <span class="nt">&lt;a</span> <span class="na">class=</span><span class="s">"page-link"</span> <span class="na">href=</span><span class="s">"?page=</span><span class="cp">{{</span> <span class="nv">page_obj.previous_page_number</span> <span class="cp">}}</span><span class="s">"</span><span class="nt">&gt;</span>Previous<span class="nt">&lt;/a&gt;</span>
          <span class="nt">&lt;/li&gt;</span>
        <span class="cp">{%</span> <span class="k">else</span> <span class="cp">%}</span>
          <span class="nt">&lt;li</span> <span class="na">class=</span><span class="s">"page-item disabled"</span><span class="nt">&gt;</span>
            <span class="nt">&lt;span</span> <span class="na">class=</span><span class="s">"page-link"</span><span class="nt">&gt;</span>Previous<span class="nt">&lt;/span&gt;</span>
          <span class="nt">&lt;/li&gt;</span>
        <span class="cp">{%</span> <span class="k">endif</span> <span class="cp">%}</span>

        <span class="cp">{%</span> <span class="k">for</span> <span class="nv">page_num</span> <span class="ow">in</span> <span class="nv">paginator.page_range</span> <span class="cp">%}</span>
          <span class="cp">{%</span> <span class="k">if</span> <span class="nv">page_obj.</span><span class="nb">number</span> <span class="o">==</span> <span class="nv">page_num</span> <span class="cp">%}</span>
            <span class="nt">&lt;li</span> <span class="na">class=</span><span class="s">"page-item active"</span><span class="nt">&gt;</span>
              <span class="nt">&lt;span</span> <span class="na">class=</span><span class="s">"page-link"</span><span class="nt">&gt;</span>
                <span class="cp">{{</span> <span class="nv">page_num</span> <span class="cp">}}</span>
                <span class="nt">&lt;span</span> <span class="na">class=</span><span class="s">"sr-only"</span><span class="nt">&gt;</span>(current)<span class="nt">&lt;/span&gt;</span>
              <span class="nt">&lt;/span&gt;</span>
            <span class="nt">&lt;/li&gt;</span>
          <span class="cp">{%</span> <span class="k">else</span> <span class="cp">%}</span>
            <span class="nt">&lt;li</span> <span class="na">class=</span><span class="s">"page-item"</span><span class="nt">&gt;</span>
              <span class="nt">&lt;a</span> <span class="na">class=</span><span class="s">"page-link"</span> <span class="na">href=</span><span class="s">"?page=</span><span class="cp">{{</span> <span class="nv">page_num</span> <span class="cp">}}</span><span class="s">"</span><span class="nt">&gt;</span><span class="cp">{{</span> <span class="nv">page_num</span> <span class="cp">}}</span><span class="nt">&lt;/a&gt;</span>
            <span class="nt">&lt;/li&gt;</span>
          <span class="cp">{%</span> <span class="k">endif</span> <span class="cp">%}</span>
        <span class="cp">{%</span> <span class="k">endfor</span> <span class="cp">%}</span>

        <span class="cp">{%</span> <span class="k">if</span> <span class="nv">page_obj.has_next</span> <span class="cp">%}</span>
          <span class="nt">&lt;li</span> <span class="na">class=</span><span class="s">"page-item"</span><span class="nt">&gt;</span>
            <span class="nt">&lt;a</span> <span class="na">class=</span><span class="s">"page-link"</span> <span class="na">href=</span><span class="s">"?page=</span><span class="cp">{{</span> <span class="nv">page_obj.next_page_number</span> <span class="cp">}}</span><span class="s">"</span><span class="nt">&gt;</span>Next<span class="nt">&lt;/a&gt;</span>
          <span class="nt">&lt;/li&gt;</span>
        <span class="cp">{%</span> <span class="k">else</span> <span class="cp">%}</span>
          <span class="nt">&lt;li</span> <span class="na">class=</span><span class="s">"page-item disabled"</span><span class="nt">&gt;</span>
            <span class="nt">&lt;span</span> <span class="na">class=</span><span class="s">"page-link"</span><span class="nt">&gt;</span>Next<span class="nt">&lt;/span&gt;</span>
          <span class="nt">&lt;/li&gt;</span>
        <span class="cp">{%</span> <span class="k">endif</span> <span class="cp">%}</span>
      <span class="nt">&lt;/ul&gt;</span>
    <span class="nt">&lt;/nav&gt;</span>
  <span class="cp">{%</span> <span class="k">endif</span> <span class="cp">%}</span>

<span class="cp">{%</span> <span class="k">endblock</span> <span class="cp">%}</span></code></pre></figure>

<p>Now take the time to run the tests and fix if needed.</p>

<p><strong>boards/tests/test_view_board_topics.py</strong></p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="kn">from</span> <span class="nn">django.test</span> <span class="kn">import</span> <span class="n">TestCase</span>
<span class="kn">from</span> <span class="nn">django.urls</span> <span class="kn">import</span> <span class="n">resolve</span>
<span class="kn">from</span> <span class="nn">..views</span> <span class="kn">import</span> <span class="n">TopicListView</span>

<span class="k">class</span> <span class="nc">BoardTopicsTests</span><span class="p">(</span><span class="n">TestCase</span><span class="p">):</span>
    <span class="c"># ...</span>
    <span class="k">def</span> <span class="nf">test_board_topics_url_resolves_board_topics_view</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">view</span> <span class="o">=</span> <span class="n">resolve</span><span class="p">(</span><span class="s">'/boards/1/'</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">view</span><span class="o">.</span><span class="n">func</span><span class="o">.</span><span class="n">view_class</span><span class="p">,</span> <span class="n">TopicListView</span><span class="p">)</span></code></pre></figure>

<h5 id="reusable-pagination-template">Reusable Pagination Template</h5>

<p>Just like we did with the <strong>form.html</strong> partial template, we can also create something similar for the pagination
HTML snippet.</p>

<p>Let’s paginate the topic posts page, and then find a way to reuse the pagination component.</p>

<p><strong>boards/views.py</strong>
<small><a href="https://gist.github.com/vitorfs/53139ca0fd7c01b8459c2ff62828f963" target="_blank" rel="noopener nofollow">(view complete file contents)</a></small></p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="k">class</span> <span class="nc">PostListView</span><span class="p">(</span><span class="n">ListView</span><span class="p">):</span>
    <span class="n">model</span> <span class="o">=</span> <span class="n">Post</span>
    <span class="n">context_object_name</span> <span class="o">=</span> <span class="s">'posts'</span>
    <span class="n">template_name</span> <span class="o">=</span> <span class="s">'topic_posts.html'</span>
    <span class="n">paginate_by</span> <span class="o">=</span> <span class="mi">2</span>

    <span class="k">def</span> <span class="nf">get_context_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">topic</span><span class="o">.</span><span class="n">views</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">topic</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
        <span class="n">kwargs</span><span class="p">[</span><span class="s">'topic'</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">topic</span>
        <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">get_context_data</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">get_queryset</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">topic</span> <span class="o">=</span> <span class="n">get_object_or_404</span><span class="p">(</span><span class="n">Topic</span><span class="p">,</span> <span class="n">board__pk</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">'pk'</span><span class="p">),</span> <span class="n">pk</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">'topic_pk'</span><span class="p">))</span>
        <span class="n">queryset</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">topic</span><span class="o">.</span><span class="n">posts</span><span class="o">.</span><span class="n">order_by</span><span class="p">(</span><span class="s">'created_at'</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">queryset</span></code></pre></figure>

<p>Now update the <strong>urls.py</strong>
<small><a href="https://gist.github.com/vitorfs/428d58dbb61f9c2601bb7434150ea37f" target="_blank" rel="noopener nofollow">(view complete file contents)</a></small></p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="kn">from</span> <span class="nn">django.conf.urls</span> <span class="kn">import</span> <span class="n">url</span>
<span class="kn">from</span> <span class="nn">boards</span> <span class="kn">import</span> <span class="n">views</span>

<span class="n">urlpatterns</span> <span class="o">=</span> <span class="p">[</span>
    <span class="c"># ...</span>
    <span class="n">url</span><span class="p">(</span><span class="s">r'^boards/(?P&lt;pk&gt;</span><span class="err">\</span><span class="s">d+)/topics/(?P&lt;topic_pk&gt;</span><span class="err">\</span><span class="s">d+)/$'</span><span class="p">,</span> <span class="n">views</span><span class="o">.</span><span class="n">PostListView</span><span class="o">.</span><span class="n">as_view</span><span class="p">(),</span> <span class="n">name</span><span class="o">=</span><span class="s">'topic_posts'</span><span class="p">),</span>
<span class="p">]</span></code></pre></figure>

<p>Now we grab that pagination HTML snippet from the <strong>topics.html</strong> template, and create a new file named
<strong>pagination.html</strong> inside the <strong>templates/includes</strong> folder, alongside with the <strong>forms.html</strong> file:</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash">myproject/
 |-- myproject/
 |    |-- accounts/
 |    |-- boards/
 |    |-- myproject/
 |    |-- static/
 |    |-- templates/
 |    |    |-- includes/
 |    |    |    |-- form.html
 |    |    |    +-- pagination.html  &lt;-- here!
 |    |    +-- ...
 |    |-- db.sqlite3
 |    +-- manage.py
 +-- venv/</code></pre></figure>

<p><strong>templates/includes/pagination.html</strong></p>

<figure class="highlight"><pre><code class="language-django" data-lang="django"><span class="cp">{%</span> <span class="k">if</span> <span class="nv">is_paginated</span> <span class="cp">%}</span>
  <span class="nt">&lt;nav</span> <span class="na">aria-label=</span><span class="s">"Topics pagination"</span> <span class="na">class=</span><span class="s">"mb-4"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;ul</span> <span class="na">class=</span><span class="s">"pagination"</span><span class="nt">&gt;</span>
      <span class="cp">{%</span> <span class="k">if</span> <span class="nv">page_obj.has_previous</span> <span class="cp">%}</span>
        <span class="nt">&lt;li</span> <span class="na">class=</span><span class="s">"page-item"</span><span class="nt">&gt;</span>
          <span class="nt">&lt;a</span> <span class="na">class=</span><span class="s">"page-link"</span> <span class="na">href=</span><span class="s">"?page=</span><span class="cp">{{</span> <span class="nv">page_obj.previous_page_number</span> <span class="cp">}}</span><span class="s">"</span><span class="nt">&gt;</span>Previous<span class="nt">&lt;/a&gt;</span>
        <span class="nt">&lt;/li&gt;</span>
      <span class="cp">{%</span> <span class="k">else</span> <span class="cp">%}</span>
        <span class="nt">&lt;li</span> <span class="na">class=</span><span class="s">"page-item disabled"</span><span class="nt">&gt;</span>
          <span class="nt">&lt;span</span> <span class="na">class=</span><span class="s">"page-link"</span><span class="nt">&gt;</span>Previous<span class="nt">&lt;/span&gt;</span>
        <span class="nt">&lt;/li&gt;</span>
      <span class="cp">{%</span> <span class="k">endif</span> <span class="cp">%}</span>

      <span class="cp">{%</span> <span class="k">for</span> <span class="nv">page_num</span> <span class="ow">in</span> <span class="nv">paginator.page_range</span> <span class="cp">%}</span>
        <span class="cp">{%</span> <span class="k">if</span> <span class="nv">page_obj.</span><span class="nb">number</span> <span class="o">==</span> <span class="nv">page_num</span> <span class="cp">%}</span>
          <span class="nt">&lt;li</span> <span class="na">class=</span><span class="s">"page-item active"</span><span class="nt">&gt;</span>
            <span class="nt">&lt;span</span> <span class="na">class=</span><span class="s">"page-link"</span><span class="nt">&gt;</span>
              <span class="cp">{{</span> <span class="nv">page_num</span> <span class="cp">}}</span>
              <span class="nt">&lt;span</span> <span class="na">class=</span><span class="s">"sr-only"</span><span class="nt">&gt;</span>(current)<span class="nt">&lt;/span&gt;</span>
            <span class="nt">&lt;/span&gt;</span>
          <span class="nt">&lt;/li&gt;</span>
        <span class="cp">{%</span> <span class="k">else</span> <span class="cp">%}</span>
          <span class="nt">&lt;li</span> <span class="na">class=</span><span class="s">"page-item"</span><span class="nt">&gt;</span>
            <span class="nt">&lt;a</span> <span class="na">class=</span><span class="s">"page-link"</span> <span class="na">href=</span><span class="s">"?page=</span><span class="cp">{{</span> <span class="nv">page_num</span> <span class="cp">}}</span><span class="s">"</span><span class="nt">&gt;</span><span class="cp">{{</span> <span class="nv">page_num</span> <span class="cp">}}</span><span class="nt">&lt;/a&gt;</span>
          <span class="nt">&lt;/li&gt;</span>
        <span class="cp">{%</span> <span class="k">endif</span> <span class="cp">%}</span>
      <span class="cp">{%</span> <span class="k">endfor</span> <span class="cp">%}</span>

      <span class="cp">{%</span> <span class="k">if</span> <span class="nv">page_obj.has_next</span> <span class="cp">%}</span>
        <span class="nt">&lt;li</span> <span class="na">class=</span><span class="s">"page-item"</span><span class="nt">&gt;</span>
          <span class="nt">&lt;a</span> <span class="na">class=</span><span class="s">"page-link"</span> <span class="na">href=</span><span class="s">"?page=</span><span class="cp">{{</span> <span class="nv">page_obj.next_page_number</span> <span class="cp">}}</span><span class="s">"</span><span class="nt">&gt;</span>Next<span class="nt">&lt;/a&gt;</span>
        <span class="nt">&lt;/li&gt;</span>
      <span class="cp">{%</span> <span class="k">else</span> <span class="cp">%}</span>
        <span class="nt">&lt;li</span> <span class="na">class=</span><span class="s">"page-item disabled"</span><span class="nt">&gt;</span>
          <span class="nt">&lt;span</span> <span class="na">class=</span><span class="s">"page-link"</span><span class="nt">&gt;</span>Next<span class="nt">&lt;/span&gt;</span>
        <span class="nt">&lt;/li&gt;</span>
      <span class="cp">{%</span> <span class="k">endif</span> <span class="cp">%}</span>
    <span class="nt">&lt;/ul&gt;</span>
  <span class="nt">&lt;/nav&gt;</span>
<span class="cp">{%</span> <span class="k">endif</span> <span class="cp">%}</span></code></pre></figure>

<p>Now in the <strong>topic_posts.html</strong> template we use it:</p>

<p><strong>templates/topic_posts.html</strong>
<small><a href="https://gist.github.com/vitorfs/df5b16bb16c1134ba4e03218dce250d7" target="_blank" rel="noopener nofollow">(view complete file contents)</a></small></p>

<figure class="highlight"><pre><code class="language-django" data-lang="django"><span class="cp">{%</span> <span class="k">block</span> <span class="nv">content</span> <span class="cp">%}</span>

  <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"mb-4"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">"</span><span class="cp">{%</span> <span class="nv">url</span> <span class="s1">'reply_topic'</span> <span class="nv">topic.board.pk</span> <span class="nv">topic.pk</span> <span class="cp">%}</span><span class="s">"</span> <span class="na">class=</span><span class="s">"btn btn-primary"</span> <span class="na">role=</span><span class="s">"button"</span><span class="nt">&gt;</span>Reply<span class="nt">&lt;/a&gt;</span>
  <span class="nt">&lt;/div&gt;</span>

  <span class="cp">{%</span> <span class="k">for</span> <span class="nv">post</span> <span class="ow">in</span> <span class="nv">posts</span> <span class="cp">%}</span>
    <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"card </span><span class="cp">{%</span> <span class="k">if</span> <span class="nv">forloop.last</span> <span class="cp">%}</span><span class="s">mb-4</span><span class="cp">{%</span> <span class="k">else</span> <span class="cp">%}</span><span class="s">mb-2</span><span class="cp">{%</span> <span class="k">endif</span> <span class="cp">%}</span><span class="s"> </span><span class="cp">{%</span> <span class="k">if</span> <span class="nv">forloop.first</span> <span class="cp">%}</span><span class="s">border-dark</span><span class="cp">{%</span> <span class="k">endif</span> <span class="cp">%}</span><span class="s">"</span><span class="nt">&gt;</span>
      <span class="cp">{%</span> <span class="k">if</span> <span class="nv">forloop.first</span> <span class="cp">%}</span>
        <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"card-header text-white bg-dark py-2 px-3"</span><span class="nt">&gt;</span><span class="cp">{{</span> <span class="nv">topic.subject</span> <span class="cp">}}</span><span class="nt">&lt;/div&gt;</span>
      <span class="cp">{%</span> <span class="k">endif</span> <span class="cp">%}</span>
      <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"card-body p-3"</span><span class="nt">&gt;</span>
        <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"row"</span><span class="nt">&gt;</span>
          <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"col-2"</span><span class="nt">&gt;</span>
            <span class="nt">&lt;img</span> <span class="na">src=</span><span class="s">"</span><span class="cp">{%</span> <span class="nv">static</span> <span class="s1">'img/avatar.svg'</span> <span class="cp">%}</span><span class="s">"</span> <span class="na">alt=</span><span class="s">"</span><span class="cp">{{</span> <span class="nv">post.created_by.username</span> <span class="cp">}}</span><span class="s">"</span> <span class="na">class=</span><span class="s">"w-100"</span><span class="nt">&gt;</span>
            <span class="nt">&lt;small&gt;</span>Posts: <span class="cp">{{</span> <span class="nv">post.created_by.posts.count</span> <span class="cp">}}</span><span class="nt">&lt;/small&gt;</span>
          <span class="nt">&lt;/div&gt;</span>
          <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"col-10"</span><span class="nt">&gt;</span>
            <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"row mb-3"</span><span class="nt">&gt;</span>
              <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"col-6"</span><span class="nt">&gt;</span>
                <span class="nt">&lt;strong</span> <span class="na">class=</span><span class="s">"text-muted"</span><span class="nt">&gt;</span><span class="cp">{{</span> <span class="nv">post.created_by.username</span> <span class="cp">}}</span><span class="nt">&lt;/strong&gt;</span>
              <span class="nt">&lt;/div&gt;</span>
              <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"col-6 text-right"</span><span class="nt">&gt;</span>
                <span class="nt">&lt;small</span> <span class="na">class=</span><span class="s">"text-muted"</span><span class="nt">&gt;</span><span class="cp">{{</span> <span class="nv">post.created_at</span> <span class="cp">}}</span><span class="nt">&lt;/small&gt;</span>
              <span class="nt">&lt;/div&gt;</span>
            <span class="nt">&lt;/div&gt;</span>
            <span class="cp">{{</span> <span class="nv">post.message</span> <span class="cp">}}</span>
            <span class="cp">{%</span> <span class="k">if</span> <span class="nv">post.created_by</span> <span class="o">==</span> <span class="nv">user</span> <span class="cp">%}</span>
              <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"mt-3"</span><span class="nt">&gt;</span>
                <span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">"</span><span class="cp">{%</span> <span class="nv">url</span> <span class="s1">'edit_post'</span> <span class="nv">post.topic.board.pk</span> <span class="nv">post.topic.pk</span> <span class="nv">post.pk</span> <span class="cp">%}</span><span class="s">"</span>
                   <span class="na">class=</span><span class="s">"btn btn-primary btn-sm"</span>
                   <span class="na">role=</span><span class="s">"button"</span><span class="nt">&gt;</span>Edit<span class="nt">&lt;/a&gt;</span>
              <span class="nt">&lt;/div&gt;</span>
            <span class="cp">{%</span> <span class="k">endif</span> <span class="cp">%}</span>
          <span class="nt">&lt;/div&gt;</span>
        <span class="nt">&lt;/div&gt;</span>
      <span class="nt">&lt;/div&gt;</span>
    <span class="nt">&lt;/div&gt;</span>
  <span class="cp">{%</span> <span class="k">endfor</span> <span class="cp">%}</span>

  <span class="cp">{%</span> <span class="k">include</span> <span class="s1">'includes/pagination.html'</span> <span class="cp">%}</span>

<span class="cp">{%</span> <span class="k">endblock</span> <span class="cp">%}</span></code></pre></figure>

<p>Don’t forget to change the main forloop to <code class="highlighter-rouge"><span class="p">{</span><span class="err">%</span><span class="w"> </span><span class="err">for</span><span class="w"> </span><span class="err">post</span><span class="w"> </span><span class="err">in</span><span class="w"> </span><span class="err">posts</span><span class="w"> </span><span class="err">%</span><span class="p">}</span></code>.</p>

<p>We can also update the previous template, the <strong>topics.html</strong> template to use the pagination partial template too:</p>

<p><strong>templates/topics.html</strong>
<small><a href="https://gist.github.com/vitorfs/9198ad8f91cd889f315ade7e4eb62710#file-topics-html-L40" target="_blank" rel="noopener nofollow">(view complete file contents)</a></small></p>

<figure class="highlight"><pre><code class="language-django" data-lang="django"><span class="cp">{%</span> <span class="k">block</span> <span class="nv">content</span> <span class="cp">%}</span>
  <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"mb-4"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">"</span><span class="cp">{%</span> <span class="nv">url</span> <span class="s1">'new_topic'</span> <span class="nv">board.pk</span> <span class="cp">%}</span><span class="s">"</span> <span class="na">class=</span><span class="s">"btn btn-primary"</span><span class="nt">&gt;</span>New topic<span class="nt">&lt;/a&gt;</span>
  <span class="nt">&lt;/div&gt;</span>

  <span class="nt">&lt;table</span> <span class="na">class=</span><span class="s">"table mb-4"</span><span class="nt">&gt;</span>
    <span class="c">&lt;!-- table code suppressed --&gt;</span>
  <span class="nt">&lt;/table&gt;</span>

  <span class="cp">{%</span> <span class="k">include</span> <span class="s1">'includes/pagination.html'</span> <span class="cp">%}</span>

<span class="cp">{%</span> <span class="k">endblock</span> <span class="cp">%}</span></code></pre></figure>

<p>Just for testing purpose, you could just add a few posts (or create some using the Python Shell) and change the
<strong>paginate_by</strong> to a low number, say 2, and see how it’s looking like:</p>

<p><img src="../../../../media/series/beginners-guide/1.11/part-6/topics-1.png" alt="Topics" />
<small><a href="https://gist.github.com/vitorfs/6b3cd0769f805ab38626f5bd97b4e5e3" target="_blank" rel="noopener nofollow">(view complete file contents)</a></small></p>

<p>Update the test cases:</p>

<p><strong>boards/tests/test_view_topic_posts.py</strong></p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="kn">from</span> <span class="nn">django.test</span> <span class="kn">import</span> <span class="n">TestCase</span>
<span class="kn">from</span> <span class="nn">django.urls</span> <span class="kn">import</span> <span class="n">resolve</span>
<span class="kn">from</span> <span class="nn">..views</span> <span class="kn">import</span> <span class="n">PostListView</span>

<span class="k">class</span> <span class="nc">TopicPostsTests</span><span class="p">(</span><span class="n">TestCase</span><span class="p">):</span>
    <span class="c"># ...</span>
    <span class="k">def</span> <span class="nf">test_view_function</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">view</span> <span class="o">=</span> <span class="n">resolve</span><span class="p">(</span><span class="s">'/boards/1/topics/1/'</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">view</span><span class="o">.</span><span class="n">func</span><span class="o">.</span><span class="n">view_class</span><span class="p">,</span> <span class="n">PostListView</span><span class="p">)</span></code></pre></figure>

<hr />

<h4 id="my-account-view">My Account View</h4>

<p>Okay, so, this is going to be our last view. After that, we will be working on improving the existing features.</p>

<p><strong>accounts/views.py</strong>
<small><a href="https://gist.github.com/vitorfs/ea62417b7a450050f2feeeb69b775996" target="_blank" rel="noopener nofollow">(view complete file contents)</a></small></p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="kn">from</span> <span class="nn">django.contrib.auth.decorators</span> <span class="kn">import</span> <span class="n">login_required</span>
<span class="kn">from</span> <span class="nn">django.contrib.auth.models</span> <span class="kn">import</span> <span class="n">User</span>
<span class="kn">from</span> <span class="nn">django.urls</span> <span class="kn">import</span> <span class="n">reverse_lazy</span>
<span class="kn">from</span> <span class="nn">django.utils.decorators</span> <span class="kn">import</span> <span class="n">method_decorator</span>
<span class="kn">from</span> <span class="nn">django.views.generic</span> <span class="kn">import</span> <span class="n">UpdateView</span>

<span class="nd">@method_decorator</span><span class="p">(</span><span class="n">login_required</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s">'dispatch'</span><span class="p">)</span>
<span class="k">class</span> <span class="nc">UserUpdateView</span><span class="p">(</span><span class="n">UpdateView</span><span class="p">):</span>
    <span class="n">model</span> <span class="o">=</span> <span class="n">User</span>
    <span class="n">fields</span> <span class="o">=</span> <span class="p">(</span><span class="s">'first_name'</span><span class="p">,</span> <span class="s">'last_name'</span><span class="p">,</span> <span class="s">'email'</span><span class="p">,</span> <span class="p">)</span>
    <span class="n">template_name</span> <span class="o">=</span> <span class="s">'my_account.html'</span>
    <span class="n">success_url</span> <span class="o">=</span> <span class="n">reverse_lazy</span><span class="p">(</span><span class="s">'my_account'</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">get_object</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">user</span></code></pre></figure>

<p><strong>myproject/urls.py</strong>
<small><a href="https://gist.github.com/vitorfs/27d87452e7584cb8c489625f507ed7aa#file-urls-py-L32" target="_blank" rel="noopener nofollow">(view complete file contents)</a></small></p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="kn">from</span> <span class="nn">django.conf.urls</span> <span class="kn">import</span> <span class="n">url</span>
<span class="kn">from</span> <span class="nn">accounts</span> <span class="kn">import</span> <span class="n">views</span> <span class="k">as</span> <span class="n">accounts_views</span>

<span class="n">urlpatterns</span> <span class="o">=</span> <span class="p">[</span>
    <span class="c"># ...</span>
    <span class="n">url</span><span class="p">(</span><span class="s">r'^settings/account/$'</span><span class="p">,</span> <span class="n">accounts_views</span><span class="o">.</span><span class="n">UserUpdateView</span><span class="o">.</span><span class="n">as_view</span><span class="p">(),</span> <span class="n">name</span><span class="o">=</span><span class="s">'my_account'</span><span class="p">),</span>
<span class="p">]</span></code></pre></figure>

<p><strong>templates/my_account.html</strong></p>

<figure class="highlight"><pre><code class="language-django" data-lang="django"><span class="cp">{%</span> <span class="k">extends</span> <span class="s1">'base.html'</span> <span class="cp">%}</span>

<span class="cp">{%</span> <span class="k">block</span> <span class="nv">title</span> <span class="cp">%}</span>My account<span class="cp">{%</span> <span class="k">endblock</span> <span class="cp">%}</span>

<span class="cp">{%</span> <span class="k">block</span> <span class="nv">breadcrumb</span> <span class="cp">%}</span>
  <span class="nt">&lt;li</span> <span class="na">class=</span><span class="s">"breadcrumb-item active"</span><span class="nt">&gt;</span>My account<span class="nt">&lt;/li&gt;</span>
<span class="cp">{%</span> <span class="k">endblock</span> <span class="cp">%}</span>

<span class="cp">{%</span> <span class="k">block</span> <span class="nv">content</span> <span class="cp">%}</span>
  <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"row"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"col-lg-6 col-md-8 col-sm-10"</span><span class="nt">&gt;</span>
      <span class="nt">&lt;form</span> <span class="na">method=</span><span class="s">"post"</span> <span class="na">novalidate</span><span class="nt">&gt;</span>
        <span class="cp">{%</span> <span class="nv">csrf_token</span> <span class="cp">%}</span>
        <span class="cp">{%</span> <span class="k">include</span> <span class="s1">'includes/form.html'</span> <span class="cp">%}</span>
        <span class="nt">&lt;button</span> <span class="na">type=</span><span class="s">"submit"</span> <span class="na">class=</span><span class="s">"btn btn-success"</span><span class="nt">&gt;</span>Save changes<span class="nt">&lt;/button&gt;</span>
      <span class="nt">&lt;/form&gt;</span>
    <span class="nt">&lt;/div&gt;</span>
  <span class="nt">&lt;/div&gt;</span>
<span class="cp">{%</span> <span class="k">endblock</span> <span class="cp">%}</span></code></pre></figure>

<p><img src="../../../../media/series/beginners-guide/1.11/part-6/account.png" alt="My Account" /></p>

<hr />

<h4 id="adding-markdown">Adding Markdown</h4>

<p>Let’s improve the user experience by adding Markdown to our text areas. You will see it’s very easy and simple.</p>

<p>First, let’s install a library called <strong>Python-Markdown</strong>:</p>

<figure class="highlight"><pre><code class="language-text" data-lang="text">pip install markdown</code></pre></figure>

<p>We can add a new method to the <strong>Post</strong> model:</p>

<p><strong>boards/models.py</strong>
<small><a href="https://gist.github.com/vitorfs/caa24fcf2b66903617ebbb41337d3d3d#file-models-py-L46" target="_blank" rel="noopener nofollow">(view complete file contents)</a></small></p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="kn">from</span> <span class="nn">django.db</span> <span class="kn">import</span> <span class="n">models</span>
<span class="kn">from</span> <span class="nn">django.utils.html</span> <span class="kn">import</span> <span class="n">mark_safe</span>
<span class="kn">from</span> <span class="nn">markdown</span> <span class="kn">import</span> <span class="n">markdown</span>

<span class="k">class</span> <span class="nc">Post</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="c"># ...</span>

    <span class="k">def</span> <span class="nf">get_message_as_markdown</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">mark_safe</span><span class="p">(</span><span class="n">markdown</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">message</span><span class="p">,</span> <span class="n">safe_mode</span><span class="o">=</span><span class="s">'escape'</span><span class="p">))</span></code></pre></figure>

<p>Here we are dealing with user input, so we must take care. When using the <code class="highlighter-rouge">markdown</code> function, we are instructing it
to escape the special characters first and then parse the markdown tags. After that, we mark the output string as safe
to be used in the template.</p>

<p>Now in the templates <strong>topic_posts.html</strong> and <strong>reply_topic.html</strong> just change from:</p>

<figure class="highlight"><pre><code class="language-django" data-lang="django"><span class="cp">{{</span> <span class="nv">post.message</span> <span class="cp">}}</span></code></pre></figure>

<p>To:</p>

<figure class="highlight"><pre><code class="language-django" data-lang="django"><span class="cp">{{</span> <span class="nv">post.get_message_as_markdown</span> <span class="cp">}}</span></code></pre></figure>

<p>From now on the users can already use markdown in the posts:</p>

<p><img src="../../../../media/series/beginners-guide/1.11/part-6/markdown-1.png" alt="Markdown" /></p>

<p><img src="../../../../media/series/beginners-guide/1.11/part-6/markdown-2.png" alt="Markdown" /></p>

<h5 id="markdown-editor">Markdown Editor</h5>

<p>We can also add a very cool Markdown editor called <a href="https://simplemde.com/" target="_blank" rel="noopener">SimpleMD</a>.</p>

<p>Either download the JavaScript library or use their CDN:</p>

<figure class="highlight"><pre><code class="language-html" data-lang="html"><span class="nt">&lt;link</span> <span class="na">rel=</span><span class="s">"stylesheet"</span> <span class="na">href=</span><span class="s">"https://cdn.jsdelivr.net/simplemde/latest/simplemde.min.css"</span><span class="nt">&gt;</span>
<span class="nt">&lt;script </span><span class="na">src=</span><span class="s">"https://cdn.jsdelivr.net/simplemde/latest/simplemde.min.js"</span><span class="nt">&gt;&lt;/script&gt;</span></code></pre></figure>

<p>Now edit the <strong>base.html</strong> to make space for extra JavaScripts:</p>

<p><strong>templates/base.html</strong>
<small><a href="https://gist.github.com/vitorfs/5a7ad8e7eae88d64f62fec82d037b168#file-base-html-L57" target="_blank" rel="noopener nofollow">(view complete file contents)</a></small></p>

<figure class="highlight"><pre><code class="language-django" data-lang="django">    <span class="nt">&lt;script </span><span class="na">src=</span><span class="s">"</span><span class="cp">{%</span> <span class="nv">static</span> <span class="s1">'js/jquery-3.2.1.min.js'</span> <span class="cp">%}</span><span class="s">"</span><span class="nt">&gt;&lt;/script&gt;</span>
    <span class="nt">&lt;script </span><span class="na">src=</span><span class="s">"</span><span class="cp">{%</span> <span class="nv">static</span> <span class="s1">'js/popper.min.js'</span> <span class="cp">%}</span><span class="s">"</span><span class="nt">&gt;&lt;/script&gt;</span>
    <span class="nt">&lt;script </span><span class="na">src=</span><span class="s">"</span><span class="cp">{%</span> <span class="nv">static</span> <span class="s1">'js/bootstrap.min.js'</span> <span class="cp">%}</span><span class="s">"</span><span class="nt">&gt;&lt;/script&gt;</span>
    <span class="cp">{%</span> <span class="k">block</span> <span class="nv">javascript</span> <span class="cp">%}{%</span> <span class="k">endblock</span> <span class="cp">%}</span>  <span class="c">&lt;!-- Add this empty block here! --&gt;</span></code></pre></figure>

<p>First edit the <strong>reply_topic.html</strong> template:</p>

<p><strong>templates/reply_topic.html</strong>
<small><a href="https://gist.github.com/vitorfs/fb63bb7530690d62787c3ed8b7e15241" target="_blank" rel="noopener nofollow">(view complete file contents)</a></small></p>

<figure class="highlight"><pre><code class="language-django" data-lang="django"><span class="cp">{%</span> <span class="k">extends</span> <span class="s1">'base.html'</span> <span class="cp">%}</span>

<span class="cp">{%</span> <span class="nv">load</span> <span class="nv">static</span> <span class="cp">%}</span>

<span class="cp">{%</span> <span class="k">block</span> <span class="nv">title</span> <span class="cp">%}</span>Post a reply<span class="cp">{%</span> <span class="k">endblock</span> <span class="cp">%}</span>

<span class="cp">{%</span> <span class="k">block</span> <span class="nv">stylesheet</span> <span class="cp">%}</span>
  <span class="nt">&lt;link</span> <span class="na">rel=</span><span class="s">"stylesheet"</span> <span class="na">href=</span><span class="s">"</span><span class="cp">{%</span> <span class="nv">static</span> <span class="s1">'css/simplemde.min.css'</span> <span class="cp">%}</span><span class="s">"</span><span class="nt">&gt;</span>
<span class="cp">{%</span> <span class="k">endblock</span> <span class="cp">%}</span>

<span class="cp">{%</span> <span class="k">block</span> <span class="nv">javascript</span> <span class="cp">%}</span>
  <span class="nt">&lt;script </span><span class="na">src=</span><span class="s">"</span><span class="cp">{%</span> <span class="nv">static</span> <span class="s1">'js/simplemde.min.js'</span> <span class="cp">%}</span><span class="s">"</span><span class="nt">&gt;&lt;/script&gt;</span>
  <span class="nt">&lt;script&gt;</span>
    <span class="kd">var</span> <span class="nx">simplemde</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">SimpleMDE</span><span class="p">();</span>
  <span class="nt">&lt;/script&gt;</span>
<span class="cp">{%</span> <span class="k">endblock</span> <span class="cp">%}</span></code></pre></figure>

<p>By default, this plugin will transform the first text area it finds into a markdown editor. So just that code should
be enough:</p>

<p><img src="../../../../media/series/beginners-guide/1.11/part-6/editor-1.png" alt="Editor" /></p>

<p>Now do the same thing with the <strong>edit_post.html</strong> template:</p>

<p><strong>templates/edit_post.html</strong>
<small><a href="https://gist.github.com/vitorfs/ee9d8c91888b0bc60013b8f037bae7bb" target="_blank" rel="noopener nofollow">(view complete file contents)</a></small></p>

<figure class="highlight"><pre><code class="language-django" data-lang="django"><span class="cp">{%</span> <span class="k">extends</span> <span class="s1">'base.html'</span> <span class="cp">%}</span>

<span class="cp">{%</span> <span class="nv">load</span> <span class="nv">static</span> <span class="cp">%}</span>

<span class="cp">{%</span> <span class="k">block</span> <span class="nv">title</span> <span class="cp">%}</span>Edit post<span class="cp">{%</span> <span class="k">endblock</span> <span class="cp">%}</span>

<span class="cp">{%</span> <span class="k">block</span> <span class="nv">stylesheet</span> <span class="cp">%}</span>
  <span class="nt">&lt;link</span> <span class="na">rel=</span><span class="s">"stylesheet"</span> <span class="na">href=</span><span class="s">"</span><span class="cp">{%</span> <span class="nv">static</span> <span class="s1">'css/simplemde.min.css'</span> <span class="cp">%}</span><span class="s">"</span><span class="nt">&gt;</span>
<span class="cp">{%</span> <span class="k">endblock</span> <span class="cp">%}</span>

<span class="cp">{%</span> <span class="k">block</span> <span class="nv">javascript</span> <span class="cp">%}</span>
  <span class="nt">&lt;script </span><span class="na">src=</span><span class="s">"</span><span class="cp">{%</span> <span class="nv">static</span> <span class="s1">'js/simplemde.min.js'</span> <span class="cp">%}</span><span class="s">"</span><span class="nt">&gt;&lt;/script&gt;</span>
  <span class="nt">&lt;script&gt;</span>
    <span class="kd">var</span> <span class="nx">simplemde</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">SimpleMDE</span><span class="p">();</span>
  <span class="nt">&lt;/script&gt;</span>
<span class="cp">{%</span> <span class="k">endblock</span> <span class="cp">%}</span></code></pre></figure>

<p><img src="../../../../media/series/beginners-guide/1.11/part-6/editor-2.png" alt="Editor" /></p>

<hr />

<h4 id="humanize">Humanize</h4>

<p>I just thought it would be a nice touch to add the built-in <strong>humanize</strong> package. It’s a set of utility functions to
add a “human touch” to data.</p>

<p>For example, we can use it to display date and time fields more naturally. Instead of showing the whole date,
we can simply show: “2 minutes ago”.</p>

<p>Let’s do it. First, add the <code class="highlighter-rouge">django.contrib.humanize</code> to the <code class="highlighter-rouge">INSTALLED_APPS</code>.</p>

<p><strong>myproject/settings.py</strong></p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">INSTALLED_APPS</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s">'django.contrib.admin'</span><span class="p">,</span>
    <span class="s">'django.contrib.auth'</span><span class="p">,</span>
    <span class="s">'django.contrib.contenttypes'</span><span class="p">,</span>
    <span class="s">'django.contrib.sessions'</span><span class="p">,</span>
    <span class="s">'django.contrib.messages'</span><span class="p">,</span>
    <span class="s">'django.contrib.staticfiles'</span><span class="p">,</span>
    <span class="s">'django.contrib.humanize'</span><span class="p">,</span>  <span class="c"># &lt;- here</span>

    <span class="s">'widget_tweaks'</span><span class="p">,</span>

    <span class="s">'accounts'</span><span class="p">,</span>
    <span class="s">'boards'</span><span class="p">,</span>
<span class="p">]</span></code></pre></figure>

<p>Now we can use it in the templates. First, let’s edit the <strong>topics.html</strong> template:</p>

<p><strong>templates/topics.html</strong>
<small><a href="https://gist.github.com/vitorfs/45521a289677a1a406b4fb743e8141ee" target="_blank" rel="noopener nofollow">(view complete file contents)</a></small></p>

<figure class="highlight"><pre><code class="language-django" data-lang="django"><span class="cp">{%</span> <span class="k">extends</span> <span class="s1">'base.html'</span> <span class="cp">%}</span>

<span class="cp">{%</span> <span class="nv">load</span> <span class="nv">humanize</span> <span class="cp">%}</span>

<span class="cp">{%</span> <span class="k">block</span> <span class="nv">content</span> <span class="cp">%}</span>
  <span class="c">&lt;!-- code suppressed --&gt;</span>

  <span class="nt">&lt;td&gt;</span><span class="cp">{{</span> <span class="nv">topic.last_updated</span><span class="o">|</span><span class="nf">naturaltime</span> <span class="cp">}}</span><span class="nt">&lt;/td&gt;</span>

  <span class="c">&lt;!-- code suppressed --&gt;</span>
<span class="cp">{%</span> <span class="k">endblock</span> <span class="cp">%}</span></code></pre></figure>

<p>All we have to do is to load the template tags using <code class="highlighter-rouge"><span class="p">{</span><span class="err">%</span><span class="w"> </span><span class="err">load</span><span class="w"> </span><span class="err">humanize</span><span class="w"> </span><span class="err">%</span><span class="p">}</span></code> and then apply the
template filter: <code class="highlighter-rouge"><span class="p">{</span><span class="err">{</span><span class="w"> </span><span class="err">topic.last_updated|naturaltime</span><span class="w"> </span><span class="p">}</span><span class="err">}</span></code></p>

<p><img src="../../../../media/series/beginners-guide/1.11/part-6/humanize.png" alt="Humanize" /></p>

<p>You may add it to other places you like.</p>

<hr />

<h4 id="gravatar">Gravatar</h4>

<p>A very easy way to add user profile pictures is by using <a href="https://gravatar.com/" target="noopener">Gravatar</a>.</p>

<p>Inside the <strong>boards/templatetags</strong> folder, create a new file named <strong>gravatar.py</strong>:</p>

<p><strong>boards/templatetags/gravatar.py</strong></p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="kn">import</span> <span class="nn">hashlib</span>
<span class="kn">from</span> <span class="nn">urllib.parse</span> <span class="kn">import</span> <span class="n">urlencode</span>

<span class="kn">from</span> <span class="nn">django</span> <span class="kn">import</span> <span class="n">template</span>
<span class="kn">from</span> <span class="nn">django.conf</span> <span class="kn">import</span> <span class="n">settings</span>

<span class="n">register</span> <span class="o">=</span> <span class="n">template</span><span class="o">.</span><span class="n">Library</span><span class="p">()</span>


<span class="nd">@register.filter</span>
<span class="k">def</span> <span class="nf">gravatar</span><span class="p">(</span><span class="n">user</span><span class="p">):</span>
    <span class="n">email</span> <span class="o">=</span> <span class="n">user</span><span class="o">.</span><span class="n">email</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s">'utf-8'</span><span class="p">)</span>
    <span class="n">default</span> <span class="o">=</span> <span class="s">'mm'</span>
    <span class="n">size</span> <span class="o">=</span> <span class="mi">256</span>
    <span class="n">url</span> <span class="o">=</span> <span class="s">'https://www.gravatar.com/avatar/{md5}?{params}'</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
        <span class="n">md5</span><span class="o">=</span><span class="n">hashlib</span><span class="o">.</span><span class="n">md5</span><span class="p">(</span><span class="n">email</span><span class="p">)</span><span class="o">.</span><span class="n">hexdigest</span><span class="p">(),</span>
        <span class="n">params</span><span class="o">=</span><span class="n">urlencode</span><span class="p">({</span><span class="s">'d'</span><span class="p">:</span> <span class="n">default</span><span class="p">,</span> <span class="s">'s'</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">size</span><span class="p">)})</span>
    <span class="p">)</span>
    <span class="k">return</span> <span class="n">url</span></code></pre></figure>

<p>Basically I’m using the <a href="https://fi.gravatar.com/site/implement/images/python/" target="_blank" rel="noopener">code snippet they provide</a>.
I just adapted it to work with Python 3.</p>

<p>Great, now we can load it in our template, just like we did with the Humanize template filter:</p>

<p><strong>templates/topic_posts.html</strong>
<small><a href="https://gist.github.com/vitorfs/23d5c5bc9e6c7ac94506a2660a61012c" target="_blank" rel="noopener nofollow">(view complete file contents)</a></small></p>

<figure class="highlight"><pre><code class="language-django" data-lang="django"><span class="cp">{%</span> <span class="k">extends</span> <span class="s1">'base.html'</span> <span class="cp">%}</span>

<span class="cp">{%</span> <span class="nv">load</span> <span class="nv">gravatar</span> <span class="cp">%}</span>

<span class="cp">{%</span> <span class="k">block</span> <span class="nv">content</span> <span class="cp">%}</span>
  <span class="c">&lt;!-- code suppressed --&gt;</span>

  <span class="nt">&lt;img</span> <span class="na">src=</span><span class="s">"</span><span class="cp">{{</span> <span class="nv">post.created_by</span><span class="o">|</span><span class="nf">gravatar</span> <span class="cp">}}</span><span class="s">"</span> <span class="na">alt=</span><span class="s">"</span><span class="cp">{{</span> <span class="nv">post.created_by.username</span> <span class="cp">}}</span><span class="s">"</span> <span class="na">class=</span><span class="s">"w-100 rounded"</span><span class="nt">&gt;</span>

  <span class="c">&lt;!-- code suppressed --&gt;</span>
<span class="cp">{%</span> <span class="k">endblock</span> <span class="cp">%}</span></code></pre></figure>

<p><img src="../../../../media/series/beginners-guide/1.11/part-6/gravatar.png" alt="Gravatar" /></p>

<hr />

<h4 id="final-adjustments">Final Adjustments</h4>

<p>Maybe you have already noticed, but there’s a small issue when someone replies to a post. It’s not updating the
<code class="highlighter-rouge">last_update</code> field, so the ordering of the topics is broken right now.</p>

<p>Let’s fix it:</p>

<p><strong>boards/views.py</strong></p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="nd">@login_required</span>
<span class="k">def</span> <span class="nf">reply_topic</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">pk</span><span class="p">,</span> <span class="n">topic_pk</span><span class="p">):</span>
    <span class="n">topic</span> <span class="o">=</span> <span class="n">get_object_or_404</span><span class="p">(</span><span class="n">Topic</span><span class="p">,</span> <span class="n">board__pk</span><span class="o">=</span><span class="n">pk</span><span class="p">,</span> <span class="n">pk</span><span class="o">=</span><span class="n">topic_pk</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">method</span> <span class="o">==</span> <span class="s">'POST'</span><span class="p">:</span>
        <span class="n">form</span> <span class="o">=</span> <span class="n">PostForm</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">POST</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">form</span><span class="o">.</span><span class="n">is_valid</span><span class="p">():</span>
            <span class="n">post</span> <span class="o">=</span> <span class="n">form</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">commit</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
            <span class="n">post</span><span class="o">.</span><span class="n">topic</span> <span class="o">=</span> <span class="n">topic</span>
            <span class="n">post</span><span class="o">.</span><span class="n">created_by</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">user</span>
            <span class="n">post</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>

            <span class="n">topic</span><span class="o">.</span><span class="n">last_updated</span> <span class="o">=</span> <span class="n">timezone</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>  <span class="c"># &lt;- here</span>
            <span class="n">topic</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>                         <span class="c"># &lt;- and here</span>

            <span class="k">return</span> <span class="n">redirect</span><span class="p">(</span><span class="s">'topic_posts'</span><span class="p">,</span> <span class="n">pk</span><span class="o">=</span><span class="n">pk</span><span class="p">,</span> <span class="n">topic_pk</span><span class="o">=</span><span class="n">topic_pk</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">form</span> <span class="o">=</span> <span class="n">PostForm</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">render</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s">'reply_topic.html'</span><span class="p">,</span> <span class="p">{</span><span class="s">'topic'</span><span class="p">:</span> <span class="n">topic</span><span class="p">,</span> <span class="s">'form'</span><span class="p">:</span> <span class="n">form</span><span class="p">})</span></code></pre></figure>

<p>Next thing we want to do is try to control the view counting system a little bit more. We don’t want to the same user
refreshing the page counting as multiple views. For this we can use sessions:</p>

<p><strong>boards/views.py</strong></p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="k">class</span> <span class="nc">PostListView</span><span class="p">(</span><span class="n">ListView</span><span class="p">):</span>
    <span class="n">model</span> <span class="o">=</span> <span class="n">Post</span>
    <span class="n">context_object_name</span> <span class="o">=</span> <span class="s">'posts'</span>
    <span class="n">template_name</span> <span class="o">=</span> <span class="s">'topic_posts.html'</span>
    <span class="n">paginate_by</span> <span class="o">=</span> <span class="mi">20</span>

    <span class="k">def</span> <span class="nf">get_context_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>

        <span class="n">session_key</span> <span class="o">=</span> <span class="s">'viewed_topic_{}'</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">topic</span><span class="o">.</span><span class="n">pk</span><span class="p">)</span>  <span class="c"># &lt;-- here</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">session_key</span><span class="p">,</span> <span class="bp">False</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">topic</span><span class="o">.</span><span class="n">views</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">topic</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">session</span><span class="p">[</span><span class="n">session_key</span><span class="p">]</span> <span class="o">=</span> <span class="bp">True</span>           <span class="c"># &lt;-- until here</span>

        <span class="n">kwargs</span><span class="p">[</span><span class="s">'topic'</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">topic</span>
        <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">get_context_data</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">get_queryset</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">topic</span> <span class="o">=</span> <span class="n">get_object_or_404</span><span class="p">(</span><span class="n">Topic</span><span class="p">,</span> <span class="n">board__pk</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">'pk'</span><span class="p">),</span> <span class="n">pk</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">'topic_pk'</span><span class="p">))</span>
        <span class="n">queryset</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">topic</span><span class="o">.</span><span class="n">posts</span><span class="o">.</span><span class="n">order_by</span><span class="p">(</span><span class="s">'created_at'</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">queryset</span></code></pre></figure>

<p>Now we could provide a better navigation in the topics listing. Currently the only option is for the user to click
in the topic title and go to the first page. We could workout something like this:</p>

<p><strong>boards/models.py</strong></p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="kn">import</span> <span class="nn">math</span>
<span class="kn">from</span> <span class="nn">django.db</span> <span class="kn">import</span> <span class="n">models</span>

<span class="k">class</span> <span class="nc">Topic</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="c"># ...</span>

    <span class="k">def</span> <span class="nf">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">subject</span>

    <span class="k">def</span> <span class="nf">get_page_count</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">count</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">posts</span><span class="o">.</span><span class="n">count</span><span class="p">()</span>
        <span class="n">pages</span> <span class="o">=</span> <span class="n">count</span> <span class="o">/</span> <span class="mi">20</span>
        <span class="k">return</span> <span class="n">math</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="n">pages</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">has_many_pages</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">count</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">count</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">count</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_page_count</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">count</span> <span class="o">&gt;</span> <span class="mi">6</span>

    <span class="k">def</span> <span class="nf">get_page_range</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">count</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_page_count</span><span class="p">()</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">has_many_pages</span><span class="p">(</span><span class="n">count</span><span class="p">):</span>
            <span class="k">return</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
        <span class="k">return</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">count</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span></code></pre></figure>

<p>Then in the <strong>topics.html</strong> template we could implement something like this:</p>

<p><strong>templates/topics.html</strong></p>

<figure class="highlight"><pre><code class="language-django" data-lang="django">  <span class="nt">&lt;table</span> <span class="na">class=</span><span class="s">"table table-striped mb-4"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;thead</span> <span class="na">class=</span><span class="s">"thead-inverse"</span><span class="nt">&gt;</span>
      <span class="nt">&lt;tr&gt;</span>
        <span class="nt">&lt;th&gt;</span>Topic<span class="nt">&lt;/th&gt;</span>
        <span class="nt">&lt;th&gt;</span>Starter<span class="nt">&lt;/th&gt;</span>
        <span class="nt">&lt;th&gt;</span>Replies<span class="nt">&lt;/th&gt;</span>
        <span class="nt">&lt;th&gt;</span>Views<span class="nt">&lt;/th&gt;</span>
        <span class="nt">&lt;th&gt;</span>Last Update<span class="nt">&lt;/th&gt;</span>
      <span class="nt">&lt;/tr&gt;</span>
    <span class="nt">&lt;/thead&gt;</span>
    <span class="nt">&lt;tbody&gt;</span>
      <span class="cp">{%</span> <span class="k">for</span> <span class="nv">topic</span> <span class="ow">in</span> <span class="nv">topics</span> <span class="cp">%}</span>
        <span class="cp">{%</span> <span class="nv">url</span> <span class="s1">'topic_posts'</span> <span class="nv">board.pk</span> <span class="nv">topic.pk</span> <span class="k">as</span> <span class="nv">topic_url</span> <span class="cp">%}</span>
        <span class="nt">&lt;tr&gt;</span>
          <span class="nt">&lt;td&gt;</span>
            <span class="nt">&lt;p</span> <span class="na">class=</span><span class="s">"mb-0"</span><span class="nt">&gt;</span>
              <span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">"</span><span class="cp">{{</span> <span class="nv">topic_url</span> <span class="cp">}}</span><span class="s">"</span><span class="nt">&gt;</span><span class="cp">{{</span> <span class="nv">topic.subject</span> <span class="cp">}}</span><span class="nt">&lt;/a&gt;</span>
            <span class="nt">&lt;/p&gt;</span>
            <span class="nt">&lt;small</span> <span class="na">class=</span><span class="s">"text-muted"</span><span class="nt">&gt;</span>
              Pages:
              <span class="cp">{%</span> <span class="k">for</span> <span class="nv">i</span> <span class="ow">in</span> <span class="nv">topic.get_page_range</span> <span class="cp">%}</span>
                <span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">"</span><span class="cp">{{</span> <span class="nv">topic_url</span> <span class="cp">}}</span><span class="s">?page=</span><span class="cp">{{</span> <span class="nv">i</span> <span class="cp">}}</span><span class="s">"</span><span class="nt">&gt;</span><span class="cp">{{</span> <span class="nv">i</span> <span class="cp">}}</span><span class="nt">&lt;/a&gt;</span>
              <span class="cp">{%</span> <span class="k">endfor</span> <span class="cp">%}</span>
              <span class="cp">{%</span> <span class="k">if</span> <span class="nv">topic.has_many_pages</span> <span class="cp">%}</span>
              ... <span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">"</span><span class="cp">{{</span> <span class="nv">topic_url</span> <span class="cp">}}</span><span class="s">?page=</span><span class="cp">{{</span> <span class="nv">topic.get_page_count</span> <span class="cp">}}</span><span class="s">"</span><span class="nt">&gt;</span>Last Page<span class="nt">&lt;/a&gt;</span>
              <span class="cp">{%</span> <span class="k">endif</span> <span class="cp">%}</span>
            <span class="nt">&lt;/small&gt;</span>
          <span class="nt">&lt;/td&gt;</span>
          <span class="nt">&lt;td</span> <span class="na">class=</span><span class="s">"align-middle"</span><span class="nt">&gt;</span><span class="cp">{{</span> <span class="nv">topic.starter.username</span> <span class="cp">}}</span><span class="nt">&lt;/td&gt;</span>
          <span class="nt">&lt;td</span> <span class="na">class=</span><span class="s">"align-middle"</span><span class="nt">&gt;</span><span class="cp">{{</span> <span class="nv">topic.replies</span> <span class="cp">}}</span><span class="nt">&lt;/td&gt;</span>
          <span class="nt">&lt;td</span> <span class="na">class=</span><span class="s">"align-middle"</span><span class="nt">&gt;</span><span class="cp">{{</span> <span class="nv">topic.views</span> <span class="cp">}}</span><span class="nt">&lt;/td&gt;</span>
          <span class="nt">&lt;td</span> <span class="na">class=</span><span class="s">"align-middle"</span><span class="nt">&gt;</span><span class="cp">{{</span> <span class="nv">topic.last_updated</span><span class="o">|</span><span class="nf">naturaltime</span> <span class="cp">}}</span><span class="nt">&lt;/td&gt;</span>
        <span class="nt">&lt;/tr&gt;</span>
      <span class="cp">{%</span> <span class="k">endfor</span> <span class="cp">%}</span>
    <span class="nt">&lt;/tbody&gt;</span>
  <span class="nt">&lt;/table&gt;</span></code></pre></figure>

<p>Like a tiny pagination for each topic. Note that I also took the time to add the <code class="highlighter-rouge">table-striped</code> class for a better
styling of the table.</p>

<p><img src="../../../../media/series/beginners-guide/1.11/part-6/pages.png" alt="Pages" /></p>

<p>In the reply page, we are currently listing all topic replies. We could limit it to just the last ten posts.</p>

<p><strong>boards/models.py</strong></p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="k">class</span> <span class="nc">Topic</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="c"># ...</span>

    <span class="k">def</span> <span class="nf">get_last_ten_posts</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">posts</span><span class="o">.</span><span class="n">order_by</span><span class="p">(</span><span class="s">'-created_at'</span><span class="p">)[:</span><span class="mi">10</span><span class="p">]</span></code></pre></figure>

<p><strong>templates/reply_topic.html</strong></p>

<figure class="highlight"><pre><code class="language-django" data-lang="django"><span class="cp">{%</span> <span class="k">block</span> <span class="nv">content</span> <span class="cp">%}</span>

  <span class="nt">&lt;form</span> <span class="na">method=</span><span class="s">"post"</span> <span class="na">class=</span><span class="s">"mb-4"</span> <span class="na">novalidate</span><span class="nt">&gt;</span>
    <span class="cp">{%</span> <span class="nv">csrf_token</span> <span class="cp">%}</span>
    <span class="cp">{%</span> <span class="k">include</span> <span class="s1">'includes/form.html'</span> <span class="cp">%}</span>
    <span class="nt">&lt;button</span> <span class="na">type=</span><span class="s">"submit"</span> <span class="na">class=</span><span class="s">"btn btn-success"</span><span class="nt">&gt;</span>Post a reply<span class="nt">&lt;/button&gt;</span>
  <span class="nt">&lt;/form&gt;</span>

  <span class="cp">{%</span> <span class="k">for</span> <span class="nv">post</span> <span class="ow">in</span> <span class="nv">topic.get_last_ten_posts</span> <span class="cp">%}</span>  <span class="c">&lt;!-- here! --&gt;</span>
    <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"card mb-2"</span><span class="nt">&gt;</span>
      <span class="c">&lt;!-- code suppressed --&gt;</span>
    <span class="nt">&lt;/div&gt;</span>
  <span class="cp">{%</span> <span class="k">endfor</span> <span class="cp">%}</span>

<span class="cp">{%</span> <span class="k">endblock</span> <span class="cp">%}</span></code></pre></figure>

<p><img src="../../../../media/series/beginners-guide/1.11/part-6/replies.png" alt="Replies" /></p>

<p>Another thing is that when the user replies to a post, we are redirecting the user to the first page again. We could
improve it by sending the user to the last page.</p>

<p>We can add an id to the post card:</p>

<p><strong>templates/topic_posts.html</strong></p>

<figure class="highlight"><pre><code class="language-django" data-lang="django"><span class="cp">{%</span> <span class="k">block</span> <span class="nv">content</span> <span class="cp">%}</span>

  <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"mb-4"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">"</span><span class="cp">{%</span> <span class="nv">url</span> <span class="s1">'reply_topic'</span> <span class="nv">topic.board.pk</span> <span class="nv">topic.pk</span> <span class="cp">%}</span><span class="s">"</span> <span class="na">class=</span><span class="s">"btn btn-primary"</span> <span class="na">role=</span><span class="s">"button"</span><span class="nt">&gt;</span>Reply<span class="nt">&lt;/a&gt;</span>
  <span class="nt">&lt;/div&gt;</span>

  <span class="cp">{%</span> <span class="k">for</span> <span class="nv">post</span> <span class="ow">in</span> <span class="nv">posts</span> <span class="cp">%}</span>
    <span class="nt">&lt;div</span> <span class="na">id=</span><span class="s">"</span><span class="cp">{{</span> <span class="nv">post.pk</span> <span class="cp">}}</span><span class="s">"</span> <span class="na">class=</span><span class="s">"card </span><span class="cp">{%</span> <span class="k">if</span> <span class="nv">forloop.last</span> <span class="cp">%}</span><span class="s">mb-4</span><span class="cp">{%</span> <span class="k">else</span> <span class="cp">%}</span><span class="s">mb-2</span><span class="cp">{%</span> <span class="k">endif</span> <span class="cp">%}</span><span class="s"> </span><span class="cp">{%</span> <span class="k">if</span> <span class="nv">forloop.first</span> <span class="cp">%}</span><span class="s">border-dark</span><span class="cp">{%</span> <span class="k">endif</span> <span class="cp">%}</span><span class="s">"</span><span class="nt">&gt;</span>
      <span class="c">&lt;!-- code suppressed --&gt;</span>
    <span class="nt">&lt;/div&gt;</span>
  <span class="cp">{%</span> <span class="k">endfor</span> <span class="cp">%}</span>

  <span class="cp">{%</span> <span class="k">include</span> <span class="s1">'includes/pagination.html'</span> <span class="cp">%}</span>

<span class="cp">{%</span> <span class="k">endblock</span> <span class="cp">%}</span></code></pre></figure>

<p>The important bit here is the <code class="highlighter-rouge">&lt;div id="{{ post.pk }}" ...&gt;</code>.</p>

<p>Then we can play with it like this in the views:</p>

<p><strong>boards/views.py</strong></p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="nd">@login_required</span>
<span class="k">def</span> <span class="nf">reply_topic</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">pk</span><span class="p">,</span> <span class="n">topic_pk</span><span class="p">):</span>
    <span class="n">topic</span> <span class="o">=</span> <span class="n">get_object_or_404</span><span class="p">(</span><span class="n">Topic</span><span class="p">,</span> <span class="n">board__pk</span><span class="o">=</span><span class="n">pk</span><span class="p">,</span> <span class="n">pk</span><span class="o">=</span><span class="n">topic_pk</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">method</span> <span class="o">==</span> <span class="s">'POST'</span><span class="p">:</span>
        <span class="n">form</span> <span class="o">=</span> <span class="n">PostForm</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">POST</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">form</span><span class="o">.</span><span class="n">is_valid</span><span class="p">():</span>
            <span class="n">post</span> <span class="o">=</span> <span class="n">form</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">commit</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
            <span class="n">post</span><span class="o">.</span><span class="n">topic</span> <span class="o">=</span> <span class="n">topic</span>
            <span class="n">post</span><span class="o">.</span><span class="n">created_by</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">user</span>
            <span class="n">post</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>

            <span class="n">topic</span><span class="o">.</span><span class="n">last_updated</span> <span class="o">=</span> <span class="n">timezone</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>
            <span class="n">topic</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>

            <span class="n">topic_url</span> <span class="o">=</span> <span class="n">reverse</span><span class="p">(</span><span class="s">'topic_posts'</span><span class="p">,</span> <span class="n">kwargs</span><span class="o">=</span><span class="p">{</span><span class="s">'pk'</span><span class="p">:</span> <span class="n">pk</span><span class="p">,</span> <span class="s">'topic_pk'</span><span class="p">:</span> <span class="n">topic_pk</span><span class="p">})</span>
            <span class="n">topic_post_url</span> <span class="o">=</span> <span class="s">'{url}?page={page}#{id}'</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                <span class="n">url</span><span class="o">=</span><span class="n">topic_url</span><span class="p">,</span>
                <span class="nb">id</span><span class="o">=</span><span class="n">post</span><span class="o">.</span><span class="n">pk</span><span class="p">,</span>
                <span class="n">page</span><span class="o">=</span><span class="n">topic</span><span class="o">.</span><span class="n">get_page_count</span><span class="p">()</span>
            <span class="p">)</span>

            <span class="k">return</span> <span class="n">redirect</span><span class="p">(</span><span class="n">topic_post_url</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">form</span> <span class="o">=</span> <span class="n">PostForm</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">render</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s">'reply_topic.html'</span><span class="p">,</span> <span class="p">{</span><span class="s">'topic'</span><span class="p">:</span> <span class="n">topic</span><span class="p">,</span> <span class="s">'form'</span><span class="p">:</span> <span class="n">form</span><span class="p">})</span></code></pre></figure>

<p>In the <strong>topic_post_url</strong> we are building a URL with the last page and adding an anchor to the element with id equals
to the post ID.</p>

<p>With this, it will required us to update the following test case:</p>

<p><strong>boards/tests/test_view_reply_topic.py</strong></p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="k">class</span> <span class="nc">SuccessfulReplyTopicTests</span><span class="p">(</span><span class="n">ReplyTopicTestCase</span><span class="p">):</span>
    <span class="c"># ...</span>

    <span class="k">def</span> <span class="nf">test_redirection</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="s">'''
        A valid form submission should redirect the user
        '''</span>
        <span class="n">url</span> <span class="o">=</span> <span class="n">reverse</span><span class="p">(</span><span class="s">'topic_posts'</span><span class="p">,</span> <span class="n">kwargs</span><span class="o">=</span><span class="p">{</span><span class="s">'pk'</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">board</span><span class="o">.</span><span class="n">pk</span><span class="p">,</span> <span class="s">'topic_pk'</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">topic</span><span class="o">.</span><span class="n">pk</span><span class="p">})</span>
        <span class="n">topic_posts_url</span> <span class="o">=</span> <span class="s">'{url}?page=1#2'</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">url</span><span class="o">=</span><span class="n">url</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertRedirects</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">response</span><span class="p">,</span> <span class="n">topic_posts_url</span><span class="p">)</span></code></pre></figure>

<p><img src="../../../../media/series/beginners-guide/1.11/part-6/reply-last-page.png" alt="Replies" /></p>

<p>Next issue, as you can see in the previous screenshot, is to solve the problem with the pagination when the number
of pages is too high.</p>

<p>The easiest way is to tweak the <strong>pagination.html</strong> template:</p>

<p><strong>templates/includes/pagination.html</strong></p>

<figure class="highlight"><pre><code class="language-django" data-lang="django"><span class="cp">{%</span> <span class="k">if</span> <span class="nv">is_paginated</span> <span class="cp">%}</span>
  <span class="nt">&lt;nav</span> <span class="na">aria-label=</span><span class="s">"Topics pagination"</span> <span class="na">class=</span><span class="s">"mb-4"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;ul</span> <span class="na">class=</span><span class="s">"pagination"</span><span class="nt">&gt;</span>
      <span class="cp">{%</span> <span class="k">if</span> <span class="nv">page_obj.</span><span class="nb">number</span> <span class="o">&gt;</span> <span class="nv">1</span> <span class="cp">%}</span>
        <span class="nt">&lt;li</span> <span class="na">class=</span><span class="s">"page-item"</span><span class="nt">&gt;</span>
          <span class="nt">&lt;a</span> <span class="na">class=</span><span class="s">"page-link"</span> <span class="na">href=</span><span class="s">"?page=1"</span><span class="nt">&gt;</span>First<span class="nt">&lt;/a&gt;</span>
        <span class="nt">&lt;/li&gt;</span>
      <span class="cp">{%</span> <span class="k">else</span> <span class="cp">%}</span>
        <span class="nt">&lt;li</span> <span class="na">class=</span><span class="s">"page-item disabled"</span><span class="nt">&gt;</span>
          <span class="nt">&lt;span</span> <span class="na">class=</span><span class="s">"page-link"</span><span class="nt">&gt;</span>First<span class="nt">&lt;/span&gt;</span>
        <span class="nt">&lt;/li&gt;</span>
      <span class="cp">{%</span> <span class="k">endif</span> <span class="cp">%}</span>

      <span class="cp">{%</span> <span class="k">if</span> <span class="nv">page_obj.has_previous</span> <span class="cp">%}</span>
        <span class="nt">&lt;li</span> <span class="na">class=</span><span class="s">"page-item"</span><span class="nt">&gt;</span>
          <span class="nt">&lt;a</span> <span class="na">class=</span><span class="s">"page-link"</span> <span class="na">href=</span><span class="s">"?page=</span><span class="cp">{{</span> <span class="nv">page_obj.previous_page_number</span> <span class="cp">}}</span><span class="s">"</span><span class="nt">&gt;</span>Previous<span class="nt">&lt;/a&gt;</span>
        <span class="nt">&lt;/li&gt;</span>
      <span class="cp">{%</span> <span class="k">else</span> <span class="cp">%}</span>
        <span class="nt">&lt;li</span> <span class="na">class=</span><span class="s">"page-item disabled"</span><span class="nt">&gt;</span>
          <span class="nt">&lt;span</span> <span class="na">class=</span><span class="s">"page-link"</span><span class="nt">&gt;</span>Previous<span class="nt">&lt;/span&gt;</span>
        <span class="nt">&lt;/li&gt;</span>
      <span class="cp">{%</span> <span class="k">endif</span> <span class="cp">%}</span>

      <span class="cp">{%</span> <span class="k">for</span> <span class="nv">page_num</span> <span class="ow">in</span> <span class="nv">paginator.page_range</span> <span class="cp">%}</span>
        <span class="cp">{%</span> <span class="k">if</span> <span class="nv">page_obj.</span><span class="nb">number</span> <span class="o">==</span> <span class="nv">page_num</span> <span class="cp">%}</span>
          <span class="nt">&lt;li</span> <span class="na">class=</span><span class="s">"page-item active"</span><span class="nt">&gt;</span>
            <span class="nt">&lt;span</span> <span class="na">class=</span><span class="s">"page-link"</span><span class="nt">&gt;</span>
              <span class="cp">{{</span> <span class="nv">page_num</span> <span class="cp">}}</span>
              <span class="nt">&lt;span</span> <span class="na">class=</span><span class="s">"sr-only"</span><span class="nt">&gt;</span>(current)<span class="nt">&lt;/span&gt;</span>
            <span class="nt">&lt;/span&gt;</span>
          <span class="nt">&lt;/li&gt;</span>
        <span class="cp">{%</span> <span class="nv">elif</span> <span class="nv">page_num</span> <span class="o">&gt;</span> <span class="nv">page_obj.</span><span class="nb">number</span><span class="o">|</span><span class="nf">add</span><span class="err">:</span><span class="s1">'-3'</span> <span class="ow">and</span> <span class="nv">page_num</span> <span class="o">&lt;</span> <span class="nv">page_obj.</span><span class="nb">number</span><span class="o">|</span><span class="nf">add</span><span class="err">:</span><span class="s1">'3'</span> <span class="cp">%}</span>
          <span class="nt">&lt;li</span> <span class="na">class=</span><span class="s">"page-item"</span><span class="nt">&gt;</span>
            <span class="nt">&lt;a</span> <span class="na">class=</span><span class="s">"page-link"</span> <span class="na">href=</span><span class="s">"?page=</span><span class="cp">{{</span> <span class="nv">page_num</span> <span class="cp">}}</span><span class="s">"</span><span class="nt">&gt;</span><span class="cp">{{</span> <span class="nv">page_num</span> <span class="cp">}}</span><span class="nt">&lt;/a&gt;</span>
          <span class="nt">&lt;/li&gt;</span>
        <span class="cp">{%</span> <span class="k">endif</span> <span class="cp">%}</span>
      <span class="cp">{%</span> <span class="k">endfor</span> <span class="cp">%}</span>

      <span class="cp">{%</span> <span class="k">if</span> <span class="nv">page_obj.has_next</span> <span class="cp">%}</span>
        <span class="nt">&lt;li</span> <span class="na">class=</span><span class="s">"page-item"</span><span class="nt">&gt;</span>
          <span class="nt">&lt;a</span> <span class="na">class=</span><span class="s">"page-link"</span> <span class="na">href=</span><span class="s">"?page=</span><span class="cp">{{</span> <span class="nv">page_obj.next_page_number</span> <span class="cp">}}</span><span class="s">"</span><span class="nt">&gt;</span>Next<span class="nt">&lt;/a&gt;</span>
        <span class="nt">&lt;/li&gt;</span>
      <span class="cp">{%</span> <span class="k">else</span> <span class="cp">%}</span>
        <span class="nt">&lt;li</span> <span class="na">class=</span><span class="s">"page-item disabled"</span><span class="nt">&gt;</span>
          <span class="nt">&lt;span</span> <span class="na">class=</span><span class="s">"page-link"</span><span class="nt">&gt;</span>Next<span class="nt">&lt;/span&gt;</span>
        <span class="nt">&lt;/li&gt;</span>
      <span class="cp">{%</span> <span class="k">endif</span> <span class="cp">%}</span>

      <span class="cp">{%</span> <span class="k">if</span> <span class="nv">page_obj.</span><span class="nb">number</span> <span class="o">!=</span> <span class="nv">paginator.num_pages</span> <span class="cp">%}</span>
        <span class="nt">&lt;li</span> <span class="na">class=</span><span class="s">"page-item"</span><span class="nt">&gt;</span>
          <span class="nt">&lt;a</span> <span class="na">class=</span><span class="s">"page-link"</span> <span class="na">href=</span><span class="s">"?page=</span><span class="cp">{{</span> <span class="nv">paginator.num_pages</span> <span class="cp">}}</span><span class="s">"</span><span class="nt">&gt;</span>Last<span class="nt">&lt;/a&gt;</span>
        <span class="nt">&lt;/li&gt;</span>
      <span class="cp">{%</span> <span class="k">else</span> <span class="cp">%}</span>
        <span class="nt">&lt;li</span> <span class="na">class=</span><span class="s">"page-item disabled"</span><span class="nt">&gt;</span>
          <span class="nt">&lt;span</span> <span class="na">class=</span><span class="s">"page-link"</span><span class="nt">&gt;</span>Last<span class="nt">&lt;/span&gt;</span>
        <span class="nt">&lt;/li&gt;</span>
      <span class="cp">{%</span> <span class="k">endif</span> <span class="cp">%}</span>
    <span class="nt">&lt;/ul&gt;</span>
  <span class="nt">&lt;/nav&gt;</span>
<span class="cp">{%</span> <span class="k">endif</span> <span class="cp">%}</span></code></pre></figure>

<p><img src="../../../../media/series/beginners-guide/1.11/part-6/long-pages.png" alt="Long pages" /></p>

<hr />

<h4 id="conclusions">Conclusions</h4>

<p>With this tutorial, we finalized the implementation of our Django board application. I will probably release a follow-up
implementation tutorial to improve the code. There are many things we can explore together. For example, database
optimizations, improve the user interface, play with file uploads, create a moderation system, and so on.</p>

<p>The next tutorial will be focused on deployment. It’s going to be a complete guide on how to put your code in
production taking care of all the important details.</p>

<p>I hope you enjoyed the sixth part of this tutorial series! The last part is coming out next week, on Oct 16, 2017.
If you would like to get notified when the last part is out, you can <a href="https://colossus.simpleisbetterthancomplex.com/subscribe/d2320a41-0378-4aa8-8f4e-5bb1ffcd521d/" target="_blank">subscribe to our mailing list</a>.</p>

<p>The source code of the project is available on GitHub. The current state of the project can be found under the release
tag <strong>v0.6-lw</strong>. The link below will take you to the right place:</p>

<p><a href="https://github.com/sibtc/django-beginners-guide/tree/v0.6-lw" target="_blank">https://github.com/sibtc/django-beginners-guide/tree/v0.6-lw</a></p>

<hr />

<div class="popular-posts">
  <div class="row">
    <div class="six columns">
      <a href="../02/a-complete-beginners-guide-to-django-part-5.html" style="text-decoration: none">
        <img src="../../../../media/series/beginners-guide/1.11/part-5/featured.jpg" alt="A Complete Beginner's Guide to Django - Part 5" title="A Complete Beginner's Guide to Django - Part 5" />
        <h5 style="margin-top: 1rem;">← Part 5 - Django ORM</h5>
      </a>
    </div>
    <div class="six columns">
      <a href="../16/a-complete-beginners-guide-to-django-part-7.html" style="text-decoration: none">
        <img src="../../../../media/series/beginners-guide/1.11/part-7/featured.jpg" alt="A Complete Beginner's Guide to Django - Part 7" title="A Complete Beginner's Guide to Django - Part 7" />
        <h5 style="text-align: right; margin-top: 1rem;">Part 7 - Deployment →</h5>
      </a>
    </div>
  </div>
</div>


          </article>

          <hr class="dashed">
<div class="row">
  <div class="six columns post-tags" style="padding-top: 4px">
    
      <a href="../../../../tag/python/index.html"><span class="tag">python</span></a>
    
      <a href="../../../../tag/django/index.html"><span class="tag">django</span></a>
    
      <a href="../../../../tag/guide/index.html"><span class="tag">guide</span></a>
    
      <a href="../../../../tag/beginners/index.html"><span class="tag">beginners</span></a>
    
      <a href="../../../../tag/views/index.html"><span class="tag">views</span></a>
    
      <a href="../../../../tag/cbv/index.html"><span class="tag">cbv</span></a>
    
      <a href="../../../../tag/gcbv/index.html"><span class="tag">gcbv</span></a>
    
  </div>
  <div class="six columns post-share">
    <div class="social">
  Share this post
  <a href="http://vk.com/share.php?url=http://sibt.co/2z75O1z"
     rel="nofollow"
     target="_blank"
     title="Share on VK">
    <i class="fa fa-vk"></i>
  </a>
  <a href="https://twitter.com/intent/tweet?text=A%20Complete%20Beginner's%20Guide%20to%20Django%20-%20Part%206&amp;url=http://sibt.co/2yyVUbY&amp;via=vitorfs&amp;related=vitorfs"
     rel="nofollow"
     target="_blank"
     title="Share on Twitter">
    <i class="fa fa-twitter"></i>
  </a>
  <a href="https://www.facebook.com/sharer/sharer.php?app_id=1645747765697865&amp;u=http://sibt.co/2yyVUsu"
     rel="nofollow"
     target="_blank"
     title="Share on Facebook">
    <i class="fa fa-facebook"></i>
  </a>
  <a href="http://www.linkedin.com/shareArticle?mini=true&amp;url=http://sibt.co/2z8WTg0&amp;title=A%20Complete%20Beginner's%20Guide%20to%20Django%20-%20Part%206&amp;summary=Welcome%20to%20the%20sixth%20part%20of%20the%20tutorial%20series!%20In%20this%20tutorial,%20we%20are%20going%20to%20explore%20in%20great%20detail%20the%20Class-Based%20Views.%20We%20are%20also%20going%20to%20refactor%20some%20of%20the%20existing%20views%20so%20to%20tak...&amp;source=https://simpleisbetterthancomplex.com"
     rel="nofollow"
     target="_blank"
     title="Share on LinkedIn">
    <i class="fa fa-linkedin"></i>
  </a>
</div>

  </div>
</div>

        </div>

        <div class="card">
          
  <div id="comments">
    <div id="disqus_thread"></div>
    <script>
      var disqus_config = function () {
        this.page.url = 'a-complete-beginners-guide-to-django-part-6.html';
        this.page.identifier = '/series/2017/10/09/a-complete-beginners-guide-to-django-part-6';
      };
      (function() {
      var d = document, s = d.createElement('script');
      s.src = 'http://simpleisbetterthancomplex.disqus.com/embed.js';
      s.setAttribute('data-timestamp', +new Date());
      (d.head || d.body).appendChild(s);
      })();
    </script>
    <script id="dsq-count-scr" src="http://simpleisbetterthancomplex.disqus.com/count.js" async></script>
    <noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript>
  </div>


        </div>
      </div>
    </div>
  </div>

  <div class="container post post-footer">
    <div class="card subscribe">
  <form action="https://colossus.simpleisbetterthancomplex.com/subscribe/d2320a41-0378-4aa8-8f4e-5bb1ffcd521d/" method="post" target="_blank" novalidate>
    <h4>
      <span class="fa fa-send" style="margin-right: 5px"></span> Subscribe to our Mailing List
    </h4>
    <h5>Receive updates from the Blog!</h5>
    <div class="row">
      <div class="eight columns">
        <input class="u-full-width" placeholder="Your email address" type="email" name="email">
      </div>
      <div class="four columns">
        <button type="submit" class="u-full-width">Subscribe</button>
      </div>
    </div>
  </form>
</div>

    <div class="card popular-posts">
  <h4>Popular Posts</h4>
  <div class="row">
    
      <div class="four columns">
        <a href="../../../../tutorial/2016/07/22/how-to-extend-django-user-model.html">
          <img src="../../../../media/2016-07-22-how-to-extend-django-user-model/featured-post-image.jpg" alt="How to Extend Django User Model" title="How to Extend Django User Model">
          How to Extend Django User Model
        </a>
      </div>
    
      <div class="four columns">
        <a href="../../../../tutorial/2016/05/11/how-to-setup-ssl-certificate-on-nginx-for-django-application.html">
          <img src="../../../../media/2016-05-11-how-to-setup-ssl-certificate-on-nginx-for-django-application/featured-post-image.jpg" alt="How to Setup a SSL Certificate on Nginx for a Django Application" title="How to Setup a SSL Certificate on Nginx for a Django Application">
          How to Setup a SSL Certificate on Nginx for a Django Application
        </a>
      </div>
    
      <div class="four columns">
        <a href="../../../../tutorial/2016/10/14/how-to-deploy-to-digital-ocean.html">
          <img src="../../../../media/2016/10/featured-do.jpg" alt="How to Deploy a Django Application to Digital Ocean" title="How to Deploy a Django Application to Digital Ocean">
          How to Deploy a Django Application to Digital Ocean
        </a>
      </div>
    
  </div>
</div>

  </div>

  <footer>
  <div class="container">
    <ul>
      <li>© 2015-2021 simple complex</li>
      <li><a rel="license noopener" href="https://creativecommons.org/licenses/by-nc-sa/3.0/" target="_blank">cc by-nc-sa 3.0</a></li>
      <li>//</li>
      <li><a href="../../../../about/index.html" rel="author">about</a></li>
      <li><a href="../../../../contact/index.html">contact</a></li>
      <li><a href="../../../../faq/index.html">faq</a></li>
      <li><a href="../../../../cookies/index.html">cookies</a></li>
      <li><a href="../../../../privacy/index.html">privacy policy</a></li>
    </ul>
  </div>
</footer>
<div class="overlay"></div>

  
  <script id="ga-page-views" src="../../../../js/page-views.js" async></script>
  <script src="http://z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=1d8c6a0f-2136-49ad-b0b3-0b09662b7e28"></script>


<style>
.related-posts .row {
  display: grid;
  grid-gap: 20px;
  grid-template-columns: repeat(3, 1fr);
}

.related-posts .four.columns {
  width: 100%;
}
</style>

<script>
_bsa.init('recommended', 'CK7I4KJJ', 'placement:simpleisbetterthancomplexcom',
    {
      target: '.related-posts .columns',
      template: `
<div class="four columns">
<a href="##link##" rel="noopener nofollow">
<img src="##smallImage##" alt="##title##" title="##title##">[Sponsored] ##title##</a>
</div>
      `
    }
  );
</script>

<script type="application/ld+json">
{
  "@context": "http://schema.org",
  "@type": "BlogPosting",
  "mainEntityOfPage": "https://simpleisbetterthancomplex.com/series/2017/10/09/a-complete-beginners-guide-to-django-part-6.html",
  "headline": "A Complete Beginner's Guide to Django - Part 6",
  "image": {
    "@type": "ImageObject",
    "url": "https://simpleisbetterthancomplex.com/media/series/beginners-guide/1.11/part-6/featured.jpg",
    "height": 370,
    "width": 960
  },
  "datePublished": "2017-10-09T08:00:00+03:00",
  "dateModified": "2017-10-09T08:00:00+03:00",
  "author": {
    "@type": "Person",
    "name": "Vitor Freitas"
  },
   "publisher": {
    "@type": "Organization",
    "name": "Simple is Better Than Complex",
    "logo": {
      "@type": "ImageObject",
      "url": "https://simpleisbetterthancomplex.com/img/gplus_logo.png",
      "height": 60,
      "width": 600
    }
  },
  "description": "Welcome to the sixth part of the tutorial series! In this tutorial, we are going to explore in great detail the Class-Based Views. We are also going to refactor some of the existing views so to tak..."
}
</script>

  <script src="../../../../js/affix.js"></script>
  <script src="../../../../js/jquery.waypoints.min.js"></script>
  <script src="../../../../js/inview.min.js"></script>
  <script>
    $(function () {
      var sidebarMaxHeight = $(window).height() - 90;
      if (sidebarMaxHeight > 600) {
        $('head').append('<style type="text/css">@media (min-width: 1200px) {#seriesSideBar.affix div.card { max-height: '+sidebarMaxHeight+'px!important; }}</style>');
      }

      /* sidebar affix */
      $("#seriesSideBar").affix({
        offset: {
          top: $("#seriesSideBar").offset().top - 50,
          bottom: function () {
            return ($("footer").outerHeight(true) + $(".post-footer").outerHeight(true));
          }
        }
      });

      /* sidebar scrollspy */
      var headers = Array();
      var trackContents = function (el) {
        var inview = new Waypoint.Inview({
          element: el,
          enter: function(direction) {
            $("#seriesSideBar ul li a").removeClass("active");
            $("#seriesSideBar ul li a[href='#" + this.element.id + "']").addClass("active");
          },
          exit: function(direction) {
            if (direction == "up") {
              var index = headers.indexOf(this.element.id);
              $("#seriesSideBar ul li a").removeClass("active");
              if (index > 0) {
                $("#seriesSideBar ul li a[href='#" + headers[index - 1] + "']").addClass("active");
              }
            }
          }
        });
      };
      $("article h4, article h5").each(function () {
        trackContents(this);
        headers.push(this.id);
      });

      /* article default os */
      var os = getOS();
      $("nav.platform a[data-platform='" + os + "']").addClass("active");
      $("body").addClass("platform-" + os);

      $(".js-set-platform a").click(function () {
        var $btn = $(this);
        var $body = $("body");
        var platform = $btn.attr("data-platform");
        var platformClass = "platform-" + platform;
        $body.removeClass("platform-mac platform-windows platform-linux");
        $body.addClass(platformClass);
        $("nav.platform a").removeClass("active");
        $("nav.platform a[data-platform='" + platform + "']").addClass("active");
      });

      var platformInview = new Waypoint.Inview({
        element: $("#platformArticle")[0],
        enter: function(direction) {
          $("#platformSideBar").hide();
        },
        exit: function(direction) {
          if (direction == "up") {
            $("#platformSideBar").hide();
          }
          else {
            $("#platformSideBar").show();
          }
        }
      });

    });
  </script>
  <noscript><style type="text/css">body article div.platform-windows { display: block!important; }</style></noscript>
  
</body>

<!-- Mirrored from simpleisbetterthancomplex.com/series/2017/10/09/a-complete-beginners-guide-to-django-part-6.html by HTTrack Website Copier/3.x [XR&CO'2014], Fri, 03 Sep 2021 12:41:06 GMT -->
</html>

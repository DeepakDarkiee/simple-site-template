<!DOCTYPE html>
<html lang="en">

<!-- Mirrored from simpleisbetterthancomplex.com/series/2017/09/25/a-complete-beginners-guide-to-django-part-4.html by HTTrack Website Copier/3.x [XR&CO'2014], Fri, 03 Sep 2021 12:41:24 GMT -->
<head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta name="ir-site-verification-token" value="-233745807">
<title>A Complete Beginner's Guide to Django - Part 4</title>
<meta name="description" content="This tutorial is going to be all about Django's authentication system. We are going to implement the whole thing, registration, login, logout, password reset...">
<link href="https://fonts.googleapis.com/css?family=Raleway:400,300,500,600,700" rel="stylesheet" type="text/css">
<link rel="stylesheet" href="../../../../css/main71de.css?v=34">
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">
<link rel="canonical" href="a-complete-beginners-guide-to-django-part-4.html">
<link rel="alternate" type="application/rss+xml" title="Simple is Better Than Complex" href="../../../../feed.xml" />
<link rel="icon" type="image/png" href="../../../../favicon.png">
<link rel="mask-icon" href="../../../../safari-pinned-tab.svg" color="#5bbad5">
<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.2/jquery.min.js"></script>
<script src="../../../../js/site7b30.js?v=4"></script>

  <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','http://www.google-analytics.com/analytics.js','ga');
    ga('create', 'UA-42049022-10', 'auto');
    ga('send', 'pageview');
  </script>
  <script>
    $(function () {
      $("#ad").on("click", "#carbonads .carbon-wrap a", function () {
        var page_id = 'a-complete-beginners-guide-to-django-part-4.html';
        ga('send', 'event', 'carbonads', 'click', page_id, {
          'transport': 'beacon'
        });
      });
    });
  </script>
  <script>
  !function(f,b,e,v,n,t,s){if(f.fbq)return;n=f.fbq=function(){n.callMethod?
  n.callMethod.apply(n,arguments):n.queue.push(arguments)};if(!f._fbq)f._fbq=n;
  n.push=n;n.loaded=!0;n.version='2.0';n.queue=[];t=b.createElement(e);t.async=!0;
  t.src=v;s=b.getElementsByTagName(e)[0];s.parentNode.insertBefore(t,s)}(window,
  document,'script','https://connect.facebook.net/en_US/fbevents.js');
  fbq('init', '1689711451348257');
  fbq('track', 'PageView');
  </script>
  <noscript><img height="1" width="1" style="display:none" alt="PageView"
  src="https://www.facebook.com/tr?id=1689711451348257&amp;ev=PageView&amp;noscript=1"
  /></noscript>
  <script data-ad-client="ca-pub-5430683801108011" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>


  <meta property="og:title" content="A Complete Beginner's Guide to Django - Part 4">
<meta property="og:url" content="https://simpleisbetterthancomplex.com/series/2017/09/25/a-complete-beginners-guide-to-django-part-4.html">
<meta property="og:image" content="https://simpleisbetterthancomplex.com/media/series/beginners-guide/1.11/part-4/thumbnail.jpg">
<meta property="og:description" content="This tutorial is going to be all about Django's authentication system. We are going to implement the whole thing, registration, login, logout, password reset...">
<meta property="og:site_name" content="Simple is Better Than Complex">
<meta property="og:locale" content="en_US">

  <meta property="article:published_time" content="2017-09-25T08:00:00+03:00">
  <meta property="article:author" content="https://facebook.com/vitorfs">

<meta property="fb:admins" content="100000024295617">
<meta property="fb:app_id" content="1645747765697865">

<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:site" content="vitorfs">
<meta name="twitter:creator" content="vitorfs">
<meta name="twitter:title" content="A Complete Beginner's Guide to Django - Part 4">
<meta name="twitter:description" content="This tutorial is going to be all about Django's authentication system. We are going to implement the whole thing, registration, login, logout, password reset, and password change.">
<meta name="twitter:image" content="https://simpleisbetterthancomplex.com/media/series/beginners-guide/1.11/part-4/thumbnail.jpg">
<meta name="p:domain_verify" content="e262845cb18e4c68b0cff535a0eaea5d">
  <meta property="og:type" content="article">
  
    <meta property="article:tag" content="python">
  
    <meta property="article:tag" content="django">
  
    <meta property="article:tag" content="guide">
  
    <meta property="article:tag" content="beginners">
  
    <meta property="article:tag" content="login">
  
    <meta property="article:tag" content="auth">
  
</head>
<body>
  <div id="top" style="visibility: hidden"></div>
<header>
  <div class="container">
    <ul class="menu menu-right">
      <li class="menu-item">
        <a href="../../../../search/index.html">
          <span class="fa fa-search"></span>
        </a>
      </li>
      <li class="toggle-menu">
        <a href="javascript:void(0);">
          <span class="fa fa-bars"></span>
        </a>
      </li>
    </ul>
    <ul class="menu menu-left">
      <li class="logo">
        <a href="../../../../index.html" style="font-weight: 900">simple<span class="brand">is</span>better<span class="brand">than</span>complex</a>
      </li>
      <li class="menu-item">
        <a href="../../../../index.html">
          <span class="fa fa-home" style="margin-right: 3px"></span>
          Home
        </a>
      </li>
      <li class="menu-item">
        <a href="../../../../archive/index.html">
          <span class="fa fa-archive" style="margin-right: 3px"></span>
          Articles
        </a>
      </li>
      <li class="menu-item">
        <a href="../../../../videos/index.html">
          <span class="fa fa-video-camera" style="margin-right: 3px"></span>
          Videos
        </a>
      </li>
      <li class="menu-item">
        <a href="../../../index.html">
          <span class="fa fa-book" style="margin-right: 3px"></span>
          Series
        </a>
      </li>
      <li class="menu-item">
        <a href="../../../../snippets/index.html">
          <span class="fa fa-code" style="margin-right: 3px"></span>
          Snippets
        </a>
      </li>
      <li class="menu-item">
        <a href="../../../../sponsor/index.html">
          <span class="fa fa-bullhorn" style="margin-right: 3px"></span>
          Sponsor
        </a>
      </li>
      <li class="menu-item">
        <a href="../../../../feed.xml" target="_blank">
          <span class="fa fa-rss" style="margin-right: 3px"></span>
          RSS
        </a>
      </li>
      <li class="menu-item">
        <a href="https://colossus.simpleisbetterthancomplex.com/subscribe/d2320a41-0378-4aa8-8f4e-5bb1ffcd521d/" class="brand" target="_blank">
          <span class="fa fa-send" style="margin-right: 3px"></span> Subscribe
        </a>
      </li>
      <li class="menu-item hidden-mobile">
        <a href="../../../../search/index.html">
          <span class="fa fa-search"></span> Search
        </a>
      </li>
    </ul>
  </div>
</header>

  <div class="container">
    <div class="row">
      <div class="twelve columns post">
        <div class="card post-author">
  <div class="author-picture">
    <img src="../../../../img/picture.jpg" alt="Vitor Freitas">
  </div>
  <div class="author-info">
    <p class="name">By <strong>Vitor Freitas</strong></p>
    <a href="https://www.digitalocean.com/?refcode=074832454ff1&amp;utm_campaign=Referral_Invite&amp;utm_medium=Referral_Program&amp;utm_source=badge" class="powered-by-do">
      <img src="https://web-platforms.sfo2.cdn.digitaloceanspaces.com/WWW/Badge 1.svg" alt="DigitalOcean Referral Badge">
    </a>
    <p class="bio">
      I'm a passionate software developer and researcher. I write about Python, Django and Web Development on a weekly basis. <a href="../../../../about/index.html" rel="author">Read more</a>.
    </p>
    <p class="contact">
      <a href="https://www.youtube.com/VitorFreitas" rel="me noopener" target="_blank" title="YouTube"><i class="fa fa-youtube-play"></i></a>
      <a href="https://github.com/vitorfs" rel="me noopener" target="_blank" title="GitHub"><i class="fa fa-github"></i></a>
      <a href="https://twitter.com/vitorfs" rel="me noopener" target="_blank" title="Twitter"><i class="fa fa-twitter"></i></a>
      <a href="https://facebook.com/vitorfs" rel="me noopener" target="_blank" title="Facebook"><i class="fa fa-facebook-official"></i></a>
      <a href="https://linkedin.com/in/vitorfs" rel="me noopener" target="_blank" title="LinkedIn"><i class="fa fa-linkedin-square"></i></a>
      <a href="https://instagram.com/vitorfs" rel="me noopener" target="_blank" title="Instagram"><i class="fa fa-instagram"></i></a>
      <a href="../../../../contact/index.html" title="Contact"><i class="fa fa-envelope"></i></a>
    </p>
  </div>
  
  
</div>

      </div>
    </div>
    <div id="main-content" class="row">
      <div id="seriesSideBar" class="three columns">
        <div class="card">
          
            <div id="ad">
              <script async type="text/javascript" src="http://cdn.carbonads.com/carbon.js?serve=CKYIEKQM&amp;placement=simpleisbetterthancomplexcom" id="_carbonads_js"></script>
            </div>
          
          <nav id="platformSideBar" class="platform js-set-platform" style="margin-bottom: 2rem; display: none; font-size: 1.2rem">
            <a href="javascript:void(0);" data-platform="mac" title="Set platform to Mac"><i class="fa fa-apple"></i> Mac</a>
            <a href="javascript:void(0);" data-platform="windows" title="Set platform to Windows"><i class="fa fa-windows"></i> Win</a>
            <a href="javascript:void(0);" data-platform="linux" title="Set platform to Linux"><i class="fa fa-linux"></i> Linux</a>
          </nav>
          <h5>Table of Contents</h5>
          <ul>
            
              <li><a href="#introduction">Introduction</a></li>
              
            
              <li><a href="#wireframes">Wireframes</a></li>
              
            
              <li><a href="#initial-setup">Initial Setup</a></li>
              
            
              <li><a href="#sign-up">Sign Up</a></li>
              
                <li style="padding-left: 1.5rem; font-size: 1.4rem; margin-bottom: 0.25rem">
                  <a href="#referencing-the-authenticated-user-in-the-template">
                    Referencing the Authenticated User in the Template
                  </a>
                </li>
              
                <li style="padding-left: 1.5rem; font-size: 1.4rem; margin-bottom: 0.25rem">
                  <a href="#testing-the-sign-up-view">
                    Testing the Sign Up View
                  </a>
                </li>
              
                <li style="padding-left: 1.5rem; font-size: 1.4rem; margin-bottom: 0.25rem">
                  <a href="#adding-the-email-field-to-the-form">
                    Adding the Email Field to the Form
                  </a>
                </li>
              
                <li style="padding-left: 1.5rem; font-size: 1.4rem; margin-bottom: 0.25rem">
                  <a href="#improving-the-tests-layout">
                    Improving the Tests Layout
                  </a>
                </li>
              
                <li style="padding-left: 1.5rem; font-size: 1.4rem; margin-bottom: 0.25rem">
                  <a href="#improving-the-sign-up-template">
                    Improving the Sign Up Template
                  </a>
                </li>
              
            
              <li><a href="#logout">Logout</a></li>
              
            
              <li><a href="#displaying-menu-for-authenticated-users">Displaying Menu For Authenticated Users</a></li>
              
            
              <li><a href="#login">Login</a></li>
              
                <li style="padding-left: 1.5rem; font-size: 1.4rem; margin-bottom: 0.25rem">
                  <a href="#log-in-non-field-errors">
                    Log In Non Field Errors
                  </a>
                </li>
              
                <li style="padding-left: 1.5rem; font-size: 1.4rem; margin-bottom: 0.25rem">
                  <a href="#creating-custom-template-tags">
                    Creating Custom Template Tags
                  </a>
                </li>
              
                <li style="padding-left: 1.5rem; font-size: 1.4rem; margin-bottom: 0.25rem">
                  <a href="#testing-the-template-tags">
                    Testing the Template Tags
                  </a>
                </li>
              
            
              <li><a href="#password-reset">Password Reset</a></li>
              
                <li style="padding-left: 1.5rem; font-size: 1.4rem; margin-bottom: 0.25rem">
                  <a href="#console-email-backend">
                    Console Email Backend
                  </a>
                </li>
              
                <li style="padding-left: 1.5rem; font-size: 1.4rem; margin-bottom: 0.25rem">
                  <a href="#configuring-the-routes">
                    Configuring the Routes
                  </a>
                </li>
              
                <li style="padding-left: 1.5rem; font-size: 1.4rem; margin-bottom: 0.25rem">
                  <a href="#password-reset-view">
                    Password Reset View
                  </a>
                </li>
              
                <li style="padding-left: 1.5rem; font-size: 1.4rem; margin-bottom: 0.25rem">
                  <a href="#password-reset-done-view">
                    Password Reset Done View
                  </a>
                </li>
              
                <li style="padding-left: 1.5rem; font-size: 1.4rem; margin-bottom: 0.25rem">
                  <a href="#password-reset-confirm-view">
                    Password Reset Confirm View
                  </a>
                </li>
              
                <li style="padding-left: 1.5rem; font-size: 1.4rem; margin-bottom: 0.25rem">
                  <a href="#password-reset-complete-view">
                    Password Reset Complete View
                  </a>
                </li>
              
            
              <li><a href="#password-change-view">Password Change View</a></li>
              
            
              <li><a href="#conclusions">Conclusions</a></li>
              
            
          </ul>
          <hr style="margin: 1.5rem 0;">
          <ul style="font-size: 1.4rem">
            <li><a href="#top"><i class="fa fa-arrow-up" style="margin-right: .2rem"></i> scroll to top</a></li>
            <li><a href="#comments"><i class="fa fa-comments" style="margin-right: .2rem"></i> go to comments</a></li>
            <li><a href="../../../beginners-guide/1.11/index.html"><i class="fa fa-list" style="margin-right: .2rem"></i> go to series index</a></li>
          </ul>
        </div>
      </div>
      <div class="nine columns content post" style="float:right">
        <div class="card">
          
  <h5 class="post-category">
    
      series
    
  </h5>
  <hr class="dashed">

<h3 class="post-title">A Complete Beginner's Guide to Django - Part 4</h3>
<ul class="post-meta">
  <li>
    <i class="fa fa-calendar"></i> Sep 25, 2017
  </li>
  <li>
    <i class="fa fa-clock-o"></i>
    73 minutes read
  </li>
  <li>
    <i class="fa fa-comments"></i>
    <a href="#disqus_thread" data-disqus-identifier="/series/2017/09/25/a-complete-beginners-guide-to-django-part-4">comments</a>
  </li>
  <li>
    <i class="fa fa-eye"></i>
    <span class="ga-page-views" data-ga-identifier="a-complete-beginners-guide-to-django-part-4.html"></span> views
  </li>
  
    <li>
      <i class="fa fa-book"></i>
      <a href="../../../beginners-guide/1.11/index.html">Part 4 of 7</a>
    </li>
  
  
</ul>

  <div class="post-featured-image">
    <img src="../../../../media/series/beginners-guide/1.11/part-4/featured.jpg" alt="A Complete Beginner's Guide to Django - Part 4" class="featured-image">
    
  </div>


          <div class="row" style="margin-bottom: 2rem;">
            <div class="five columns">
              <nav id="platformArticle" class="platform js-set-platform">
                <a href="javascript:void(0);" data-platform="mac" title="Set platform to Mac"><i class="fa fa-apple"></i> Mac</a>
                <a href="javascript:void(0);" data-platform="windows" title="Set platform to Windows"><i class="fa fa-windows"></i> Windows</a>
                <a href="javascript:void(0);" data-platform="linux" title="Set platform to Linux"><i class="fa fa-linux"></i> Linux</a>

              </nav>
            </div>
            <div class="three columns">
              <nav class="platform">
                <a href="../../../beginners-guide/1.11/index.html" class="series-nav">Series 4/7</a>
              </nav>
            </div>
            <div class="four columns versions">
              
                <img src="https://img.shields.io/badge/python-3.6.2-brightgreen.svg" alt="Python 3.6.2">
              
              
                <img src="https://img.shields.io/badge/django-1.11.4-brightgreen.svg" alt="Django 1.11.4">
              
            </div>
          </div>

          <article>
            <h4 id="introduction">Introduction</h4>

<p>This tutorial is going to be all about Django’s authentication system. We are going to implement the whole thing:
registration, login, logout, password reset, and password change.</p>

<p>You are also going to get a brief introduction on how to protect some views from non-authorized users and how to
access the information of the logged in user.</p>

<p>In the next section, you will find a few wireframes of authentication-related pages that we are going to implement
in this tutorial. After that, you will find an initial setup of a new Django app. So far we have been working on
an app named <strong>boards</strong>. But all the authentication related stuff can live in a different app, so to achieve a better
organization of the code.</p>

<p><img src="../../../../media/series/beginners-guide/1.11/part-4/Pixton_Comic_Accounts_App.png" alt="Accounts App" /></p>

<hr />

<h4 id="wireframes">Wireframes</h4>

<p>We have to update the wireframes of the application. First, we are going to add new options for the top menu. If
the user is not authenticated, we should have two buttons: sign up and log in.</p>

<div id="figure-1">
  <p><img src="../../../../media/series/beginners-guide/1.11/part-4/wireframe-menu-not-authenticated.png" alt="Wireframe Top Menu" /></p>
  <p style="text-align: center">
    <small>Figure 1: Top menu for not authenticated users.</small>
  </p>
</div>

<p>If the user is authenticated, we should instead display their names along with a dropdown menu with three options:
my account, change password and log out.</p>

<div id="figure-2">
  <p><img src="../../../../media/series/beginners-guide/1.11/part-4/wireframe-menu-authenticated.png" alt="Wireframe Top Menu" /></p>
  <p style="text-align: center">
    <small>Figure 2: Top menu for authenticated users.</small>
  </p>
</div>

<p>On the log in page, we need a form with <strong>username</strong> and <strong>password</strong>, a button with the main action (log in) and two
alternative paths: sign up page and password reset page.</p>

<div id="figure-3">
  <p><img src="../../../../media/series/beginners-guide/1.11/part-4/wireframe-login.png" alt="Wireframe log in page" /></p>
  <p style="text-align: center">
    <small>Figure 3: Log in page</small>
  </p>
</div>

<p>On the sign up page, we should have a form with four fields: <strong>username</strong>, <strong>email address</strong>, <strong>password</strong>, and
<strong>password confirmation</strong>. The user should also be able to reach the log in page.</p>

<div id="figure-4">
  <p><img src="../../../../media/series/beginners-guide/1.11/part-4/wireframe-signup.png" alt="Wireframe sign up page" /></p>
  <p style="text-align: center">
    <small>Figure 4: Sign up page</small>
  </p>
</div>

<p>On the password reset page, we will have a form with just the <strong>email address</strong>.</p>

<div id="figure-5">
  <p><img src="../../../../media/series/beginners-guide/1.11/part-4/wireframe-reset.png" alt="Wireframe password reset page" /></p>
  <p style="text-align: center">
    <small>Figure 5: Password reset</small>
  </p>
</div>

<p>Then, after clicking on a special token link, the user will be redirected to a page where they can set a new password:</p>

<div id="figure-6">
  <p><img src="../../../../media/series/beginners-guide/1.11/part-4/wireframe-change-password.png" alt="Wireframe change password page" /></p>
  <p style="text-align: center">
    <small>Figure 6: Change password</small>
  </p>
</div>

<hr />

<h4 id="initial-setup">Initial Setup</h4>

<p>To manage all this information, we can break it down in a different app. In the project root, in the same page where
the <strong>manage.py</strong> script is, run the following command to start a new app:</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash">django-admin startapp accounts</code></pre></figure>

<p>The project structure should like this right now:</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash">myproject/
 |-- myproject/
 |    |-- accounts/     &lt;-- our new django app!
 |    |-- boards/
 |    |-- myproject/
 |    |-- static/
 |    |-- templates/
 |    |-- db.sqlite3
 |    +-- manage.py
 +-- venv/</code></pre></figure>

<p>Next step, include the <strong>accounts</strong> app to the <code class="highlighter-rouge">INSTALLED_APPS</code> in the <strong>settings.py</strong> file:</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">INSTALLED_APPS</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s">'django.contrib.admin'</span><span class="p">,</span>
    <span class="s">'django.contrib.auth'</span><span class="p">,</span>
    <span class="s">'django.contrib.contenttypes'</span><span class="p">,</span>
    <span class="s">'django.contrib.sessions'</span><span class="p">,</span>
    <span class="s">'django.contrib.messages'</span><span class="p">,</span>
    <span class="s">'django.contrib.staticfiles'</span><span class="p">,</span>

    <span class="s">'widget_tweaks'</span><span class="p">,</span>

    <span class="s">'accounts'</span><span class="p">,</span>
    <span class="s">'boards'</span><span class="p">,</span>
<span class="p">]</span></code></pre></figure>

<p>From now on, we will be working on the <strong>accounts</strong> app.</p>

<hr />

<h4 id="sign-up">Sign Up</h4>

<p><img src="../../../../media/series/beginners-guide/1.11/part-4/Pixton_Comic_Sign_Up_View.png" alt="Sign Up" /></p>

<p>Let’s start by creating the sign up view. First thing, create a new route in the <strong>urls.py</strong> file:</p>

<p><strong>myproject/urls.py</strong></p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="kn">from</span> <span class="nn">django.conf.urls</span> <span class="kn">import</span> <span class="n">url</span>
<span class="kn">from</span> <span class="nn">django.contrib</span> <span class="kn">import</span> <span class="n">admin</span>

<span class="kn">from</span> <span class="nn">accounts</span> <span class="kn">import</span> <span class="n">views</span> <span class="k">as</span> <span class="n">accounts_views</span>
<span class="kn">from</span> <span class="nn">boards</span> <span class="kn">import</span> <span class="n">views</span>

<span class="n">urlpatterns</span> <span class="o">=</span> <span class="p">[</span>
    <span class="n">url</span><span class="p">(</span><span class="s">r'^$'</span><span class="p">,</span> <span class="n">views</span><span class="o">.</span><span class="n">home</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s">'home'</span><span class="p">),</span>
    <span class="n">url</span><span class="p">(</span><span class="s">r'^signup/$'</span><span class="p">,</span> <span class="n">accounts_views</span><span class="o">.</span><span class="n">signup</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s">'signup'</span><span class="p">),</span>
    <span class="n">url</span><span class="p">(</span><span class="s">r'^boards/(?P&lt;pk&gt;</span><span class="err">\</span><span class="s">d+)/$'</span><span class="p">,</span> <span class="n">views</span><span class="o">.</span><span class="n">board_topics</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s">'board_topics'</span><span class="p">),</span>
    <span class="n">url</span><span class="p">(</span><span class="s">r'^boards/(?P&lt;pk&gt;</span><span class="err">\</span><span class="s">d+)/new/$'</span><span class="p">,</span> <span class="n">views</span><span class="o">.</span><span class="n">new_topic</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s">'new_topic'</span><span class="p">),</span>
    <span class="n">url</span><span class="p">(</span><span class="s">r'^admin/'</span><span class="p">,</span> <span class="n">admin</span><span class="o">.</span><span class="n">site</span><span class="o">.</span><span class="n">urls</span><span class="p">),</span>
<span class="p">]</span></code></pre></figure>

<p>Notice how we are importing the <strong>views</strong> module from the <strong>accounts</strong> app in a different way:</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="kn">from</span> <span class="nn">accounts</span> <span class="kn">import</span> <span class="n">views</span> <span class="k">as</span> <span class="n">accounts_views</span></code></pre></figure>

<p>We are giving an alias because otherwise, it would clash with the <strong>boards’</strong> views. We can improve the <strong>urls.py</strong>
design later on. But for now, let’s focus on the authentication features.</p>

<p>Now edit the <strong>views.py</strong> inside the <strong>accounts</strong> app and create a new view named <strong>signup</strong>:</p>

<p><strong>accounts/views.py</strong></p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="kn">from</span> <span class="nn">django.shortcuts</span> <span class="kn">import</span> <span class="n">render</span>

<span class="k">def</span> <span class="nf">signup</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">render</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s">'signup.html'</span><span class="p">)</span></code></pre></figure>

<p>Create the new template, named <strong>signup.html</strong>:</p>

<p><strong>templates/signup.html</strong></p>

<figure class="highlight"><pre><code class="language-django" data-lang="django"><span class="cp">{%</span> <span class="k">extends</span> <span class="s1">'base.html'</span> <span class="cp">%}</span>

<span class="cp">{%</span> <span class="k">block</span> <span class="nv">content</span> <span class="cp">%}</span>
  <span class="nt">&lt;h2&gt;</span>Sign up<span class="nt">&lt;/h2&gt;</span>
<span class="cp">{%</span> <span class="k">endblock</span> <span class="cp">%}</span></code></pre></figure>

<p>Open the URL <strong>http://127.0.0.1:8000/signup/</strong> in the browser, check if everything is working:</p>

<p><img src="../../../../media/series/beginners-guide/1.11/part-4/signup.png" alt="Sign up" /></p>

<p>Time to write some tests:</p>

<p><strong>accounts/tests.py</strong></p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="kn">from</span> <span class="nn">django.core.urlresolvers</span> <span class="kn">import</span> <span class="n">reverse</span>
<span class="kn">from</span> <span class="nn">django.urls</span> <span class="kn">import</span> <span class="n">resolve</span>
<span class="kn">from</span> <span class="nn">django.test</span> <span class="kn">import</span> <span class="n">TestCase</span>
<span class="kn">from</span> <span class="nn">.views</span> <span class="kn">import</span> <span class="n">signup</span>

<span class="k">class</span> <span class="nc">SignUpTests</span><span class="p">(</span><span class="n">TestCase</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">test_signup_status_code</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">url</span> <span class="o">=</span> <span class="n">reverse</span><span class="p">(</span><span class="s">'signup'</span><span class="p">)</span>
        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">status_code</span><span class="p">,</span> <span class="mi">200</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">test_signup_url_resolves_signup_view</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">view</span> <span class="o">=</span> <span class="n">resolve</span><span class="p">(</span><span class="s">'/signup/'</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">view</span><span class="o">.</span><span class="n">func</span><span class="p">,</span> <span class="n">signup</span><span class="p">)</span></code></pre></figure>

<p>Testing the status code (200 = success) and if the URL <strong>/signup/</strong> is returning the correct view function.</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash">python manage.py <span class="nb">test</span></code></pre></figure>

<figure class="highlight"><pre><code class="language-text" data-lang="text">Creating test database for alias 'default'...
System check identified no issues (0 silenced).
..................
----------------------------------------------------------------------
Ran 18 tests in 0.652s

OK
Destroying test database for alias 'default'...</code></pre></figure>

<p>For the authentication views (sign up, log in, password reset, etc.) we won’t use the top bar or the breadcrumb.
We can still use the <strong>base.html</strong> template. It just needs some tweaks:</p>

<p><strong>templates/base.html</strong></p>

<figure class="highlight"><pre><code class="language-django" data-lang="django"><span class="cp">{%</span> <span class="nv">load</span> <span class="nv">static</span> <span class="cp">%}&lt;!DOCTYPE html&gt;</span>
<span class="nt">&lt;html&gt;</span>
  <span class="nt">&lt;head&gt;</span>
    <span class="nt">&lt;meta</span> <span class="na">charset=</span><span class="s">"utf-8"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;title&gt;</span><span class="cp">{%</span> <span class="k">block</span> <span class="nv">title</span> <span class="cp">%}</span>Django Boards<span class="cp">{%</span> <span class="k">endblock</span> <span class="cp">%}</span><span class="nt">&lt;/title&gt;</span>
    <span class="nt">&lt;link</span> <span class="na">href=</span><span class="s">"https://fonts.googleapis.com/css?family=Peralta"</span> <span class="na">rel=</span><span class="s">"stylesheet"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;link</span> <span class="na">rel=</span><span class="s">"stylesheet"</span> <span class="na">href=</span><span class="s">"</span><span class="cp">{%</span> <span class="nv">static</span> <span class="s1">'css/bootstrap.min.css'</span> <span class="cp">%}</span><span class="s">"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;link</span> <span class="na">rel=</span><span class="s">"stylesheet"</span> <span class="na">href=</span><span class="s">"</span><span class="cp">{%</span> <span class="nv">static</span> <span class="s1">'css/app.css'</span> <span class="cp">%}</span><span class="s">"</span><span class="nt">&gt;</span>
    <span class="cp">{%</span> <span class="k">block</span> <span class="nv">stylesheet</span> <span class="cp">%}{%</span> <span class="k">endblock</span> <span class="cp">%}</span>  <span class="c">&lt;!-- HERE --&gt;</span>
  <span class="nt">&lt;/head&gt;</span>
  <span class="nt">&lt;body&gt;</span>
    <span class="cp">{%</span> <span class="k">block</span> <span class="nv">body</span> <span class="cp">%}</span>  <span class="c">&lt;!-- HERE --&gt;</span>
      <span class="nt">&lt;nav</span> <span class="na">class=</span><span class="s">"navbar navbar-expand-lg navbar-dark bg-dark"</span><span class="nt">&gt;</span>
        <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"container"</span><span class="nt">&gt;</span>
          <span class="nt">&lt;a</span> <span class="na">class=</span><span class="s">"navbar-brand"</span> <span class="na">href=</span><span class="s">"</span><span class="cp">{%</span> <span class="nv">url</span> <span class="s1">'home'</span> <span class="cp">%}</span><span class="s">"</span><span class="nt">&gt;</span>Django Boards<span class="nt">&lt;/a&gt;</span>
        <span class="nt">&lt;/div&gt;</span>
      <span class="nt">&lt;/nav&gt;</span>
      <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"container"</span><span class="nt">&gt;</span>
        <span class="nt">&lt;ol</span> <span class="na">class=</span><span class="s">"breadcrumb my-4"</span><span class="nt">&gt;</span>
          <span class="cp">{%</span> <span class="k">block</span> <span class="nv">breadcrumb</span> <span class="cp">%}</span>
          <span class="cp">{%</span> <span class="k">endblock</span> <span class="cp">%}</span>
        <span class="nt">&lt;/ol&gt;</span>
        <span class="cp">{%</span> <span class="k">block</span> <span class="nv">content</span> <span class="cp">%}</span>
        <span class="cp">{%</span> <span class="k">endblock</span> <span class="cp">%}</span>
      <span class="nt">&lt;/div&gt;</span>
    <span class="cp">{%</span> <span class="k">endblock</span> <span class="nv">body</span> <span class="cp">%}</span>  <span class="c">&lt;!-- AND HERE --&gt;</span>
  <span class="nt">&lt;/body&gt;</span>
<span class="nt">&lt;/html&gt;</span></code></pre></figure>

<p>I marked with comments the new bits in the <strong>base.html</strong> template. The block
<code class="highlighter-rouge"><span class="p">{</span><span class="err">%</span><span class="w"> </span><span class="err">block</span><span class="w"> </span><span class="err">stylesheet</span><span class="w"> </span><span class="err">%</span><span class="p">}{</span><span class="err">%</span><span class="w"> </span><span class="err">endblock</span><span class="w"> </span><span class="err">%</span><span class="p">}</span></code> will be used to add extra CSS, specific to some pages.</p>

<p>The block <code class="highlighter-rouge"><span class="p">{</span><span class="err">%</span><span class="w"> </span><span class="err">block</span><span class="w"> </span><span class="err">body</span><span class="w"> </span><span class="err">%</span><span class="p">}</span></code> is wrapping the whole HTML document. We can use it to have an
empty document taking advantage of the head of the <strong>base.html</strong>. Notice how we named the end block
<code class="highlighter-rouge"><span class="p">{</span><span class="err">%</span><span class="w"> </span><span class="err">endblock</span><span class="w"> </span><span class="err">body</span><span class="w"> </span><span class="err">%</span><span class="p">}</span></code>. In cases like this, it’s a good practice to name the closing tag, so it’s
easier to identify where it ends.</p>

<p>Now on the <strong>signup.html</strong> template, instead of using the <code class="highlighter-rouge"><span class="p">{</span><span class="err">%</span><span class="w"> </span><span class="err">block</span><span class="w"> </span><span class="err">content</span><span class="w"> </span><span class="err">%</span><span class="p">}</span></code>, we can use the
<code class="highlighter-rouge"><span class="p">{</span><span class="err">%</span><span class="w"> </span><span class="err">block</span><span class="w"> </span><span class="err">body</span><span class="w"> </span><span class="err">%</span><span class="p">}</span></code>.</p>

<p><strong>templates/signup.html</strong></p>

<figure class="highlight"><pre><code class="language-django" data-lang="django"><span class="cp">{%</span> <span class="k">extends</span> <span class="s1">'base.html'</span> <span class="cp">%}</span>

<span class="cp">{%</span> <span class="k">block</span> <span class="nv">body</span> <span class="cp">%}</span>
  <span class="nt">&lt;h2&gt;</span>Sign up<span class="nt">&lt;/h2&gt;</span>
<span class="cp">{%</span> <span class="k">endblock</span> <span class="cp">%}</span></code></pre></figure>

<p><img src="../../../../media/series/beginners-guide/1.11/part-4/signup-2.png" alt="Sign up" /></p>

<p><img src="../../../../media/series/beginners-guide/1.11/part-4/Pixton_Comic_Empty.png" alt="Too Empty" /></p>

<p>Time to create the sign up form. Django has a built-in form named <strong>UserCreationForm</strong>. Let’s use it:</p>

<p><strong>accounts/views.py</strong></p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="kn">from</span> <span class="nn">django.contrib.auth.forms</span> <span class="kn">import</span> <span class="n">UserCreationForm</span>
<span class="kn">from</span> <span class="nn">django.shortcuts</span> <span class="kn">import</span> <span class="n">render</span>

<span class="k">def</span> <span class="nf">signup</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="n">form</span> <span class="o">=</span> <span class="n">UserCreationForm</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">render</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s">'signup.html'</span><span class="p">,</span> <span class="p">{</span><span class="s">'form'</span><span class="p">:</span> <span class="n">form</span><span class="p">})</span></code></pre></figure>

<p><strong>templates/signup.html</strong></p>

<figure class="highlight"><pre><code class="language-django" data-lang="django"><span class="cp">{%</span> <span class="k">extends</span> <span class="s1">'base.html'</span> <span class="cp">%}</span>

<span class="cp">{%</span> <span class="k">block</span> <span class="nv">body</span> <span class="cp">%}</span>
  <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"container"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;h2&gt;</span>Sign up<span class="nt">&lt;/h2&gt;</span>
    <span class="nt">&lt;form</span> <span class="na">method=</span><span class="s">"post"</span> <span class="na">novalidate</span><span class="nt">&gt;</span>
      <span class="cp">{%</span> <span class="nv">csrf_token</span> <span class="cp">%}</span>
      <span class="cp">{{</span> <span class="nv">form.as_p</span> <span class="cp">}}</span>
      <span class="nt">&lt;button</span> <span class="na">type=</span><span class="s">"submit"</span> <span class="na">class=</span><span class="s">"btn btn-primary"</span><span class="nt">&gt;</span>Create an account<span class="nt">&lt;/button&gt;</span>
    <span class="nt">&lt;/form&gt;</span>
  <span class="nt">&lt;/div&gt;</span>
<span class="cp">{%</span> <span class="k">endblock</span> <span class="cp">%}</span></code></pre></figure>

<p><img src="../../../../media/series/beginners-guide/1.11/part-4/signup-3.png" alt="Sign up" /></p>

<p>Looking a little bit messy, right? We can use our <strong>form.html</strong> template to make it look better:</p>

<p><strong>templates/signup.html</strong></p>

<figure class="highlight"><pre><code class="language-django" data-lang="django"><span class="cp">{%</span> <span class="k">extends</span> <span class="s1">'base.html'</span> <span class="cp">%}</span>

<span class="cp">{%</span> <span class="k">block</span> <span class="nv">body</span> <span class="cp">%}</span>
  <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"container"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;h2&gt;</span>Sign up<span class="nt">&lt;/h2&gt;</span>
    <span class="nt">&lt;form</span> <span class="na">method=</span><span class="s">"post"</span> <span class="na">novalidate</span><span class="nt">&gt;</span>
      <span class="cp">{%</span> <span class="nv">csrf_token</span> <span class="cp">%}</span>
      <span class="cp">{%</span> <span class="k">include</span> <span class="s1">'includes/form.html'</span> <span class="cp">%}</span>
      <span class="nt">&lt;button</span> <span class="na">type=</span><span class="s">"submit"</span> <span class="na">class=</span><span class="s">"btn btn-primary"</span><span class="nt">&gt;</span>Create an account<span class="nt">&lt;/button&gt;</span>
    <span class="nt">&lt;/form&gt;</span>
  <span class="nt">&lt;/div&gt;</span>
<span class="cp">{%</span> <span class="k">endblock</span> <span class="cp">%}</span></code></pre></figure>

<p><img src="../../../../media/series/beginners-guide/1.11/part-4/signup-4.png" alt="Sign up" /></p>

<p>Uh, almost there. Currently, our <strong>form.html</strong> partial template is displaying some raw HTML. It’s a security feature.
By default Django treats all strings as unsafe, escaping all the special characters that may cause trouble. But in this
case, we can trust it.</p>

<p><strong>templates/includes/form.html</strong></p>

<figure class="highlight"><pre><code class="language-django" data-lang="django"><span class="cp">{%</span> <span class="nv">load</span> <span class="nv">widget_tweaks</span> <span class="cp">%}</span>

<span class="cp">{%</span> <span class="k">for</span> <span class="nv">field</span> <span class="ow">in</span> <span class="nv">form</span> <span class="cp">%}</span>
  <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"form-group"</span><span class="nt">&gt;</span>
    <span class="cp">{{</span> <span class="nv">field.label_tag</span> <span class="cp">}}</span>

    <span class="c">&lt;!-- code suppressed for brevity --&gt;</span>

    <span class="cp">{%</span> <span class="k">if</span> <span class="nv">field.help_text</span> <span class="cp">%}</span>
      <span class="nt">&lt;small</span> <span class="na">class=</span><span class="s">"form-text text-muted"</span><span class="nt">&gt;</span>
        <span class="cp">{{</span> <span class="nv">field.help_text</span><span class="o">|</span><span class="nf">safe</span> <span class="cp">}}</span>  <span class="c">&lt;!-- new code here --&gt;</span>
      <span class="nt">&lt;/small&gt;</span>
    <span class="cp">{%</span> <span class="k">endif</span> <span class="cp">%}</span>
  <span class="nt">&lt;/div&gt;</span>
<span class="cp">{%</span> <span class="k">endfor</span> <span class="cp">%}</span></code></pre></figure>

<p>Basically, in the previous template we added the option <code class="highlighter-rouge">safe</code> to the <code class="highlighter-rouge">field.help_text</code>: <code class="highlighter-rouge"><span class="p">{</span><span class="err">{</span><span class="w"> </span><span class="err">field.help_text|safe</span><span class="w"> </span><span class="p">}</span><span class="err">}</span></code>.</p>

<p>Save the <strong>form.html</strong> file, and check the sign up page again:</p>

<p><img src="../../../../media/series/beginners-guide/1.11/part-4/signup-5.png" alt="Sign up" /></p>

<p>Now let’s implement the business logic in the <strong>signup</strong> view:</p>

<p><strong>accounts/views.py</strong></p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="kn">from</span> <span class="nn">django.contrib.auth</span> <span class="kn">import</span> <span class="n">login</span> <span class="k">as</span> <span class="n">auth_login</span>
<span class="kn">from</span> <span class="nn">django.contrib.auth.forms</span> <span class="kn">import</span> <span class="n">UserCreationForm</span>
<span class="kn">from</span> <span class="nn">django.shortcuts</span> <span class="kn">import</span> <span class="n">render</span><span class="p">,</span> <span class="n">redirect</span>

<span class="k">def</span> <span class="nf">signup</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">method</span> <span class="o">==</span> <span class="s">'POST'</span><span class="p">:</span>
        <span class="n">form</span> <span class="o">=</span> <span class="n">UserCreationForm</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">POST</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">form</span><span class="o">.</span><span class="n">is_valid</span><span class="p">():</span>
            <span class="n">user</span> <span class="o">=</span> <span class="n">form</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
            <span class="n">auth_login</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">user</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">redirect</span><span class="p">(</span><span class="s">'home'</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">form</span> <span class="o">=</span> <span class="n">UserCreationForm</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">render</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s">'signup.html'</span><span class="p">,</span> <span class="p">{</span><span class="s">'form'</span><span class="p">:</span> <span class="n">form</span><span class="p">})</span></code></pre></figure>

<p>A basic form processing with a small detail: the <strong>login</strong> function (renamed to <strong>auth_login</strong> to avoid clashing with
the built-in login view).</p>

<div class="info">
  <p>
    <strong><i class="fa fa-info-circle"></i> Note:</strong>
    I renamed the <code>login</code> function to <code>auth_login</code>, but later I realized that Django 1.11
    has a class-based view for the login view, <code>LoginView</code>, so there was no risk of clashing the names.
  </p>
  <p>
    On the older versions there was a <code>auth.login</code> and <code>auth.view.login</code>, which used to
    cause some confusion, because one was the function that logs the user in, and the other was the view.
  </p>
  <p>
    Long story short: you can import it just as <code>login</code> if you want, it will not cause any problem.
  </p>
</div>

<p>If the form is valid, a <strong>User</strong> instance is created with the <code class="highlighter-rouge">user = form.save()</code>. The created user is then passed
as an argument to the <strong>auth_login</strong> function, manually authenticating the user. After that, the view redirects the
user to the homepage, keeping the flow of the application.</p>

<p>Let’s try it. First, submit some invalid data. Either an empty form, non-matching fields, or an existing username:</p>

<p><img src="../../../../media/series/beginners-guide/1.11/part-4/signup-6.png" alt="Sign up" /></p>

<p>Now fill the form and submit it, check if the user is created and redirected to the homepage:</p>

<p><img src="../../../../media/series/beginners-guide/1.11/part-4/signup-7.png" alt="Sign up" /></p>

<h5 id="referencing-the-authenticated-user-in-the-template">Referencing the Authenticated User in the Template</h5>

<p>How can we know if it worked? Well, we can edit the <strong>base.html</strong> template to add the name of the user on the top bar:</p>

<p><strong>templates/base.html</strong></p>

<figure class="highlight"><pre><code class="language-django" data-lang="django"><span class="cp">{%</span> <span class="k">block</span> <span class="nv">body</span> <span class="cp">%}</span>
  <span class="nt">&lt;nav</span> <span class="na">class=</span><span class="s">"navbar navbar-expand-sm navbar-dark bg-dark"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"container"</span><span class="nt">&gt;</span>
      <span class="nt">&lt;a</span> <span class="na">class=</span><span class="s">"navbar-brand"</span> <span class="na">href=</span><span class="s">"</span><span class="cp">{%</span> <span class="nv">url</span> <span class="s1">'home'</span> <span class="cp">%}</span><span class="s">"</span><span class="nt">&gt;</span>Django Boards<span class="nt">&lt;/a&gt;</span>
      <span class="nt">&lt;button</span> <span class="na">class=</span><span class="s">"navbar-toggler"</span> <span class="na">type=</span><span class="s">"button"</span> <span class="na">data-toggle=</span><span class="s">"collapse"</span> <span class="na">data-target=</span><span class="s">"#mainMenu"</span> <span class="na">aria-controls=</span><span class="s">"mainMenu"</span> <span class="na">aria-expanded=</span><span class="s">"false"</span> <span class="na">aria-label=</span><span class="s">"Toggle navigation"</span><span class="nt">&gt;</span>
        <span class="nt">&lt;span</span> <span class="na">class=</span><span class="s">"navbar-toggler-icon"</span><span class="nt">&gt;&lt;/span&gt;</span>
      <span class="nt">&lt;/button&gt;</span>
      <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"collapse navbar-collapse"</span> <span class="na">id=</span><span class="s">"mainMenu"</span><span class="nt">&gt;</span>
        <span class="nt">&lt;ul</span> <span class="na">class=</span><span class="s">"navbar-nav ml-auto"</span><span class="nt">&gt;</span>
          <span class="nt">&lt;li</span> <span class="na">class=</span><span class="s">"nav-item"</span><span class="nt">&gt;</span>
            <span class="nt">&lt;a</span> <span class="na">class=</span><span class="s">"nav-link"</span> <span class="na">href=</span><span class="s">"#"</span><span class="nt">&gt;</span><span class="cp">{{</span> <span class="nv">user.username</span> <span class="cp">}}</span><span class="nt">&lt;/a&gt;</span>
          <span class="nt">&lt;/li&gt;</span>
        <span class="nt">&lt;/ul&gt;</span>
      <span class="nt">&lt;/div&gt;</span>
    <span class="nt">&lt;/div&gt;</span>
  <span class="nt">&lt;/nav&gt;</span>

  <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"container"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;ol</span> <span class="na">class=</span><span class="s">"breadcrumb my-4"</span><span class="nt">&gt;</span>
      <span class="cp">{%</span> <span class="k">block</span> <span class="nv">breadcrumb</span> <span class="cp">%}</span>
      <span class="cp">{%</span> <span class="k">endblock</span> <span class="cp">%}</span>
    <span class="nt">&lt;/ol&gt;</span>
    <span class="cp">{%</span> <span class="k">block</span> <span class="nv">content</span> <span class="cp">%}</span>
    <span class="cp">{%</span> <span class="k">endblock</span> <span class="cp">%}</span>
  <span class="nt">&lt;/div&gt;</span>
<span class="cp">{%</span> <span class="k">endblock</span> <span class="nv">body</span> <span class="cp">%}</span></code></pre></figure>

<p><img src="../../../../media/series/beginners-guide/1.11/part-4/signup-8.png" alt="Sign up" /></p>

<h5 id="testing-the-sign-up-view">Testing the Sign Up View</h5>

<p>Let’s now improve our test cases:</p>

<p><strong>accounts/tests.py</strong></p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="kn">from</span> <span class="nn">django.contrib.auth.forms</span> <span class="kn">import</span> <span class="n">UserCreationForm</span>
<span class="kn">from</span> <span class="nn">django.core.urlresolvers</span> <span class="kn">import</span> <span class="n">reverse</span>
<span class="kn">from</span> <span class="nn">django.urls</span> <span class="kn">import</span> <span class="n">resolve</span>
<span class="kn">from</span> <span class="nn">django.test</span> <span class="kn">import</span> <span class="n">TestCase</span>
<span class="kn">from</span> <span class="nn">.views</span> <span class="kn">import</span> <span class="n">signup</span>

<span class="k">class</span> <span class="nc">SignUpTests</span><span class="p">(</span><span class="n">TestCase</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">setUp</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">url</span> <span class="o">=</span> <span class="n">reverse</span><span class="p">(</span><span class="s">'signup'</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">test_signup_status_code</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">response</span><span class="o">.</span><span class="n">status_code</span><span class="p">,</span> <span class="mi">200</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">test_signup_url_resolves_signup_view</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">view</span> <span class="o">=</span> <span class="n">resolve</span><span class="p">(</span><span class="s">'/signup/'</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">view</span><span class="o">.</span><span class="n">func</span><span class="p">,</span> <span class="n">signup</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">test_csrf</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertContains</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">response</span><span class="p">,</span> <span class="s">'csrfmiddlewaretoken'</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">test_contains_form</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">form</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">response</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">'form'</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIsInstance</span><span class="p">(</span><span class="n">form</span><span class="p">,</span> <span class="n">UserCreationForm</span><span class="p">)</span></code></pre></figure>

<p>We changed a little bit the <strong>SignUpTests</strong> class. Defined a <strong>setUp</strong> method, moved the response object to there. Then
now we are also testing if there are a form and the CSRF token in the response.</p>

<p>Now we are going to test a successful sign up. This time, let’s create a new class to organize better the tests:</p>

<p><strong>accounts/tests.py</strong></p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="kn">from</span> <span class="nn">django.contrib.auth.models</span> <span class="kn">import</span> <span class="n">User</span>
<span class="kn">from</span> <span class="nn">django.contrib.auth.forms</span> <span class="kn">import</span> <span class="n">UserCreationForm</span>
<span class="kn">from</span> <span class="nn">django.core.urlresolvers</span> <span class="kn">import</span> <span class="n">reverse</span>
<span class="kn">from</span> <span class="nn">django.urls</span> <span class="kn">import</span> <span class="n">resolve</span>
<span class="kn">from</span> <span class="nn">django.test</span> <span class="kn">import</span> <span class="n">TestCase</span>
<span class="kn">from</span> <span class="nn">.views</span> <span class="kn">import</span> <span class="n">signup</span>

<span class="k">class</span> <span class="nc">SignUpTests</span><span class="p">(</span><span class="n">TestCase</span><span class="p">):</span>
    <span class="c"># code suppressed...</span>

<span class="k">class</span> <span class="nc">SuccessfulSignUpTests</span><span class="p">(</span><span class="n">TestCase</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">setUp</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">url</span> <span class="o">=</span> <span class="n">reverse</span><span class="p">(</span><span class="s">'signup'</span><span class="p">)</span>
        <span class="n">data</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s">'username'</span><span class="p">:</span> <span class="s">'john'</span><span class="p">,</span>
            <span class="s">'password1'</span><span class="p">:</span> <span class="s">'abcdef123456'</span><span class="p">,</span>
            <span class="s">'password2'</span><span class="p">:</span> <span class="s">'abcdef123456'</span>
        <span class="p">}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">home_url</span> <span class="o">=</span> <span class="n">reverse</span><span class="p">(</span><span class="s">'home'</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">test_redirection</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="s">'''
        A valid form submission should redirect the user to the home page
        '''</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertRedirects</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">response</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">home_url</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">test_user_creation</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">User</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">exists</span><span class="p">())</span>

    <span class="k">def</span> <span class="nf">test_user_authentication</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="s">'''
        Create a new request to an arbitrary page.
        The resulting response should now have a `user` to its context,
        after a successful sign up.
        '''</span>
        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">home_url</span><span class="p">)</span>
        <span class="n">user</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">'user'</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">user</span><span class="o">.</span><span class="n">is_authenticated</span><span class="p">)</span></code></pre></figure>

<p>Run the tests.</p>

<p>Using a similar strategy, now let’s create a new class for sign up tests when the data is invalid:</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="kn">from</span> <span class="nn">django.contrib.auth.models</span> <span class="kn">import</span> <span class="n">User</span>
<span class="kn">from</span> <span class="nn">django.contrib.auth.forms</span> <span class="kn">import</span> <span class="n">UserCreationForm</span>
<span class="kn">from</span> <span class="nn">django.core.urlresolvers</span> <span class="kn">import</span> <span class="n">reverse</span>
<span class="kn">from</span> <span class="nn">django.urls</span> <span class="kn">import</span> <span class="n">resolve</span>
<span class="kn">from</span> <span class="nn">django.test</span> <span class="kn">import</span> <span class="n">TestCase</span>
<span class="kn">from</span> <span class="nn">.views</span> <span class="kn">import</span> <span class="n">signup</span>

<span class="k">class</span> <span class="nc">SignUpTests</span><span class="p">(</span><span class="n">TestCase</span><span class="p">):</span>
    <span class="c"># code suppressed...</span>

<span class="k">class</span> <span class="nc">SuccessfulSignUpTests</span><span class="p">(</span><span class="n">TestCase</span><span class="p">):</span>
    <span class="c"># code suppressed...</span>

<span class="k">class</span> <span class="nc">InvalidSignUpTests</span><span class="p">(</span><span class="n">TestCase</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">setUp</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">url</span> <span class="o">=</span> <span class="n">reverse</span><span class="p">(</span><span class="s">'signup'</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="p">{})</span>  <span class="c"># submit an empty dictionary</span>

    <span class="k">def</span> <span class="nf">test_signup_status_code</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="s">'''
        An invalid form submission should return to the same page
        '''</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">response</span><span class="o">.</span><span class="n">status_code</span><span class="p">,</span> <span class="mi">200</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">test_form_errors</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">form</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">response</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">'form'</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">form</span><span class="o">.</span><span class="n">errors</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">test_dont_create_user</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertFalse</span><span class="p">(</span><span class="n">User</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">exists</span><span class="p">())</span></code></pre></figure>

<h5 id="adding-the-email-field-to-the-form">Adding the Email Field to the Form</h5>

<p>Everything is working, but… The <strong>email address</strong> field is missing. Well, the <strong>UserCreationForm</strong> does not provide
an <strong>email</strong> field. But we can extend it.</p>

<p>Create a file named <strong>forms.py</strong> inside the <strong>accounts</strong> folder:</p>

<p><strong>accounts/forms.py</strong></p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="kn">from</span> <span class="nn">django</span> <span class="kn">import</span> <span class="n">forms</span>
<span class="kn">from</span> <span class="nn">django.contrib.auth.forms</span> <span class="kn">import</span> <span class="n">UserCreationForm</span>
<span class="kn">from</span> <span class="nn">django.contrib.auth.models</span> <span class="kn">import</span> <span class="n">User</span>

<span class="k">class</span> <span class="nc">SignUpForm</span><span class="p">(</span><span class="n">UserCreationForm</span><span class="p">):</span>
    <span class="n">email</span> <span class="o">=</span> <span class="n">forms</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">254</span><span class="p">,</span> <span class="n">required</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">widget</span><span class="o">=</span><span class="n">forms</span><span class="o">.</span><span class="n">EmailInput</span><span class="p">())</span>
    <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
        <span class="n">model</span> <span class="o">=</span> <span class="n">User</span>
        <span class="n">fields</span> <span class="o">=</span> <span class="p">(</span><span class="s">'username'</span><span class="p">,</span> <span class="s">'email'</span><span class="p">,</span> <span class="s">'password1'</span><span class="p">,</span> <span class="s">'password2'</span><span class="p">)</span></code></pre></figure>

<p>Now, instead of using the <strong>UserCreationForm</strong> in our <strong>views.py</strong>, let’s import the new form, <strong>SignUpForm</strong>, and use
it instead:</p>

<p><strong>accounts/views.py</strong></p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="kn">from</span> <span class="nn">django.contrib.auth</span> <span class="kn">import</span> <span class="n">login</span> <span class="k">as</span> <span class="n">auth_login</span>
<span class="kn">from</span> <span class="nn">django.shortcuts</span> <span class="kn">import</span> <span class="n">render</span><span class="p">,</span> <span class="n">redirect</span>

<span class="kn">from</span> <span class="nn">.forms</span> <span class="kn">import</span> <span class="n">SignUpForm</span>

<span class="k">def</span> <span class="nf">signup</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">method</span> <span class="o">==</span> <span class="s">'POST'</span><span class="p">:</span>
        <span class="n">form</span> <span class="o">=</span> <span class="n">SignUpForm</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">POST</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">form</span><span class="o">.</span><span class="n">is_valid</span><span class="p">():</span>
            <span class="n">user</span> <span class="o">=</span> <span class="n">form</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
            <span class="n">auth_login</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">user</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">redirect</span><span class="p">(</span><span class="s">'home'</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">form</span> <span class="o">=</span> <span class="n">SignUpForm</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">render</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s">'signup.html'</span><span class="p">,</span> <span class="p">{</span><span class="s">'form'</span><span class="p">:</span> <span class="n">form</span><span class="p">})</span></code></pre></figure>

<p>Just with this small change, everything is already working:</p>

<p><img src="../../../../media/series/beginners-guide/1.11/part-4/signup-9.png" alt="Sign up" /></p>

<p>Remember to change the test case to use the <strong>SignUpForm</strong> instead of <strong>UserCreationForm</strong>:</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="kn">from</span> <span class="nn">.forms</span> <span class="kn">import</span> <span class="n">SignUpForm</span>

<span class="k">class</span> <span class="nc">SignUpTests</span><span class="p">(</span><span class="n">TestCase</span><span class="p">):</span>
    <span class="c"># ...</span>

    <span class="k">def</span> <span class="nf">test_contains_form</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">form</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">response</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">'form'</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIsInstance</span><span class="p">(</span><span class="n">form</span><span class="p">,</span> <span class="n">SignUpForm</span><span class="p">)</span>

<span class="k">class</span> <span class="nc">SuccessfulSignUpTests</span><span class="p">(</span><span class="n">TestCase</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">setUp</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">url</span> <span class="o">=</span> <span class="n">reverse</span><span class="p">(</span><span class="s">'signup'</span><span class="p">)</span>
        <span class="n">data</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s">'username'</span><span class="p">:</span> <span class="s">'john'</span><span class="p">,</span>
            <span class="s">'email'</span><span class="p">:</span> <span class="s">'john@doe.com'</span><span class="p">,</span>
            <span class="s">'password1'</span><span class="p">:</span> <span class="s">'abcdef123456'</span><span class="p">,</span>
            <span class="s">'password2'</span><span class="p">:</span> <span class="s">'abcdef123456'</span>
        <span class="p">}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">home_url</span> <span class="o">=</span> <span class="n">reverse</span><span class="p">(</span><span class="s">'home'</span><span class="p">)</span>

    <span class="c"># ...</span></code></pre></figure>

<p>The previous test case would still pass because since <strong>SignUpForm</strong> extends the <strong>UserCreationForm</strong>, <em>it is</em> an
instance of <strong>UserCreationForm</strong>.</p>

<p>Now let’s think about what happened for a moment. We added a new form field:</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">fields</span> <span class="o">=</span> <span class="p">(</span><span class="s">'username'</span><span class="p">,</span> <span class="s">'email'</span><span class="p">,</span> <span class="s">'password1'</span><span class="p">,</span> <span class="s">'password2'</span><span class="p">)</span></code></pre></figure>

<p>And it automatically reflected in the HTML template. It’s good, right? Well, depends. What if in the future, a new
developer wanted to re-use the <strong>SignUpForm</strong> for something else, and add some extra fields to it. Then those new
fields would also show up in the <strong>signup.html</strong>, which may not be the desired behavior. This change could pass
unnoticed, and we don’t want any surprises.</p>

<p>So let’s create a new test, that verifies the HTML inputs in the template:</p>

<p><strong>accounts/tests.py</strong></p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="k">class</span> <span class="nc">SignUpTests</span><span class="p">(</span><span class="n">TestCase</span><span class="p">):</span>
    <span class="c"># ...</span>

    <span class="k">def</span> <span class="nf">test_form_inputs</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="s">'''
        The view must contain five inputs: csrf, username, email,
        password1, password2
        '''</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertContains</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">response</span><span class="p">,</span> <span class="s">'&lt;input'</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertContains</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">response</span><span class="p">,</span> <span class="s">'type="text"'</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertContains</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">response</span><span class="p">,</span> <span class="s">'type="email"'</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertContains</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">response</span><span class="p">,</span> <span class="s">'type="password"'</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span></code></pre></figure>

<h5 id="improving-the-tests-layout">Improving the Tests Layout</h5>

<p>Alright, so we are testing the inputs and everything, but we still have to test the form itself. Instead of just keep
adding tests to the <strong>accounts/tests.py</strong> file, let’s improve the project design a little bit.</p>

<p>Create a new folder named <strong>tests</strong> within the <strong>accounts</strong> folder. Then, inside the <strong>tests</strong> folder, create an empty
file named <strong>__init__.py</strong>.</p>

<p>Now, move the <strong>tests.py</strong> file to inside the <strong>tests</strong> folder, and rename it to <strong>test_view_signup.py</strong>.</p>

<p>The final result should be the following:</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash">myproject/
 |-- myproject/
 |    |-- accounts/
 |    |    |-- migrations/
 |    |    |-- tests/
 |    |    |    |-- __init__.py
 |    |    |    +-- test_view_signup.py
 |    |    |-- __init__.py
 |    |    |-- admin.py
 |    |    |-- apps.py
 |    |    |-- models.py
 |    |    +-- views.py
 |    |-- boards/
 |    |-- myproject/
 |    |-- static/
 |    |-- templates/
 |    |-- db.sqlite3
 |    +-- manage.py
 +-- venv/</code></pre></figure>

<p>Note that since we are using relative import within the context of the apps, we need to fix the imports in the new
<strong>test_view_signup.py</strong>:</p>

<p><strong>accounts/tests/test_view_signup.py</strong></p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="kn">from</span> <span class="nn">django.contrib.auth.models</span> <span class="kn">import</span> <span class="n">User</span>
<span class="kn">from</span> <span class="nn">django.core.urlresolvers</span> <span class="kn">import</span> <span class="n">reverse</span>
<span class="kn">from</span> <span class="nn">django.urls</span> <span class="kn">import</span> <span class="n">resolve</span>
<span class="kn">from</span> <span class="nn">django.test</span> <span class="kn">import</span> <span class="n">TestCase</span>

<span class="kn">from</span> <span class="nn">..views</span> <span class="kn">import</span> <span class="n">signup</span>
<span class="kn">from</span> <span class="nn">..forms</span> <span class="kn">import</span> <span class="n">SignUpForm</span></code></pre></figure>

<p>We are using relative imports inside the app modules so we can have the freedom to rename the Django app later on,
without having to fix all the absolute imports.</p>

<p>Now let’s create a new test file, to test the <strong>SignUpForm</strong>. Add a new test file named <strong>test_form_signup.py</strong>:</p>

<p><strong>accounts/tests/test_form_signup.py</strong></p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="kn">from</span> <span class="nn">django.test</span> <span class="kn">import</span> <span class="n">TestCase</span>
<span class="kn">from</span> <span class="nn">..forms</span> <span class="kn">import</span> <span class="n">SignUpForm</span>

<span class="k">class</span> <span class="nc">SignUpFormTest</span><span class="p">(</span><span class="n">TestCase</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">test_form_has_fields</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">form</span> <span class="o">=</span> <span class="n">SignUpForm</span><span class="p">()</span>
        <span class="n">expected</span> <span class="o">=</span> <span class="p">[</span><span class="s">'username'</span><span class="p">,</span> <span class="s">'email'</span><span class="p">,</span> <span class="s">'password1'</span><span class="p">,</span> <span class="s">'password2'</span><span class="p">,]</span>
        <span class="n">actual</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">form</span><span class="o">.</span><span class="n">fields</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertSequenceEqual</span><span class="p">(</span><span class="n">expected</span><span class="p">,</span> <span class="n">actual</span><span class="p">)</span></code></pre></figure>

<p>It looks very strict, right? For example, if in the future we have to change the <strong>SignUpForm</strong>, to include the user’s
first and last name, we will probably end up having to fix a few test cases, even if we didn’t break anything.</p>

<p><img src="../../../../media/series/beginners-guide/1.11/part-4/Pixton_Comic_Test_Alerts.png" alt="Test Case Alert" /></p>

<p>Those alerts are useful because they help to bring awareness, especially for newcomers touching the code for the first
time. It helps them code with confidence.</p>

<h5 id="improving-the-sign-up-template">Improving the Sign Up Template</h5>

<p>Let’s work a little bit on it. Here we can use Bootstrap 4 cards components to make it look good.</p>

<p>Go to <a href="https://www.toptal.com/designers/subtlepatterns/" target="_blank">https://www.toptal.com/designers/subtlepatterns/</a>
and find a nice background pattern to use as a background of the accounts pages. Download it, create a new folder
named <strong>img</strong> inside the <strong>static</strong> folder, and place the image there.</p>

<p>Then after that, create a new CSS file named <strong>accounts.css</strong> in the <strong>static/css</strong>. The result should be the
following:</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash">myproject/
 |-- myproject/
 |    |-- accounts/
 |    |-- boards/
 |    |-- myproject/
 |    |-- static/
 |    |    |-- css/
 |    |    |    |-- accounts.css  &lt;-- here
 |    |    |    |-- app.css
 |    |    |    +-- bootstrap.min.css
 |    |    +-- img/
 |    |    |    +-- shattered.png  &lt;-- here <span class="o">(</span>the name may be different, depending on the patter you downloaded<span class="o">)</span>
 |    |-- templates/
 |    |-- db.sqlite3
 |    +-- manage.py
 +-- venv/</code></pre></figure>

<p>Now edit the <strong>accounts.css</strong> file:</p>

<p><strong>static/css/accounts.css</strong></p>

<figure class="highlight"><pre><code class="language-css" data-lang="css"><span class="nt">body</span> <span class="p">{</span>
  <span class="nl">background-image</span><span class="p">:</span> <span class="sx">url(../img/shattered.png)</span><span class="p">;</span>
<span class="p">}</span>

<span class="nc">.logo</span> <span class="p">{</span>
  <span class="nl">font-family</span><span class="p">:</span> <span class="s2">'Peralta'</span><span class="p">,</span> <span class="nb">cursive</span><span class="p">;</span>
<span class="p">}</span>

<span class="nc">.logo</span> <span class="nt">a</span> <span class="p">{</span>
  <span class="nl">color</span><span class="p">:</span> <span class="n">rgba</span><span class="p">(</span><span class="m">0</span><span class="p">,</span><span class="m">0</span><span class="p">,</span><span class="m">0</span><span class="p">,</span><span class="m">.9</span><span class="p">);</span>
<span class="p">}</span>

<span class="nc">.logo</span> <span class="nt">a</span><span class="nd">:hover</span><span class="o">,</span>
<span class="nc">.logo</span> <span class="nt">a</span><span class="nd">:active</span> <span class="p">{</span>
  <span class="nl">text-decoration</span><span class="p">:</span> <span class="nb">none</span><span class="p">;</span>
<span class="p">}</span></code></pre></figure>

<p>In the <strong>signup.html</strong> template, we can change it to make use of the new CSS and also take the Bootstrap 4 card
components into use:</p>

<p><strong>templates/signup.html</strong></p>

<figure class="highlight"><pre><code class="language-django" data-lang="django"><span class="cp">{%</span> <span class="k">extends</span> <span class="s1">'base.html'</span> <span class="cp">%}</span>

<span class="cp">{%</span> <span class="nv">load</span> <span class="nv">static</span> <span class="cp">%}</span>

<span class="cp">{%</span> <span class="k">block</span> <span class="nv">stylesheet</span> <span class="cp">%}</span>
  <span class="nt">&lt;link</span> <span class="na">rel=</span><span class="s">"stylesheet"</span> <span class="na">href=</span><span class="s">"</span><span class="cp">{%</span> <span class="nv">static</span> <span class="s1">'css/accounts.css'</span> <span class="cp">%}</span><span class="s">"</span><span class="nt">&gt;</span>
<span class="cp">{%</span> <span class="k">endblock</span> <span class="cp">%}</span>

<span class="cp">{%</span> <span class="k">block</span> <span class="nv">body</span> <span class="cp">%}</span>
  <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"container"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;h1</span> <span class="na">class=</span><span class="s">"text-center logo my-4"</span><span class="nt">&gt;</span>
      <span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">"</span><span class="cp">{%</span> <span class="nv">url</span> <span class="s1">'home'</span> <span class="cp">%}</span><span class="s">"</span><span class="nt">&gt;</span>Django Boards<span class="nt">&lt;/a&gt;</span>
    <span class="nt">&lt;/h1&gt;</span>
    <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"row justify-content-center"</span><span class="nt">&gt;</span>
      <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"col-lg-8 col-md-10 col-sm-12"</span><span class="nt">&gt;</span>
        <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"card"</span><span class="nt">&gt;</span>
          <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"card-body"</span><span class="nt">&gt;</span>
            <span class="nt">&lt;h3</span> <span class="na">class=</span><span class="s">"card-title"</span><span class="nt">&gt;</span>Sign up<span class="nt">&lt;/h3&gt;</span>
            <span class="nt">&lt;form</span> <span class="na">method=</span><span class="s">"post"</span> <span class="na">novalidate</span><span class="nt">&gt;</span>
              <span class="cp">{%</span> <span class="nv">csrf_token</span> <span class="cp">%}</span>
              <span class="cp">{%</span> <span class="k">include</span> <span class="s1">'includes/form.html'</span> <span class="cp">%}</span>
              <span class="nt">&lt;button</span> <span class="na">type=</span><span class="s">"submit"</span> <span class="na">class=</span><span class="s">"btn btn-primary btn-block"</span><span class="nt">&gt;</span>Create an account<span class="nt">&lt;/button&gt;</span>
            <span class="nt">&lt;/form&gt;</span>
          <span class="nt">&lt;/div&gt;</span>
          <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"card-footer text-muted text-center"</span><span class="nt">&gt;</span>
            Already have an account? <span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">"#"</span><span class="nt">&gt;</span>Log in<span class="nt">&lt;/a&gt;</span>
          <span class="nt">&lt;/div&gt;</span>
        <span class="nt">&lt;/div&gt;</span>
      <span class="nt">&lt;/div&gt;</span>
    <span class="nt">&lt;/div&gt;</span>
  <span class="nt">&lt;/div&gt;</span>
<span class="cp">{%</span> <span class="k">endblock</span> <span class="cp">%}</span></code></pre></figure>

<p>With that, this should be our sign up page right now:</p>

<p><img src="../../../../media/series/beginners-guide/1.11/part-4/signup-10.jpg" alt="Sign up" /></p>

<hr />

<h4 id="logout">Logout</h4>

<p>To keep a natural flow in the implementation, let’s add the log out view. First, edit the <strong>urls.py</strong> to add a new
route:</p>

<p><strong>myproject/urls.py</strong></p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="kn">from</span> <span class="nn">django.conf.urls</span> <span class="kn">import</span> <span class="n">url</span>
<span class="kn">from</span> <span class="nn">django.contrib</span> <span class="kn">import</span> <span class="n">admin</span>
<span class="kn">from</span> <span class="nn">django.contrib.auth</span> <span class="kn">import</span> <span class="n">views</span> <span class="k">as</span> <span class="n">auth_views</span>

<span class="kn">from</span> <span class="nn">accounts</span> <span class="kn">import</span> <span class="n">views</span> <span class="k">as</span> <span class="n">accounts_views</span>
<span class="kn">from</span> <span class="nn">boards</span> <span class="kn">import</span> <span class="n">views</span>

<span class="n">urlpatterns</span> <span class="o">=</span> <span class="p">[</span>
    <span class="n">url</span><span class="p">(</span><span class="s">r'^$'</span><span class="p">,</span> <span class="n">views</span><span class="o">.</span><span class="n">home</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s">'home'</span><span class="p">),</span>
    <span class="n">url</span><span class="p">(</span><span class="s">r'^signup/$'</span><span class="p">,</span> <span class="n">accounts_views</span><span class="o">.</span><span class="n">signup</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s">'signup'</span><span class="p">),</span>
    <span class="n">url</span><span class="p">(</span><span class="s">r'^logout/$'</span><span class="p">,</span> <span class="n">auth_views</span><span class="o">.</span><span class="n">LogoutView</span><span class="o">.</span><span class="n">as_view</span><span class="p">(),</span> <span class="n">name</span><span class="o">=</span><span class="s">'logout'</span><span class="p">),</span>
    <span class="n">url</span><span class="p">(</span><span class="s">r'^boards/(?P&lt;pk&gt;</span><span class="err">\</span><span class="s">d+)/$'</span><span class="p">,</span> <span class="n">views</span><span class="o">.</span><span class="n">board_topics</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s">'board_topics'</span><span class="p">),</span>
    <span class="n">url</span><span class="p">(</span><span class="s">r'^boards/(?P&lt;pk&gt;</span><span class="err">\</span><span class="s">d+)/new/$'</span><span class="p">,</span> <span class="n">views</span><span class="o">.</span><span class="n">new_topic</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s">'new_topic'</span><span class="p">),</span>
    <span class="n">url</span><span class="p">(</span><span class="s">r'^admin/'</span><span class="p">,</span> <span class="n">admin</span><span class="o">.</span><span class="n">site</span><span class="o">.</span><span class="n">urls</span><span class="p">),</span>
<span class="p">]</span></code></pre></figure>

<p>We imported the <strong>views</strong> from the Django’s contrib module. We renamed it to <strong>auth_views</strong> to avoid clashing
with the <strong>boards.views</strong>. Notice that this view is a little bit different: <code class="highlighter-rouge">LogoutView.as_view()</code>. It’s a Django’s
class-based view. So far we have only implemented views as Python functions. The class-based views provide a more
flexible way to extend and reuse views. We will discuss more that subject later on.</p>

<p>Open the <strong>settings.py</strong> file and add the <code class="highlighter-rouge">LOGOUT_REDIRECT_URL</code> variable to the bottom of the file:</p>

<p><strong>myproject/settings.py</strong></p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">LOGOUT_REDIRECT_URL</span> <span class="o">=</span> <span class="s">'home'</span></code></pre></figure>

<p>Here we are passing the name of the URL pattern we want to redirect the user after the log out.</p>

<p>After that, it’s already done. Just access the URL <strong>127.0.0.1:8000/logout/</strong> and you will be logged out. But hold on
a second. Before you log out, let’s create the dropdown menu for logged in users.</p>

<hr />

<h4 id="displaying-menu-for-authenticated-users">Displaying Menu For Authenticated Users</h4>

<p>Now we will need to do some tweaks in our <strong>base.html</strong> template. We have to add a dropdown menu with the logout link.</p>

<p>The Bootstrap 4 dropdown component needs jQuery to work.</p>

<p>First, go to <a href="https://jquery.com/download/" target="_blank">jquery.com/download/</a> and download the
<strong>compressed, production jQuery 3.2.1</strong> version.</p>

<p><img src="../../../../media/series/beginners-guide/1.11/part-4/jquery-download.jpg" alt="jQuery Download" /></p>

<p>Inside the <strong>static</strong> folder, create a new folder named <strong>js</strong>. Copy the <strong>jquery-3.2.1.min.js</strong> file to there.</p>

<p>Bootstrap 4 also needs a library called <strong>Popper</strong> to work. Go to <a href="https://popper.js.org/" target="_blank">popper.js.org</a>
and download the latest version.</p>

<p>Inside the <strong>popper.js-1.12.5</strong> folder, go to <strong>dist/umd</strong> and copy the file <strong>popper.min.js</strong> to our <strong>js</strong> folder.
Pay attention here; Bootstrap 4 will only work with the <strong>umd/popper.min.js</strong>. So make sure you are copying the right
file.</p>

<p>If you no longer have all the Bootstrap 4 files, download it again from <a href="http://getbootstrap.com/" target="_blank">getbootstrap.com</a>.</p>

<p>Similarly, copy the <strong>bootstrap.min.js</strong> file to our <strong>js</strong> folder as well.</p>

<p>The final result should be:</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash">myproject/
 |-- myproject/
 |    |-- accounts/
 |    |-- boards/
 |    |-- myproject/
 |    |-- static/
 |    |    |-- css/
 |    |    +-- js/
 |    |         |-- bootstrap.min.js
 |    |         |-- jquery-3.2.1.min.js
 |    |         +-- popper.min.js
 |    |-- templates/
 |    |-- db.sqlite3
 |    +-- manage.py
 +-- venv/</code></pre></figure>

<p>In the bottom of the <strong>base.html</strong> file, add the scripts <em>after</em> the <code class="highlighter-rouge"><span class="p">{</span><span class="err">%</span><span class="w"> </span><span class="err">endblock</span><span class="w"> </span><span class="err">body</span><span class="w"> </span><span class="err">%</span><span class="p">}</span></code>:</p>

<p><strong>templates/base.html</strong></p>

<figure class="highlight"><pre><code class="language-django" data-lang="django"><span class="cp">{%</span> <span class="nv">load</span> <span class="nv">static</span> <span class="cp">%}&lt;!DOCTYPE html&gt;</span>
<span class="nt">&lt;html&gt;</span>
  <span class="nt">&lt;head&gt;</span>
    <span class="nt">&lt;meta</span> <span class="na">charset=</span><span class="s">"utf-8"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;title&gt;</span><span class="cp">{%</span> <span class="k">block</span> <span class="nv">title</span> <span class="cp">%}</span>Django Boards<span class="cp">{%</span> <span class="k">endblock</span> <span class="cp">%}</span><span class="nt">&lt;/title&gt;</span>
    <span class="nt">&lt;link</span> <span class="na">href=</span><span class="s">"https://fonts.googleapis.com/css?family=Peralta"</span> <span class="na">rel=</span><span class="s">"stylesheet"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;link</span> <span class="na">rel=</span><span class="s">"stylesheet"</span> <span class="na">href=</span><span class="s">"</span><span class="cp">{%</span> <span class="nv">static</span> <span class="s1">'css/bootstrap.min.css'</span> <span class="cp">%}</span><span class="s">"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;link</span> <span class="na">rel=</span><span class="s">"stylesheet"</span> <span class="na">href=</span><span class="s">"</span><span class="cp">{%</span> <span class="nv">static</span> <span class="s1">'css/app.css'</span> <span class="cp">%}</span><span class="s">"</span><span class="nt">&gt;</span>
    <span class="cp">{%</span> <span class="k">block</span> <span class="nv">stylesheet</span> <span class="cp">%}{%</span> <span class="k">endblock</span> <span class="cp">%}</span>
  <span class="nt">&lt;/head&gt;</span>
  <span class="nt">&lt;body&gt;</span>
    <span class="cp">{%</span> <span class="k">block</span> <span class="nv">body</span> <span class="cp">%}</span>
    <span class="c">&lt;!-- code suppressed for brevity --&gt;</span>
    <span class="cp">{%</span> <span class="k">endblock</span> <span class="nv">body</span> <span class="cp">%}</span>
    <span class="nt">&lt;script </span><span class="na">src=</span><span class="s">"</span><span class="cp">{%</span> <span class="nv">static</span> <span class="s1">'js/jquery-3.2.1.min.js'</span> <span class="cp">%}</span><span class="s">"</span><span class="nt">&gt;&lt;/script&gt;</span>
    <span class="nt">&lt;script </span><span class="na">src=</span><span class="s">"</span><span class="cp">{%</span> <span class="nv">static</span> <span class="s1">'js/popper.min.js'</span> <span class="cp">%}</span><span class="s">"</span><span class="nt">&gt;&lt;/script&gt;</span>
    <span class="nt">&lt;script </span><span class="na">src=</span><span class="s">"</span><span class="cp">{%</span> <span class="nv">static</span> <span class="s1">'js/bootstrap.min.js'</span> <span class="cp">%}</span><span class="s">"</span><span class="nt">&gt;&lt;/script&gt;</span>
  <span class="nt">&lt;/body&gt;</span>
<span class="nt">&lt;/html&gt;</span></code></pre></figure>

<p>If you found the instructions confusing, just download the files using the direct links below:</p>

<ul>
  <li><a href="https://code.jquery.com/jquery-3.2.1.min.js" target="_blank">https://code.jquery.com/jquery-3.2.1.min.js</a></li>
  <li><a href="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.11.0/umd/popper.min.js" target="_blank">https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.11.0/umd/popper.min.js</a></li>
  <li><a href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-beta/js/bootstrap.min.js" target="_blank">https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-beta/js/bootstrap.min.js</a></li>
</ul>

<p>Right-click and <strong>*Save link as…</strong>.</p>

<p>Now we can add the Bootstrap 4 dropdown menu:</p>

<p><strong>templates/base.html</strong></p>

<figure class="highlight"><pre><code class="language-django" data-lang="django"><span class="nt">&lt;nav</span> <span class="na">class=</span><span class="s">"navbar navbar-expand-sm navbar-dark bg-dark"</span><span class="nt">&gt;</span>
  <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"container"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;a</span> <span class="na">class=</span><span class="s">"navbar-brand"</span> <span class="na">href=</span><span class="s">"</span><span class="cp">{%</span> <span class="nv">url</span> <span class="s1">'home'</span> <span class="cp">%}</span><span class="s">"</span><span class="nt">&gt;</span>Django Boards<span class="nt">&lt;/a&gt;</span>
    <span class="nt">&lt;button</span> <span class="na">class=</span><span class="s">"navbar-toggler"</span> <span class="na">type=</span><span class="s">"button"</span> <span class="na">data-toggle=</span><span class="s">"collapse"</span> <span class="na">data-target=</span><span class="s">"#mainMenu"</span> <span class="na">aria-controls=</span><span class="s">"mainMenu"</span> <span class="na">aria-expanded=</span><span class="s">"false"</span> <span class="na">aria-label=</span><span class="s">"Toggle navigation"</span><span class="nt">&gt;</span>
      <span class="nt">&lt;span</span> <span class="na">class=</span><span class="s">"navbar-toggler-icon"</span><span class="nt">&gt;&lt;/span&gt;</span>
    <span class="nt">&lt;/button&gt;</span>
    <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"collapse navbar-collapse"</span> <span class="na">id=</span><span class="s">"mainMenu"</span><span class="nt">&gt;</span>
      <span class="nt">&lt;ul</span> <span class="na">class=</span><span class="s">"navbar-nav ml-auto"</span><span class="nt">&gt;</span>
        <span class="nt">&lt;li</span> <span class="na">class=</span><span class="s">"nav-item dropdown"</span><span class="nt">&gt;</span>
          <span class="nt">&lt;a</span> <span class="na">class=</span><span class="s">"nav-link dropdown-toggle"</span> <span class="na">href=</span><span class="s">"#"</span> <span class="na">id=</span><span class="s">"userMenu"</span> <span class="na">data-toggle=</span><span class="s">"dropdown"</span> <span class="na">aria-haspopup=</span><span class="s">"true"</span> <span class="na">aria-expanded=</span><span class="s">"false"</span><span class="nt">&gt;</span>
            <span class="cp">{{</span> <span class="nv">user.username</span> <span class="cp">}}</span>
          <span class="nt">&lt;/a&gt;</span>
          <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"dropdown-menu dropdown-menu-right"</span> <span class="na">aria-labelledby=</span><span class="s">"userMenu"</span><span class="nt">&gt;</span>
            <span class="nt">&lt;a</span> <span class="na">class=</span><span class="s">"dropdown-item"</span> <span class="na">href=</span><span class="s">"#"</span><span class="nt">&gt;</span>My account<span class="nt">&lt;/a&gt;</span>
            <span class="nt">&lt;a</span> <span class="na">class=</span><span class="s">"dropdown-item"</span> <span class="na">href=</span><span class="s">"#"</span><span class="nt">&gt;</span>Change password<span class="nt">&lt;/a&gt;</span>
            <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"dropdown-divider"</span><span class="nt">&gt;&lt;/div&gt;</span>
            <span class="nt">&lt;a</span> <span class="na">class=</span><span class="s">"dropdown-item"</span> <span class="na">href=</span><span class="s">"</span><span class="cp">{%</span> <span class="nv">url</span> <span class="s1">'logout'</span> <span class="cp">%}</span><span class="s">"</span><span class="nt">&gt;</span>Log out<span class="nt">&lt;/a&gt;</span>
          <span class="nt">&lt;/div&gt;</span>
        <span class="nt">&lt;/li&gt;</span>
      <span class="nt">&lt;/ul&gt;</span>
    <span class="nt">&lt;/div&gt;</span>
  <span class="nt">&lt;/div&gt;</span>
<span class="nt">&lt;/nav&gt;</span></code></pre></figure>

<p><img src="../../../../media/series/beginners-guide/1.11/part-4/dropdown.png" alt="Dropdown menu" /></p>

<p>Let’s try it. Click on logout:</p>

<p><img src="../../../../media/series/beginners-guide/1.11/part-4/logout.png" alt="Logout" /></p>

<p>It’s working. But the dropdown is showing regardless of the user being logged in or not. The difference is that now the
username is empty, and we can only see an arrow.</p>

<p>We can improve it a little bit:</p>

<figure class="highlight"><pre><code class="language-django" data-lang="django"><span class="nt">&lt;nav</span> <span class="na">class=</span><span class="s">"navbar navbar-expand-sm navbar-dark bg-dark"</span><span class="nt">&gt;</span>
  <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"container"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;a</span> <span class="na">class=</span><span class="s">"navbar-brand"</span> <span class="na">href=</span><span class="s">"</span><span class="cp">{%</span> <span class="nv">url</span> <span class="s1">'home'</span> <span class="cp">%}</span><span class="s">"</span><span class="nt">&gt;</span>Django Boards<span class="nt">&lt;/a&gt;</span>
    <span class="nt">&lt;button</span> <span class="na">class=</span><span class="s">"navbar-toggler"</span> <span class="na">type=</span><span class="s">"button"</span> <span class="na">data-toggle=</span><span class="s">"collapse"</span> <span class="na">data-target=</span><span class="s">"#mainMenu"</span> <span class="na">aria-controls=</span><span class="s">"mainMenu"</span> <span class="na">aria-expanded=</span><span class="s">"false"</span> <span class="na">aria-label=</span><span class="s">"Toggle navigation"</span><span class="nt">&gt;</span>
      <span class="nt">&lt;span</span> <span class="na">class=</span><span class="s">"navbar-toggler-icon"</span><span class="nt">&gt;&lt;/span&gt;</span>
    <span class="nt">&lt;/button&gt;</span>
    <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"collapse navbar-collapse"</span> <span class="na">id=</span><span class="s">"mainMenu"</span><span class="nt">&gt;</span>
      <span class="cp">{%</span> <span class="k">if</span> <span class="nv">user.is_authenticated</span> <span class="cp">%}</span>
        <span class="nt">&lt;ul</span> <span class="na">class=</span><span class="s">"navbar-nav ml-auto"</span><span class="nt">&gt;</span>
          <span class="nt">&lt;li</span> <span class="na">class=</span><span class="s">"nav-item dropdown"</span><span class="nt">&gt;</span>
            <span class="nt">&lt;a</span> <span class="na">class=</span><span class="s">"nav-link dropdown-toggle"</span> <span class="na">href=</span><span class="s">"#"</span> <span class="na">id=</span><span class="s">"userMenu"</span> <span class="na">data-toggle=</span><span class="s">"dropdown"</span> <span class="na">aria-haspopup=</span><span class="s">"true"</span> <span class="na">aria-expanded=</span><span class="s">"false"</span><span class="nt">&gt;</span>
              <span class="cp">{{</span> <span class="nv">user.username</span> <span class="cp">}}</span>
            <span class="nt">&lt;/a&gt;</span>
            <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"dropdown-menu dropdown-menu-right"</span> <span class="na">aria-labelledby=</span><span class="s">"userMenu"</span><span class="nt">&gt;</span>
              <span class="nt">&lt;a</span> <span class="na">class=</span><span class="s">"dropdown-item"</span> <span class="na">href=</span><span class="s">"#"</span><span class="nt">&gt;</span>My account<span class="nt">&lt;/a&gt;</span>
              <span class="nt">&lt;a</span> <span class="na">class=</span><span class="s">"dropdown-item"</span> <span class="na">href=</span><span class="s">"#"</span><span class="nt">&gt;</span>Change password<span class="nt">&lt;/a&gt;</span>
              <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"dropdown-divider"</span><span class="nt">&gt;&lt;/div&gt;</span>
              <span class="nt">&lt;a</span> <span class="na">class=</span><span class="s">"dropdown-item"</span> <span class="na">href=</span><span class="s">"</span><span class="cp">{%</span> <span class="nv">url</span> <span class="s1">'logout'</span> <span class="cp">%}</span><span class="s">"</span><span class="nt">&gt;</span>Log out<span class="nt">&lt;/a&gt;</span>
            <span class="nt">&lt;/div&gt;</span>
          <span class="nt">&lt;/li&gt;</span>
        <span class="nt">&lt;/ul&gt;</span>
      <span class="cp">{%</span> <span class="k">else</span> <span class="cp">%}</span>
        <span class="nt">&lt;form</span> <span class="na">class=</span><span class="s">"form-inline ml-auto"</span><span class="nt">&gt;</span>
          <span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">"#"</span> <span class="na">class=</span><span class="s">"btn btn-outline-secondary"</span><span class="nt">&gt;</span>Log in<span class="nt">&lt;/a&gt;</span>
          <span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">"</span><span class="cp">{%</span> <span class="nv">url</span> <span class="s1">'signup'</span> <span class="cp">%}</span><span class="s">"</span> <span class="na">class=</span><span class="s">"btn btn-primary ml-2"</span><span class="nt">&gt;</span>Sign up<span class="nt">&lt;/a&gt;</span>
        <span class="nt">&lt;/form&gt;</span>
      <span class="cp">{%</span> <span class="k">endif</span> <span class="cp">%}</span>
    <span class="nt">&lt;/div&gt;</span>
  <span class="nt">&lt;/div&gt;</span>
<span class="nt">&lt;/nav&gt;</span></code></pre></figure>

<p>Now we are telling Django to show the dropdown menu if the user is logged in, and if not, show the log in and sign up
buttons:</p>

<p><img src="../../../../media/series/beginners-guide/1.11/part-4/mainmenu.png" alt="Main Menu" /></p>

<hr />

<h4 id="login">Login</h4>

<p>First thing, add a new URL route:</p>

<p><strong>myproject/urls.py</strong></p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="kn">from</span> <span class="nn">django.conf.urls</span> <span class="kn">import</span> <span class="n">url</span>
<span class="kn">from</span> <span class="nn">django.contrib</span> <span class="kn">import</span> <span class="n">admin</span>
<span class="kn">from</span> <span class="nn">django.contrib.auth</span> <span class="kn">import</span> <span class="n">views</span> <span class="k">as</span> <span class="n">auth_views</span>

<span class="kn">from</span> <span class="nn">accounts</span> <span class="kn">import</span> <span class="n">views</span> <span class="k">as</span> <span class="n">accounts_views</span>
<span class="kn">from</span> <span class="nn">boards</span> <span class="kn">import</span> <span class="n">views</span>

<span class="n">urlpatterns</span> <span class="o">=</span> <span class="p">[</span>
    <span class="n">url</span><span class="p">(</span><span class="s">r'^$'</span><span class="p">,</span> <span class="n">views</span><span class="o">.</span><span class="n">home</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s">'home'</span><span class="p">),</span>
    <span class="n">url</span><span class="p">(</span><span class="s">r'^signup/$'</span><span class="p">,</span> <span class="n">accounts_views</span><span class="o">.</span><span class="n">signup</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s">'signup'</span><span class="p">),</span>
    <span class="n">url</span><span class="p">(</span><span class="s">r'^login/$'</span><span class="p">,</span> <span class="n">auth_views</span><span class="o">.</span><span class="n">LoginView</span><span class="o">.</span><span class="n">as_view</span><span class="p">(</span><span class="n">template_name</span><span class="o">=</span><span class="s">'login.html'</span><span class="p">),</span> <span class="n">name</span><span class="o">=</span><span class="s">'login'</span><span class="p">),</span>
    <span class="n">url</span><span class="p">(</span><span class="s">r'^logout/$'</span><span class="p">,</span> <span class="n">auth_views</span><span class="o">.</span><span class="n">LogoutView</span><span class="o">.</span><span class="n">as_view</span><span class="p">(),</span> <span class="n">name</span><span class="o">=</span><span class="s">'logout'</span><span class="p">),</span>
    <span class="n">url</span><span class="p">(</span><span class="s">r'^boards/(?P&lt;pk&gt;</span><span class="err">\</span><span class="s">d+)/$'</span><span class="p">,</span> <span class="n">views</span><span class="o">.</span><span class="n">board_topics</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s">'board_topics'</span><span class="p">),</span>
    <span class="n">url</span><span class="p">(</span><span class="s">r'^boards/(?P&lt;pk&gt;</span><span class="err">\</span><span class="s">d+)/new/$'</span><span class="p">,</span> <span class="n">views</span><span class="o">.</span><span class="n">new_topic</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s">'new_topic'</span><span class="p">),</span>
    <span class="n">url</span><span class="p">(</span><span class="s">r'^admin/'</span><span class="p">,</span> <span class="n">admin</span><span class="o">.</span><span class="n">site</span><span class="o">.</span><span class="n">urls</span><span class="p">),</span>
<span class="p">]</span></code></pre></figure>

<p>Inside the <code class="highlighter-rouge">as_view()</code> we can pass some extra parameters, so to override the defaults. In this case, we are instructing
the <strong>LoginView</strong> to look for a template at <strong>login.html</strong>.</p>

<p>Edit the <strong>settings.py</strong> and add the following configuration:</p>

<p><strong>myproject/settings.py</strong></p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">LOGIN_REDIRECT_URL</span> <span class="o">=</span> <span class="s">'home'</span></code></pre></figure>

<p>This configuration is telling Django where to redirect the user after a successful login.</p>

<p>Finally, add the login URL to the <strong>base.html</strong> template:</p>

<p><strong>templates/base.html</strong></p>

<figure class="highlight"><pre><code class="language-django" data-lang="django"><span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">"</span><span class="cp">{%</span> <span class="nv">url</span> <span class="s1">'login'</span> <span class="cp">%}</span><span class="s">"</span> <span class="na">class=</span><span class="s">"btn btn-outline-secondary"</span><span class="nt">&gt;</span>Log in<span class="nt">&lt;/a&gt;</span></code></pre></figure>

<p>We can create a template similar to the sign up page. Create a new file named <strong>login.html</strong>:</p>

<p><strong>templates/login.html</strong></p>

<figure class="highlight"><pre><code class="language-django" data-lang="django"><span class="cp">{%</span> <span class="k">extends</span> <span class="s1">'base.html'</span> <span class="cp">%}</span>

<span class="cp">{%</span> <span class="nv">load</span> <span class="nv">static</span> <span class="cp">%}</span>

<span class="cp">{%</span> <span class="k">block</span> <span class="nv">stylesheet</span> <span class="cp">%}</span>
  <span class="nt">&lt;link</span> <span class="na">rel=</span><span class="s">"stylesheet"</span> <span class="na">href=</span><span class="s">"</span><span class="cp">{%</span> <span class="nv">static</span> <span class="s1">'css/accounts.css'</span> <span class="cp">%}</span><span class="s">"</span><span class="nt">&gt;</span>
<span class="cp">{%</span> <span class="k">endblock</span> <span class="cp">%}</span>

<span class="cp">{%</span> <span class="k">block</span> <span class="nv">body</span> <span class="cp">%}</span>
  <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"container"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;h1</span> <span class="na">class=</span><span class="s">"text-center logo my-4"</span><span class="nt">&gt;</span>
      <span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">"</span><span class="cp">{%</span> <span class="nv">url</span> <span class="s1">'home'</span> <span class="cp">%}</span><span class="s">"</span><span class="nt">&gt;</span>Django Boards<span class="nt">&lt;/a&gt;</span>
    <span class="nt">&lt;/h1&gt;</span>
    <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"row justify-content-center"</span><span class="nt">&gt;</span>
      <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"col-lg-4 col-md-6 col-sm-8"</span><span class="nt">&gt;</span>
        <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"card"</span><span class="nt">&gt;</span>
          <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"card-body"</span><span class="nt">&gt;</span>
            <span class="nt">&lt;h3</span> <span class="na">class=</span><span class="s">"card-title"</span><span class="nt">&gt;</span>Log in<span class="nt">&lt;/h3&gt;</span>
            <span class="nt">&lt;form</span> <span class="na">method=</span><span class="s">"post"</span> <span class="na">novalidate</span><span class="nt">&gt;</span>
              <span class="cp">{%</span> <span class="nv">csrf_token</span> <span class="cp">%}</span>
              <span class="cp">{%</span> <span class="k">include</span> <span class="s1">'includes/form.html'</span> <span class="cp">%}</span>
              <span class="nt">&lt;button</span> <span class="na">type=</span><span class="s">"submit"</span> <span class="na">class=</span><span class="s">"btn btn-primary btn-block"</span><span class="nt">&gt;</span>Log in<span class="nt">&lt;/button&gt;</span>
            <span class="nt">&lt;/form&gt;</span>
          <span class="nt">&lt;/div&gt;</span>
          <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"card-footer text-muted text-center"</span><span class="nt">&gt;</span>
            New to Django Boards? <span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">"</span><span class="cp">{%</span> <span class="nv">url</span> <span class="s1">'signup'</span> <span class="cp">%}</span><span class="s">"</span><span class="nt">&gt;</span>Sign up<span class="nt">&lt;/a&gt;</span>
          <span class="nt">&lt;/div&gt;</span>
        <span class="nt">&lt;/div&gt;</span>
        <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"text-center py-2"</span><span class="nt">&gt;</span>
          <span class="nt">&lt;small&gt;</span>
            <span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">"#"</span> <span class="na">class=</span><span class="s">"text-muted"</span><span class="nt">&gt;</span>Forgot your password?<span class="nt">&lt;/a&gt;</span>
          <span class="nt">&lt;/small&gt;</span>
        <span class="nt">&lt;/div&gt;</span>
      <span class="nt">&lt;/div&gt;</span>
    <span class="nt">&lt;/div&gt;</span>
  <span class="nt">&lt;/div&gt;</span>
<span class="cp">{%</span> <span class="k">endblock</span> <span class="cp">%}</span></code></pre></figure>

<p><img src="../../../../media/series/beginners-guide/1.11/part-4/login.jpg" alt="Login" /></p>

<p>And we are repeating HTML templates. Let’s refactor it.</p>

<p>Create a new template named <strong>base_accounts.html</strong>:</p>

<p><strong>templates/base_accounts.html</strong></p>

<figure class="highlight"><pre><code class="language-django" data-lang="django"><span class="cp">{%</span> <span class="k">extends</span> <span class="s1">'base.html'</span> <span class="cp">%}</span>

<span class="cp">{%</span> <span class="nv">load</span> <span class="nv">static</span> <span class="cp">%}</span>

<span class="cp">{%</span> <span class="k">block</span> <span class="nv">stylesheet</span> <span class="cp">%}</span>
  <span class="nt">&lt;link</span> <span class="na">rel=</span><span class="s">"stylesheet"</span> <span class="na">href=</span><span class="s">"</span><span class="cp">{%</span> <span class="nv">static</span> <span class="s1">'css/accounts.css'</span> <span class="cp">%}</span><span class="s">"</span><span class="nt">&gt;</span>
<span class="cp">{%</span> <span class="k">endblock</span> <span class="cp">%}</span>

<span class="cp">{%</span> <span class="k">block</span> <span class="nv">body</span> <span class="cp">%}</span>
  <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"container"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;h1</span> <span class="na">class=</span><span class="s">"text-center logo my-4"</span><span class="nt">&gt;</span>
      <span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">"</span><span class="cp">{%</span> <span class="nv">url</span> <span class="s1">'home'</span> <span class="cp">%}</span><span class="s">"</span><span class="nt">&gt;</span>Django Boards<span class="nt">&lt;/a&gt;</span>
    <span class="nt">&lt;/h1&gt;</span>
    <span class="cp">{%</span> <span class="k">block</span> <span class="nv">content</span> <span class="cp">%}</span>
    <span class="cp">{%</span> <span class="k">endblock</span> <span class="cp">%}</span>
  <span class="nt">&lt;/div&gt;</span>
<span class="cp">{%</span> <span class="k">endblock</span> <span class="cp">%}</span></code></pre></figure>

<p>Now use it on both <strong>signup.html</strong> and <strong>login.html</strong>:</p>

<p><strong>templates/login.html</strong></p>

<figure class="highlight"><pre><code class="language-django" data-lang="django"><span class="cp">{%</span> <span class="k">extends</span> <span class="s1">'base_accounts.html'</span> <span class="cp">%}</span>

<span class="cp">{%</span> <span class="k">block</span> <span class="nv">title</span> <span class="cp">%}</span>Log in to Django Boards<span class="cp">{%</span> <span class="k">endblock</span> <span class="cp">%}</span>

<span class="cp">{%</span> <span class="k">block</span> <span class="nv">content</span> <span class="cp">%}</span>
  <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"row justify-content-center"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"col-lg-4 col-md-6 col-sm-8"</span><span class="nt">&gt;</span>
      <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"card"</span><span class="nt">&gt;</span>
        <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"card-body"</span><span class="nt">&gt;</span>
          <span class="nt">&lt;h3</span> <span class="na">class=</span><span class="s">"card-title"</span><span class="nt">&gt;</span>Log in<span class="nt">&lt;/h3&gt;</span>
          <span class="nt">&lt;form</span> <span class="na">method=</span><span class="s">"post"</span> <span class="na">novalidate</span><span class="nt">&gt;</span>
            <span class="cp">{%</span> <span class="nv">csrf_token</span> <span class="cp">%}</span>
            <span class="cp">{%</span> <span class="k">include</span> <span class="s1">'includes/form.html'</span> <span class="cp">%}</span>
            <span class="nt">&lt;button</span> <span class="na">type=</span><span class="s">"submit"</span> <span class="na">class=</span><span class="s">"btn btn-primary btn-block"</span><span class="nt">&gt;</span>Log in<span class="nt">&lt;/button&gt;</span>
          <span class="nt">&lt;/form&gt;</span>
        <span class="nt">&lt;/div&gt;</span>
        <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"card-footer text-muted text-center"</span><span class="nt">&gt;</span>
          New to Django Boards? <span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">"</span><span class="cp">{%</span> <span class="nv">url</span> <span class="s1">'signup'</span> <span class="cp">%}</span><span class="s">"</span><span class="nt">&gt;</span>Sign up<span class="nt">&lt;/a&gt;</span>
        <span class="nt">&lt;/div&gt;</span>
      <span class="nt">&lt;/div&gt;</span>
      <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"text-center py-2"</span><span class="nt">&gt;</span>
        <span class="nt">&lt;small&gt;</span>
          <span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">"#"</span> <span class="na">class=</span><span class="s">"text-muted"</span><span class="nt">&gt;</span>Forgot your password?<span class="nt">&lt;/a&gt;</span>
        <span class="nt">&lt;/small&gt;</span>
      <span class="nt">&lt;/div&gt;</span>
    <span class="nt">&lt;/div&gt;</span>
  <span class="nt">&lt;/div&gt;</span>
<span class="cp">{%</span> <span class="k">endblock</span> <span class="cp">%}</span></code></pre></figure>

<p>We still don’t have the password reset URL, so let’s leave it as <code class="highlighter-rouge">#</code> for now.</p>

<p><strong>templates/signup.html</strong></p>

<figure class="highlight"><pre><code class="language-django" data-lang="django"><span class="cp">{%</span> <span class="k">extends</span> <span class="s1">'base_accounts.html'</span> <span class="cp">%}</span>

<span class="cp">{%</span> <span class="k">block</span> <span class="nv">title</span> <span class="cp">%}</span>Sign up to Django Boards<span class="cp">{%</span> <span class="k">endblock</span> <span class="cp">%}</span>

<span class="cp">{%</span> <span class="k">block</span> <span class="nv">content</span> <span class="cp">%}</span>
  <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"row justify-content-center"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"col-lg-8 col-md-10 col-sm-12"</span><span class="nt">&gt;</span>
      <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"card"</span><span class="nt">&gt;</span>
        <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"card-body"</span><span class="nt">&gt;</span>
          <span class="nt">&lt;h3</span> <span class="na">class=</span><span class="s">"card-title"</span><span class="nt">&gt;</span>Sign up<span class="nt">&lt;/h3&gt;</span>
          <span class="nt">&lt;form</span> <span class="na">method=</span><span class="s">"post"</span> <span class="na">novalidate</span><span class="nt">&gt;</span>
            <span class="cp">{%</span> <span class="nv">csrf_token</span> <span class="cp">%}</span>
            <span class="cp">{%</span> <span class="k">include</span> <span class="s1">'includes/form.html'</span> <span class="cp">%}</span>
            <span class="nt">&lt;button</span> <span class="na">type=</span><span class="s">"submit"</span> <span class="na">class=</span><span class="s">"btn btn-primary btn-block"</span><span class="nt">&gt;</span>Create an account<span class="nt">&lt;/button&gt;</span>
          <span class="nt">&lt;/form&gt;</span>
        <span class="nt">&lt;/div&gt;</span>
        <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"card-footer text-muted text-center"</span><span class="nt">&gt;</span>
          Already have an account? <span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">"</span><span class="cp">{%</span> <span class="nv">url</span> <span class="s1">'login'</span> <span class="cp">%}</span><span class="s">"</span><span class="nt">&gt;</span>Log in<span class="nt">&lt;/a&gt;</span>
        <span class="nt">&lt;/div&gt;</span>
      <span class="nt">&lt;/div&gt;</span>
    <span class="nt">&lt;/div&gt;</span>
  <span class="nt">&lt;/div&gt;</span>
<span class="cp">{%</span> <span class="k">endblock</span> <span class="cp">%}</span></code></pre></figure>

<p>Notice that we added the log in URL: <code class="highlighter-rouge">&lt;a href="{% url 'login' %}"&gt;Log in&lt;/a&gt;</code>.</p>

<h5 id="log-in-non-field-errors">Log In Non Field Errors</h5>

<p>If we submit the log in form empty, we get some nice error messages:</p>

<p><img src="../../../../media/series/beginners-guide/1.11/part-4/login-1.jpg" alt="Login" /></p>

<p>But if we submit an username that doesn’t exist or an invalid password, right now that’s what’s going to happen:</p>

<p><img src="../../../../media/series/beginners-guide/1.11/part-4/login-2.jpg" alt="Login" /></p>

<p>A little bit misleading. The fields are showing green, suggesting they are okay. Also, there’s no message saying
anything.</p>

<p>That’s because forms have a special type of error, which is called <strong>non-field errors</strong>. It’s a collection of errors
that are not related to a specific field. Let’s refactor the <strong>form.html</strong> partial template to display those errors as
well:</p>

<p><strong>templates/includes/form.html</strong></p>

<figure class="highlight"><pre><code class="language-django" data-lang="django"><span class="cp">{%</span> <span class="nv">load</span> <span class="nv">widget_tweaks</span> <span class="cp">%}</span>

<span class="cp">{%</span> <span class="k">if</span> <span class="nv">form.non_field_errors</span> <span class="cp">%}</span>
  <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"alert alert-danger"</span> <span class="na">role=</span><span class="s">"alert"</span><span class="nt">&gt;</span>
    <span class="cp">{%</span> <span class="k">for</span> <span class="nv">error</span> <span class="ow">in</span> <span class="nv">form.non_field_errors</span> <span class="cp">%}</span>
      <span class="nt">&lt;p</span><span class="cp">{%</span> <span class="k">if</span> <span class="nv">forloop.last</span> <span class="cp">%}</span> <span class="na">class=</span><span class="s">"mb-0"</span><span class="cp">{%</span> <span class="k">endif</span> <span class="cp">%}</span><span class="nt">&gt;</span><span class="cp">{{</span> <span class="nv">error</span> <span class="cp">}}</span><span class="nt">&lt;/p&gt;</span>
    <span class="cp">{%</span> <span class="k">endfor</span> <span class="cp">%}</span>
  <span class="nt">&lt;/div&gt;</span>
<span class="cp">{%</span> <span class="k">endif</span> <span class="cp">%}</span>

<span class="cp">{%</span> <span class="k">for</span> <span class="nv">field</span> <span class="ow">in</span> <span class="nv">form</span> <span class="cp">%}</span>
  <span class="c">&lt;!-- code suppressed --&gt;</span>
<span class="cp">{%</span> <span class="k">endfor</span> <span class="cp">%}</span></code></pre></figure>

<p>The <code class="highlighter-rouge"><span class="p">{</span><span class="err">%</span><span class="w"> </span><span class="err">if</span><span class="w"> </span><span class="err">forloop.last</span><span class="w"> </span><span class="err">%</span><span class="p">}</span></code> is just a minor thing. Because the <code class="highlighter-rouge">p</code> tag has a <code class="highlighter-rouge">margin-bottom</code>.
And a form may have several non-field errors. For each non-field error, we render a <code class="highlighter-rouge">p</code> tag with the error. Then
I’m checking if it’s the last error to render. If so, we add a Bootstrap 4 CSS class <code class="highlighter-rouge">mb-0</code> which stands for
“margin bottom = 0”. Then the alert doesn’t look weird, with some extra space. Again, just a very minor detail. I did
that just to keep the consistency of the spacing.</p>

<p><img src="../../../../media/series/beginners-guide/1.11/part-4/login-3.jpg" alt="Login" /></p>

<p>We still have to deal with the password field though. The thing is, Django never returned the data of password fields
to the client. So, instead of trying to do something smart, let’s just ignore the <code class="highlighter-rouge">is-valid</code> and <code class="highlighter-rouge">is-invalid</code> CSS
classes in some cases. But our form template already looks complicated. We can move some of the code to a
<strong>template tag</strong>.</p>

<h5 id="creating-custom-template-tags">Creating Custom Template Tags</h5>

<p>Inside the <strong>boards</strong> app, create a new folder named <strong>templatetags</strong>. Then inside this folder, create two empty files
named <strong>__init__.py</strong> and <strong>form_tags.py</strong>.</p>

<p>The structure should be the following:</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash">myproject/
 |-- myproject/
 |    |-- accounts/
 |    |-- boards/
 |    |    |-- migrations/
 |    |    |-- templatetags/        &lt;-- here
 |    |    |    |-- __init__.py
 |    |    |    +-- form_tags.py
 |    |    |-- __init__.py
 |    |    |-- admin.py
 |    |    |-- apps.py
 |    |    |-- models.py
 |    |    |-- tests.py
 |    |    +-- views.py
 |    |-- myproject/
 |    |-- static/
 |    |-- templates/
 |    |-- db.sqlite3
 |    +-- manage.py
 +-- venv/</code></pre></figure>

<p>In the <strong>form_tags.py</strong> file, let’s create two template tags:</p>

<p><strong>boards/templatetags/form_tags.py</strong></p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="kn">from</span> <span class="nn">django</span> <span class="kn">import</span> <span class="n">template</span>

<span class="n">register</span> <span class="o">=</span> <span class="n">template</span><span class="o">.</span><span class="n">Library</span><span class="p">()</span>

<span class="nd">@register.filter</span>
<span class="k">def</span> <span class="nf">field_type</span><span class="p">(</span><span class="n">bound_field</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">bound_field</span><span class="o">.</span><span class="n">field</span><span class="o">.</span><span class="n">widget</span><span class="o">.</span><span class="n">__class__</span><span class="o">.</span><span class="n">__name__</span>

<span class="nd">@register.filter</span>
<span class="k">def</span> <span class="nf">input_class</span><span class="p">(</span><span class="n">bound_field</span><span class="p">):</span>
    <span class="n">css_class</span> <span class="o">=</span> <span class="s">''</span>
    <span class="k">if</span> <span class="n">bound_field</span><span class="o">.</span><span class="n">form</span><span class="o">.</span><span class="n">is_bound</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">bound_field</span><span class="o">.</span><span class="n">errors</span><span class="p">:</span>
            <span class="n">css_class</span> <span class="o">=</span> <span class="s">'is-invalid'</span>
        <span class="k">elif</span> <span class="n">field_type</span><span class="p">(</span><span class="n">bound_field</span><span class="p">)</span> <span class="o">!=</span> <span class="s">'PasswordInput'</span><span class="p">:</span>
            <span class="n">css_class</span> <span class="o">=</span> <span class="s">'is-valid'</span>
    <span class="k">return</span> <span class="s">'form-control {}'</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">css_class</span><span class="p">)</span></code></pre></figure>

<p>Those are <em>template filters</em>. They work like this:</p>

<p>First, we load it in a template as we do with the <strong>widget_tweaks</strong> or <strong>static</strong> template tags. Note that after
creating this file, you will have to manually stop the development server and start it again so Django can identify
the new template tags.</p>

<figure class="highlight"><pre><code class="language-django" data-lang="django"><span class="cp">{%</span> <span class="nv">load</span> <span class="nv">form_tags</span> <span class="cp">%}</span></code></pre></figure>

<p>Then after that, we can use them in a template:</p>

<figure class="highlight"><pre><code class="language-django" data-lang="django"><span class="cp">{{</span> <span class="nv">form.username</span><span class="o">|</span><span class="nf">field_type</span> <span class="cp">}}</span></code></pre></figure>

<p>Will return:</p>

<figure class="highlight"><pre><code class="language-django" data-lang="django">'TextInput'</code></pre></figure>

<p>Or in case of the <strong>input_class</strong>:</p>

<figure class="highlight"><pre><code class="language-django" data-lang="django"><span class="cp">{{</span> <span class="nv">form.username</span><span class="o">|</span><span class="nf">input_class</span> <span class="cp">}}</span>

<span class="c">&lt;!-- if the form is not bound, it will simply return: --&gt;</span>
'form-control '

<span class="c">&lt;!-- if the form is bound and valid: --&gt;</span>
'form-control is-valid'

<span class="c">&lt;!-- if the form is bound and invalid: --&gt;</span>
'form-control is-invalid'</code></pre></figure>

<p>Now update the <strong>form.html</strong> to use the new template tags:</p>

<p><strong>templates/includes/form.html</strong></p>

<figure class="highlight"><pre><code class="language-django" data-lang="django"><span class="cp">{%</span> <span class="nv">load</span> <span class="nv">form_tags</span> <span class="nv">widget_tweaks</span> <span class="cp">%}</span>

<span class="cp">{%</span> <span class="k">if</span> <span class="nv">form.non_field_errors</span> <span class="cp">%}</span>
  <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"alert alert-danger"</span> <span class="na">role=</span><span class="s">"alert"</span><span class="nt">&gt;</span>
    <span class="cp">{%</span> <span class="k">for</span> <span class="nv">error</span> <span class="ow">in</span> <span class="nv">form.non_field_errors</span> <span class="cp">%}</span>
      <span class="nt">&lt;p</span><span class="cp">{%</span> <span class="k">if</span> <span class="nv">forloop.last</span> <span class="cp">%}</span> <span class="na">class=</span><span class="s">"mb-0"</span><span class="cp">{%</span> <span class="k">endif</span> <span class="cp">%}</span><span class="nt">&gt;</span><span class="cp">{{</span> <span class="nv">error</span> <span class="cp">}}</span><span class="nt">&lt;/p&gt;</span>
    <span class="cp">{%</span> <span class="k">endfor</span> <span class="cp">%}</span>
  <span class="nt">&lt;/div&gt;</span>
<span class="cp">{%</span> <span class="k">endif</span> <span class="cp">%}</span>

<span class="cp">{%</span> <span class="k">for</span> <span class="nv">field</span> <span class="ow">in</span> <span class="nv">form</span> <span class="cp">%}</span>
  <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"form-group"</span><span class="nt">&gt;</span>
    <span class="cp">{{</span> <span class="nv">field.label_tag</span> <span class="cp">}}</span>
    <span class="cp">{%</span> <span class="nv">render_field</span> <span class="nv">field</span> <span class="nv">class</span><span class="err">=</span><span class="nv">field</span><span class="o">|</span><span class="nf">input_class</span> <span class="cp">%}</span>
    <span class="cp">{%</span> <span class="k">for</span> <span class="nv">error</span> <span class="ow">in</span> <span class="nv">field.errors</span> <span class="cp">%}</span>
      <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"invalid-feedback"</span><span class="nt">&gt;</span>
        <span class="cp">{{</span> <span class="nv">error</span> <span class="cp">}}</span>
      <span class="nt">&lt;/div&gt;</span>
    <span class="cp">{%</span> <span class="k">endfor</span> <span class="cp">%}</span>
    <span class="cp">{%</span> <span class="k">if</span> <span class="nv">field.help_text</span> <span class="cp">%}</span>
      <span class="nt">&lt;small</span> <span class="na">class=</span><span class="s">"form-text text-muted"</span><span class="nt">&gt;</span>
        <span class="cp">{{</span> <span class="nv">field.help_text</span><span class="o">|</span><span class="nf">safe</span> <span class="cp">}}</span>
      <span class="nt">&lt;/small&gt;</span>
    <span class="cp">{%</span> <span class="k">endif</span> <span class="cp">%}</span>
  <span class="nt">&lt;/div&gt;</span>
<span class="cp">{%</span> <span class="k">endfor</span> <span class="cp">%}</span></code></pre></figure>

<p>Much better, right? Reduced the complexity of the template. It looks cleaner now. And it also solved the problem with
the password field displaying a green border:</p>

<p><img src="../../../../media/series/beginners-guide/1.11/part-4/login-4.jpg" alt="Login" /></p>

<h5 id="testing-the-template-tags">Testing the Template Tags</h5>

<p>First, let’s just organize the <strong>boards’</strong> tests a little bit. Like we did with the <strong>accounts</strong> app, create a new folder
named <strong>tests</strong>, add a <strong>__init__.py</strong>, copy the <strong>tests.py</strong> and rename it to just <strong>test_views.py</strong> for now.</p>

<p>Add a new empty file named <strong>test_templatetags.py</strong>.</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash">myproject/
 |-- myproject/
 |    |-- accounts/
 |    |-- boards/
 |    |    |-- migrations/
 |    |    |-- templatetags/
 |    |    |-- tests/
 |    |    |    |-- __init__.py
 |    |    |    |-- test_templatetags.py  &lt;-- new file, empty <span class="k">for </span>now
 |    |    |    +-- test_views.py  &lt;-- our old file with all the tests
 |    |    |-- __init__.py
 |    |    |-- admin.py
 |    |    |-- apps.py
 |    |    |-- models.py
 |    |    +-- views.py
 |    |-- myproject/
 |    |-- static/
 |    |-- templates/
 |    |-- db.sqlite3
 |    +-- manage.py
 +-- venv/</code></pre></figure>

<p>Fix the <strong>test_views.py</strong> imports:</p>

<p><strong>boards/tests/test_views.py</strong></p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="kn">from</span> <span class="nn">..views</span> <span class="kn">import</span> <span class="n">home</span><span class="p">,</span> <span class="n">board_topics</span><span class="p">,</span> <span class="n">new_topic</span>
<span class="kn">from</span> <span class="nn">..models</span> <span class="kn">import</span> <span class="n">Board</span><span class="p">,</span> <span class="n">Topic</span><span class="p">,</span> <span class="n">Post</span>
<span class="kn">from</span> <span class="nn">..forms</span> <span class="kn">import</span> <span class="n">NewTopicForm</span></code></pre></figure>

<p>Execute the tests just to make sure everything is working.</p>

<p><strong>boards/tests/test_templatetags.py</strong></p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="kn">from</span> <span class="nn">django</span> <span class="kn">import</span> <span class="n">forms</span>
<span class="kn">from</span> <span class="nn">django.test</span> <span class="kn">import</span> <span class="n">TestCase</span>
<span class="kn">from</span> <span class="nn">..templatetags.form_tags</span> <span class="kn">import</span> <span class="n">field_type</span><span class="p">,</span> <span class="n">input_class</span>

<span class="k">class</span> <span class="nc">ExampleForm</span><span class="p">(</span><span class="n">forms</span><span class="o">.</span><span class="n">Form</span><span class="p">):</span>
    <span class="n">name</span> <span class="o">=</span> <span class="n">forms</span><span class="o">.</span><span class="n">CharField</span><span class="p">()</span>
    <span class="n">password</span> <span class="o">=</span> <span class="n">forms</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">widget</span><span class="o">=</span><span class="n">forms</span><span class="o">.</span><span class="n">PasswordInput</span><span class="p">())</span>
    <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
        <span class="n">fields</span> <span class="o">=</span> <span class="p">(</span><span class="s">'name'</span><span class="p">,</span> <span class="s">'password'</span><span class="p">)</span>

<span class="k">class</span> <span class="nc">FieldTypeTests</span><span class="p">(</span><span class="n">TestCase</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">test_field_widget_type</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">form</span> <span class="o">=</span> <span class="n">ExampleForm</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="s">'TextInput'</span><span class="p">,</span> <span class="n">field_type</span><span class="p">(</span><span class="n">form</span><span class="p">[</span><span class="s">'name'</span><span class="p">]))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="s">'PasswordInput'</span><span class="p">,</span> <span class="n">field_type</span><span class="p">(</span><span class="n">form</span><span class="p">[</span><span class="s">'password'</span><span class="p">]))</span>

<span class="k">class</span> <span class="nc">InputClassTests</span><span class="p">(</span><span class="n">TestCase</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">test_unbound_field_initial_state</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">form</span> <span class="o">=</span> <span class="n">ExampleForm</span><span class="p">()</span>  <span class="c"># unbound form</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="s">'form-control '</span><span class="p">,</span> <span class="n">input_class</span><span class="p">(</span><span class="n">form</span><span class="p">[</span><span class="s">'name'</span><span class="p">]))</span>

    <span class="k">def</span> <span class="nf">test_valid_bound_field</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">form</span> <span class="o">=</span> <span class="n">ExampleForm</span><span class="p">({</span><span class="s">'name'</span><span class="p">:</span> <span class="s">'john'</span><span class="p">,</span> <span class="s">'password'</span><span class="p">:</span> <span class="s">'123'</span><span class="p">})</span>  <span class="c"># bound form (field + data)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="s">'form-control is-valid'</span><span class="p">,</span> <span class="n">input_class</span><span class="p">(</span><span class="n">form</span><span class="p">[</span><span class="s">'name'</span><span class="p">]))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="s">'form-control '</span><span class="p">,</span> <span class="n">input_class</span><span class="p">(</span><span class="n">form</span><span class="p">[</span><span class="s">'password'</span><span class="p">]))</span>

    <span class="k">def</span> <span class="nf">test_invalid_bound_field</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">form</span> <span class="o">=</span> <span class="n">ExampleForm</span><span class="p">({</span><span class="s">'name'</span><span class="p">:</span> <span class="s">''</span><span class="p">,</span> <span class="s">'password'</span><span class="p">:</span> <span class="s">'123'</span><span class="p">})</span>  <span class="c"># bound form (field + data)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="s">'form-control is-invalid'</span><span class="p">,</span> <span class="n">input_class</span><span class="p">(</span><span class="n">form</span><span class="p">[</span><span class="s">'name'</span><span class="p">]))</span></code></pre></figure>

<p>We created a form class to be used in the tests then added test cases covering the possible scenarios in the two
template tags.</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash">python manage.py <span class="nb">test</span></code></pre></figure>

<figure class="highlight"><pre><code class="language-text" data-lang="text">Creating test database for alias 'default'...
System check identified no issues (0 silenced).
................................
----------------------------------------------------------------------
Ran 32 tests in 0.846s

OK
Destroying test database for alias 'default'...</code></pre></figure>

<hr />

<h4 id="password-reset">Password Reset</h4>

<p>The password reset process involves some nasty URL patterns. But as we discussed in the previous tutorial, we don’t
need to be an expert in regular expressions. It’s just a matter of knowing the common ones.</p>

<p>Another important thing before we start is that, for the password reset process, we need to send emails. It’s a little
bit complicated in the beginning because we need an external service. For now, we won’t be configuring a production
quality email service. In fact, during the development phase, we can use Django’s debug tools to check if the emails
are being sent correctly.</p>

<p><img src="../../../../media/series/beginners-guide/1.11/part-4/Pixton_Comic_Email.png" alt="Comic Email" /></p>

<h5 id="console-email-backend">Console Email Backend</h5>

<p>The idea is during the development of the project, instead of sending real emails, we just log them. There are
two options: writing all emails in a text file or simply displaying them in the console. I find the latter option more
convenient because we are already using a console to run the development server and the setup is a bit easier.</p>

<p>Edit the <strong>settings.py</strong> module and add the <code class="highlighter-rouge">EMAIL_BACKEND</code> variable to the end of the file:</p>

<p><strong>myproject/settings.py</strong></p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">EMAIL_BACKEND</span> <span class="o">=</span> <span class="s">'django.core.mail.backends.console.EmailBackend'</span></code></pre></figure>

<h5 id="configuring-the-routes">Configuring the Routes</h5>

<p>The password reset process requires four views:</p>

<ul>
  <li>A page with a form to start the reset process;</li>
  <li>A success page saying the process initiated, instructing the user to check their spam folders, etc.;</li>
  <li>A page to check the token sent via email;</li>
  <li>A page to tell the user if the reset was successful or not.</li>
</ul>

<p>The views are built-in, we don’t need to implement anything. All we need to do is add the routes to the <strong>urls.py</strong>
and create the templates.</p>

<p><strong>myproject/urls.py</strong>
<small><a href="https://gist.github.com/vitorfs/117e300e00d5685f7186e09260f82736#file-urls-py-L14" target="_blank" rel="noopener nofollow">(view complete file contents)</a></small></p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">url</span><span class="p">(</span><span class="s">r'^reset/$'</span><span class="p">,</span>
    <span class="n">auth_views</span><span class="o">.</span><span class="n">PasswordResetView</span><span class="o">.</span><span class="n">as_view</span><span class="p">(</span>
        <span class="n">template_name</span><span class="o">=</span><span class="s">'password_reset.html'</span><span class="p">,</span>
        <span class="n">email_template_name</span><span class="o">=</span><span class="s">'password_reset_email.html'</span><span class="p">,</span>
        <span class="n">subject_template_name</span><span class="o">=</span><span class="s">'password_reset_subject.txt'</span>
    <span class="p">),</span>
    <span class="n">name</span><span class="o">=</span><span class="s">'password_reset'</span><span class="p">),</span>
<span class="n">url</span><span class="p">(</span><span class="s">r'^reset/done/$'</span><span class="p">,</span>
    <span class="n">auth_views</span><span class="o">.</span><span class="n">PasswordResetDoneView</span><span class="o">.</span><span class="n">as_view</span><span class="p">(</span><span class="n">template_name</span><span class="o">=</span><span class="s">'password_reset_done.html'</span><span class="p">),</span>
    <span class="n">name</span><span class="o">=</span><span class="s">'password_reset_done'</span><span class="p">),</span>
<span class="n">url</span><span class="p">(</span><span class="s">r'^reset/(?P&lt;uidb64&gt;[0-9A-Za-z_</span><span class="err">\</span><span class="s">-]+)/(?P&lt;token&gt;[0-9A-Za-z]{1,13}-[0-9A-Za-z]{1,20})/$'</span><span class="p">,</span>
    <span class="n">auth_views</span><span class="o">.</span><span class="n">PasswordResetConfirmView</span><span class="o">.</span><span class="n">as_view</span><span class="p">(</span><span class="n">template_name</span><span class="o">=</span><span class="s">'password_reset_confirm.html'</span><span class="p">),</span>
    <span class="n">name</span><span class="o">=</span><span class="s">'password_reset_confirm'</span><span class="p">),</span>
<span class="n">url</span><span class="p">(</span><span class="s">r'^reset/complete/$'</span><span class="p">,</span>
    <span class="n">auth_views</span><span class="o">.</span><span class="n">PasswordResetCompleteView</span><span class="o">.</span><span class="n">as_view</span><span class="p">(</span><span class="n">template_name</span><span class="o">=</span><span class="s">'password_reset_complete.html'</span><span class="p">),</span>
    <span class="n">name</span><span class="o">=</span><span class="s">'password_reset_complete'</span><span class="p">),</span>
<span class="p">]</span></code></pre></figure>

<p>The <code class="highlighter-rouge">template_name</code> parameter in the password reset views are optional. But I thought it would be a good idea to
re-define it, so the link between the view and the template be more obvious than just using the defaults.</p>

<p>Inside the <strong>templates</strong> folder, the following template files:</p>

<ul>
  <li><strong>password_reset.html</strong></li>
  <li><strong>password_reset_email.html</strong>: this template is the body of the email message sent to the user</li>
  <li><strong>password_reset_subject.txt</strong>: this template is the subject line of the email, it should be a single line file</li>
  <li><strong>password_reset_done.html</strong></li>
  <li><strong>password_reset_confirm.html</strong></li>
  <li><strong>password_reset_complete.html</strong></li>
</ul>

<p>Before we start implementing the templates, let’s prepare a new test file.</p>

<p>We can add just some basic tests because those views and forms are already tested in the Django code. We are going to
test just the specifics of our application.</p>

<p>Create a new test file named <strong>test_view_password_reset.py</strong> inside the <strong>accounts/tests</strong> folder.</p>

<h5 id="password-reset-view">Password Reset View</h5>

<p><strong>templates/password_reset.html</strong></p>

<figure class="highlight"><pre><code class="language-django" data-lang="django"><span class="cp">{%</span> <span class="k">extends</span> <span class="s1">'base_accounts.html'</span> <span class="cp">%}</span>

<span class="cp">{%</span> <span class="k">block</span> <span class="nv">title</span> <span class="cp">%}</span>Reset your password<span class="cp">{%</span> <span class="k">endblock</span> <span class="cp">%}</span>

<span class="cp">{%</span> <span class="k">block</span> <span class="nv">content</span> <span class="cp">%}</span>
  <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"row justify-content-center"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"col-lg-4 col-md-6 col-sm-8"</span><span class="nt">&gt;</span>
      <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"card"</span><span class="nt">&gt;</span>
        <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"card-body"</span><span class="nt">&gt;</span>
          <span class="nt">&lt;h3</span> <span class="na">class=</span><span class="s">"card-title"</span><span class="nt">&gt;</span>Reset your password<span class="nt">&lt;/h3&gt;</span>
          <span class="nt">&lt;p&gt;</span>Enter your email address and we will send you a link to reset your password.<span class="nt">&lt;/p&gt;</span>
          <span class="nt">&lt;form</span> <span class="na">method=</span><span class="s">"post"</span> <span class="na">novalidate</span><span class="nt">&gt;</span>
            <span class="cp">{%</span> <span class="nv">csrf_token</span> <span class="cp">%}</span>
            <span class="cp">{%</span> <span class="k">include</span> <span class="s1">'includes/form.html'</span> <span class="cp">%}</span>
            <span class="nt">&lt;button</span> <span class="na">type=</span><span class="s">"submit"</span> <span class="na">class=</span><span class="s">"btn btn-primary btn-block"</span><span class="nt">&gt;</span>Send password reset email<span class="nt">&lt;/button&gt;</span>
          <span class="nt">&lt;/form&gt;</span>
        <span class="nt">&lt;/div&gt;</span>
      <span class="nt">&lt;/div&gt;</span>
    <span class="nt">&lt;/div&gt;</span>
  <span class="nt">&lt;/div&gt;</span>
<span class="cp">{%</span> <span class="k">endblock</span> <span class="cp">%}</span></code></pre></figure>

<p><img src="../../../../media/series/beginners-guide/1.11/part-4/password_reset.jpg" alt="Password Reset" /></p>

<p><strong>accounts/tests/test_view_password_reset.py</strong></p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="kn">from</span> <span class="nn">django.contrib.auth</span> <span class="kn">import</span> <span class="n">views</span> <span class="k">as</span> <span class="n">auth_views</span>
<span class="kn">from</span> <span class="nn">django.contrib.auth.forms</span> <span class="kn">import</span> <span class="n">PasswordResetForm</span>
<span class="kn">from</span> <span class="nn">django.contrib.auth.models</span> <span class="kn">import</span> <span class="n">User</span>
<span class="kn">from</span> <span class="nn">django.core</span> <span class="kn">import</span> <span class="n">mail</span>
<span class="kn">from</span> <span class="nn">django.core.urlresolvers</span> <span class="kn">import</span> <span class="n">reverse</span>
<span class="kn">from</span> <span class="nn">django.urls</span> <span class="kn">import</span> <span class="n">resolve</span>
<span class="kn">from</span> <span class="nn">django.test</span> <span class="kn">import</span> <span class="n">TestCase</span>


<span class="k">class</span> <span class="nc">PasswordResetTests</span><span class="p">(</span><span class="n">TestCase</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">setUp</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">url</span> <span class="o">=</span> <span class="n">reverse</span><span class="p">(</span><span class="s">'password_reset'</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">test_status_code</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">response</span><span class="o">.</span><span class="n">status_code</span><span class="p">,</span> <span class="mi">200</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">test_view_function</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">view</span> <span class="o">=</span> <span class="n">resolve</span><span class="p">(</span><span class="s">'/reset/'</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">view</span><span class="o">.</span><span class="n">func</span><span class="o">.</span><span class="n">view_class</span><span class="p">,</span> <span class="n">auth_views</span><span class="o">.</span><span class="n">PasswordResetView</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">test_csrf</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertContains</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">response</span><span class="p">,</span> <span class="s">'csrfmiddlewaretoken'</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">test_contains_form</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">form</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">response</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">'form'</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIsInstance</span><span class="p">(</span><span class="n">form</span><span class="p">,</span> <span class="n">PasswordResetForm</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">test_form_inputs</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="s">'''
        The view must contain two inputs: csrf and email
        '''</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertContains</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">response</span><span class="p">,</span> <span class="s">'&lt;input'</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertContains</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">response</span><span class="p">,</span> <span class="s">'type="email"'</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">SuccessfulPasswordResetTests</span><span class="p">(</span><span class="n">TestCase</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">setUp</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">email</span> <span class="o">=</span> <span class="s">'john@doe.com'</span>
        <span class="n">User</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">create_user</span><span class="p">(</span><span class="n">username</span><span class="o">=</span><span class="s">'john'</span><span class="p">,</span> <span class="n">email</span><span class="o">=</span><span class="n">email</span><span class="p">,</span> <span class="n">password</span><span class="o">=</span><span class="s">'123abcdef'</span><span class="p">)</span>
        <span class="n">url</span> <span class="o">=</span> <span class="n">reverse</span><span class="p">(</span><span class="s">'password_reset'</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="p">{</span><span class="s">'email'</span><span class="p">:</span> <span class="n">email</span><span class="p">})</span>

    <span class="k">def</span> <span class="nf">test_redirection</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="s">'''
        A valid form submission should redirect the user to `password_reset_done` view
        '''</span>
        <span class="n">url</span> <span class="o">=</span> <span class="n">reverse</span><span class="p">(</span><span class="s">'password_reset_done'</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertRedirects</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">response</span><span class="p">,</span> <span class="n">url</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">test_send_password_reset_email</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">mail</span><span class="o">.</span><span class="n">outbox</span><span class="p">))</span>


<span class="k">class</span> <span class="nc">InvalidPasswordResetTests</span><span class="p">(</span><span class="n">TestCase</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">setUp</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">url</span> <span class="o">=</span> <span class="n">reverse</span><span class="p">(</span><span class="s">'password_reset'</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="p">{</span><span class="s">'email'</span><span class="p">:</span> <span class="s">'donotexist@email.com'</span><span class="p">})</span>

    <span class="k">def</span> <span class="nf">test_redirection</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="s">'''
        Even invalid emails in the database should
        redirect the user to `password_reset_done` view
        '''</span>
        <span class="n">url</span> <span class="o">=</span> <span class="n">reverse</span><span class="p">(</span><span class="s">'password_reset_done'</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertRedirects</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">response</span><span class="p">,</span> <span class="n">url</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">test_no_reset_email_sent</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">mail</span><span class="o">.</span><span class="n">outbox</span><span class="p">))</span></code></pre></figure>

<p><strong>templates/password_reset_subject.txt</strong></p>

<figure class="highlight"><pre><code class="language-django" data-lang="django">[Django Boards] Please reset your password</code></pre></figure>

<p><strong>templates/password_reset_email.html</strong></p>

<figure class="highlight"><pre><code class="language-django" data-lang="django">Hi there,

Someone asked for a password reset for the email address <span class="cp">{{</span> <span class="nv">email</span> <span class="cp">}}</span>.
Follow the link below:
<span class="cp">{{</span> <span class="nv">protocol</span> <span class="cp">}}</span>://<span class="cp">{{</span> <span class="nv">domain</span> <span class="cp">}}{%</span> <span class="nv">url</span> <span class="s1">'password_reset_confirm'</span> <span class="nv">uidb64</span><span class="err">=</span><span class="nv">uid</span> <span class="nv">token</span><span class="err">=</span><span class="nv">token</span> <span class="cp">%}</span>

In case you forgot your Django Boards username: <span class="cp">{{</span> <span class="nv">user.username</span> <span class="cp">}}</span>

If clicking the link above doesn't work, please copy and paste the URL
in a new browser window instead.

If you've received this mail in error, it's likely that another user entered
your email address by mistake while trying to reset a password. If you didn't
initiate the request, you don't need to take any further action and can safely
disregard this email.

Thanks,

The Django Boards Team</code></pre></figure>

<p><img src="../../../../media/series/beginners-guide/1.11/part-4/password_reset_email.png" alt="Password Reset Email" /></p>

<p>We can create a specific file to test the email message. Create a new file named <strong>test_mail_password_reset.py</strong>
inside the <strong>accounts/tests</strong> folder:</p>

<p><strong>accounts/tests/test_mail_password_reset.py</strong></p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="kn">from</span> <span class="nn">django.core</span> <span class="kn">import</span> <span class="n">mail</span>
<span class="kn">from</span> <span class="nn">django.contrib.auth.models</span> <span class="kn">import</span> <span class="n">User</span>
<span class="kn">from</span> <span class="nn">django.urls</span> <span class="kn">import</span> <span class="n">reverse</span>
<span class="kn">from</span> <span class="nn">django.test</span> <span class="kn">import</span> <span class="n">TestCase</span>

<span class="k">class</span> <span class="nc">PasswordResetMailTests</span><span class="p">(</span><span class="n">TestCase</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">setUp</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">User</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">create_user</span><span class="p">(</span><span class="n">username</span><span class="o">=</span><span class="s">'john'</span><span class="p">,</span> <span class="n">email</span><span class="o">=</span><span class="s">'john@doe.com'</span><span class="p">,</span> <span class="n">password</span><span class="o">=</span><span class="s">'123'</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="n">reverse</span><span class="p">(</span><span class="s">'password_reset'</span><span class="p">),</span> <span class="p">{</span> <span class="s">'email'</span><span class="p">:</span> <span class="s">'john@doe.com'</span> <span class="p">})</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">email</span> <span class="o">=</span> <span class="n">mail</span><span class="o">.</span><span class="n">outbox</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">test_email_subject</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="s">'[Django Boards] Please reset your password'</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">email</span><span class="o">.</span><span class="n">subject</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">test_email_body</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">context</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">response</span><span class="o">.</span><span class="n">context</span>
        <span class="n">token</span> <span class="o">=</span> <span class="n">context</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">'token'</span><span class="p">)</span>
        <span class="n">uid</span> <span class="o">=</span> <span class="n">context</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">'uid'</span><span class="p">)</span>
        <span class="n">password_reset_token_url</span> <span class="o">=</span> <span class="n">reverse</span><span class="p">(</span><span class="s">'password_reset_confirm'</span><span class="p">,</span> <span class="n">kwargs</span><span class="o">=</span><span class="p">{</span>
            <span class="s">'uidb64'</span><span class="p">:</span> <span class="n">uid</span><span class="p">,</span>
            <span class="s">'token'</span><span class="p">:</span> <span class="n">token</span>
        <span class="p">})</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIn</span><span class="p">(</span><span class="n">password_reset_token_url</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">email</span><span class="o">.</span><span class="n">body</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIn</span><span class="p">(</span><span class="s">'john'</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">email</span><span class="o">.</span><span class="n">body</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIn</span><span class="p">(</span><span class="s">'john@doe.com'</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">email</span><span class="o">.</span><span class="n">body</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">test_email_to</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">([</span><span class="s">'john@doe.com'</span><span class="p">,],</span> <span class="bp">self</span><span class="o">.</span><span class="n">email</span><span class="o">.</span><span class="n">to</span><span class="p">)</span></code></pre></figure>

<p>This test case grabs the email sent by the application, and examine the subject line, the body contents, and to who
was the email sent to.</p>

<h5 id="password-reset-done-view">Password Reset Done View</h5>

<p><strong>templates/password_reset_done.html</strong></p>

<figure class="highlight"><pre><code class="language-django" data-lang="django"><span class="cp">{%</span> <span class="k">extends</span> <span class="s1">'base_accounts.html'</span> <span class="cp">%}</span>

<span class="cp">{%</span> <span class="k">block</span> <span class="nv">title</span> <span class="cp">%}</span>Reset your password<span class="cp">{%</span> <span class="k">endblock</span> <span class="cp">%}</span>

<span class="cp">{%</span> <span class="k">block</span> <span class="nv">content</span> <span class="cp">%}</span>
  <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"row justify-content-center"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"col-lg-4 col-md-6 col-sm-8"</span><span class="nt">&gt;</span>
      <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"card"</span><span class="nt">&gt;</span>
        <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"card-body"</span><span class="nt">&gt;</span>
          <span class="nt">&lt;h3</span> <span class="na">class=</span><span class="s">"card-title"</span><span class="nt">&gt;</span>Reset your password<span class="nt">&lt;/h3&gt;</span>
          <span class="nt">&lt;p&gt;</span>Check your email for a link to reset your password. If it doesn't appear within a few minutes, check your spam folder.<span class="nt">&lt;/p&gt;</span>
          <span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">"</span><span class="cp">{%</span> <span class="nv">url</span> <span class="s1">'login'</span> <span class="cp">%}</span><span class="s">"</span> <span class="na">class=</span><span class="s">"btn btn-secondary btn-block"</span><span class="nt">&gt;</span>Return to log in<span class="nt">&lt;/a&gt;</span>
        <span class="nt">&lt;/div&gt;</span>
      <span class="nt">&lt;/div&gt;</span>
    <span class="nt">&lt;/div&gt;</span>
  <span class="nt">&lt;/div&gt;</span>
<span class="cp">{%</span> <span class="k">endblock</span> <span class="cp">%}</span></code></pre></figure>

<p><img src="../../../../media/series/beginners-guide/1.11/part-4/password_reset_done.jpg" alt="Password Reset Done" /></p>

<p><strong>accounts/tests/test_view_password_reset.py</strong></p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="kn">from</span> <span class="nn">django.contrib.auth</span> <span class="kn">import</span> <span class="n">views</span> <span class="k">as</span> <span class="n">auth_views</span>
<span class="kn">from</span> <span class="nn">django.core.urlresolvers</span> <span class="kn">import</span> <span class="n">reverse</span>
<span class="kn">from</span> <span class="nn">django.urls</span> <span class="kn">import</span> <span class="n">resolve</span>
<span class="kn">from</span> <span class="nn">django.test</span> <span class="kn">import</span> <span class="n">TestCase</span>

<span class="k">class</span> <span class="nc">PasswordResetDoneTests</span><span class="p">(</span><span class="n">TestCase</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">setUp</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">url</span> <span class="o">=</span> <span class="n">reverse</span><span class="p">(</span><span class="s">'password_reset_done'</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">test_status_code</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">response</span><span class="o">.</span><span class="n">status_code</span><span class="p">,</span> <span class="mi">200</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">test_view_function</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">view</span> <span class="o">=</span> <span class="n">resolve</span><span class="p">(</span><span class="s">'/reset/done/'</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">view</span><span class="o">.</span><span class="n">func</span><span class="o">.</span><span class="n">view_class</span><span class="p">,</span> <span class="n">auth_views</span><span class="o">.</span><span class="n">PasswordResetDoneView</span><span class="p">)</span></code></pre></figure>

<h5 id="password-reset-confirm-view">Password Reset Confirm View</h5>

<p><strong>templates/password_reset_confirm.html</strong></p>

<figure class="highlight"><pre><code class="language-django" data-lang="django"><span class="cp">{%</span> <span class="k">extends</span> <span class="s1">'base_accounts.html'</span> <span class="cp">%}</span>

<span class="cp">{%</span> <span class="k">block</span> <span class="nv">title</span> <span class="cp">%}</span>
  <span class="cp">{%</span> <span class="k">if</span> <span class="nv">validlink</span> <span class="cp">%}</span>
    Change password for <span class="cp">{{</span> <span class="nv">form.user.username</span> <span class="cp">}}</span>
  <span class="cp">{%</span> <span class="k">else</span> <span class="cp">%}</span>
    Reset your password
  <span class="cp">{%</span> <span class="k">endif</span> <span class="cp">%}</span>
<span class="cp">{%</span> <span class="k">endblock</span> <span class="cp">%}</span>

<span class="cp">{%</span> <span class="k">block</span> <span class="nv">content</span> <span class="cp">%}</span>
  <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"row justify-content-center"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"col-lg-6 col-md-8 col-sm-10"</span><span class="nt">&gt;</span>
      <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"card"</span><span class="nt">&gt;</span>
        <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"card-body"</span><span class="nt">&gt;</span>
          <span class="cp">{%</span> <span class="k">if</span> <span class="nv">validlink</span> <span class="cp">%}</span>
            <span class="nt">&lt;h3</span> <span class="na">class=</span><span class="s">"card-title"</span><span class="nt">&gt;</span>Change password for @<span class="cp">{{</span> <span class="nv">form.user.username</span> <span class="cp">}}</span><span class="nt">&lt;/h3&gt;</span>
            <span class="nt">&lt;form</span> <span class="na">method=</span><span class="s">"post"</span> <span class="na">novalidate</span><span class="nt">&gt;</span>
              <span class="cp">{%</span> <span class="nv">csrf_token</span> <span class="cp">%}</span>
              <span class="cp">{%</span> <span class="k">include</span> <span class="s1">'includes/form.html'</span> <span class="cp">%}</span>
              <span class="nt">&lt;button</span> <span class="na">type=</span><span class="s">"submit"</span> <span class="na">class=</span><span class="s">"btn btn-success btn-block"</span><span class="nt">&gt;</span>Change password<span class="nt">&lt;/button&gt;</span>
            <span class="nt">&lt;/form&gt;</span>
          <span class="cp">{%</span> <span class="k">else</span> <span class="cp">%}</span>
            <span class="nt">&lt;h3</span> <span class="na">class=</span><span class="s">"card-title"</span><span class="nt">&gt;</span>Reset your password<span class="nt">&lt;/h3&gt;</span>
            <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"alert alert-danger"</span> <span class="na">role=</span><span class="s">"alert"</span><span class="nt">&gt;</span>
              It looks like you clicked on an invalid password reset link. Please try again.
            <span class="nt">&lt;/div&gt;</span>
            <span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">"</span><span class="cp">{%</span> <span class="nv">url</span> <span class="s1">'password_reset'</span> <span class="cp">%}</span><span class="s">"</span> <span class="na">class=</span><span class="s">"btn btn-secondary btn-block"</span><span class="nt">&gt;</span>Request a new password reset link<span class="nt">&lt;/a&gt;</span>
          <span class="cp">{%</span> <span class="k">endif</span> <span class="cp">%}</span>
        <span class="nt">&lt;/div&gt;</span>
      <span class="nt">&lt;/div&gt;</span>
    <span class="nt">&lt;/div&gt;</span>
  <span class="nt">&lt;/div&gt;</span>
<span class="cp">{%</span> <span class="k">endblock</span> <span class="cp">%}</span></code></pre></figure>

<p>This page can only be accessed with the link sent in the email. It looks like this: <strong>http://127.0.0.1:8000/reset/Mw/4po-2b5f2d47c19966e294a1/</strong></p>

<p>During the development phase, grab this link from the email in the console.</p>

<p>If the link is valid:</p>

<p><img src="../../../../media/series/beginners-guide/1.11/part-4/password_reset_confirm_valid.jpg" alt="Password Reset Confirm Valid" /></p>

<p>Or if the link has already been used:</p>

<p><img src="../../../../media/series/beginners-guide/1.11/part-4/password_reset_confirm_invalid.jpg" alt="Password Reset Confirm Invalid" /></p>

<p><strong>accounts/tests/test_view_password_reset.py</strong></p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="kn">from</span> <span class="nn">django.contrib.auth.tokens</span> <span class="kn">import</span> <span class="n">default_token_generator</span>
<span class="kn">from</span> <span class="nn">django.utils.encoding</span> <span class="kn">import</span> <span class="n">force_bytes</span>
<span class="kn">from</span> <span class="nn">django.utils.http</span> <span class="kn">import</span> <span class="n">urlsafe_base64_encode</span>
<span class="kn">from</span> <span class="nn">django.contrib.auth</span> <span class="kn">import</span> <span class="n">views</span> <span class="k">as</span> <span class="n">auth_views</span>
<span class="kn">from</span> <span class="nn">django.contrib.auth.forms</span> <span class="kn">import</span> <span class="n">SetPasswordForm</span>
<span class="kn">from</span> <span class="nn">django.contrib.auth.models</span> <span class="kn">import</span> <span class="n">User</span>
<span class="kn">from</span> <span class="nn">django.core.urlresolvers</span> <span class="kn">import</span> <span class="n">reverse</span>
<span class="kn">from</span> <span class="nn">django.urls</span> <span class="kn">import</span> <span class="n">resolve</span>
<span class="kn">from</span> <span class="nn">django.test</span> <span class="kn">import</span> <span class="n">TestCase</span>


<span class="k">class</span> <span class="nc">PasswordResetConfirmTests</span><span class="p">(</span><span class="n">TestCase</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">setUp</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">user</span> <span class="o">=</span> <span class="n">User</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">create_user</span><span class="p">(</span><span class="n">username</span><span class="o">=</span><span class="s">'john'</span><span class="p">,</span> <span class="n">email</span><span class="o">=</span><span class="s">'john@doe.com'</span><span class="p">,</span> <span class="n">password</span><span class="o">=</span><span class="s">'123abcdef'</span><span class="p">)</span>

        <span class="s">'''
        create a valid password reset token
        based on how django creates the token internally:
        https://github.com/django/django/blob/1.11.5/django/contrib/auth/forms.py#L280
        '''</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">uid</span> <span class="o">=</span> <span class="n">urlsafe_base64_encode</span><span class="p">(</span><span class="n">force_bytes</span><span class="p">(</span><span class="n">user</span><span class="o">.</span><span class="n">pk</span><span class="p">))</span><span class="o">.</span><span class="n">decode</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">token</span> <span class="o">=</span> <span class="n">default_token_generator</span><span class="o">.</span><span class="n">make_token</span><span class="p">(</span><span class="n">user</span><span class="p">)</span>

        <span class="n">url</span> <span class="o">=</span> <span class="n">reverse</span><span class="p">(</span><span class="s">'password_reset_confirm'</span><span class="p">,</span> <span class="n">kwargs</span><span class="o">=</span><span class="p">{</span><span class="s">'uidb64'</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">uid</span><span class="p">,</span> <span class="s">'token'</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">token</span><span class="p">})</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">follow</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">test_status_code</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">response</span><span class="o">.</span><span class="n">status_code</span><span class="p">,</span> <span class="mi">200</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">test_view_function</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">view</span> <span class="o">=</span> <span class="n">resolve</span><span class="p">(</span><span class="s">'/reset/{uidb64}/{token}/'</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">uidb64</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">uid</span><span class="p">,</span> <span class="n">token</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">token</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">view</span><span class="o">.</span><span class="n">func</span><span class="o">.</span><span class="n">view_class</span><span class="p">,</span> <span class="n">auth_views</span><span class="o">.</span><span class="n">PasswordResetConfirmView</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">test_csrf</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertContains</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">response</span><span class="p">,</span> <span class="s">'csrfmiddlewaretoken'</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">test_contains_form</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">form</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">response</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">'form'</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIsInstance</span><span class="p">(</span><span class="n">form</span><span class="p">,</span> <span class="n">SetPasswordForm</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">test_form_inputs</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="s">'''
        The view must contain two inputs: csrf and two password fields
        '''</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertContains</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">response</span><span class="p">,</span> <span class="s">'&lt;input'</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertContains</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">response</span><span class="p">,</span> <span class="s">'type="password"'</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">InvalidPasswordResetConfirmTests</span><span class="p">(</span><span class="n">TestCase</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">setUp</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">user</span> <span class="o">=</span> <span class="n">User</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">create_user</span><span class="p">(</span><span class="n">username</span><span class="o">=</span><span class="s">'john'</span><span class="p">,</span> <span class="n">email</span><span class="o">=</span><span class="s">'john@doe.com'</span><span class="p">,</span> <span class="n">password</span><span class="o">=</span><span class="s">'123abcdef'</span><span class="p">)</span>
        <span class="n">uid</span> <span class="o">=</span> <span class="n">urlsafe_base64_encode</span><span class="p">(</span><span class="n">force_bytes</span><span class="p">(</span><span class="n">user</span><span class="o">.</span><span class="n">pk</span><span class="p">))</span><span class="o">.</span><span class="n">decode</span><span class="p">()</span>
        <span class="n">token</span> <span class="o">=</span> <span class="n">default_token_generator</span><span class="o">.</span><span class="n">make_token</span><span class="p">(</span><span class="n">user</span><span class="p">)</span>

        <span class="s">'''
        invalidate the token by changing the password
        '''</span>
        <span class="n">user</span><span class="o">.</span><span class="n">set_password</span><span class="p">(</span><span class="s">'abcdef123'</span><span class="p">)</span>
        <span class="n">user</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>

        <span class="n">url</span> <span class="o">=</span> <span class="n">reverse</span><span class="p">(</span><span class="s">'password_reset_confirm'</span><span class="p">,</span> <span class="n">kwargs</span><span class="o">=</span><span class="p">{</span><span class="s">'uidb64'</span><span class="p">:</span> <span class="n">uid</span><span class="p">,</span> <span class="s">'token'</span><span class="p">:</span> <span class="n">token</span><span class="p">})</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">test_status_code</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">response</span><span class="o">.</span><span class="n">status_code</span><span class="p">,</span> <span class="mi">200</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">test_html</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">password_reset_url</span> <span class="o">=</span> <span class="n">reverse</span><span class="p">(</span><span class="s">'password_reset'</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertContains</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">response</span><span class="p">,</span> <span class="s">'invalid password reset link'</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertContains</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">response</span><span class="p">,</span> <span class="s">'href="{0}"'</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">password_reset_url</span><span class="p">))</span></code></pre></figure>

<h5 id="password-reset-complete-view">Password Reset Complete View</h5>

<p><strong>templates/password_reset_complete.html</strong></p>

<figure class="highlight"><pre><code class="language-django" data-lang="django"><span class="cp">{%</span> <span class="k">extends</span> <span class="s1">'base_accounts.html'</span> <span class="cp">%}</span>

<span class="cp">{%</span> <span class="k">block</span> <span class="nv">title</span> <span class="cp">%}</span>Password changed!<span class="cp">{%</span> <span class="k">endblock</span> <span class="cp">%}</span>

<span class="cp">{%</span> <span class="k">block</span> <span class="nv">content</span> <span class="cp">%}</span>
  <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"row justify-content-center"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"col-lg-6 col-md-8 col-sm-10"</span><span class="nt">&gt;</span>
      <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"card"</span><span class="nt">&gt;</span>
        <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"card-body"</span><span class="nt">&gt;</span>
          <span class="nt">&lt;h3</span> <span class="na">class=</span><span class="s">"card-title"</span><span class="nt">&gt;</span>Password changed!<span class="nt">&lt;/h3&gt;</span>
          <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"alert alert-success"</span> <span class="na">role=</span><span class="s">"alert"</span><span class="nt">&gt;</span>
            You have successfully changed your password! You may now proceed to log in.
          <span class="nt">&lt;/div&gt;</span>
          <span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">"</span><span class="cp">{%</span> <span class="nv">url</span> <span class="s1">'login'</span> <span class="cp">%}</span><span class="s">"</span> <span class="na">class=</span><span class="s">"btn btn-secondary btn-block"</span><span class="nt">&gt;</span>Return to log in<span class="nt">&lt;/a&gt;</span>
        <span class="nt">&lt;/div&gt;</span>
      <span class="nt">&lt;/div&gt;</span>
    <span class="nt">&lt;/div&gt;</span>
  <span class="nt">&lt;/div&gt;</span>
<span class="cp">{%</span> <span class="k">endblock</span> <span class="cp">%}</span></code></pre></figure>

<p><img src="../../../../media/series/beginners-guide/1.11/part-4/password_reset_complete.jpg" alt="Password Reset Complete" /></p>

<p><strong>accounts/tests/test_view_password_reset.py</strong>
<small><a href="https://gist.github.com/vitorfs/c9657d39d28c2a0cfb0933e715bfc9cf#file-test_view_password_reset-py-L149" target="_blank" rel="noopener nofollow">(view complete file contents)</a></small></p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="kn">from</span> <span class="nn">django.contrib.auth</span> <span class="kn">import</span> <span class="n">views</span> <span class="k">as</span> <span class="n">auth_views</span>
<span class="kn">from</span> <span class="nn">django.core.urlresolvers</span> <span class="kn">import</span> <span class="n">reverse</span>
<span class="kn">from</span> <span class="nn">django.urls</span> <span class="kn">import</span> <span class="n">resolve</span>
<span class="kn">from</span> <span class="nn">django.test</span> <span class="kn">import</span> <span class="n">TestCase</span>

<span class="k">class</span> <span class="nc">PasswordResetCompleteTests</span><span class="p">(</span><span class="n">TestCase</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">setUp</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">url</span> <span class="o">=</span> <span class="n">reverse</span><span class="p">(</span><span class="s">'password_reset_complete'</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">test_status_code</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">response</span><span class="o">.</span><span class="n">status_code</span><span class="p">,</span> <span class="mi">200</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">test_view_function</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">view</span> <span class="o">=</span> <span class="n">resolve</span><span class="p">(</span><span class="s">'/reset/complete/'</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">view</span><span class="o">.</span><span class="n">func</span><span class="o">.</span><span class="n">view_class</span><span class="p">,</span> <span class="n">auth_views</span><span class="o">.</span><span class="n">PasswordResetCompleteView</span><span class="p">)</span></code></pre></figure>

<hr />

<h4 id="password-change-view">Password Change View</h4>

<p>This view is meant to be used by logged in users that want to change their password. Usually, those forms are composed
of three fields: old password, new password, and new password confirmation.</p>

<p><strong>myproject/urls.py</strong>
<small><a href="https://gist.github.com/vitorfs/0927898f37831cad0d6a4ec538b8a002#file-urls-py-L31" target="_blank" rel="noopener nofollow">(view complete file contents)</a></small></p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">url</span><span class="p">(</span><span class="s">r'^settings/password/$'</span><span class="p">,</span> <span class="n">auth_views</span><span class="o">.</span><span class="n">PasswordChangeView</span><span class="o">.</span><span class="n">as_view</span><span class="p">(</span><span class="n">template_name</span><span class="o">=</span><span class="s">'password_change.html'</span><span class="p">),</span>
    <span class="n">name</span><span class="o">=</span><span class="s">'password_change'</span><span class="p">),</span>
<span class="n">url</span><span class="p">(</span><span class="s">r'^settings/password/done/$'</span><span class="p">,</span> <span class="n">auth_views</span><span class="o">.</span><span class="n">PasswordChangeDoneView</span><span class="o">.</span><span class="n">as_view</span><span class="p">(</span><span class="n">template_name</span><span class="o">=</span><span class="s">'password_change_done.html'</span><span class="p">),</span>
    <span class="n">name</span><span class="o">=</span><span class="s">'password_change_done'</span><span class="p">),</span></code></pre></figure>

<p>Those views only works for logged in users. They make use of a view decorator named <code class="highlighter-rouge">@login_required</code>. This decorator
prevents non-authorized users to access this page. If the user is not logged in, Django will redirect them to the login
page.</p>

<p>Now we have to define what is the login URL of our application in the <strong>settings.py</strong>:</p>

<p><strong>myproject/settings.py</strong>
<small><a href="https://gist.github.com/vitorfs/2d3a2c45df7deb025b8206c5a9b55e12#file-settings-py-L133" target="_blank" rel="noopener nofollow">(view complete file contents)</a></small></p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">LOGIN_URL</span> <span class="o">=</span> <span class="s">'login'</span></code></pre></figure>

<p><strong>templates/password_change.html</strong></p>

<figure class="highlight"><pre><code class="language-django" data-lang="django"><span class="cp">{%</span> <span class="k">extends</span> <span class="s1">'base.html'</span> <span class="cp">%}</span>

<span class="cp">{%</span> <span class="k">block</span> <span class="nv">title</span> <span class="cp">%}</span>Change password<span class="cp">{%</span> <span class="k">endblock</span> <span class="cp">%}</span>

<span class="cp">{%</span> <span class="k">block</span> <span class="nv">breadcrumb</span> <span class="cp">%}</span>
  <span class="nt">&lt;li</span> <span class="na">class=</span><span class="s">"breadcrumb-item active"</span><span class="nt">&gt;</span>Change password<span class="nt">&lt;/li&gt;</span>
<span class="cp">{%</span> <span class="k">endblock</span> <span class="cp">%}</span>

<span class="cp">{%</span> <span class="k">block</span> <span class="nv">content</span> <span class="cp">%}</span>
  <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"row"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"col-lg-6 col-md-8 col-sm-10"</span><span class="nt">&gt;</span>
      <span class="nt">&lt;form</span> <span class="na">method=</span><span class="s">"post"</span> <span class="na">novalidate</span><span class="nt">&gt;</span>
        <span class="cp">{%</span> <span class="nv">csrf_token</span> <span class="cp">%}</span>
        <span class="cp">{%</span> <span class="k">include</span> <span class="s1">'includes/form.html'</span> <span class="cp">%}</span>
        <span class="nt">&lt;button</span> <span class="na">type=</span><span class="s">"submit"</span> <span class="na">class=</span><span class="s">"btn btn-success"</span><span class="nt">&gt;</span>Change password<span class="nt">&lt;/button&gt;</span>
      <span class="nt">&lt;/form&gt;</span>
    <span class="nt">&lt;/div&gt;</span>
  <span class="nt">&lt;/div&gt;</span>
<span class="cp">{%</span> <span class="k">endblock</span> <span class="cp">%}</span></code></pre></figure>

<p><img src="../../../../media/series/beginners-guide/1.11/part-4/password_change.png" alt="Change Password" /></p>

<p><strong>templates/password_change_done.html</strong></p>

<figure class="highlight"><pre><code class="language-django" data-lang="django"><span class="cp">{%</span> <span class="k">extends</span> <span class="s1">'base.html'</span> <span class="cp">%}</span>

<span class="cp">{%</span> <span class="k">block</span> <span class="nv">title</span> <span class="cp">%}</span>Change password successful<span class="cp">{%</span> <span class="k">endblock</span> <span class="cp">%}</span>

<span class="cp">{%</span> <span class="k">block</span> <span class="nv">breadcrumb</span> <span class="cp">%}</span>
  <span class="nt">&lt;li</span> <span class="na">class=</span><span class="s">"breadcrumb-item"</span><span class="nt">&gt;&lt;a</span> <span class="na">href=</span><span class="s">"</span><span class="cp">{%</span> <span class="nv">url</span> <span class="s1">'password_change'</span> <span class="cp">%}</span><span class="s">"</span><span class="nt">&gt;</span>Change password<span class="nt">&lt;/a&gt;&lt;/li&gt;</span>
  <span class="nt">&lt;li</span> <span class="na">class=</span><span class="s">"breadcrumb-item active"</span><span class="nt">&gt;</span>Success<span class="nt">&lt;/li&gt;</span>
<span class="cp">{%</span> <span class="k">endblock</span> <span class="cp">%}</span>

<span class="cp">{%</span> <span class="k">block</span> <span class="nv">content</span> <span class="cp">%}</span>
  <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"alert alert-success"</span> <span class="na">role=</span><span class="s">"alert"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;strong&gt;</span>Success!<span class="nt">&lt;/strong&gt;</span> Your password has been changed!
  <span class="nt">&lt;/div&gt;</span>
  <span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">"</span><span class="cp">{%</span> <span class="nv">url</span> <span class="s1">'home'</span> <span class="cp">%}</span><span class="s">"</span> <span class="na">class=</span><span class="s">"btn btn-secondary"</span><span class="nt">&gt;</span>Return to home page<span class="nt">&lt;/a&gt;</span>
<span class="cp">{%</span> <span class="k">endblock</span> <span class="cp">%}</span></code></pre></figure>

<p><img src="../../../../media/series/beginners-guide/1.11/part-4/password_change_done.png" alt="Change Password Successful" /></p>

<p>Regarding the password change view, we can implement similar test cases as we have already been doing so far. Create
a new test file named <strong>test_view_password_change.py</strong>.</p>

<p>I will list below new types of tests. You can check all the tests I wrote for the password change view clicking in the
<em>view complete file contents</em> link next to the code snippet. Most of the tests are similar to what we have been
doing so far. I moved to an external file to avoid being too repetitive.</p>

<p><strong>accounts/tests/test_view_password_change.py</strong>
<small><a href="https://gist.github.com/vitorfs/03e2f20a4c1e693c9b22b343503fb461#file-test_view_password_change-py-L40" target="_blank" rel="noopener nofollow">(view complete file contents)</a></small></p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="k">class</span> <span class="nc">LoginRequiredPasswordChangeTests</span><span class="p">(</span><span class="n">TestCase</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">test_redirection</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">url</span> <span class="o">=</span> <span class="n">reverse</span><span class="p">(</span><span class="s">'password_change'</span><span class="p">)</span>
        <span class="n">login_url</span> <span class="o">=</span> <span class="n">reverse</span><span class="p">(</span><span class="s">'login'</span><span class="p">)</span>
        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertRedirects</span><span class="p">(</span><span class="n">response</span><span class="p">,</span> <span class="n">f</span><span class="s">'{login_url}?next={url}'</span><span class="p">)</span></code></pre></figure>

<p>The test above tries to access the <strong>password_change</strong> view without being logged in. The expected behavior is to
redirect the user to the login page.</p>

<p><strong>accounts/tests/test_view_password_change.py</strong>
<small><a href="https://gist.github.com/vitorfs/03e2f20a4c1e693c9b22b343503fb461#file-test_view_password_change-py-L48" target="_blank" rel="noopener nofollow">(view complete file contents)</a></small></p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="k">class</span> <span class="nc">PasswordChangeTestCase</span><span class="p">(</span><span class="n">TestCase</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">setUp</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="p">{}):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">user</span> <span class="o">=</span> <span class="n">User</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">create_user</span><span class="p">(</span><span class="n">username</span><span class="o">=</span><span class="s">'john'</span><span class="p">,</span> <span class="n">email</span><span class="o">=</span><span class="s">'john@doe.com'</span><span class="p">,</span> <span class="n">password</span><span class="o">=</span><span class="s">'old_password'</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">url</span> <span class="o">=</span> <span class="n">reverse</span><span class="p">(</span><span class="s">'password_change'</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">login</span><span class="p">(</span><span class="n">username</span><span class="o">=</span><span class="s">'john'</span><span class="p">,</span> <span class="n">password</span><span class="o">=</span><span class="s">'old_password'</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">url</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span></code></pre></figure>

<p>Here we defined a new class named <strong>PasswordChangeTestCase</strong>. It does a basic setup, creating a user and making a
<strong>POST</strong> request to the <strong>password_change</strong> view. In the next set of test cases, we are going to use this class
instead of the <strong>TestCase</strong> class and test a successful request and an invalid request:</p>

<p><strong>accounts/tests/test_view_password_change.py</strong>
<small><a href="https://gist.github.com/vitorfs/03e2f20a4c1e693c9b22b343503fb461#file-test_view_password_change-py-L60" target="_blank" rel="noopener nofollow">(view complete file contents)</a></small></p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="k">class</span> <span class="nc">SuccessfulPasswordChangeTests</span><span class="p">(</span><span class="n">PasswordChangeTestCase</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">setUp</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">setUp</span><span class="p">({</span>
            <span class="s">'old_password'</span><span class="p">:</span> <span class="s">'old_password'</span><span class="p">,</span>
            <span class="s">'new_password1'</span><span class="p">:</span> <span class="s">'new_password'</span><span class="p">,</span>
            <span class="s">'new_password2'</span><span class="p">:</span> <span class="s">'new_password'</span><span class="p">,</span>
        <span class="p">})</span>

    <span class="k">def</span> <span class="nf">test_redirection</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="s">'''
        A valid form submission should redirect the user
        '''</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertRedirects</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">response</span><span class="p">,</span> <span class="n">reverse</span><span class="p">(</span><span class="s">'password_change_done'</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">test_password_changed</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="s">'''
        refresh the user instance from database to get the new password
        hash updated by the change password view.
        '''</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">user</span><span class="o">.</span><span class="n">refresh_from_db</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">user</span><span class="o">.</span><span class="n">check_password</span><span class="p">(</span><span class="s">'new_password'</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">test_user_authentication</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="s">'''
        Create a new request to an arbitrary page.
        The resulting response should now have an `user` to its context, after a successful sign up.
        '''</span>
        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">reverse</span><span class="p">(</span><span class="s">'home'</span><span class="p">))</span>
        <span class="n">user</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">'user'</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">user</span><span class="o">.</span><span class="n">is_authenticated</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">InvalidPasswordChangeTests</span><span class="p">(</span><span class="n">PasswordChangeTestCase</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">test_status_code</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="s">'''
        An invalid form submission should return to the same page
        '''</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">response</span><span class="o">.</span><span class="n">status_code</span><span class="p">,</span> <span class="mi">200</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">test_form_errors</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">form</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">response</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">'form'</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">form</span><span class="o">.</span><span class="n">errors</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">test_didnt_change_password</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="s">'''
        refresh the user instance from the database to make
        sure we have the latest data.
        '''</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">user</span><span class="o">.</span><span class="n">refresh_from_db</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">user</span><span class="o">.</span><span class="n">check_password</span><span class="p">(</span><span class="s">'old_password'</span><span class="p">))</span></code></pre></figure>

<p>The <code class="highlighter-rouge">refresh_from_db()</code> method make sure we have the latest state of the data. It forces Django to query the database
again to update the data. We have to do it because the <strong>change_password</strong> view update the password in the database.
So to test if the password <em>really</em> changed, we have to grab the latest data from the database.</p>

<hr />

<h4 id="conclusions">Conclusions</h4>

<p>Authentication is a very common use case for most Django applications. In this tutorial, we implemented all the
important views: sign up, log in, log out, password reset, and change password. Now that we have a way to create users
and authenticate them, we will be able to proceed with the development of the other views of our application.</p>

<p>We still have to improve lots of things regarding the code design: the templates folder is starting to get messy with
too many files. The <strong>boards</strong> app tests are still disorganized. Also, we have to start refactoring the <strong>new topic</strong>
view, because now we can retrieve the logged in user. We will get to that part soon.</p>

<p>I hope you enjoyed the forth part of this tutorial series! The fifth part is coming out next week, on Oct 2, 2017.
If you would like to get notified when the fifth part is out, you can <a href="https://colossus.simpleisbetterthancomplex.com/subscribe/d2320a41-0378-4aa8-8f4e-5bb1ffcd521d/" target="_blank">subscribe to our mailing list</a>.</p>

<p>The source code of the project is available on GitHub. The current state of the project can be found under the release
tag <strong>v0.4-lw</strong>. The link below will take you to the right place:</p>

<p><a href="https://github.com/sibtc/django-beginners-guide/tree/v0.4-lw" target="_blank">https://github.com/sibtc/django-beginners-guide/tree/v0.4-lw</a></p>

<hr />

<div class="popular-posts">
  <div class="row">
    <div class="six columns">
      <a href="../18/a-complete-beginners-guide-to-django-part-3.html" style="text-decoration: none">
        <img src="../../../../media/series/beginners-guide/1.11/part-3/featured.jpg" alt="A Complete Beginner's Guide to Django - Part 3" title="A Complete Beginner's Guide to Django - Part 3" />
        <h5 style="margin-top: 1rem;">← Part 3 - Advanced Concepts</h5>
      </a>
    </div>
    <div class="six columns">
      <a href="../../10/02/a-complete-beginners-guide-to-django-part-5.html" style="text-decoration: none">
        <img src="../../../../media/series/beginners-guide/1.11/part-5/featured.jpg" alt="A Complete Beginner's Guide to Django - Part 5" title="A Complete Beginner's Guide to Django - Part 5" />
        <h5 style="text-align: right; margin-top: 1rem;">Part 5 - Django ORM →</h5>
      </a>
    </div>
  </div>
</div>

          </article>

          <hr class="dashed">
<div class="row">
  <div class="six columns post-tags" style="padding-top: 4px">
    
      <a href="../../../../tag/python/index.html"><span class="tag">python</span></a>
    
      <a href="../../../../tag/django/index.html"><span class="tag">django</span></a>
    
      <a href="../../../../tag/guide/index.html"><span class="tag">guide</span></a>
    
      <a href="../../../../tag/beginners/index.html"><span class="tag">beginners</span></a>
    
      <a href="../../../../tag/login/index.html"><span class="tag">login</span></a>
    
      <a href="../../../../tag/auth/index.html"><span class="tag">auth</span></a>
    
  </div>
  <div class="six columns post-share">
    <div class="social">
  Share this post
  <a href="http://vk.com/share.php?url=http://sibt.co/2y1TMcB"
     rel="nofollow"
     target="_blank"
     title="Share on VK">
    <i class="fa fa-vk"></i>
  </a>
  <a href="https://twitter.com/intent/tweet?text=A%20Complete%20Beginner's%20Guide%20to%20Django%20-%20Part%204&amp;url=http://sibt.co/2jWn9Xv&amp;via=vitorfs&amp;related=vitorfs"
     rel="nofollow"
     target="_blank"
     title="Share on Twitter">
    <i class="fa fa-twitter"></i>
  </a>
  <a href="https://www.facebook.com/sharer/sharer.php?app_id=1645747765697865&amp;u=http://sibt.co/2y2opyl"
     rel="nofollow"
     target="_blank"
     title="Share on Facebook">
    <i class="fa fa-facebook"></i>
  </a>
  <a href="http://www.linkedin.com/shareArticle?mini=true&amp;url=http://sibt.co/2jW80VZ&amp;title=A%20Complete%20Beginner's%20Guide%20to%20Django%20-%20Part%204&amp;summary=This%20tutorial%20is%20going%20to%20be%20all%20about%20Django's%20authentication%20system.%20We%20are%20going%20to%20implement%20the%20whole%20thing,%20registration,%20login,%20logout,%20password%20reset,%20and%20password%20change.&amp;source=https://simpleisbetterthancomplex.com"
     rel="nofollow"
     target="_blank"
     title="Share on LinkedIn">
    <i class="fa fa-linkedin"></i>
  </a>
</div>

  </div>
</div>

        </div>

        <div class="card">
          
  <div id="comments">
    <div id="disqus_thread"></div>
    <script>
      var disqus_config = function () {
        this.page.url = 'a-complete-beginners-guide-to-django-part-4.html';
        this.page.identifier = '/series/2017/09/25/a-complete-beginners-guide-to-django-part-4';
      };
      (function() {
      var d = document, s = d.createElement('script');
      s.src = 'http://simpleisbetterthancomplex.disqus.com/embed.js';
      s.setAttribute('data-timestamp', +new Date());
      (d.head || d.body).appendChild(s);
      })();
    </script>
    <script id="dsq-count-scr" src="http://simpleisbetterthancomplex.disqus.com/count.js" async></script>
    <noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript>
  </div>


        </div>
      </div>
    </div>
  </div>

  <div class="container post post-footer">
    <div class="card subscribe">
  <form action="https://colossus.simpleisbetterthancomplex.com/subscribe/d2320a41-0378-4aa8-8f4e-5bb1ffcd521d/" method="post" target="_blank" novalidate>
    <h4>
      <span class="fa fa-send" style="margin-right: 5px"></span> Subscribe to our Mailing List
    </h4>
    <h5>Receive updates from the Blog!</h5>
    <div class="row">
      <div class="eight columns">
        <input class="u-full-width" placeholder="Your email address" type="email" name="email">
      </div>
      <div class="four columns">
        <button type="submit" class="u-full-width">Subscribe</button>
      </div>
    </div>
  </form>
</div>

    <div class="card popular-posts">
  <h4>Popular Posts</h4>
  <div class="row">
    
      <div class="four columns">
        <a href="../../../../tutorial/2016/07/22/how-to-extend-django-user-model.html">
          <img src="../../../../media/2016-07-22-how-to-extend-django-user-model/featured-post-image.jpg" alt="How to Extend Django User Model" title="How to Extend Django User Model">
          How to Extend Django User Model
        </a>
      </div>
    
      <div class="four columns">
        <a href="../../../../tutorial/2016/05/11/how-to-setup-ssl-certificate-on-nginx-for-django-application.html">
          <img src="../../../../media/2016-05-11-how-to-setup-ssl-certificate-on-nginx-for-django-application/featured-post-image.jpg" alt="How to Setup a SSL Certificate on Nginx for a Django Application" title="How to Setup a SSL Certificate on Nginx for a Django Application">
          How to Setup a SSL Certificate on Nginx for a Django Application
        </a>
      </div>
    
      <div class="four columns">
        <a href="../../../../tutorial/2016/10/14/how-to-deploy-to-digital-ocean.html">
          <img src="../../../../media/2016/10/featured-do.jpg" alt="How to Deploy a Django Application to Digital Ocean" title="How to Deploy a Django Application to Digital Ocean">
          How to Deploy a Django Application to Digital Ocean
        </a>
      </div>
    
  </div>
</div>

  </div>

  <footer>
  <div class="container">
    <ul>
      <li>© 2015-2021 simple complex</li>
      <li><a rel="license noopener" href="https://creativecommons.org/licenses/by-nc-sa/3.0/" target="_blank">cc by-nc-sa 3.0</a></li>
      <li>//</li>
      <li><a href="../../../../about/index.html" rel="author">about</a></li>
      <li><a href="../../../../contact/index.html">contact</a></li>
      <li><a href="../../../../faq/index.html">faq</a></li>
      <li><a href="../../../../cookies/index.html">cookies</a></li>
      <li><a href="../../../../privacy/index.html">privacy policy</a></li>
    </ul>
  </div>
</footer>
<div class="overlay"></div>

  
  <script id="ga-page-views" src="../../../../js/page-views.js" async></script>
  <script src="http://z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=1d8c6a0f-2136-49ad-b0b3-0b09662b7e28"></script>


<style>
.related-posts .row {
  display: grid;
  grid-gap: 20px;
  grid-template-columns: repeat(3, 1fr);
}

.related-posts .four.columns {
  width: 100%;
}
</style>

<script>
_bsa.init('recommended', 'CK7I4KJJ', 'placement:simpleisbetterthancomplexcom',
    {
      target: '.related-posts .columns',
      template: `
<div class="four columns">
<a href="##link##" rel="noopener nofollow">
<img src="##smallImage##" alt="##title##" title="##title##">[Sponsored] ##title##</a>
</div>
      `
    }
  );
</script>

<script type="application/ld+json">
{
  "@context": "http://schema.org",
  "@type": "BlogPosting",
  "mainEntityOfPage": "https://simpleisbetterthancomplex.com/series/2017/09/25/a-complete-beginners-guide-to-django-part-4.html",
  "headline": "A Complete Beginner's Guide to Django - Part 4",
  "image": {
    "@type": "ImageObject",
    "url": "https://simpleisbetterthancomplex.com/media/series/beginners-guide/1.11/part-4/featured.jpg",
    "height": 370,
    "width": 960
  },
  "datePublished": "2017-09-25T08:00:00+03:00",
  "dateModified": "2017-09-25T08:00:00+03:00",
  "author": {
    "@type": "Person",
    "name": "Vitor Freitas"
  },
   "publisher": {
    "@type": "Organization",
    "name": "Simple is Better Than Complex",
    "logo": {
      "@type": "ImageObject",
      "url": "https://simpleisbetterthancomplex.com/img/gplus_logo.png",
      "height": 60,
      "width": 600
    }
  },
  "description": "This tutorial is going to be all about Django's authentication system. We are going to implement the whole thing, registration, login, logout, password reset, and password change."
}
</script>

  <script src="../../../../js/affix.js"></script>
  <script src="../../../../js/jquery.waypoints.min.js"></script>
  <script src="../../../../js/inview.min.js"></script>
  <script>
    $(function () {
      var sidebarMaxHeight = $(window).height() - 90;
      if (sidebarMaxHeight > 600) {
        $('head').append('<style type="text/css">@media (min-width: 1200px) {#seriesSideBar.affix div.card { max-height: '+sidebarMaxHeight+'px!important; }}</style>');
      }

      /* sidebar affix */
      $("#seriesSideBar").affix({
        offset: {
          top: $("#seriesSideBar").offset().top - 50,
          bottom: function () {
            return ($("footer").outerHeight(true) + $(".post-footer").outerHeight(true));
          }
        }
      });

      /* sidebar scrollspy */
      var headers = Array();
      var trackContents = function (el) {
        var inview = new Waypoint.Inview({
          element: el,
          enter: function(direction) {
            $("#seriesSideBar ul li a").removeClass("active");
            $("#seriesSideBar ul li a[href='#" + this.element.id + "']").addClass("active");
          },
          exit: function(direction) {
            if (direction == "up") {
              var index = headers.indexOf(this.element.id);
              $("#seriesSideBar ul li a").removeClass("active");
              if (index > 0) {
                $("#seriesSideBar ul li a[href='#" + headers[index - 1] + "']").addClass("active");
              }
            }
          }
        });
      };
      $("article h4, article h5").each(function () {
        trackContents(this);
        headers.push(this.id);
      });

      /* article default os */
      var os = getOS();
      $("nav.platform a[data-platform='" + os + "']").addClass("active");
      $("body").addClass("platform-" + os);

      $(".js-set-platform a").click(function () {
        var $btn = $(this);
        var $body = $("body");
        var platform = $btn.attr("data-platform");
        var platformClass = "platform-" + platform;
        $body.removeClass("platform-mac platform-windows platform-linux");
        $body.addClass(platformClass);
        $("nav.platform a").removeClass("active");
        $("nav.platform a[data-platform='" + platform + "']").addClass("active");
      });

      var platformInview = new Waypoint.Inview({
        element: $("#platformArticle")[0],
        enter: function(direction) {
          $("#platformSideBar").hide();
        },
        exit: function(direction) {
          if (direction == "up") {
            $("#platformSideBar").hide();
          }
          else {
            $("#platformSideBar").show();
          }
        }
      });

    });
  </script>
  <noscript><style type="text/css">body article div.platform-windows { display: block!important; }</style></noscript>
  
</body>

<!-- Mirrored from simpleisbetterthancomplex.com/series/2017/09/25/a-complete-beginners-guide-to-django-part-4.html by HTTrack Website Copier/3.x [XR&CO'2014], Fri, 03 Sep 2021 12:42:02 GMT -->
</html>

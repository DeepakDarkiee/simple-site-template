<!DOCTYPE html>
<html lang="en">

<!-- Mirrored from simpleisbetterthancomplex.com/tutorial/2016/10/13/how-to-use-generic-relations.html by HTTrack Website Copier/3.x [XR&CO'2014], Fri, 03 Sep 2021 12:47:00 GMT -->
<head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta name="ir-site-verification-token" value="-233745807">
<title>How to Use Django's Generic Relations</title>
<meta name="description" content="You probably have already seen Django’s ContentTypes and wondered how to use it or what is it for anyway.Basically it’s a built in app that keeps track of mo...">
<link href="https://fonts.googleapis.com/css?family=Raleway:400,300,500,600,700" rel="stylesheet" type="text/css">
<link rel="stylesheet" href="../../../../css/main71de.css?v=34">
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">
<link rel="canonical" href="how-to-use-generic-relations.html">
<link rel="alternate" type="application/rss+xml" title="Simple is Better Than Complex" href="../../../../feed.xml" />
<link rel="icon" type="image/png" href="../../../../favicon.png">
<link rel="mask-icon" href="../../../../safari-pinned-tab.svg" color="#5bbad5">
<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.2/jquery.min.js"></script>
<script src="../../../../js/site7b30.js?v=4"></script>

  <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','http://www.google-analytics.com/analytics.js','ga');
    ga('create', 'UA-42049022-10', 'auto');
    ga('send', 'pageview');
  </script>
  <script>
    $(function () {
      $("#ad").on("click", "#carbonads .carbon-wrap a", function () {
        var page_id = 'how-to-use-generic-relations.html';
        ga('send', 'event', 'carbonads', 'click', page_id, {
          'transport': 'beacon'
        });
      });
    });
  </script>
  <script>
  !function(f,b,e,v,n,t,s){if(f.fbq)return;n=f.fbq=function(){n.callMethod?
  n.callMethod.apply(n,arguments):n.queue.push(arguments)};if(!f._fbq)f._fbq=n;
  n.push=n;n.loaded=!0;n.version='2.0';n.queue=[];t=b.createElement(e);t.async=!0;
  t.src=v;s=b.getElementsByTagName(e)[0];s.parentNode.insertBefore(t,s)}(window,
  document,'script','https://connect.facebook.net/en_US/fbevents.js');
  fbq('init', '1689711451348257');
  fbq('track', 'PageView');
  </script>
  <noscript><img height="1" width="1" style="display:none" alt="PageView"
  src="https://www.facebook.com/tr?id=1689711451348257&amp;ev=PageView&amp;noscript=1"
  /></noscript>
  <script data-ad-client="ca-pub-5430683801108011" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>


  <meta property="og:title" content="How to Use Django's Generic Relations">
<meta property="og:url" content="https://simpleisbetterthancomplex.com/tutorial/2016/10/13/how-to-use-generic-relations.html">
<meta property="og:image" content="https://simpleisbetterthancomplex.com/media/2016/10/featured-generic.jpg">
<meta property="og:description" content="You probably have already seen Django’s ContentTypes and wondered how to use it or what is it for anyway.Basically it’s a built in app that keeps track of mo...">
<meta property="og:site_name" content="Simple is Better Than Complex">
<meta property="og:locale" content="en_US">

  <meta property="article:published_time" content="2016-10-13T14:48:00+03:00">
  <meta property="article:author" content="https://facebook.com/vitorfs">

<meta property="fb:admins" content="100000024295617">
<meta property="fb:app_id" content="1645747765697865">

<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:site" content="vitorfs">
<meta name="twitter:creator" content="vitorfs">
<meta name="twitter:title" content="How to Use Django's Generic Relations">
<meta name="twitter:description" content="You probably have already seen Django’s ContentTypes and wondered how to use it or what is it for anyway.Basically it’s a built in app that keeps track of models from the installed apps of your Dja...">
<meta name="twitter:image" content="https://simpleisbetterthancomplex.com/media/2016/10/featured-generic.jpg">
<meta name="p:domain_verify" content="e262845cb18e4c68b0cff535a0eaea5d">
  <meta property="og:type" content="article">
  
    <meta property="article:tag" content="django">
  
    <meta property="article:tag" content="content types">
  
    <meta property="article:tag" content="generic relations">
  
  <style type="text/css">
    @media (min-width: 750px) {
      body {
        /*padding-top:50px!important;*/
      }
    }
  </style>
  <script src="http://m.servedby-buysellads.com/monetization.js"></script>
</head>
<body>
  <div id="top" style="visibility: hidden"></div>
<header>
  <div class="container">
    <ul class="menu menu-right">
      <li class="menu-item">
        <a href="../../../../search/index.html">
          <span class="fa fa-search"></span>
        </a>
      </li>
      <li class="toggle-menu">
        <a href="javascript:void(0);">
          <span class="fa fa-bars"></span>
        </a>
      </li>
    </ul>
    <ul class="menu menu-left">
      <li class="logo">
        <a href="../../../../index.html" style="font-weight: 900">simple<span class="brand">is</span>better<span class="brand">than</span>complex</a>
      </li>
      <li class="menu-item">
        <a href="../../../../index.html">
          <span class="fa fa-home" style="margin-right: 3px"></span>
          Home
        </a>
      </li>
      <li class="menu-item">
        <a href="../../../../archive/index.html">
          <span class="fa fa-archive" style="margin-right: 3px"></span>
          Articles
        </a>
      </li>
      <li class="menu-item">
        <a href="../../../../videos/index.html">
          <span class="fa fa-video-camera" style="margin-right: 3px"></span>
          Videos
        </a>
      </li>
      <li class="menu-item">
        <a href="../../../../series/index.html">
          <span class="fa fa-book" style="margin-right: 3px"></span>
          Series
        </a>
      </li>
      <li class="menu-item">
        <a href="../../../../snippets/index.html">
          <span class="fa fa-code" style="margin-right: 3px"></span>
          Snippets
        </a>
      </li>
      <li class="menu-item">
        <a href="../../../../sponsor/index.html">
          <span class="fa fa-bullhorn" style="margin-right: 3px"></span>
          Sponsor
        </a>
      </li>
      <li class="menu-item">
        <a href="../../../../feed.xml" target="_blank">
          <span class="fa fa-rss" style="margin-right: 3px"></span>
          RSS
        </a>
      </li>
      <li class="menu-item">
        <a href="https://colossus.simpleisbetterthancomplex.com/subscribe/d2320a41-0378-4aa8-8f4e-5bb1ffcd521d/" class="brand" target="_blank">
          <span class="fa fa-send" style="margin-right: 3px"></span> Subscribe
        </a>
      </li>
      <li class="menu-item hidden-mobile">
        <a href="../../../../search/index.html">
          <span class="fa fa-search"></span> Search
        </a>
      </li>
    </ul>
  </div>
</header>

  <!--p style="text-align:center;font-size:1.4rem;margin-top:2rem;margin-bottom:2rem;">
    <span style="background-color:#1eaedb;color:#fff;border-radius:3px;padding:3px 5px;font-size:1.2rem;margin-right:5px;">Sponsored</span>
    <a href="/sponsor/" rel="noopener nofollow">
      By You? Learn more about sponsorship of the blog.
    </a>
  </p-->

  <main>
    <div class="container">
      <div class="row">
        <div class="ten offset-by-one columns content post">
          <div class="card post-author">
  <div class="author-picture">
    <img src="../../../../img/picture.jpg" alt="Vitor Freitas">
  </div>
  <div class="author-info">
    <p class="name">By <strong>Vitor Freitas</strong></p>
    <a href="https://www.digitalocean.com/?refcode=074832454ff1&amp;utm_campaign=Referral_Invite&amp;utm_medium=Referral_Program&amp;utm_source=badge" class="powered-by-do">
      <img src="https://web-platforms.sfo2.cdn.digitaloceanspaces.com/WWW/Badge 1.svg" alt="DigitalOcean Referral Badge">
    </a>
    <p class="bio">
      I'm a passionate software developer and researcher. I write about Python, Django and Web Development on a weekly basis. <a href="../../../../about/index.html" rel="author">Read more</a>.
    </p>
    <p class="contact">
      <a href="https://www.youtube.com/VitorFreitas" rel="me noopener" target="_blank" title="YouTube"><i class="fa fa-youtube-play"></i></a>
      <a href="https://github.com/vitorfs" rel="me noopener" target="_blank" title="GitHub"><i class="fa fa-github"></i></a>
      <a href="https://twitter.com/vitorfs" rel="me noopener" target="_blank" title="Twitter"><i class="fa fa-twitter"></i></a>
      <a href="https://facebook.com/vitorfs" rel="me noopener" target="_blank" title="Facebook"><i class="fa fa-facebook-official"></i></a>
      <a href="https://linkedin.com/in/vitorfs" rel="me noopener" target="_blank" title="LinkedIn"><i class="fa fa-linkedin-square"></i></a>
      <a href="https://instagram.com/vitorfs" rel="me noopener" target="_blank" title="Instagram"><i class="fa fa-instagram"></i></a>
      <a href="../../../../contact/index.html" title="Contact"><i class="fa fa-envelope"></i></a>
    </p>
  </div>
  
  
  <div class="row">
    <div class="six columns">
      <div id="ad">
        <script async type="text/javascript" src="http://cdn.carbonads.com/carbon.js?serve=CKYIEKQM&amp;placement=simpleisbetterthancomplexcom" id="_carbonads_js"></script>
      </div>
    </div>


    <!--div class="six columns">
      <div id="ad2">
        <div id="sponsored">
          <a href="/sponsor/">
            <img src="/media/sponsored/ad.png" alt="Advertise Here">
            <span>Reach 90k+ Django developers every month. Learn more about sponsorship of the blog.</span>
          </a>
          <small>
            <a href="/sponsor/">Sponsored</a>
          </small>
        </div>

        <div id="sponsored">
          <a href="https://click.linksynergy.com/link?id=phY4769lVwA&offerid=507388.567828&type=2&murl=https%3A%2F%2Fwww.udemy.com%2Fcomplete-python-bootcamp%2F" target="_blank" rel="noopener nofollow">
            <img border="0" src="https://udemy-images.udemy.com/course/480x270/567828_67d0.jpg" alt="Complete Python Bootcamp: Go from zero to hero in Python 3">
            <span>Complete Python Bootcamp: Go from zero to hero in Python 3</span>
          </a>
          <small>
            <a href="/sponsor/">Sponsored</a>
          </small>
          <img border="0" width="1" height="1" src="https://ad.linksynergy.com/fs-bin/show?id=phY4769lVwA&bids=507388.567828&type=2&subid=0" alt="LinkSynergy">
        </div>

      </div>
    </div-->


  </div>
  
</div>


          <p style="text-align:center;font-size:1.4rem;margin-bottom:4rem;">
            <i class="fa fa-youtube-play" style="color:#ff0000!important;"></i> <a href="https://www.youtube.com/VitorFreitas?sub_confirmation=1" target="_blank">Subscribe to our YouTube Channel!</a>
            <br>
            <a href="https://youtu.be/Udf4VbtM92Y" target="_blank">[Jul 12, 2021] New Video: How to Use Django Rest Framework Permissions (DRF Tutorial - Part 7)</a>
          </p>

          <div class="card">
            
  <h5 class="post-category">
    
      tutorial
    
  </h5>
  <hr class="dashed">

<h3 class="post-title">How to Use Django's Generic Relations</h3>
<ul class="post-meta">
  <li>
    <i class="fa fa-calendar"></i> Oct 13, 2016
  </li>
  <li>
    <i class="fa fa-clock-o"></i>
    9 minutes read
  </li>
  <li>
    <i class="fa fa-comments"></i>
    <a href="#disqus_thread" data-disqus-identifier="/tutorial/2016/10/13/how-to-use-generic-relations">comments</a>
  </li>
  <li>
    <i class="fa fa-eye"></i>
    <span class="ga-page-views" data-ga-identifier="how-to-use-generic-relations.html"></span> views
  </li>
  
  
</ul>

  <div class="post-featured-image">
    <img src="../../../../media/2016/10/featured-generic.jpg" alt="How to Use Django's Generic Relations" class="featured-image">
    
      <small>(Picture: <a href="https://www.pexels.com/photo/business-identity-blank-stationery-set-on-wood-background-6372/" target="_blank">https://www.pexels.com/photo/business-identity-blank-stationery-set-on-wood-background-6372/</a>)</small>
    
  </div>


            <article>
              <p>You probably have already seen Django’s <strong>ContentTypes</strong> and wondered how to use it or what is it for anyway.
Basically it’s a built in app that keeps track of models from the installed apps of your Django application. And one
of the use cases of the <strong>ContentTypes</strong> is to create generic relationships between models. That’s what this post is
about.</p>

<hr />

<h4 id="installation">Installation</h4>

<p>If you didn’t remove anything from settings generated by the <code class="highlighter-rouge">django-admin startproject myproject</code> command, it’s probably
already installed. Also Django’s built in authentication system relies on it.</p>

<p>Basically just make sure you have it in your <code class="highlighter-rouge">INSTALLED_APPS</code>:</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">INSTALLED_APPS</span> <span class="o">=</span> <span class="p">[</span>
    <span class="o">...</span>

    <span class="s">'django.contrib.contenttypes'</span><span class="p">,</span>

    <span class="o">...</span>
<span class="p">]</span></code></pre></figure>

<hr />

<h4 id="example-scenario">Example Scenario</h4>

<p>Let’s say we have one social app where the users can ask and answer questions, <strong>up vote</strong>, <strong>down vote</strong>, <strong>favorite</strong>
a question, <strong>like</strong> a post in the website, etc.</p>

<p>To keep track of that we create a model named <strong>Activity</strong>. See below:</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="k">class</span> <span class="nc">Activity</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">FAVORITE</span> <span class="o">=</span> <span class="s">'F'</span>
    <span class="n">LIKE</span> <span class="o">=</span> <span class="s">'L'</span>
    <span class="n">UP_VOTE</span> <span class="o">=</span> <span class="s">'U'</span>
    <span class="n">DOWN_VOTE</span> <span class="o">=</span> <span class="s">'D'</span>
    <span class="n">ACTIVITY_TYPES</span> <span class="o">=</span> <span class="p">(</span>
        <span class="p">(</span><span class="n">FAVORITE</span><span class="p">,</span> <span class="s">'Favorite'</span><span class="p">),</span>
        <span class="p">(</span><span class="n">LIKE</span><span class="p">,</span> <span class="s">'Like'</span><span class="p">),</span>
        <span class="p">(</span><span class="n">UP_VOTE</span><span class="p">,</span> <span class="s">'Up Vote'</span><span class="p">),</span>
        <span class="p">(</span><span class="n">DOWN_VOTE</span><span class="p">,</span> <span class="s">'Down Vote'</span><span class="p">),</span>
    <span class="p">)</span>

    <span class="n">user</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">ForeignKey</span><span class="p">(</span><span class="n">User</span><span class="p">)</span>
    <span class="n">activity_type</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">choices</span><span class="o">=</span><span class="n">ACTIVITY_TYPES</span><span class="p">)</span>
    <span class="n">date</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">DateTimeField</span><span class="p">(</span><span class="n">auto_now_add</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="n">post</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">ForeignKey</span><span class="p">(</span><span class="n">Post</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="n">question</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">ForeignKey</span><span class="p">(</span><span class="n">Question</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="n">answer</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">ForeignKey</span><span class="p">(</span><span class="n">Answer</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="n">comment</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">ForeignKey</span><span class="p">(</span><span class="n">Comment</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span></code></pre></figure>

<p>So an <strong>Activity</strong> can possibly interact with a <strong>Post</strong>, <strong>Question</strong>, <strong>Answer</strong> or a <strong>Comment</strong> instance. In a
practical scenario an <strong>Activity</strong> instance would represent a single interaction. For example, the User with ID 1
<strong>up voted</strong> a Question with ID 125:</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">Activity</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">user</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">activity_type</span><span class="o">=</span><span class="s">'U'</span><span class="p">,</span> <span class="n">question</span><span class="o">=</span><span class="mi">125</span><span class="p">)</span></code></pre></figure>

<p>And if I wanted to calculate how many <strong>up votes</strong> the Question 125 received, I could do something like that:</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">question</span> <span class="o">=</span> <span class="n">Question</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">pk</span><span class="o">=</span><span class="mi">125</span><span class="p">)</span>
<span class="n">up_votes</span> <span class="o">=</span> <span class="n">question</span><span class="o">.</span><span class="n">activity_set</span><span class="o">.</span><span class="nb">filter</span><span class="p">(</span><span class="n">activity_type</span><span class="o">=</span><span class="n">Activity</span><span class="o">.</span><span class="n">UP_VOTE</span><span class="p">)</span>

<span class="c"># Display how many up votes</span>
<span class="n">count</span> <span class="o">=</span> <span class="n">up_votes</span><span class="o">.</span><span class="n">count</span><span class="p">()</span>

<span class="c"># Display the names of users who up voted</span>
<span class="n">up_voters</span> <span class="o">=</span> <span class="n">up_votes</span><span class="o">.</span><span class="n">values_list</span><span class="p">(</span><span class="s">'user__first_name'</span><span class="p">)</span></code></pre></figure>

<p>In a similar way we could work with the Post, Answer and Comment models.</p>

<hr />

<h4 id="using-the-generic-relations">Using the Generic Relations</h4>

<p>If we wanted to achieve the same result using <strong>Generic Relations</strong>, here is what the <strong>Activity</strong> models should
look like:</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="kn">from</span> <span class="nn">django.contrib.contenttypes.fields</span> <span class="kn">import</span> <span class="n">GenericForeignKey</span>
<span class="kn">from</span> <span class="nn">django.contrib.contenttypes.models</span> <span class="kn">import</span> <span class="n">ContentType</span>

<span class="k">class</span> <span class="nc">Activity</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">FAVORITE</span> <span class="o">=</span> <span class="s">'F'</span>
    <span class="n">LIKE</span> <span class="o">=</span> <span class="s">'L'</span>
    <span class="n">UP_VOTE</span> <span class="o">=</span> <span class="s">'U'</span>
    <span class="n">DOWN_VOTE</span> <span class="o">=</span> <span class="s">'D'</span>
    <span class="n">ACTIVITY_TYPES</span> <span class="o">=</span> <span class="p">(</span>
        <span class="p">(</span><span class="n">FAVORITE</span><span class="p">,</span> <span class="s">'Favorite'</span><span class="p">),</span>
        <span class="p">(</span><span class="n">LIKE</span><span class="p">,</span> <span class="s">'Like'</span><span class="p">),</span>
        <span class="p">(</span><span class="n">UP_VOTE</span><span class="p">,</span> <span class="s">'Up Vote'</span><span class="p">),</span>
        <span class="p">(</span><span class="n">DOWN_VOTE</span><span class="p">,</span> <span class="s">'Down Vote'</span><span class="p">),</span>
    <span class="p">)</span>

    <span class="n">user</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">ForeignKey</span><span class="p">(</span><span class="n">User</span><span class="p">)</span>
    <span class="n">activity_type</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">choices</span><span class="o">=</span><span class="n">ACTIVITY_TYPES</span><span class="p">)</span>
    <span class="n">date</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">DateTimeField</span><span class="p">(</span><span class="n">auto_now_add</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>

    <span class="c"># Below the mandatory fields for generic relation</span>
    <span class="n">content_type</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">ForeignKey</span><span class="p">(</span><span class="n">ContentType</span><span class="p">,</span> <span class="n">on_delete</span><span class="o">=</span><span class="n">models</span><span class="o">.</span><span class="n">CASCADE</span><span class="p">)</span>
    <span class="n">object_id</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">PositiveIntegerField</span><span class="p">()</span>
    <span class="n">content_object</span> <span class="o">=</span> <span class="n">GenericForeignKey</span><span class="p">()</span></code></pre></figure>

<p>Now we are no longer keeping <strong>ForeignKey</strong> to other models we want to track the favorite, like, up vote and down vote
activities. Meaning we can now track those activities to any model we want without having to modify the Activity model.</p>

<p>The relation is created in the model you want to track the <strong>Activity</strong>:</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="kn">from</span> <span class="nn">django.db</span> <span class="kn">import</span> <span class="n">models</span>
<span class="kn">from</span> <span class="nn">django.contrib.contenttypes.fields</span> <span class="kn">import</span> <span class="n">GenericRelation</span>

<span class="kn">from</span> <span class="nn">activities.models</span> <span class="kn">import</span> <span class="n">Activity</span>


<span class="k">class</span> <span class="nc">Post</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="o">...</span>
    <span class="n">likes</span> <span class="o">=</span> <span class="n">GenericRelation</span><span class="p">(</span><span class="n">Activity</span><span class="p">)</span>

<span class="k">class</span> <span class="nc">Question</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="o">...</span>
    <span class="n">activities</span> <span class="o">=</span> <span class="n">GenericRelation</span><span class="p">(</span><span class="n">Activity</span><span class="p">)</span>

<span class="k">class</span> <span class="nc">Answer</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="o">...</span>
    <span class="n">votes</span> <span class="o">=</span> <span class="n">GenericRelation</span><span class="p">(</span><span class="n">Activity</span><span class="p">)</span>

<span class="k">class</span> <span class="nc">Comment</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="o">...</span>
    <span class="n">likes</span> <span class="o">=</span> <span class="n">GenericRelation</span><span class="p">(</span><span class="n">Activity</span><span class="p">)</span></code></pre></figure>

<p>This also enables you to define a more meaningful name for the relations. For example, the <strong>Users</strong> can only interact
with <strong>Post</strong> and <strong>Comment</strong> models to <strong>like</strong> it. While with the <strong>Answer</strong> model, they can only
<strong>up vote/down vote</strong>. And finally with the <strong>Question</strong> model, the <strong>Users</strong> can <strong>up vote/down vote</strong> and
<strong>favorite</strong> it.</p>

<p>Now if you want to <strong>like</strong> a <strong>Post</strong>, you could do something like this:</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="c"># Get the post object</span>
<span class="n">post</span> <span class="o">=</span> <span class="n">Post</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">pk</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

<span class="c"># Add a like activity</span>
<span class="n">post</span><span class="o">.</span><span class="n">likes</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">activity_type</span><span class="o">=</span><span class="n">Activity</span><span class="o">.</span><span class="n">LIKE</span><span class="p">,</span> <span class="n">user</span><span class="o">=</span><span class="n">request</span><span class="o">.</span><span class="n">user</span><span class="p">)</span>

<span class="c"># Or in a similar way using the Activity model to add the like</span>
<span class="n">Activity</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">content_object</span><span class="o">=</span><span class="n">post</span><span class="p">,</span> <span class="n">activity_type</span><span class="o">=</span><span class="n">Activity</span><span class="o">.</span><span class="n">LIKE</span><span class="p">,</span> <span class="n">user</span><span class="o">=</span><span class="n">request</span><span class="o">.</span><span class="n">user</span><span class="p">)</span>

<span class="c"># Get all Activity instances related to Post</span>
<span class="n">post</span><span class="o">.</span><span class="n">likes</span><span class="o">.</span><span class="nb">all</span><span class="p">()</span>

<span class="c"># Count the number of likes</span>
<span class="n">post</span><span class="o">.</span><span class="n">likes</span><span class="o">.</span><span class="n">count</span><span class="p">()</span>

<span class="c"># Get the users who liked the post</span>
<span class="n">post</span><span class="o">.</span><span class="n">likes</span><span class="o">.</span><span class="n">values_list</span><span class="p">(</span><span class="s">'user__first_name'</span><span class="p">,</span> <span class="n">flat</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span></code></pre></figure>

<p>A good thing about it is that if have a new model that you wants to interact with <strong>Activity</strong>, you simply add a
<strong>GenericRelation</strong>:</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="kn">from</span> <span class="nn">django.contrib.contenttypes.fields</span> <span class="kn">import</span> <span class="n">GenericRelation</span>

<span class="k">class</span> <span class="nc">Picture</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">user</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">ForeignKey</span><span class="p">(</span><span class="n">User</span><span class="p">)</span>
    <span class="n">picture_file</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">ImageField</span><span class="p">(</span><span class="n">upload_to</span><span class="o">=</span><span class="s">'uploads/pictures'</span><span class="p">)</span>
    <span class="n">date</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">DateTimeField</span><span class="p">(</span><span class="n">auto_now_add</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="n">favorites</span> <span class="o">=</span> <span class="n">GenericRelation</span><span class="p">(</span><span class="n">Activity</span><span class="p">)</span></code></pre></figure>

<p>And it’s already ready to use:</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">picture</span> <span class="o">=</span> <span class="n">Picture</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">pk</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

<span class="n">picture</span><span class="o">.</span><span class="n">favorites</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">activity_type</span><span class="o">=</span><span class="n">Activity</span><span class="o">.</span><span class="n">FAVORITE</span><span class="p">,</span> <span class="n">user</span><span class="o">=</span><span class="n">request</span><span class="o">.</span><span class="n">user</span><span class="p">)</span>
<span class="n">picture</span><span class="o">.</span><span class="n">favorites</span><span class="o">.</span><span class="n">count</span><span class="p">()</span></code></pre></figure>

<hr />

<h4 id="reverse-relations">Reverse relations</h4>

<p>You may also define an extra parameter in the GenericRelation:</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="kn">from</span> <span class="nn">django.contrib.contenttypes.fields</span> <span class="kn">import</span> <span class="n">GenericRelation</span>

<span class="k">class</span> <span class="nc">Picture</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">user</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">ForeignKey</span><span class="p">(</span><span class="n">User</span><span class="p">)</span>
    <span class="n">picture_file</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">ImageField</span><span class="p">(</span><span class="n">upload_to</span><span class="o">=</span><span class="s">'uploads/pictures'</span><span class="p">)</span>
    <span class="n">date</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">DateTimeField</span><span class="p">(</span><span class="n">auto_now_add</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="n">favorites</span> <span class="o">=</span> <span class="n">GenericRelation</span><span class="p">(</span><span class="n">Activity</span><span class="p">,</span> <span class="n">related_query_name</span><span class="o">=</span><span class="s">'pictures'</span><span class="p">)</span></code></pre></figure>

<p>Then you can use it to query for example all favorited pictures that was uploaded by a given user:</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">user</span> <span class="o">=</span> <span class="n">User</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">pk</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">Activity</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="nb">filter</span><span class="p">(</span><span class="n">pictures__user</span><span class="o">=</span><span class="n">user</span><span class="p">)</span></code></pre></figure>

<hr />

<h4 id="caveats">Caveats</h4>

<p>This is just one of the usages of the <strong>ContentTypes</strong> and <strong>GenericRelations</strong>. Even though it seems very nice to use,
take care when implementing it! It adds an extra layer of complexity and will eventually make things slower.</p>

<p>Another caveat is that the <strong>GenericForeignKey</strong> does not accept an <strong>on_delete</strong> argument to customize this behavior.
The default behavior will cascade all the relations.</p>

<p>One way to avoid the default behavior is to not define a <strong>GenericRelation</strong>. Check the example below:</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="k">class</span> <span class="nc">Comment</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">text</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">500</span><span class="p">,</span> <span class="n">blank</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="n">date</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">DateTimeField</span><span class="p">(</span><span class="n">auto_now_add</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>

<span class="c"># Add a new instance of Comment</span>
<span class="n">comment</span> <span class="o">=</span> <span class="n">Comment</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">text</span><span class="o">=</span><span class="s">'This is a test comment'</span><span class="p">)</span>

<span class="c"># Like the comment</span>
<span class="n">Activity</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">content_object</span><span class="o">=</span><span class="n">comment</span><span class="p">,</span> <span class="n">activity_type</span><span class="o">=</span><span class="n">Activity</span><span class="o">.</span><span class="n">LIKE</span><span class="p">,</span> <span class="n">user</span><span class="o">=</span><span class="n">request</span><span class="o">.</span><span class="n">user</span><span class="p">)</span></code></pre></figure>

<p>Now to get the list of <strong>likes</strong> this <strong>Comment</strong> received you must use the <strong>ContentType</strong> class:</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="kn">from</span> <span class="nn">django.contrib.contenttypes.models</span> <span class="kn">import</span> <span class="n">ContentType</span>

<span class="c"># Pass the instance we created in the snippet above</span>
<span class="n">ct</span> <span class="o">=</span> <span class="n">ContentType</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get_for_model</span><span class="p">(</span><span class="n">comment</span><span class="p">)</span>

<span class="c"># Get the list of likes</span>
<span class="n">Activity</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="nb">filter</span><span class="p">(</span><span class="n">content_type</span><span class="o">=</span><span class="n">ct</span><span class="p">,</span> <span class="n">object_id</span><span class="o">=</span><span class="n">comment</span><span class="o">.</span><span class="nb">id</span><span class="p">,</span> <span class="n">activity_type</span><span class="o">=</span><span class="n">Activity</span><span class="o">.</span><span class="n">LIKE</span><span class="p">)</span></code></pre></figure>

<p>This is also an option if you want to interact with a model from Django’s contrib module or any third party model that
you don’t have access to add a <strong>GenericRelation</strong>.</p>

            </article>
            
            <hr>
            <div class="popular-posts related-posts">
  <h4>Related Posts</h4>
    <div class="row">
      
    </div>
</div>


            <hr class="dashed">
<div class="row">
  <div class="six columns post-tags" style="padding-top: 4px">
    
      <a href="../../../../tag/django/index.html"><span class="tag">django</span></a>
    
      <a href="../../../../tag/content-types/index.html"><span class="tag">content types</span></a>
    
      <a href="../../../../tag/generic-relations/index.html"><span class="tag">generic relations</span></a>
    
  </div>
  <div class="six columns post-share">
    <div class="social">
  Share this post
  <a href="http://vk.com/share.php?url=http://sibt.co/2nrkmpU"
     rel="nofollow"
     target="_blank"
     title="Share on VK">
    <i class="fa fa-vk"></i>
  </a>
  <a href="https://twitter.com/intent/tweet?text=How%20to%20Use%20Django's%20Generic%20Relations&amp;url=http://sibt.co/2ndPjxz&amp;via=vitorfs&amp;related=vitorfs"
     rel="nofollow"
     target="_blank"
     title="Share on Twitter">
    <i class="fa fa-twitter"></i>
  </a>
  <a href="https://www.facebook.com/sharer/sharer.php?app_id=1645747765697865&amp;u=http://sibt.co/2mMx6o1"
     rel="nofollow"
     target="_blank"
     title="Share on Facebook">
    <i class="fa fa-facebook"></i>
  </a>
  <a href="http://www.linkedin.com/shareArticle?mini=true&amp;url=http://sibt.co/2mwbt9O&amp;title=How%20to%20Use%20Django's%20Generic%20Relations&amp;summary=You%20probably%20have%20already%20seen%20Django%E2%80%99s%20ContentTypes%20and%20wondered%20how%20to%20use%20it%20or%20what%20is%20it%20for%20anyway.Basically%20it%E2%80%99s%20a%20built%20in%20app%20that%20keeps%20track%20of%20models%20from%20the%20installed%20apps%20of%20your%20Dja...&amp;source=https://simpleisbetterthancomplex.com"
     rel="nofollow"
     target="_blank"
     title="Share on LinkedIn">
    <i class="fa fa-linkedin"></i>
  </a>
</div>

  </div>
</div>

          </div>
          <!--div style="text-align:center;margin-bottom:20px">

            <a href="//namecheap.pxf.io/c/477033/408288/5618" target="_blank" rel="noopener nofollow">
              <img src="//a.impactradius-go.com/display-ad/5618-408288" border="0" alt="Search and buy domains from Namecheap. Lowest prices!" width="728" height="90" style="max-width:100%!important" />
            </a>
            <img height="0" width="0" src="//namecheap.pxf.io/i/477033/408288/5618" alt="Impact Radius" style="position:absolute;visibility:hidden;" border="0" />


            <a href="https://click.linksynergy.com/fs-bin/click?id=phY4769lVwA&offerid=467035.415&subid=0&type=4" target="_blank" rel="noopener nofollow">
              <img border="0" alt="Deep Learning Specialization on Coursera" src="https://ad.linksynergy.com/fs-bin/show?id=phY4769lVwA&bids=467035.415&subid=0&type=4&gridnum=16" style="max-width:100%!important">
            </a>

          </div-->

          <div class="card">
            
  <div id="comments">
    <div id="disqus_thread"></div>
    <script>
      var disqus_config = function () {
        this.page.url = 'how-to-use-generic-relations.html';
        this.page.identifier = '/tutorial/2016/10/13/how-to-use-generic-relations';
      };
      (function() {
      var d = document, s = d.createElement('script');
      s.src = 'http://simpleisbetterthancomplex.disqus.com/embed.js';
      s.setAttribute('data-timestamp', +new Date());
      (d.head || d.body).appendChild(s);
      })();
    </script>
    <script id="dsq-count-scr" src="http://simpleisbetterthancomplex.disqus.com/count.js" async></script>
    <noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript>
  </div>


          </div>
          <div class="card subscribe">
  <form action="https://colossus.simpleisbetterthancomplex.com/subscribe/d2320a41-0378-4aa8-8f4e-5bb1ffcd521d/" method="post" target="_blank" novalidate>
    <h4>
      <span class="fa fa-send" style="margin-right: 5px"></span> Subscribe to our Mailing List
    </h4>
    <h5>Receive updates from the Blog!</h5>
    <div class="row">
      <div class="eight columns">
        <input class="u-full-width" placeholder="Your email address" type="email" name="email">
      </div>
      <div class="four columns">
        <button type="submit" class="u-full-width">Subscribe</button>
      </div>
    </div>
  </form>
</div>

          <div class="card popular-posts">
  <h4>Popular Posts</h4>
  <div class="row">
    
      <div class="four columns">
        <a href="../../07/22/how-to-extend-django-user-model.html">
          <img src="../../../../media/2016-07-22-how-to-extend-django-user-model/featured-post-image.jpg" alt="How to Extend Django User Model" title="How to Extend Django User Model">
          How to Extend Django User Model
        </a>
      </div>
    
      <div class="four columns">
        <a href="../../05/11/how-to-setup-ssl-certificate-on-nginx-for-django-application.html">
          <img src="../../../../media/2016-05-11-how-to-setup-ssl-certificate-on-nginx-for-django-application/featured-post-image.jpg" alt="How to Setup a SSL Certificate on Nginx for a Django Application" title="How to Setup a SSL Certificate on Nginx for a Django Application">
          How to Setup a SSL Certificate on Nginx for a Django Application
        </a>
      </div>
    
      <div class="four columns">
        <a href="../14/how-to-deploy-to-digital-ocean.html">
          <img src="../../../../media/2016/10/featured-do.jpg" alt="How to Deploy a Django Application to Digital Ocean" title="How to Deploy a Django Application to Digital Ocean">
          How to Deploy a Django Application to Digital Ocean
        </a>
      </div>
    
  </div>
</div>

        </div>
      </div>
    </div>
  </main>
  <footer>
  <div class="container">
    <ul>
      <li>© 2015-2021 simple complex</li>
      <li><a rel="license noopener" href="https://creativecommons.org/licenses/by-nc-sa/3.0/" target="_blank">cc by-nc-sa 3.0</a></li>
      <li>//</li>
      <li><a href="../../../../about/index.html" rel="author">about</a></li>
      <li><a href="../../../../contact/index.html">contact</a></li>
      <li><a href="../../../../faq/index.html">faq</a></li>
      <li><a href="../../../../cookies/index.html">cookies</a></li>
      <li><a href="../../../../privacy/index.html">privacy policy</a></li>
    </ul>
  </div>
</footer>
<div class="overlay"></div>

  
  <script id="ga-page-views" src="../../../../js/page-views.js" async></script>
  <script src="http://z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=1d8c6a0f-2136-49ad-b0b3-0b09662b7e28"></script>


<style>
.related-posts .row {
  display: grid;
  grid-gap: 20px;
  grid-template-columns: repeat(3, 1fr);
}

.related-posts .four.columns {
  width: 100%;
}
</style>

<script>
_bsa.init('recommended', 'CK7I4KJJ', 'placement:simpleisbetterthancomplexcom',
    {
      target: '.related-posts .columns',
      template: `
<div class="four columns">
<a href="##link##" rel="noopener nofollow">
<img src="##smallImage##" alt="##title##" title="##title##">[Sponsored] ##title##</a>
</div>
      `
    }
  );
</script>

<script type="application/ld+json">
{
  "@context": "http://schema.org",
  "@type": "BlogPosting",
  "mainEntityOfPage": "https://simpleisbetterthancomplex.com/tutorial/2016/10/13/how-to-use-generic-relations.html",
  "headline": "How to Use Django's Generic Relations",
  "image": {
    "@type": "ImageObject",
    "url": "https://simpleisbetterthancomplex.com/media/2016/10/featured-generic.jpg",
    "height": 370,
    "width": 960
  },
  "datePublished": "2016-10-13T14:48:00+03:00",
  "dateModified": "2016-10-13T14:48:00+03:00",
  "author": {
    "@type": "Person",
    "name": "Vitor Freitas"
  },
   "publisher": {
    "@type": "Organization",
    "name": "Simple is Better Than Complex",
    "logo": {
      "@type": "ImageObject",
      "url": "https://simpleisbetterthancomplex.com/img/gplus_logo.png",
      "height": 60,
      "width": 600
    }
  },
  "description": "You probably have already seen Django’s ContentTypes and wondered how to use it or what is it for anyway.Basically it’s a built in app that keeps track of models from the installed apps of your Dja..."
}
</script>

</body>

<!-- Mirrored from simpleisbetterthancomplex.com/tutorial/2016/10/13/how-to-use-generic-relations.html by HTTrack Website Copier/3.x [XR&CO'2014], Fri, 03 Sep 2021 12:47:01 GMT -->
</html>

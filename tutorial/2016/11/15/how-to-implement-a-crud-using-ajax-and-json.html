<!DOCTYPE html>
<html lang="en">

<!-- Mirrored from simpleisbetterthancomplex.com/tutorial/2016/11/15/how-to-implement-a-crud-using-ajax-and-json.html by HTTrack Website Copier/3.x [XR&CO'2014], Fri, 03 Sep 2021 12:46:17 GMT -->
<head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta name="ir-site-verification-token" value="-233745807">
<title>How to Implement CRUD Using Ajax and Json</title>
<meta name="description" content="Using Ajax to create asynchronous request to manipulate Django models is a very common use case. It can be used toprovide an in line edit in a table, or crea...">
<link href="https://fonts.googleapis.com/css?family=Raleway:400,300,500,600,700" rel="stylesheet" type="text/css">
<link rel="stylesheet" href="../../../../css/main71de.css?v=34">
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">
<link rel="canonical" href="how-to-implement-a-crud-using-ajax-and-json.html">
<link rel="alternate" type="application/rss+xml" title="Simple is Better Than Complex" href="../../../../feed.xml" />
<link rel="icon" type="image/png" href="../../../../favicon.png">
<link rel="mask-icon" href="../../../../safari-pinned-tab.svg" color="#5bbad5">
<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.2/jquery.min.js"></script>
<script src="../../../../js/site7b30.js?v=4"></script>

  <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','http://www.google-analytics.com/analytics.js','ga');
    ga('create', 'UA-42049022-10', 'auto');
    ga('send', 'pageview');
  </script>
  <script>
    $(function () {
      $("#ad").on("click", "#carbonads .carbon-wrap a", function () {
        var page_id = 'how-to-implement-a-crud-using-ajax-and-json.html';
        ga('send', 'event', 'carbonads', 'click', page_id, {
          'transport': 'beacon'
        });
      });
    });
  </script>
  <script>
  !function(f,b,e,v,n,t,s){if(f.fbq)return;n=f.fbq=function(){n.callMethod?
  n.callMethod.apply(n,arguments):n.queue.push(arguments)};if(!f._fbq)f._fbq=n;
  n.push=n;n.loaded=!0;n.version='2.0';n.queue=[];t=b.createElement(e);t.async=!0;
  t.src=v;s=b.getElementsByTagName(e)[0];s.parentNode.insertBefore(t,s)}(window,
  document,'script','https://connect.facebook.net/en_US/fbevents.js');
  fbq('init', '1689711451348257');
  fbq('track', 'PageView');
  </script>
  <noscript><img height="1" width="1" style="display:none" alt="PageView"
  src="https://www.facebook.com/tr?id=1689711451348257&amp;ev=PageView&amp;noscript=1"
  /></noscript>
  <script data-ad-client="ca-pub-5430683801108011" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>


  <meta property="og:title" content="How to Implement CRUD Using Ajax and Json">
<meta property="og:url" content="https://simpleisbetterthancomplex.com/tutorial/2016/11/15/how-to-implement-a-crud-using-ajax-and-json.html">
<meta property="og:image" content="https://simpleisbetterthancomplex.com/media/2016/11/thumbnail-ajax.jpg">
<meta property="og:description" content="Using Ajax to create asynchronous request to manipulate Django models is a very common use case. It can be used toprovide an in line edit in a table, or crea...">
<meta property="og:site_name" content="Simple is Better Than Complex">
<meta property="og:locale" content="en_US">

  <meta property="article:published_time" content="2016-11-15T13:42:00+02:00">
  <meta property="article:author" content="https://facebook.com/vitorfs">

<meta property="fb:admins" content="100000024295617">
<meta property="fb:app_id" content="1645747765697865">

<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:site" content="vitorfs">
<meta name="twitter:creator" content="vitorfs">
<meta name="twitter:title" content="How to Implement CRUD Using Ajax and Json">
<meta name="twitter:description" content="Using Ajax to create asynchronous request to manipulate Django models is a very common use case. It can be used toprovide an in line edit in a table, or create a new model instance without going ba...">
<meta name="twitter:image" content="https://simpleisbetterthancomplex.com/media/2016/11/thumbnail-ajax.jpg">
<meta name="p:domain_verify" content="e262845cb18e4c68b0cff535a0eaea5d">
  <meta property="og:type" content="article">
  
    <meta property="article:tag" content="django">
  
    <meta property="article:tag" content="ajax">
  
    <meta property="article:tag" content="crud">
  
    <meta property="article:tag" content="jquery">
  
  <style type="text/css">
    @media (min-width: 750px) {
      body {
        /*padding-top:50px!important;*/
      }
    }
  </style>
  <script src="http://m.servedby-buysellads.com/monetization.js"></script>
</head>
<body>
  <div id="top" style="visibility: hidden"></div>
<header>
  <div class="container">
    <ul class="menu menu-right">
      <li class="menu-item">
        <a href="../../../../search/index.html">
          <span class="fa fa-search"></span>
        </a>
      </li>
      <li class="toggle-menu">
        <a href="javascript:void(0);">
          <span class="fa fa-bars"></span>
        </a>
      </li>
    </ul>
    <ul class="menu menu-left">
      <li class="logo">
        <a href="../../../../index.html" style="font-weight: 900">simple<span class="brand">is</span>better<span class="brand">than</span>complex</a>
      </li>
      <li class="menu-item">
        <a href="../../../../index.html">
          <span class="fa fa-home" style="margin-right: 3px"></span>
          Home
        </a>
      </li>
      <li class="menu-item">
        <a href="../../../../archive/index.html">
          <span class="fa fa-archive" style="margin-right: 3px"></span>
          Articles
        </a>
      </li>
      <li class="menu-item">
        <a href="../../../../videos/index.html">
          <span class="fa fa-video-camera" style="margin-right: 3px"></span>
          Videos
        </a>
      </li>
      <li class="menu-item">
        <a href="../../../../series/index.html">
          <span class="fa fa-book" style="margin-right: 3px"></span>
          Series
        </a>
      </li>
      <li class="menu-item">
        <a href="../../../../snippets/index.html">
          <span class="fa fa-code" style="margin-right: 3px"></span>
          Snippets
        </a>
      </li>
      <li class="menu-item">
        <a href="../../../../sponsor/index.html">
          <span class="fa fa-bullhorn" style="margin-right: 3px"></span>
          Sponsor
        </a>
      </li>
      <li class="menu-item">
        <a href="../../../../feed.xml" target="_blank">
          <span class="fa fa-rss" style="margin-right: 3px"></span>
          RSS
        </a>
      </li>
      <li class="menu-item">
        <a href="https://colossus.simpleisbetterthancomplex.com/subscribe/d2320a41-0378-4aa8-8f4e-5bb1ffcd521d/" class="brand" target="_blank">
          <span class="fa fa-send" style="margin-right: 3px"></span> Subscribe
        </a>
      </li>
      <li class="menu-item hidden-mobile">
        <a href="../../../../search/index.html">
          <span class="fa fa-search"></span> Search
        </a>
      </li>
    </ul>
  </div>
</header>

  <!--p style="text-align:center;font-size:1.4rem;margin-top:2rem;margin-bottom:2rem;">
    <span style="background-color:#1eaedb;color:#fff;border-radius:3px;padding:3px 5px;font-size:1.2rem;margin-right:5px;">Sponsored</span>
    <a href="/sponsor/" rel="noopener nofollow">
      By You? Learn more about sponsorship of the blog.
    </a>
  </p-->

  <main>
    <div class="container">
      <div class="row">
        <div class="ten offset-by-one columns content post">
          <div class="card post-author">
  <div class="author-picture">
    <img src="../../../../img/picture.jpg" alt="Vitor Freitas">
  </div>
  <div class="author-info">
    <p class="name">By <strong>Vitor Freitas</strong></p>
    <a href="https://www.digitalocean.com/?refcode=074832454ff1&amp;utm_campaign=Referral_Invite&amp;utm_medium=Referral_Program&amp;utm_source=badge" class="powered-by-do">
      <img src="https://web-platforms.sfo2.cdn.digitaloceanspaces.com/WWW/Badge 1.svg" alt="DigitalOcean Referral Badge">
    </a>
    <p class="bio">
      I'm a passionate software developer and researcher. I write about Python, Django and Web Development on a weekly basis. <a href="../../../../about/index.html" rel="author">Read more</a>.
    </p>
    <p class="contact">
      <a href="https://www.youtube.com/VitorFreitas" rel="me noopener" target="_blank" title="YouTube"><i class="fa fa-youtube-play"></i></a>
      <a href="https://github.com/vitorfs" rel="me noopener" target="_blank" title="GitHub"><i class="fa fa-github"></i></a>
      <a href="https://twitter.com/vitorfs" rel="me noopener" target="_blank" title="Twitter"><i class="fa fa-twitter"></i></a>
      <a href="https://facebook.com/vitorfs" rel="me noopener" target="_blank" title="Facebook"><i class="fa fa-facebook-official"></i></a>
      <a href="https://linkedin.com/in/vitorfs" rel="me noopener" target="_blank" title="LinkedIn"><i class="fa fa-linkedin-square"></i></a>
      <a href="https://instagram.com/vitorfs" rel="me noopener" target="_blank" title="Instagram"><i class="fa fa-instagram"></i></a>
      <a href="../../../../contact/index.html" title="Contact"><i class="fa fa-envelope"></i></a>
    </p>
  </div>
  
  
  <div class="row">
    <div class="six columns">
      <div id="ad">
        <script async type="text/javascript" src="http://cdn.carbonads.com/carbon.js?serve=CKYIEKQM&amp;placement=simpleisbetterthancomplexcom" id="_carbonads_js"></script>
      </div>
    </div>


    <!--div class="six columns">
      <div id="ad2">
        <div id="sponsored">
          <a href="/sponsor/">
            <img src="/media/sponsored/ad.png" alt="Advertise Here">
            <span>Reach 90k+ Django developers every month. Learn more about sponsorship of the blog.</span>
          </a>
          <small>
            <a href="/sponsor/">Sponsored</a>
          </small>
        </div>

        <div id="sponsored">
          <a href="https://click.linksynergy.com/link?id=phY4769lVwA&offerid=507388.567828&type=2&murl=https%3A%2F%2Fwww.udemy.com%2Fcomplete-python-bootcamp%2F" target="_blank" rel="noopener nofollow">
            <img border="0" src="https://udemy-images.udemy.com/course/480x270/567828_67d0.jpg" alt="Complete Python Bootcamp: Go from zero to hero in Python 3">
            <span>Complete Python Bootcamp: Go from zero to hero in Python 3</span>
          </a>
          <small>
            <a href="/sponsor/">Sponsored</a>
          </small>
          <img border="0" width="1" height="1" src="https://ad.linksynergy.com/fs-bin/show?id=phY4769lVwA&bids=507388.567828&type=2&subid=0" alt="LinkSynergy">
        </div>

      </div>
    </div-->


  </div>
  
</div>


          <p style="text-align:center;font-size:1.4rem;margin-bottom:4rem;">
            <i class="fa fa-youtube-play" style="color:#ff0000!important;"></i> <a href="https://www.youtube.com/VitorFreitas?sub_confirmation=1" target="_blank">Subscribe to our YouTube Channel!</a>
            <br>
            <a href="https://youtu.be/Udf4VbtM92Y" target="_blank">[Jul 12, 2021] New Video: How to Use Django Rest Framework Permissions (DRF Tutorial - Part 7)</a>
          </p>

          <div class="card">
            
  <h5 class="post-category">
    
      tutorial
    
  </h5>
  <hr class="dashed">

<h3 class="post-title">How to Implement CRUD Using Ajax and Json</h3>
<ul class="post-meta">
  <li>
    <i class="fa fa-calendar"></i> Nov 15, 2016
  </li>
  <li>
    <i class="fa fa-clock-o"></i>
    35 minutes read
  </li>
  <li>
    <i class="fa fa-comments"></i>
    <a href="#disqus_thread" data-disqus-identifier="/tutorial/2016/11/15/how-to-implement-a-crud-using-ajax-and-json">comments</a>
  </li>
  <li>
    <i class="fa fa-eye"></i>
    <span class="ga-page-views" data-ga-identifier="how-to-implement-a-crud-using-ajax-and-json.html"></span> views
  </li>
  
  
</ul>

  <div class="post-featured-image">
    <img src="../../../../media/2016/11/featured-ajax.jpg" alt="How to Implement CRUD Using Ajax and Json" class="featured-image">
    
      <small>(Picture: <a href="https://www.pexels.com/photo/macbook-laptop-smartphone-apple-7358/" target="_blank">https://www.pexels.com/photo/macbook-laptop-smartphone-apple-7358/</a>)</small>
    
  </div>


            <article>
              <p>Using Ajax to create asynchronous request to manipulate Django models is a very common use case. It can be used to
provide an in line edit in a table, or create a new model instance without going back and forth in the website.
It also bring some challenges, such as keeping the state of the objects consistent.</p>

<p>In case you are not familiar with the term CRUD, it stand for <strong>C</strong>reate <strong>R</strong>ead <strong>U</strong>pdate <strong>D</strong>elete.</p>

<p>Those are the basic operations we perform in the application entities. For the most part the Django Admin is all about
CRUD.</p>

<p>This tutorial is compatible with Python 2.7 and 3.5, using Django 1.8, 1.9 or 1.10.</p>

<hr />

<h4 id="table-of-contents">Table of Contents</h4>

<ul>
  <li><a href="#basic-configuration">Basic Configuration</a></li>
  <li><a href="#working-example">Working Example</a></li>
  <li><a href="#listing-books">Listing Books</a></li>
  <li><a href="#create-book">Create Book</a></li>
  <li><a href="#edit-book">Edit Book</a></li>
  <li><a href="#delete-book">Delete Book</a></li>
  <li><a href="#conclusions">Conclusions</a></li>
</ul>

<hr />

<h4 id="basic-configuration">Basic Configuration</h4>

<p>For this tutorial we will be using jQuery to implement the Ajax requests. Feel free to use any other JavaScript
framework (or to implement it using bare JavaScript). The concepts should remain the same.</p>

<p>Grab a copy of jQuery, either download it or refer to one of the many CDN options.</p>

<p><a href="http://jquery.com/download/" target="_blank">jquery.com/download/</a></p>

<p>I usually like to have a local copy, because sometimes I have to work off-line. Place the jQuery in the bottom of your
base template:</p>

<p><strong>base.html</strong></p>

<figure class="highlight"><pre><code class="language-django" data-lang="django"><span class="cp">{%</span> <span class="nv">load</span> <span class="nv">static</span> <span class="cp">%}&lt;!DOCTYPE html&gt;</span>
<span class="nt">&lt;html</span> <span class="na">lang=</span><span class="s">"en"</span><span class="nt">&gt;</span>
  <span class="nt">&lt;head&gt;</span>
    <span class="nt">&lt;meta</span> <span class="na">charset=</span><span class="s">"utf-8"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;meta</span> <span class="na">http-equiv=</span><span class="s">"X-UA-Compatible"</span> <span class="na">content=</span><span class="s">"IE=edge"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;meta</span> <span class="na">name=</span><span class="s">"viewport"</span> <span class="na">content=</span><span class="s">"width=device-width, initial-scale=1"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;title&gt;</span>Bookstore - Simple is Better Than Complex<span class="nt">&lt;/title&gt;</span>
    <span class="nt">&lt;link</span> <span class="na">href=</span><span class="s">"</span><span class="cp">{%</span> <span class="nv">static</span> <span class="s1">'css/bootstrap.min.css'</span> <span class="cp">%}</span><span class="s">"</span> <span class="na">rel=</span><span class="s">"stylesheet"</span><span class="nt">&gt;</span>
    <span class="c">&lt;!--[if lt IE 9]&gt;
      &lt;script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"&gt;&lt;/script&gt;
      &lt;script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"&gt;&lt;/script&gt;
    &lt;![endif]--&gt;</span>
  <span class="nt">&lt;/head&gt;</span>
  <span class="nt">&lt;body&gt;</span>
    <span class="cp">{%</span> <span class="k">include</span> <span class="s1">'includes/header.html'</span> <span class="cp">%}</span>
    <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"container"</span><span class="nt">&gt;</span>
      <span class="cp">{%</span> <span class="k">block</span> <span class="nv">content</span> <span class="cp">%}</span>
      <span class="cp">{%</span> <span class="k">endblock</span> <span class="cp">%}</span>
    <span class="nt">&lt;/div&gt;</span>
    <span class="nt">&lt;script </span><span class="na">src=</span><span class="s">"</span><span class="cp">{%</span> <span class="nv">static</span> <span class="s1">'js/jquery-3.1.1.min.js'</span> <span class="cp">%}</span><span class="s">"</span><span class="nt">&gt;&lt;/script&gt;</span>  <span class="c">&lt;!-- JQUERY HERE --&gt;</span>
    <span class="nt">&lt;script </span><span class="na">src=</span><span class="s">"</span><span class="cp">{%</span> <span class="nv">static</span> <span class="s1">'js/bootstrap.min.js'</span> <span class="cp">%}</span><span class="s">"</span><span class="nt">&gt;&lt;/script&gt;</span>
    <span class="cp">{%</span> <span class="k">block</span> <span class="nv">javascript</span> <span class="cp">%}</span>
    <span class="cp">{%</span> <span class="k">endblock</span> <span class="cp">%}</span>
  <span class="nt">&lt;/body&gt;</span>
<span class="nt">&lt;/html&gt;</span></code></pre></figure>

<p>I will be also using Bootstrap. It is not required but it provide a good base css and also some useful HTML components,
such as a Modal and pretty tables.</p>

<hr />

<h4 id="working-example">Working Example</h4>

<p>I will be working in a app called <strong>books</strong>. For the CRUD operations consider the following model:</p>

<p><strong>models.py</strong></p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="k">class</span> <span class="nc">Book</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">HARDCOVER</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="n">PAPERBACK</span> <span class="o">=</span> <span class="mi">2</span>
    <span class="n">EBOOK</span> <span class="o">=</span> <span class="mi">3</span>
    <span class="n">BOOK_TYPES</span> <span class="o">=</span> <span class="p">(</span>
        <span class="p">(</span><span class="n">HARDCOVER</span><span class="p">,</span> <span class="s">'Hardcover'</span><span class="p">),</span>
        <span class="p">(</span><span class="n">PAPERBACK</span><span class="p">,</span> <span class="s">'Paperback'</span><span class="p">),</span>
        <span class="p">(</span><span class="n">EBOOK</span><span class="p">,</span> <span class="s">'E-book'</span><span class="p">),</span>
    <span class="p">)</span>
    <span class="n">title</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">50</span><span class="p">)</span>
    <span class="n">publication_date</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">DateField</span><span class="p">(</span><span class="n">null</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="n">author</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span> <span class="n">blank</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="n">price</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">DecimalField</span><span class="p">(</span><span class="n">max_digits</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">decimal_places</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
    <span class="n">pages</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">IntegerField</span><span class="p">(</span><span class="n">blank</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="n">book_type</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">PositiveSmallIntegerField</span><span class="p">(</span><span class="n">choices</span><span class="o">=</span><span class="n">BOOK_TYPES</span><span class="p">)</span></code></pre></figure>

<hr />

<h4 id="listing-books">Listing Books</h4>

<p>Let’s get started by listing all the book objects.</p>

<p>We need a route in the urlconf:</p>

<p><strong>urls.py</strong>:</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="kn">from</span> <span class="nn">django.conf.urls</span> <span class="kn">import</span> <span class="n">url</span><span class="p">,</span> <span class="n">include</span>
<span class="kn">from</span> <span class="nn">mysite.books</span> <span class="kn">import</span> <span class="n">views</span>

<span class="n">urlpatterns</span> <span class="o">=</span> <span class="p">[</span>
    <span class="n">url</span><span class="p">(</span><span class="s">r'^books/$'</span><span class="p">,</span> <span class="n">views</span><span class="o">.</span><span class="n">book_list</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s">'book_list'</span><span class="p">),</span>
<span class="p">]</span></code></pre></figure>

<p>A simple view to list all the books:</p>

<p><strong>views.py</strong></p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="kn">from</span> <span class="nn">django.shortcuts</span> <span class="kn">import</span> <span class="n">render</span>
<span class="kn">from</span> <span class="nn">.models</span> <span class="kn">import</span> <span class="n">Book</span>

<span class="k">def</span> <span class="nf">book_list</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="n">books</span> <span class="o">=</span> <span class="n">Book</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="nb">all</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">render</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s">'books/book_list.html'</span><span class="p">,</span> <span class="p">{</span><span class="s">'books'</span><span class="p">:</span> <span class="n">books</span><span class="p">})</span></code></pre></figure>

<p><strong>book_list.html</strong></p>

<figure class="highlight"><pre><code class="language-django" data-lang="django"><span class="cp">{%</span> <span class="k">extends</span> <span class="s1">'base.html'</span> <span class="cp">%}</span>

<span class="cp">{%</span> <span class="k">block</span> <span class="nv">content</span> <span class="cp">%}</span>
  <span class="nt">&lt;h1</span> <span class="na">class=</span><span class="s">"page-header"</span><span class="nt">&gt;</span>Books<span class="nt">&lt;/h1&gt;</span>
  <span class="nt">&lt;table</span> <span class="na">class=</span><span class="s">"table"</span> <span class="na">id=</span><span class="s">"book-table"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;thead&gt;</span>
      <span class="nt">&lt;tr&gt;</span>
        <span class="nt">&lt;th&gt;</span>#<span class="nt">&lt;/th&gt;</span>
        <span class="nt">&lt;th&gt;</span>Title<span class="nt">&lt;/th&gt;</span>
        <span class="nt">&lt;th&gt;</span>Author<span class="nt">&lt;/th&gt;</span>
        <span class="nt">&lt;th&gt;</span>Type<span class="nt">&lt;/th&gt;</span>
        <span class="nt">&lt;th&gt;</span>Publication date<span class="nt">&lt;/th&gt;</span>
        <span class="nt">&lt;th&gt;</span>Pages<span class="nt">&lt;/th&gt;</span>
        <span class="nt">&lt;th&gt;</span>Price<span class="nt">&lt;/th&gt;</span>
      <span class="nt">&lt;/tr&gt;</span>
    <span class="nt">&lt;/thead&gt;</span>
    <span class="nt">&lt;tbody&gt;</span>
      <span class="cp">{%</span> <span class="k">for</span> <span class="nv">book</span> <span class="ow">in</span> <span class="nv">book_list</span> <span class="cp">%}</span>
        <span class="nt">&lt;tr&gt;</span>
          <span class="nt">&lt;td&gt;</span><span class="cp">{{</span> <span class="nv">book.id</span> <span class="cp">}}</span><span class="nt">&lt;/td&gt;</span>
          <span class="nt">&lt;td&gt;</span><span class="cp">{{</span> <span class="nv">book.title</span> <span class="cp">}}</span><span class="nt">&lt;/td&gt;</span>
          <span class="nt">&lt;td&gt;</span><span class="cp">{{</span> <span class="nv">book.author</span> <span class="cp">}}</span><span class="nt">&lt;/td&gt;</span>
          <span class="nt">&lt;td&gt;</span><span class="cp">{{</span> <span class="nv">book.get_book_type_display</span> <span class="cp">}}</span><span class="nt">&lt;/td&gt;</span>
          <span class="nt">&lt;td&gt;</span><span class="cp">{{</span> <span class="nv">book.publication_date</span> <span class="cp">}}</span><span class="nt">&lt;/td&gt;</span>
          <span class="nt">&lt;td&gt;</span><span class="cp">{{</span> <span class="nv">book.pages</span> <span class="cp">}}</span><span class="nt">&lt;/td&gt;</span>
          <span class="nt">&lt;td&gt;</span><span class="cp">{{</span> <span class="nv">book.price</span> <span class="cp">}}</span><span class="nt">&lt;/td&gt;</span>
        <span class="nt">&lt;/tr&gt;</span>
      <span class="cp">{%</span> <span class="nv">empty</span> <span class="cp">%}</span>
        <span class="nt">&lt;tr&gt;</span>
          <span class="nt">&lt;td</span> <span class="na">colspan=</span><span class="s">"7"</span> <span class="na">class=</span><span class="s">"text-center bg-warning"</span><span class="nt">&gt;</span>No book<span class="nt">&lt;/td&gt;</span>
        <span class="nt">&lt;/tr&gt;</span>
      <span class="cp">{%</span> <span class="k">endfor</span> <span class="cp">%}</span>
    <span class="nt">&lt;/tbody&gt;</span>
  <span class="nt">&lt;/table&gt;</span>
<span class="cp">{%</span> <span class="k">endblock</span> <span class="cp">%}</span></code></pre></figure>

<p>So far nothing special. Our template should look like this:</p>

<p><img src="../../../../media/2016/11/books1.png" alt="Books List" /></p>

<hr />

<h4 id="create-book">Create Book</h4>

<p>First thing, let’s create a model form. Let Django do its work.</p>

<p><strong>forms.py</strong></p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="kn">from</span> <span class="nn">django</span> <span class="kn">import</span> <span class="n">forms</span>
<span class="kn">from</span> <span class="nn">.models</span> <span class="kn">import</span> <span class="n">Book</span>

<span class="k">class</span> <span class="nc">BookForm</span><span class="p">(</span><span class="n">forms</span><span class="o">.</span><span class="n">ModelForm</span><span class="p">):</span>
    <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
        <span class="n">model</span> <span class="o">=</span> <span class="n">Book</span>
        <span class="n">fields</span> <span class="o">=</span> <span class="p">(</span><span class="s">'title'</span><span class="p">,</span> <span class="s">'publication_date'</span><span class="p">,</span> <span class="s">'author'</span><span class="p">,</span> <span class="s">'price'</span><span class="p">,</span> <span class="s">'pages'</span><span class="p">,</span> <span class="s">'book_type'</span><span class="p">,</span> <span class="p">)</span></code></pre></figure>

<p>We need now to prepare the template to handle the creation operation. We will be working with partial templates to
render only the parts that we actually need.</p>

<p>The strategy I like to use is to place a generic bootstrap modal, and use it for all the operations.</p>

<p><strong>book_list.html</strong></p>

<figure class="highlight"><pre><code class="language-django" data-lang="django"><span class="cp">{%</span> <span class="k">extends</span> <span class="s1">'base.html'</span> <span class="cp">%}</span>

<span class="cp">{%</span> <span class="k">block</span> <span class="nv">content</span> <span class="cp">%}</span>
  <span class="nt">&lt;h1</span> <span class="na">class=</span><span class="s">"page-header"</span><span class="nt">&gt;</span>Books<span class="nt">&lt;/h1&gt;</span>

  <span class="c">&lt;!-- BUTTON TO TRIGGER THE ACTION --&gt;</span>
  <span class="nt">&lt;p&gt;</span>
    <span class="nt">&lt;button</span> <span class="na">type=</span><span class="s">"button"</span> <span class="na">class=</span><span class="s">"btn btn-primary js-create-book"</span><span class="nt">&gt;</span>
      <span class="nt">&lt;span</span> <span class="na">class=</span><span class="s">"glyphicon glyphicon-plus"</span><span class="nt">&gt;&lt;/span&gt;</span>
      New book
    <span class="nt">&lt;/button&gt;</span>
  <span class="nt">&lt;/p&gt;</span>

  <span class="nt">&lt;table</span> <span class="na">class=</span><span class="s">"table"</span> <span class="na">id=</span><span class="s">"book-table"</span><span class="nt">&gt;</span>
    <span class="c">&lt;!-- TABLE CONTENT SUPPRESSED FOR BREVITY'S SAKE --&gt;</span>
  <span class="nt">&lt;/table&gt;</span>

  <span class="c">&lt;!-- THE MODAL WE WILL BE USING --&gt;</span>
  <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"modal fade"</span> <span class="na">id=</span><span class="s">"modal-book"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"modal-dialog"</span><span class="nt">&gt;</span>
      <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"modal-content"</span><span class="nt">&gt;</span>
      <span class="nt">&lt;/div&gt;</span>
    <span class="nt">&lt;/div&gt;</span>
<span class="cp">{%</span> <span class="k">endblock</span> <span class="cp">%}</span></code></pre></figure>

<p>Note that I already added a <strong>button</strong> that will be used to start the creation process. I added a class <strong>js-create-book</strong>
to hook the click event. I usually add a class starting with <strong>js-</strong> for all elements that interacts with JavaScript
code. It’s easier to debug the code later on. It’s not a enforcement but just a convention. Helps the code quality.</p>

<p>Add a new route:</p>

<p><strong>urls.py</strong>:</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="kn">from</span> <span class="nn">django.conf.urls</span> <span class="kn">import</span> <span class="n">url</span><span class="p">,</span> <span class="n">include</span>
<span class="kn">from</span> <span class="nn">mysite.books</span> <span class="kn">import</span> <span class="n">views</span>

<span class="n">urlpatterns</span> <span class="o">=</span> <span class="p">[</span>
    <span class="n">url</span><span class="p">(</span><span class="s">r'^books/$'</span><span class="p">,</span> <span class="n">views</span><span class="o">.</span><span class="n">book_list</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s">'book_list'</span><span class="p">),</span>
    <span class="n">url</span><span class="p">(</span><span class="s">r'^books/create/$'</span><span class="p">,</span> <span class="n">views</span><span class="o">.</span><span class="n">book_create</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s">'book_create'</span><span class="p">),</span>
<span class="p">]</span></code></pre></figure>

<p>Let’s implement the <strong>book_create</strong> view:</p>

<p><strong>views.py</strong></p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="kn">from</span> <span class="nn">django.http</span> <span class="kn">import</span> <span class="n">JsonResponse</span>
<span class="kn">from</span> <span class="nn">django.template.loader</span> <span class="kn">import</span> <span class="n">render_to_string</span>
<span class="kn">from</span> <span class="nn">.forms</span> <span class="kn">import</span> <span class="n">BookForm</span>

<span class="k">def</span> <span class="nf">book_create</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="n">form</span> <span class="o">=</span> <span class="n">BookForm</span><span class="p">()</span>
    <span class="n">context</span> <span class="o">=</span> <span class="p">{</span><span class="s">'form'</span><span class="p">:</span> <span class="n">form</span><span class="p">}</span>
    <span class="n">html_form</span> <span class="o">=</span> <span class="n">render_to_string</span><span class="p">(</span><span class="s">'books/includes/partial_book_create.html'</span><span class="p">,</span>
        <span class="n">context</span><span class="p">,</span>
        <span class="n">request</span><span class="o">=</span><span class="n">request</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="k">return</span> <span class="n">JsonResponse</span><span class="p">({</span><span class="s">'html_form'</span><span class="p">:</span> <span class="n">html_form</span><span class="p">})</span></code></pre></figure>

<p>Note that we are not rendering a template but returning a Json response.</p>

<p>Now we create the partial template to render the form:</p>

<p><strong>partial_book_create.html</strong></p>

<figure class="highlight"><pre><code class="language-django" data-lang="django"><span class="cp">{%</span> <span class="nv">load</span> <span class="nv">widget_tweaks</span> <span class="cp">%}</span>

<span class="nt">&lt;form</span> <span class="na">method=</span><span class="s">"post"</span><span class="nt">&gt;</span>
  <span class="cp">{%</span> <span class="nv">csrf_token</span> <span class="cp">%}</span>
  <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"modal-header"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;button</span> <span class="na">type=</span><span class="s">"button"</span> <span class="na">class=</span><span class="s">"close"</span> <span class="na">data-dismiss=</span><span class="s">"modal"</span> <span class="na">aria-label=</span><span class="s">"Close"</span><span class="nt">&gt;</span>
      <span class="nt">&lt;span</span> <span class="na">aria-hidden=</span><span class="s">"true"</span><span class="nt">&gt;</span><span class="ni">&amp;times;</span><span class="nt">&lt;/span&gt;</span>
    <span class="nt">&lt;/button&gt;</span>
    <span class="nt">&lt;h4</span> <span class="na">class=</span><span class="s">"modal-title"</span><span class="nt">&gt;</span>Create a new book<span class="nt">&lt;/h4&gt;</span>
  <span class="nt">&lt;/div&gt;</span>
  <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"modal-body"</span><span class="nt">&gt;</span>
    <span class="cp">{%</span> <span class="k">for</span> <span class="nv">field</span> <span class="ow">in</span> <span class="nv">form</span> <span class="cp">%}</span>
      <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"form-group</span><span class="cp">{%</span> <span class="k">if</span> <span class="nv">field.errors</span> <span class="cp">%}</span><span class="s"> has-error</span><span class="cp">{%</span> <span class="k">endif</span> <span class="cp">%}</span><span class="s">"</span><span class="nt">&gt;</span>
        <span class="nt">&lt;label</span> <span class="na">for=</span><span class="s">"</span><span class="cp">{{</span> <span class="nv">field.id_for_label</span> <span class="cp">}}</span><span class="s">"</span><span class="nt">&gt;</span><span class="cp">{{</span> <span class="nv">field.label</span> <span class="cp">}}</span><span class="nt">&lt;/label&gt;</span>
        <span class="cp">{%</span> <span class="nv">render_field</span> <span class="nv">field</span> <span class="nv">class</span><span class="err">=</span><span class="s2">"form-control"</span> <span class="cp">%}</span>
        <span class="cp">{%</span> <span class="k">for</span> <span class="nv">error</span> <span class="ow">in</span> <span class="nv">field.errors</span> <span class="cp">%}</span>
          <span class="nt">&lt;p</span> <span class="na">class=</span><span class="s">"help-block"</span><span class="nt">&gt;</span><span class="cp">{{</span> <span class="nv">error</span> <span class="cp">}}</span><span class="nt">&lt;/p&gt;</span>
        <span class="cp">{%</span> <span class="k">endfor</span> <span class="cp">%}</span>
      <span class="nt">&lt;/div&gt;</span>
    <span class="cp">{%</span> <span class="k">endfor</span> <span class="cp">%}</span>
  <span class="nt">&lt;/div&gt;</span>
  <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"modal-footer"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;button</span> <span class="na">type=</span><span class="s">"button"</span> <span class="na">class=</span><span class="s">"btn btn-default"</span> <span class="na">data-dismiss=</span><span class="s">"modal"</span><span class="nt">&gt;</span>Close<span class="nt">&lt;/button&gt;</span>
    <span class="nt">&lt;button</span> <span class="na">type=</span><span class="s">"submit"</span> <span class="na">class=</span><span class="s">"btn btn-primary"</span><span class="nt">&gt;</span>Create book<span class="nt">&lt;/button&gt;</span>
  <span class="nt">&lt;/div&gt;</span>
<span class="nt">&lt;/form&gt;</span></code></pre></figure>

<p>I’m using the <strong>django-widget-tweaks</strong> library to render the form fields properly using the bootstrap class.
You can read more about it in a post I published last year: <a href="../../../../2015/12/04/package-of-the-week-django-widget-tweaks.html">Package of the Week: Django Widget Tweaks</a>.</p>

<p>Now the glue that will put everything together: JavaScript.</p>

<p>Create an external JavaScript file. I created mine in the path: <strong>mysite/books/static/books/js/books.js</strong></p>

<p><strong>books.js</strong></p>

<figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="nx">$</span><span class="p">(</span><span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>

  <span class="nx">$</span><span class="p">(</span><span class="s2">".js-create-book"</span><span class="p">).</span><span class="nx">click</span><span class="p">(</span><span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="nx">$</span><span class="p">.</span><span class="nx">ajax</span><span class="p">({</span>
      <span class="na">url</span><span class="p">:</span> <span class="s1">'/books/create/'</span><span class="p">,</span>
      <span class="na">type</span><span class="p">:</span> <span class="s1">'get'</span><span class="p">,</span>
      <span class="na">dataType</span><span class="p">:</span> <span class="s1">'json'</span><span class="p">,</span>
      <span class="na">beforeSend</span><span class="p">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
        <span class="nx">$</span><span class="p">(</span><span class="s2">"#modal-book"</span><span class="p">).</span><span class="nx">modal</span><span class="p">(</span><span class="s2">"show"</span><span class="p">);</span>
      <span class="p">},</span>
      <span class="na">success</span><span class="p">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">data</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">$</span><span class="p">(</span><span class="s2">"#modal-book .modal-content"</span><span class="p">).</span><span class="nx">html</span><span class="p">(</span><span class="nx">data</span><span class="p">.</span><span class="nx">html_form</span><span class="p">);</span>
      <span class="p">}</span>
    <span class="p">});</span>
  <span class="p">});</span>

<span class="p">});</span></code></pre></figure>

<p>Don’t forget to include this JavaScript file in the <strong>book_list.html</strong> template:</p>

<p><strong>book_list.html</strong></p>

<figure class="highlight"><pre><code class="language-django" data-lang="django"><span class="cp">{%</span> <span class="k">extends</span> <span class="s1">'base.html'</span> <span class="cp">%}</span>

<span class="cp">{%</span> <span class="nv">load</span> <span class="nv">static</span> <span class="cp">%}</span>

<span class="cp">{%</span> <span class="k">block</span> <span class="nv">javascript</span> <span class="cp">%}</span>
  <span class="nt">&lt;script </span><span class="na">src=</span><span class="s">"</span><span class="cp">{%</span> <span class="nv">static</span> <span class="s1">'books/js/books.js'</span> <span class="cp">%}</span><span class="s">"</span><span class="nt">&gt;&lt;/script&gt;</span>
<span class="cp">{%</span> <span class="k">endblock</span> <span class="cp">%}</span>

<span class="cp">{%</span> <span class="k">block</span> <span class="nv">content</span> <span class="cp">%}</span>
  <span class="c">&lt;!-- BLOCK CONTENT SUPPRESSED FOR BREVITY'S SAKE --&gt;</span>
<span class="cp">{%</span> <span class="k">endblock</span> <span class="cp">%}</span></code></pre></figure>

<p>Let’s explore the JavaScript snippet in great detail:</p>

<p>This is a jQuery shortcut to tell the browser to wait for all the HTML be rendered before executing the code:</p>

<figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="nx">$</span><span class="p">(</span><span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
  <span class="p">...</span>
<span class="p">});</span></code></pre></figure>

<p>Here we are hooking into the click event of the element with class <strong>js-create-book</strong>, which is our Add book button.</p>

<figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="nx">$</span><span class="p">(</span><span class="s2">".js-create-book"</span><span class="p">).</span><span class="nx">click</span><span class="p">(</span><span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
  <span class="p">...</span>
<span class="p">});</span></code></pre></figure>

<p>When the user clicks in the <strong>js-create-book</strong> button, this anonymous function with the <strong>$.ajax</strong> call will be
executed:</p>

<figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="nx">$</span><span class="p">.</span><span class="nx">ajax</span><span class="p">({</span>
  <span class="na">url</span><span class="p">:</span> <span class="s1">'/books/create/'</span><span class="p">,</span>
  <span class="na">type</span><span class="p">:</span> <span class="s1">'get'</span><span class="p">,</span>
  <span class="na">dataType</span><span class="p">:</span> <span class="s1">'json'</span><span class="p">,</span>
  <span class="na">beforeSend</span><span class="p">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="nx">$</span><span class="p">(</span><span class="s2">"#modal-book"</span><span class="p">).</span><span class="nx">modal</span><span class="p">(</span><span class="s2">"show"</span><span class="p">);</span>
  <span class="p">},</span>
  <span class="na">success</span><span class="p">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">data</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">$</span><span class="p">(</span><span class="s2">"#modal-book .modal-content"</span><span class="p">).</span><span class="nx">html</span><span class="p">(</span><span class="nx">data</span><span class="p">.</span><span class="nx">html_form</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">});</span></code></pre></figure>

<p>Now, what is this ajax request saying to the browser:</p>

<p><em>Hey, the resource I want is in this path</em>:</p>

<figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="nx">url</span><span class="err">:</span> <span class="s1">'/books/create/'</span><span class="p">,</span></code></pre></figure>

<p><em>Make sure you request my data using the HTTP GET method:</em></p>

<figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="nx">type</span><span class="err">:</span> <span class="s1">'get'</span><span class="p">,</span></code></pre></figure>

<p><em>Oh, by the way, I want to receive the data in JSON format:</em></p>

<figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="nx">dataType</span><span class="err">:</span> <span class="s1">'json'</span><span class="p">,</span></code></pre></figure>

<p><em>But just before you communicate with the server, please execute this code:</em></p>

<figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="nx">beforeSend</span><span class="err">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
  <span class="nx">$</span><span class="p">(</span><span class="s2">"#modal-book"</span><span class="p">).</span><span class="nx">modal</span><span class="p">(</span><span class="s2">"show"</span><span class="p">);</span>
<span class="p">},</span></code></pre></figure>

<p>(This will open the Bootstrap Modal before the Ajax request starts.)</p>

<p><em>And right after you receive the data (in the data variable), execute this code:</em></p>

<figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="nx">success</span><span class="err">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">data</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">$</span><span class="p">(</span><span class="s2">"#modal-book .modal-content"</span><span class="p">).</span><span class="nx">html</span><span class="p">(</span><span class="nx">data</span><span class="p">.</span><span class="nx">html_form</span><span class="p">);</span>
<span class="p">}</span></code></pre></figure>

<p>(This will render the partial form defined in the <strong>partial_book_create.html</strong> template.)</p>

<p>Let’s have a look on what we have so far:</p>

<p><img src="../../../../media/2016/11/books2.png" alt="Books Add Button" /></p>

<p>Then when the user clicks the button:</p>

<p><img src="../../../../media/2016/11/books3.png" alt="Books Modal" /></p>

<p>Great stuff. The book form is being rendered asynchronously. But it is not doing much at the moment. Good news is that
the structure is ready, now it is a matter of playing with the data.</p>

<p>Let’s implement now the form submission handling.</p>

<p>First let’s improve the <strong>book_create</strong> view function:</p>

<p><strong>views.py</strong></p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="k">def</span> <span class="nf">book_create</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="n">data</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>

    <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">method</span> <span class="o">==</span> <span class="s">'POST'</span><span class="p">:</span>
        <span class="n">form</span> <span class="o">=</span> <span class="n">BookForm</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">POST</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">form</span><span class="o">.</span><span class="n">is_valid</span><span class="p">():</span>
            <span class="n">form</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
            <span class="n">data</span><span class="p">[</span><span class="s">'form_is_valid'</span><span class="p">]</span> <span class="o">=</span> <span class="bp">True</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">data</span><span class="p">[</span><span class="s">'form_is_valid'</span><span class="p">]</span> <span class="o">=</span> <span class="bp">False</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">form</span> <span class="o">=</span> <span class="n">BookForm</span><span class="p">()</span>

    <span class="n">context</span> <span class="o">=</span> <span class="p">{</span><span class="s">'form'</span><span class="p">:</span> <span class="n">form</span><span class="p">}</span>
    <span class="n">data</span><span class="p">[</span><span class="s">'html_form'</span><span class="p">]</span> <span class="o">=</span> <span class="n">render_to_string</span><span class="p">(</span><span class="s">'books/includes/partial_book_create.html'</span><span class="p">,</span>
        <span class="n">context</span><span class="p">,</span>
        <span class="n">request</span><span class="o">=</span><span class="n">request</span>
    <span class="p">)</span>
    <span class="k">return</span> <span class="n">JsonResponse</span><span class="p">(</span><span class="n">data</span><span class="p">)</span></code></pre></figure>

<p><strong>partial_book_create.html</strong></p>

<figure class="highlight"><pre><code class="language-django" data-lang="django"><span class="cp">{%</span> <span class="nv">load</span> <span class="nv">widget_tweaks</span> <span class="cp">%}</span>

<span class="nt">&lt;form</span> <span class="na">method=</span><span class="s">"post"</span> <span class="na">action=</span><span class="s">"</span><span class="cp">{%</span> <span class="nv">url</span> <span class="s1">'book_create'</span> <span class="cp">%}</span><span class="s">"</span> <span class="na">class=</span><span class="s">"js-book-create-form"</span><span class="nt">&gt;</span>
  <span class="c">&lt;!-- FORM CONTENT SUPPRESSED FOR BREVITY'S SAKE --&gt;</span>
<span class="nt">&lt;/form&gt;</span></code></pre></figure>

<p>I added the <strong>action</strong> attribute to tell the browser to where it should send the submission and the class
<strong>js-book-create-form</strong> for us to use in the JavaScript side, hooking on the form submit event.</p>

<p><strong>books.js</strong></p>

<figure class="highlight"><pre><code class="language-javascript" data-lang="javascript">  <span class="nx">$</span><span class="p">(</span><span class="s2">"#modal-book"</span><span class="p">).</span><span class="nx">on</span><span class="p">(</span><span class="s2">"submit"</span><span class="p">,</span> <span class="s2">".js-book-create-form"</span><span class="p">,</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="p">...</span>
  <span class="p">});</span></code></pre></figure>

<p>The way we are listening to the <strong>submit</strong> event is a little bit different from what we have implemented before. That’s
because the element with class <strong>.js-book-create-form</strong> didn’t exist on the initial page load of the <strong>book_list.html</strong>
template. So we can’t register a listener to an element that doesn’t exists.</p>

<p>A work around is to register the listener to an element that will always exist in the page context. The <strong>#modal-book</strong>
is the closest element. It is a little bit more complex what happen, but long story short, the HTML events propagate
to the parents elements until it reaches the end of the document.</p>

<p>Hooking to the <strong>body</strong> element would have the same effect, but it would be slightly worst, because it would have to
travel through several HTML elements before reaching it. So always pick the closest one.</p>

<p>Now the actual function:</p>

<p><strong>books.js</strong></p>

<figure class="highlight"><pre><code class="language-javascript" data-lang="javascript">  <span class="nx">$</span><span class="p">(</span><span class="s2">"#modal-book"</span><span class="p">).</span><span class="nx">on</span><span class="p">(</span><span class="s2">"submit"</span><span class="p">,</span> <span class="s2">".js-book-create-form"</span><span class="p">,</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">form</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="k">this</span><span class="p">);</span>
    <span class="nx">$</span><span class="p">.</span><span class="nx">ajax</span><span class="p">({</span>
      <span class="na">url</span><span class="p">:</span> <span class="nx">form</span><span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s2">"action"</span><span class="p">),</span>
      <span class="na">data</span><span class="p">:</span> <span class="nx">form</span><span class="p">.</span><span class="nx">serialize</span><span class="p">(),</span>
      <span class="na">type</span><span class="p">:</span> <span class="nx">form</span><span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s2">"method"</span><span class="p">),</span>
      <span class="na">dataType</span><span class="p">:</span> <span class="s1">'json'</span><span class="p">,</span>
      <span class="na">success</span><span class="p">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">data</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">data</span><span class="p">.</span><span class="nx">form_is_valid</span><span class="p">)</span> <span class="p">{</span>
          <span class="nx">alert</span><span class="p">(</span><span class="s2">"Book created!"</span><span class="p">);</span>  <span class="c1">// &lt;-- This is just a placeholder for now for testing</span>
        <span class="p">}</span>
        <span class="k">else</span> <span class="p">{</span>
          <span class="nx">$</span><span class="p">(</span><span class="s2">"#modal-book .modal-content"</span><span class="p">).</span><span class="nx">html</span><span class="p">(</span><span class="nx">data</span><span class="p">.</span><span class="nx">html_form</span><span class="p">);</span>
        <span class="p">}</span>
      <span class="p">}</span>
    <span class="p">});</span>
    <span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
  <span class="p">});</span></code></pre></figure>

<p>A very important detail here: in the end of the function we are returning <strong>false</strong>. That’s because we are capturing
the form submission event. So to avoid the browser to perform a full HTTP POST to the server, we cancel the default
behavior returning false in the function.</p>

<p>So, what we are doing here:</p>

<figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="kd">var</span> <span class="nx">form</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="k">this</span><span class="p">);</span></code></pre></figure>

<p>In this context, <code class="highlighter-rouge">this</code> refers to the element with class <code class="highlighter-rouge">.js-book-create-form</code>. Which is the element that fired
the submit event. So when we select <code class="highlighter-rouge">$(this)</code> we are selecting the actual form.</p>

<figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="nx">url</span><span class="err">:</span> <span class="nx">form</span><span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s2">"action"</span><span class="p">),</span></code></pre></figure>

<p>Now I’m using the form attributes to build the Ajax request. The <strong>action</strong> here refers to the <strong>action</strong> attribute in
the <strong>form</strong>, which translates to <code class="highlighter-rouge">/books/create/</code>.</p>

<figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="nx">data</span><span class="err">:</span> <span class="nx">form</span><span class="p">.</span><span class="nx">serialize</span><span class="p">(),</span></code></pre></figure>

<p>As the name suggests, we are serializing all the data from the form, and posting it to the server. The rest follows
the same concepts as I explained before.</p>

<p>Before we move on, let’s have a look on what we have so far.</p>

<p>The user fills the data:</p>

<p><img src="../../../../media/2016/11/books4.png" alt="New Book" /></p>

<p>The user clicks on the <strong>Create book</strong> button:</p>

<p><img src="../../../../media/2016/11/books5.png" alt="New Book" /></p>

<p>The data was invalid. No hard refresh no anything. Just this tiny part changed with the validation. This is what
happened:</p>

<ol>
  <li>The form was submitted via Ajax</li>
  <li>The view function processed the form</li>
  <li>The form data was invalid</li>
  <li>The view function rendered the invalid stated to the <code class="highlighter-rouge">data['html_form']</code>, using the <strong>render_to_string</strong></li>
  <li>The Ajax request returned to the JavaScript function</li>
  <li>The Ajax <strong>success</strong> callback was executed, replacing the contents of the modal with the new <code class="highlighter-rouge">data['html_form']</code></li>
</ol>

<p>Please note that the Ajax <strong>success</strong> callback:</p>

<figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="nx">$</span><span class="p">.</span><span class="nx">ajax</span><span class="p">({</span>
  <span class="c1">// ...</span>
  <span class="na">success</span><span class="p">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">data</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// ...</span>
  <span class="p">}</span>
<span class="p">});</span></code></pre></figure>

<p>Refers to the status of the <strong>HTTP Request</strong>, which has nothing to do with the status of your form, or whether the form
was successfully processed or not. It only means that the <strong>HTTP Request</strong> returned a status <strong>200</strong> for example.</p>

<p>Let’s fix the <strong>publication date</strong> value and submit the form again:</p>

<p><img src="../../../../media/2016/11/books6.png" alt="New Book" /></p>

<p>There we go, the <strong>alert</strong> tells us that the form was successfully processed and hopefully it was created in the
database.</p>

<figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="nx">success</span><span class="err">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">data</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">data</span><span class="p">.</span><span class="nx">form_is_valid</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">alert</span><span class="p">(</span><span class="s2">"Book created!"</span><span class="p">);</span>  <span class="c1">// &lt;-- This line was executed! Means success</span>
  <span class="p">}</span>
  <span class="k">else</span> <span class="p">{</span>
    <span class="nx">$</span><span class="p">(</span><span class="s2">"#modal-book .modal-content"</span><span class="p">).</span><span class="nx">html</span><span class="p">(</span><span class="nx">data</span><span class="p">.</span><span class="nx">html_form</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">}</span></code></pre></figure>

<p>It is not 100% what we want, but we are getting close. Let’s refresh the screen and see if the new book shows in the
table:</p>

<p><img src="../../../../media/2016/11/books7.png" alt="Book List" /></p>

<p>Great. We are getting there.</p>

<p>What we want to do now: after the success form processing, we want to close the bootstrap modal <em>and</em> update the table
with the newly created book. For that matter we will extract the body of the table to a external partial template,
and we will return the new table body in the Ajax success callback.</p>

<p>Watch that:</p>

<p><strong>book_list.html</strong></p>

<figure class="highlight"><pre><code class="language-django" data-lang="django"><span class="nt">&lt;table</span> <span class="na">class=</span><span class="s">"table"</span> <span class="na">id=</span><span class="s">"book-table"</span><span class="nt">&gt;</span>
  <span class="nt">&lt;thead&gt;</span>
    <span class="nt">&lt;tr&gt;</span>
      <span class="nt">&lt;th&gt;</span>#<span class="nt">&lt;/th&gt;</span>
      <span class="nt">&lt;th&gt;</span>Title<span class="nt">&lt;/th&gt;</span>
      <span class="nt">&lt;th&gt;</span>Author<span class="nt">&lt;/th&gt;</span>
      <span class="nt">&lt;th&gt;</span>Type<span class="nt">&lt;/th&gt;</span>
      <span class="nt">&lt;th&gt;</span>Publication date<span class="nt">&lt;/th&gt;</span>
      <span class="nt">&lt;th&gt;</span>Pages<span class="nt">&lt;/th&gt;</span>
      <span class="nt">&lt;th&gt;</span>Price<span class="nt">&lt;/th&gt;</span>
    <span class="nt">&lt;/tr&gt;</span>
  <span class="nt">&lt;/thead&gt;</span>
  <span class="nt">&lt;tbody&gt;</span>
    <span class="cp">{%</span> <span class="k">include</span> <span class="s1">'books/includes/partial_book_list.html'</span> <span class="cp">%}</span>
  <span class="nt">&lt;/tbody&gt;</span>
<span class="nt">&lt;/table&gt;</span></code></pre></figure>

<p><strong>partial_book_list.html</strong></p>

<figure class="highlight"><pre><code class="language-django" data-lang="django"><span class="cp">{%</span> <span class="k">for</span> <span class="nv">book</span> <span class="ow">in</span> <span class="nv">books</span> <span class="cp">%}</span>
  <span class="nt">&lt;tr&gt;</span>
    <span class="nt">&lt;td&gt;</span><span class="cp">{{</span> <span class="nv">book.id</span> <span class="cp">}}</span><span class="nt">&lt;/td&gt;</span>
    <span class="nt">&lt;td&gt;</span><span class="cp">{{</span> <span class="nv">book.title</span> <span class="cp">}}</span><span class="nt">&lt;/td&gt;</span>
    <span class="nt">&lt;td&gt;</span><span class="cp">{{</span> <span class="nv">book.author</span> <span class="cp">}}</span><span class="nt">&lt;/td&gt;</span>
    <span class="nt">&lt;td&gt;</span><span class="cp">{{</span> <span class="nv">book.get_book_type_display</span> <span class="cp">}}</span><span class="nt">&lt;/td&gt;</span>
    <span class="nt">&lt;td&gt;</span><span class="cp">{{</span> <span class="nv">book.publication_date</span> <span class="cp">}}</span><span class="nt">&lt;/td&gt;</span>
    <span class="nt">&lt;td&gt;</span><span class="cp">{{</span> <span class="nv">book.pages</span> <span class="cp">}}</span><span class="nt">&lt;/td&gt;</span>
    <span class="nt">&lt;td&gt;</span><span class="cp">{{</span> <span class="nv">book.price</span> <span class="cp">}}</span><span class="nt">&lt;/td&gt;</span>
  <span class="nt">&lt;/tr&gt;</span>
<span class="cp">{%</span> <span class="nv">empty</span> <span class="cp">%}</span>
  <span class="nt">&lt;tr&gt;</span>
    <span class="nt">&lt;td</span> <span class="na">colspan=</span><span class="s">"7"</span> <span class="na">class=</span><span class="s">"text-center bg-warning"</span><span class="nt">&gt;</span>No book<span class="nt">&lt;/td&gt;</span>
  <span class="nt">&lt;/tr&gt;</span>
<span class="cp">{%</span> <span class="k">endfor</span> <span class="cp">%}</span></code></pre></figure>

<p>Now we can reuse the <strong>partial_book_list.html</strong> snippet without repeating ourselves.</p>

<p>Next step: <strong>book_create</strong> view function.</p>

<p><strong>views.py</strong></p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="k">def</span> <span class="nf">book_create</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="n">data</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>

    <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">method</span> <span class="o">==</span> <span class="s">'POST'</span><span class="p">:</span>
        <span class="n">form</span> <span class="o">=</span> <span class="n">BookForm</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">POST</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">form</span><span class="o">.</span><span class="n">is_valid</span><span class="p">():</span>
            <span class="n">form</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
            <span class="n">data</span><span class="p">[</span><span class="s">'form_is_valid'</span><span class="p">]</span> <span class="o">=</span> <span class="bp">True</span>
            <span class="n">books</span> <span class="o">=</span> <span class="n">Book</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="nb">all</span><span class="p">()</span>
            <span class="n">data</span><span class="p">[</span><span class="s">'html_book_list'</span><span class="p">]</span> <span class="o">=</span> <span class="n">render_to_string</span><span class="p">(</span><span class="s">'books/includes/partial_book_list.html'</span><span class="p">,</span> <span class="p">{</span>
                <span class="s">'books'</span><span class="p">:</span> <span class="n">books</span>
            <span class="p">})</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">data</span><span class="p">[</span><span class="s">'form_is_valid'</span><span class="p">]</span> <span class="o">=</span> <span class="bp">False</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">form</span> <span class="o">=</span> <span class="n">BookForm</span><span class="p">()</span>

    <span class="n">context</span> <span class="o">=</span> <span class="p">{</span><span class="s">'form'</span><span class="p">:</span> <span class="n">form</span><span class="p">}</span>
    <span class="n">data</span><span class="p">[</span><span class="s">'html_form'</span><span class="p">]</span> <span class="o">=</span> <span class="n">render_to_string</span><span class="p">(</span><span class="s">'books/includes/partial_book_create.html'</span><span class="p">,</span>
        <span class="n">context</span><span class="p">,</span>
        <span class="n">request</span><span class="o">=</span><span class="n">request</span>
    <span class="p">)</span>
    <span class="k">return</span> <span class="n">JsonResponse</span><span class="p">(</span><span class="n">data</span><span class="p">)</span></code></pre></figure>

<p>A proper success handler in the JavaScript side:</p>

<p><strong>books.js</strong></p>

<figure class="highlight"><pre><code class="language-javascript" data-lang="javascript">  <span class="nx">$</span><span class="p">(</span><span class="s2">"#modal-book"</span><span class="p">).</span><span class="nx">on</span><span class="p">(</span><span class="s2">"submit"</span><span class="p">,</span> <span class="s2">".js-book-create-form"</span><span class="p">,</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">form</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="k">this</span><span class="p">);</span>
    <span class="nx">$</span><span class="p">.</span><span class="nx">ajax</span><span class="p">({</span>
      <span class="na">url</span><span class="p">:</span> <span class="nx">form</span><span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s2">"action"</span><span class="p">),</span>
      <span class="na">data</span><span class="p">:</span> <span class="nx">form</span><span class="p">.</span><span class="nx">serialize</span><span class="p">(),</span>
      <span class="na">type</span><span class="p">:</span> <span class="nx">form</span><span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s2">"method"</span><span class="p">),</span>
      <span class="na">dataType</span><span class="p">:</span> <span class="s1">'json'</span><span class="p">,</span>
      <span class="na">success</span><span class="p">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">data</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">data</span><span class="p">.</span><span class="nx">form_is_valid</span><span class="p">)</span> <span class="p">{</span>
          <span class="nx">$</span><span class="p">(</span><span class="s2">"#book-table tbody"</span><span class="p">).</span><span class="nx">html</span><span class="p">(</span><span class="nx">data</span><span class="p">.</span><span class="nx">html_book_list</span><span class="p">);</span>  <span class="c1">// &lt;-- Replace the table body</span>
          <span class="nx">$</span><span class="p">(</span><span class="s2">"#modal-book"</span><span class="p">).</span><span class="nx">modal</span><span class="p">(</span><span class="s2">"hide"</span><span class="p">);</span>  <span class="c1">// &lt;-- Close the modal</span>
        <span class="p">}</span>
        <span class="k">else</span> <span class="p">{</span>
          <span class="nx">$</span><span class="p">(</span><span class="s2">"#modal-book .modal-content"</span><span class="p">).</span><span class="nx">html</span><span class="p">(</span><span class="nx">data</span><span class="p">.</span><span class="nx">html_form</span><span class="p">);</span>
        <span class="p">}</span>
      <span class="p">}</span>
    <span class="p">});</span>
    <span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
  <span class="p">});</span></code></pre></figure>

<p>Sweet. It’s working!</p>

<hr />

<h4 id="edit-book">Edit Book</h4>

<p>As you can expect, this will be very similar to what we did on the Create Book section. Except we will need to pass
the ID of the book we want to edit. The rest should be somewhat the same. We will be reusing several parts of the code.</p>

<p><strong>urls.py</strong>:</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="kn">from</span> <span class="nn">django.conf.urls</span> <span class="kn">import</span> <span class="n">url</span><span class="p">,</span> <span class="n">include</span>
<span class="kn">from</span> <span class="nn">mysite.books</span> <span class="kn">import</span> <span class="n">views</span>

<span class="n">urlpatterns</span> <span class="o">=</span> <span class="p">[</span>
    <span class="n">url</span><span class="p">(</span><span class="s">r'^books/$'</span><span class="p">,</span> <span class="n">views</span><span class="o">.</span><span class="n">book_list</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s">'book_list'</span><span class="p">),</span>
    <span class="n">url</span><span class="p">(</span><span class="s">r'^books/create/$'</span><span class="p">,</span> <span class="n">views</span><span class="o">.</span><span class="n">book_create</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s">'book_create'</span><span class="p">),</span>
    <span class="n">url</span><span class="p">(</span><span class="s">r'^books/(?P&lt;pk&gt;</span><span class="err">\</span><span class="s">d+)/update/$'</span><span class="p">,</span> <span class="n">views</span><span class="o">.</span><span class="n">book_update</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s">'book_update'</span><span class="p">),</span>
<span class="p">]</span></code></pre></figure>

<p>Now we refactor the <strong>book_create</strong> view to reuse its code in the <strong>book_update</strong> view:</p>

<p><strong>views.py</strong></p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="kn">from</span> <span class="nn">django.shortcuts</span> <span class="kn">import</span> <span class="n">render</span><span class="p">,</span> <span class="n">get_object_or_404</span>
<span class="kn">from</span> <span class="nn">django.http</span> <span class="kn">import</span> <span class="n">JsonResponse</span>
<span class="kn">from</span> <span class="nn">django.template.loader</span> <span class="kn">import</span> <span class="n">render_to_string</span>

<span class="kn">from</span> <span class="nn">.models</span> <span class="kn">import</span> <span class="n">Book</span>
<span class="kn">from</span> <span class="nn">.forms</span> <span class="kn">import</span> <span class="n">BookForm</span>


<span class="k">def</span> <span class="nf">save_book_form</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">form</span><span class="p">,</span> <span class="n">template_name</span><span class="p">):</span>
    <span class="n">data</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">method</span> <span class="o">==</span> <span class="s">'POST'</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">form</span><span class="o">.</span><span class="n">is_valid</span><span class="p">():</span>
            <span class="n">form</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
            <span class="n">data</span><span class="p">[</span><span class="s">'form_is_valid'</span><span class="p">]</span> <span class="o">=</span> <span class="bp">True</span>
            <span class="n">books</span> <span class="o">=</span> <span class="n">Book</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="nb">all</span><span class="p">()</span>
            <span class="n">data</span><span class="p">[</span><span class="s">'html_book_list'</span><span class="p">]</span> <span class="o">=</span> <span class="n">render_to_string</span><span class="p">(</span><span class="s">'books/includes/partial_book_list.html'</span><span class="p">,</span> <span class="p">{</span>
                <span class="s">'books'</span><span class="p">:</span> <span class="n">books</span>
            <span class="p">})</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">data</span><span class="p">[</span><span class="s">'form_is_valid'</span><span class="p">]</span> <span class="o">=</span> <span class="bp">False</span>
    <span class="n">context</span> <span class="o">=</span> <span class="p">{</span><span class="s">'form'</span><span class="p">:</span> <span class="n">form</span><span class="p">}</span>
    <span class="n">data</span><span class="p">[</span><span class="s">'html_form'</span><span class="p">]</span> <span class="o">=</span> <span class="n">render_to_string</span><span class="p">(</span><span class="n">template_name</span><span class="p">,</span> <span class="n">context</span><span class="p">,</span> <span class="n">request</span><span class="o">=</span><span class="n">request</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">JsonResponse</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">book_create</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">method</span> <span class="o">==</span> <span class="s">'POST'</span><span class="p">:</span>
        <span class="n">form</span> <span class="o">=</span> <span class="n">BookForm</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">POST</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">form</span> <span class="o">=</span> <span class="n">BookForm</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">save_book_form</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">form</span><span class="p">,</span> <span class="s">'books/includes/partial_book_create.html'</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">book_update</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">pk</span><span class="p">):</span>
    <span class="n">book</span> <span class="o">=</span> <span class="n">get_object_or_404</span><span class="p">(</span><span class="n">Book</span><span class="p">,</span> <span class="n">pk</span><span class="o">=</span><span class="n">pk</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">method</span> <span class="o">==</span> <span class="s">'POST'</span><span class="p">:</span>
        <span class="n">form</span> <span class="o">=</span> <span class="n">BookForm</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">POST</span><span class="p">,</span> <span class="n">instance</span><span class="o">=</span><span class="n">book</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">form</span> <span class="o">=</span> <span class="n">BookForm</span><span class="p">(</span><span class="n">instance</span><span class="o">=</span><span class="n">book</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">save_book_form</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">form</span><span class="p">,</span> <span class="s">'books/includes/partial_book_update.html'</span><span class="p">)</span></code></pre></figure>

<p>Basically the view functions <strong>book_create</strong> and <strong>book_update</strong> are responsible for receiving the request, preparing
the form instance and passing it to the <strong>save_book_form</strong>, along with the name of the template to use in the rendering
process.</p>

<p>Next step is to create the <strong>partial_book_update.html</strong> template. Similar to what we did with the view functions, we
will also refactor the <strong>partial_book_create.html</strong> to reuse some of the code.</p>

<p><strong>partial_book_form.html</strong></p>

<figure class="highlight"><pre><code class="language-django" data-lang="django"><span class="cp">{%</span> <span class="nv">load</span> <span class="nv">widget_tweaks</span> <span class="cp">%}</span>

<span class="cp">{%</span> <span class="k">for</span> <span class="nv">field</span> <span class="ow">in</span> <span class="nv">form</span> <span class="cp">%}</span>
  <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"form-group</span><span class="cp">{%</span> <span class="k">if</span> <span class="nv">field.errors</span> <span class="cp">%}</span><span class="s"> has-error</span><span class="cp">{%</span> <span class="k">endif</span> <span class="cp">%}</span><span class="s">"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;label</span> <span class="na">for=</span><span class="s">"</span><span class="cp">{{</span> <span class="nv">field.id_for_label</span> <span class="cp">}}</span><span class="s">"</span><span class="nt">&gt;</span><span class="cp">{{</span> <span class="nv">field.label</span> <span class="cp">}}</span><span class="nt">&lt;/label&gt;</span>
    <span class="cp">{%</span> <span class="nv">render_field</span> <span class="nv">field</span> <span class="nv">class</span><span class="err">=</span><span class="s2">"form-control"</span> <span class="cp">%}</span>
    <span class="cp">{%</span> <span class="k">for</span> <span class="nv">error</span> <span class="ow">in</span> <span class="nv">field.errors</span> <span class="cp">%}</span>
      <span class="nt">&lt;p</span> <span class="na">class=</span><span class="s">"help-block"</span><span class="nt">&gt;</span><span class="cp">{{</span> <span class="nv">error</span> <span class="cp">}}</span><span class="nt">&lt;/p&gt;</span>
    <span class="cp">{%</span> <span class="k">endfor</span> <span class="cp">%}</span>
  <span class="nt">&lt;/div&gt;</span>
<span class="cp">{%</span> <span class="k">endfor</span> <span class="cp">%}</span></code></pre></figure>

<p><strong>partial_book_create.html</strong></p>

<figure class="highlight"><pre><code class="language-django" data-lang="django"><span class="nt">&lt;form</span> <span class="na">method=</span><span class="s">"post"</span> <span class="na">action=</span><span class="s">"</span><span class="cp">{%</span> <span class="nv">url</span> <span class="s1">'book_create'</span> <span class="cp">%}</span><span class="s">"</span> <span class="na">class=</span><span class="s">"js-book-create-form"</span><span class="nt">&gt;</span>
  <span class="cp">{%</span> <span class="nv">csrf_token</span> <span class="cp">%}</span>
  <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"modal-header"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;button</span> <span class="na">type=</span><span class="s">"button"</span> <span class="na">class=</span><span class="s">"close"</span> <span class="na">data-dismiss=</span><span class="s">"modal"</span> <span class="na">aria-label=</span><span class="s">"Close"</span><span class="nt">&gt;</span>
      <span class="nt">&lt;span</span> <span class="na">aria-hidden=</span><span class="s">"true"</span><span class="nt">&gt;</span><span class="ni">&amp;times;</span><span class="nt">&lt;/span&gt;</span>
    <span class="nt">&lt;/button&gt;</span>
    <span class="nt">&lt;h4</span> <span class="na">class=</span><span class="s">"modal-title"</span><span class="nt">&gt;</span>Create a new book<span class="nt">&lt;/h4&gt;</span>
  <span class="nt">&lt;/div&gt;</span>
  <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"modal-body"</span><span class="nt">&gt;</span>
    <span class="cp">{%</span> <span class="k">include</span> <span class="s1">'books/includes/partial_book_form.html'</span> <span class="cp">%}</span>
  <span class="nt">&lt;/div&gt;</span>
  <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"modal-footer"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;button</span> <span class="na">type=</span><span class="s">"button"</span> <span class="na">class=</span><span class="s">"btn btn-default"</span> <span class="na">data-dismiss=</span><span class="s">"modal"</span><span class="nt">&gt;</span>Close<span class="nt">&lt;/button&gt;</span>
    <span class="nt">&lt;button</span> <span class="na">type=</span><span class="s">"submit"</span> <span class="na">class=</span><span class="s">"btn btn-primary"</span><span class="nt">&gt;</span>Create book<span class="nt">&lt;/button&gt;</span>
  <span class="nt">&lt;/div&gt;</span>
<span class="nt">&lt;/form&gt;</span></code></pre></figure>

<p><strong>partial_book_update.html</strong></p>

<figure class="highlight"><pre><code class="language-django" data-lang="django"><span class="nt">&lt;form</span> <span class="na">method=</span><span class="s">"post"</span> <span class="na">action=</span><span class="s">"</span><span class="cp">{%</span> <span class="nv">url</span> <span class="s1">'book_update'</span> <span class="nv">form.instance.pk</span> <span class="cp">%}</span><span class="s">"</span> <span class="na">class=</span><span class="s">"js-book-update-form"</span><span class="nt">&gt;</span>
  <span class="cp">{%</span> <span class="nv">csrf_token</span> <span class="cp">%}</span>
  <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"modal-header"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;button</span> <span class="na">type=</span><span class="s">"button"</span> <span class="na">class=</span><span class="s">"close"</span> <span class="na">data-dismiss=</span><span class="s">"modal"</span> <span class="na">aria-label=</span><span class="s">"Close"</span><span class="nt">&gt;</span>
      <span class="nt">&lt;span</span> <span class="na">aria-hidden=</span><span class="s">"true"</span><span class="nt">&gt;</span><span class="ni">&amp;times;</span><span class="nt">&lt;/span&gt;</span>
    <span class="nt">&lt;/button&gt;</span>
    <span class="nt">&lt;h4</span> <span class="na">class=</span><span class="s">"modal-title"</span><span class="nt">&gt;</span>Update book<span class="nt">&lt;/h4&gt;</span>
  <span class="nt">&lt;/div&gt;</span>
  <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"modal-body"</span><span class="nt">&gt;</span>
    <span class="cp">{%</span> <span class="k">include</span> <span class="s1">'books/includes/partial_book_form.html'</span> <span class="cp">%}</span>
  <span class="nt">&lt;/div&gt;</span>
  <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"modal-footer"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;button</span> <span class="na">type=</span><span class="s">"button"</span> <span class="na">class=</span><span class="s">"btn btn-default"</span> <span class="na">data-dismiss=</span><span class="s">"modal"</span><span class="nt">&gt;</span>Close<span class="nt">&lt;/button&gt;</span>
    <span class="nt">&lt;button</span> <span class="na">type=</span><span class="s">"submit"</span> <span class="na">class=</span><span class="s">"btn btn-primary"</span><span class="nt">&gt;</span>Update book<span class="nt">&lt;/button&gt;</span>
  <span class="nt">&lt;/div&gt;</span>
<span class="nt">&lt;/form&gt;</span></code></pre></figure>

<p>This is good enough. Now we gotta add an edit button to trigger the action.</p>

<p><strong>partial_book_list.html</strong></p>

<figure class="highlight"><pre><code class="language-django" data-lang="django"><span class="cp">{%</span> <span class="k">for</span> <span class="nv">book</span> <span class="ow">in</span> <span class="nv">books</span> <span class="cp">%}</span>
  <span class="nt">&lt;tr&gt;</span>
    <span class="nt">&lt;td&gt;</span><span class="cp">{{</span> <span class="nv">book.id</span> <span class="cp">}}</span><span class="nt">&lt;/td&gt;</span>
    <span class="nt">&lt;td&gt;</span><span class="cp">{{</span> <span class="nv">book.title</span> <span class="cp">}}</span><span class="nt">&lt;/td&gt;</span>
    <span class="nt">&lt;td&gt;</span><span class="cp">{{</span> <span class="nv">book.author</span> <span class="cp">}}</span><span class="nt">&lt;/td&gt;</span>
    <span class="nt">&lt;td&gt;</span><span class="cp">{{</span> <span class="nv">book.get_book_type_display</span> <span class="cp">}}</span><span class="nt">&lt;/td&gt;</span>
    <span class="nt">&lt;td&gt;</span><span class="cp">{{</span> <span class="nv">book.publication_date</span> <span class="cp">}}</span><span class="nt">&lt;/td&gt;</span>
    <span class="nt">&lt;td&gt;</span><span class="cp">{{</span> <span class="nv">book.pages</span> <span class="cp">}}</span><span class="nt">&lt;/td&gt;</span>
    <span class="nt">&lt;td&gt;</span><span class="cp">{{</span> <span class="nv">book.price</span> <span class="cp">}}</span><span class="nt">&lt;/td&gt;</span>
    <span class="nt">&lt;td&gt;</span>
      <span class="nt">&lt;button</span> <span class="na">type=</span><span class="s">"button"</span>
              <span class="na">class=</span><span class="s">"btn btn-warning btn-sm js-update-book"</span>
              <span class="na">data-url=</span><span class="s">"</span><span class="cp">{%</span> <span class="nv">url</span> <span class="s1">'book_update'</span> <span class="nv">book.id</span> <span class="cp">%}</span><span class="s">"</span><span class="nt">&gt;</span>
        <span class="nt">&lt;span</span> <span class="na">class=</span><span class="s">"glyphicon glyphicon-pencil"</span><span class="nt">&gt;&lt;/span&gt;</span> Edit
      <span class="nt">&lt;/button&gt;</span>
    <span class="nt">&lt;/td&gt;</span>
  <span class="nt">&lt;/tr&gt;</span>
<span class="cp">{%</span> <span class="nv">empty</span> <span class="cp">%}</span>
  <span class="nt">&lt;tr&gt;</span>
    <span class="nt">&lt;td</span> <span class="na">colspan=</span><span class="s">"8"</span> <span class="na">class=</span><span class="s">"text-center bg-warning"</span><span class="nt">&gt;</span>No book<span class="nt">&lt;/td&gt;</span>
  <span class="nt">&lt;/tr&gt;</span>
<span class="cp">{%</span> <span class="k">endfor</span> <span class="cp">%}</span></code></pre></figure>

<p>The class <strong>js-update-book</strong> will be used to start the edit process. Now note that I also added an extra HTML attribute
named <strong>data-url</strong>. This is the URL that will be used to create the ajax request dynamically.</p>

<p>Take the time and refactor the <strong>js-create-book</strong> button to also use the <strong>data-url</strong> strategy, so we can extract
the hard-coded URL from the Ajax request.</p>

<p><strong>book_list.html</strong></p>

<figure class="highlight"><pre><code class="language-django" data-lang="django"><span class="cp">{%</span> <span class="k">extends</span> <span class="s1">'base.html'</span> <span class="cp">%}</span>

<span class="cp">{%</span> <span class="k">block</span> <span class="nv">content</span> <span class="cp">%}</span>
  <span class="nt">&lt;h1</span> <span class="na">class=</span><span class="s">"page-header"</span><span class="nt">&gt;</span>Books<span class="nt">&lt;/h1&gt;</span>

  <span class="nt">&lt;p&gt;</span>
    <span class="nt">&lt;button</span> <span class="na">type=</span><span class="s">"button"</span>
            <span class="na">class=</span><span class="s">"btn btn-primary js-create-book"</span>
            <span class="na">data-url=</span><span class="s">"</span><span class="cp">{%</span> <span class="nv">url</span> <span class="s1">'book_create'</span> <span class="cp">%}</span><span class="s">"</span><span class="nt">&gt;</span>
      <span class="nt">&lt;span</span> <span class="na">class=</span><span class="s">"glyphicon glyphicon-plus"</span><span class="nt">&gt;&lt;/span&gt;</span>
      New book
    <span class="nt">&lt;/button&gt;</span>
  <span class="nt">&lt;/p&gt;</span>

  <span class="c">&lt;!-- REST OF THE PAGE... --&gt;</span>

<span class="cp">{%</span> <span class="k">endblock</span> <span class="cp">%}</span></code></pre></figure>

<p><strong>books.js</strong></p>

<figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="nx">$</span><span class="p">(</span><span class="s2">".js-create-book"</span><span class="p">).</span><span class="nx">click</span><span class="p">(</span><span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
  <span class="kd">var</span> <span class="nx">btn</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="k">this</span><span class="p">);</span>  <span class="c1">// &lt;-- HERE</span>
  <span class="nx">$</span><span class="p">.</span><span class="nx">ajax</span><span class="p">({</span>
    <span class="na">url</span><span class="p">:</span> <span class="nx">btn</span><span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s2">"data-url"</span><span class="p">),</span>  <span class="c1">// &lt;-- AND HERE</span>
    <span class="na">type</span><span class="p">:</span> <span class="s1">'get'</span><span class="p">,</span>
    <span class="na">dataType</span><span class="p">:</span> <span class="s1">'json'</span><span class="p">,</span>
    <span class="na">beforeSend</span><span class="p">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
      <span class="nx">$</span><span class="p">(</span><span class="s2">"#modal-book"</span><span class="p">).</span><span class="nx">modal</span><span class="p">(</span><span class="s2">"show"</span><span class="p">);</span>
    <span class="p">},</span>
    <span class="na">success</span><span class="p">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">data</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">$</span><span class="p">(</span><span class="s2">"#modal-book .modal-content"</span><span class="p">).</span><span class="nx">html</span><span class="p">(</span><span class="nx">data</span><span class="p">.</span><span class="nx">html_form</span><span class="p">);</span>
    <span class="p">}</span>
  <span class="p">});</span>
<span class="p">});</span></code></pre></figure>

<p>Next step is to create the edit functions. The thing is, they are pretty much the same as the create. So, basically
what we want to do is to extract the anonymous functions that we are using, and reuse them in the edit buttons and
forms. Check it out:</p>

<p><strong>books.js</strong></p>

<figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="nx">$</span><span class="p">(</span><span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>

  <span class="cm">/* Functions */</span>

  <span class="kd">var</span> <span class="nx">loadForm</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">btn</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="k">this</span><span class="p">);</span>
    <span class="nx">$</span><span class="p">.</span><span class="nx">ajax</span><span class="p">({</span>
      <span class="na">url</span><span class="p">:</span> <span class="nx">btn</span><span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s2">"data-url"</span><span class="p">),</span>
      <span class="na">type</span><span class="p">:</span> <span class="s1">'get'</span><span class="p">,</span>
      <span class="na">dataType</span><span class="p">:</span> <span class="s1">'json'</span><span class="p">,</span>
      <span class="na">beforeSend</span><span class="p">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
        <span class="nx">$</span><span class="p">(</span><span class="s2">"#modal-book"</span><span class="p">).</span><span class="nx">modal</span><span class="p">(</span><span class="s2">"show"</span><span class="p">);</span>
      <span class="p">},</span>
      <span class="na">success</span><span class="p">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">data</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">$</span><span class="p">(</span><span class="s2">"#modal-book .modal-content"</span><span class="p">).</span><span class="nx">html</span><span class="p">(</span><span class="nx">data</span><span class="p">.</span><span class="nx">html_form</span><span class="p">);</span>
      <span class="p">}</span>
    <span class="p">});</span>
  <span class="p">};</span>

  <span class="kd">var</span> <span class="nx">saveForm</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">form</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="k">this</span><span class="p">);</span>
    <span class="nx">$</span><span class="p">.</span><span class="nx">ajax</span><span class="p">({</span>
      <span class="na">url</span><span class="p">:</span> <span class="nx">form</span><span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s2">"action"</span><span class="p">),</span>
      <span class="na">data</span><span class="p">:</span> <span class="nx">form</span><span class="p">.</span><span class="nx">serialize</span><span class="p">(),</span>
      <span class="na">type</span><span class="p">:</span> <span class="nx">form</span><span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s2">"method"</span><span class="p">),</span>
      <span class="na">dataType</span><span class="p">:</span> <span class="s1">'json'</span><span class="p">,</span>
      <span class="na">success</span><span class="p">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">data</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">data</span><span class="p">.</span><span class="nx">form_is_valid</span><span class="p">)</span> <span class="p">{</span>
          <span class="nx">$</span><span class="p">(</span><span class="s2">"#book-table tbody"</span><span class="p">).</span><span class="nx">html</span><span class="p">(</span><span class="nx">data</span><span class="p">.</span><span class="nx">html_book_list</span><span class="p">);</span>
          <span class="nx">$</span><span class="p">(</span><span class="s2">"#modal-book"</span><span class="p">).</span><span class="nx">modal</span><span class="p">(</span><span class="s2">"hide"</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="k">else</span> <span class="p">{</span>
          <span class="nx">$</span><span class="p">(</span><span class="s2">"#modal-book .modal-content"</span><span class="p">).</span><span class="nx">html</span><span class="p">(</span><span class="nx">data</span><span class="p">.</span><span class="nx">html_form</span><span class="p">);</span>
        <span class="p">}</span>
      <span class="p">}</span>
    <span class="p">});</span>
    <span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
  <span class="p">};</span>


  <span class="cm">/* Binding */</span>

  <span class="c1">// Create book</span>
  <span class="nx">$</span><span class="p">(</span><span class="s2">".js-create-book"</span><span class="p">).</span><span class="nx">click</span><span class="p">(</span><span class="nx">loadForm</span><span class="p">);</span>
  <span class="nx">$</span><span class="p">(</span><span class="s2">"#modal-book"</span><span class="p">).</span><span class="nx">on</span><span class="p">(</span><span class="s2">"submit"</span><span class="p">,</span> <span class="s2">".js-book-create-form"</span><span class="p">,</span> <span class="nx">saveForm</span><span class="p">);</span>

  <span class="c1">// Update book</span>
  <span class="nx">$</span><span class="p">(</span><span class="s2">"#book-table"</span><span class="p">).</span><span class="nx">on</span><span class="p">(</span><span class="s2">"click"</span><span class="p">,</span> <span class="s2">".js-update-book"</span><span class="p">,</span> <span class="nx">loadForm</span><span class="p">);</span>
  <span class="nx">$</span><span class="p">(</span><span class="s2">"#modal-book"</span><span class="p">).</span><span class="nx">on</span><span class="p">(</span><span class="s2">"submit"</span><span class="p">,</span> <span class="s2">".js-book-update-form"</span><span class="p">,</span> <span class="nx">saveForm</span><span class="p">);</span>

<span class="p">});</span></code></pre></figure>

<p>Let’s have a look on what we have so far.</p>

<p><img src="../../../../media/2016/11/books8.png" alt="Book Edit" /></p>

<p>The user clicks in the edit button.</p>

<p><img src="../../../../media/2016/11/books9.png" alt="Book Edit" /></p>

<p>Changes some data like the title of the book and hit the <strong>Update book</strong> button:</p>

<p><img src="../../../../media/2016/11/books10.png" alt="Book Edit" /></p>

<p>Cool! Now just the delete and we are done.</p>

<hr />

<h4 id="delete-book">Delete Book</h4>

<p><strong>urls.py</strong>:</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="kn">from</span> <span class="nn">django.conf.urls</span> <span class="kn">import</span> <span class="n">url</span><span class="p">,</span> <span class="n">include</span>
<span class="kn">from</span> <span class="nn">mysite.books</span> <span class="kn">import</span> <span class="n">views</span>

<span class="n">urlpatterns</span> <span class="o">=</span> <span class="p">[</span>
    <span class="n">url</span><span class="p">(</span><span class="s">r'^books/$'</span><span class="p">,</span> <span class="n">views</span><span class="o">.</span><span class="n">book_list</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s">'book_list'</span><span class="p">),</span>
    <span class="n">url</span><span class="p">(</span><span class="s">r'^books/create/$'</span><span class="p">,</span> <span class="n">views</span><span class="o">.</span><span class="n">book_create</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s">'book_create'</span><span class="p">),</span>
    <span class="n">url</span><span class="p">(</span><span class="s">r'^books/(?P&lt;pk&gt;</span><span class="err">\</span><span class="s">d+)/update/$'</span><span class="p">,</span> <span class="n">views</span><span class="o">.</span><span class="n">book_update</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s">'book_update'</span><span class="p">),</span>
    <span class="n">url</span><span class="p">(</span><span class="s">r'^books/(?P&lt;pk&gt;</span><span class="err">\</span><span class="s">d+)/delete/$'</span><span class="p">,</span> <span class="n">views</span><span class="o">.</span><span class="n">book_delete</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s">'book_delete'</span><span class="p">),</span>
<span class="p">]</span></code></pre></figure>

<p><strong>views.py</strong></p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="k">def</span> <span class="nf">book_delete</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">pk</span><span class="p">):</span>
    <span class="n">book</span> <span class="o">=</span> <span class="n">get_object_or_404</span><span class="p">(</span><span class="n">Book</span><span class="p">,</span> <span class="n">pk</span><span class="o">=</span><span class="n">pk</span><span class="p">)</span>
    <span class="n">data</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">method</span> <span class="o">==</span> <span class="s">'POST'</span><span class="p">:</span>
        <span class="n">book</span><span class="o">.</span><span class="n">delete</span><span class="p">()</span>
        <span class="n">data</span><span class="p">[</span><span class="s">'form_is_valid'</span><span class="p">]</span> <span class="o">=</span> <span class="bp">True</span>  <span class="c"># This is just to play along with the existing code</span>
        <span class="n">books</span> <span class="o">=</span> <span class="n">Book</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="nb">all</span><span class="p">()</span>
        <span class="n">data</span><span class="p">[</span><span class="s">'html_book_list'</span><span class="p">]</span> <span class="o">=</span> <span class="n">render_to_string</span><span class="p">(</span><span class="s">'books/includes/partial_book_list.html'</span><span class="p">,</span> <span class="p">{</span>
            <span class="s">'books'</span><span class="p">:</span> <span class="n">books</span>
        <span class="p">})</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">context</span> <span class="o">=</span> <span class="p">{</span><span class="s">'book'</span><span class="p">:</span> <span class="n">book</span><span class="p">}</span>
        <span class="n">data</span><span class="p">[</span><span class="s">'html_form'</span><span class="p">]</span> <span class="o">=</span> <span class="n">render_to_string</span><span class="p">(</span><span class="s">'books/includes/partial_book_delete.html'</span><span class="p">,</span>
            <span class="n">context</span><span class="p">,</span>
            <span class="n">request</span><span class="o">=</span><span class="n">request</span><span class="p">,</span>
        <span class="p">)</span>
    <span class="k">return</span> <span class="n">JsonResponse</span><span class="p">(</span><span class="n">data</span><span class="p">)</span></code></pre></figure>

<p><strong>partial_book_delete.html</strong></p>

<figure class="highlight"><pre><code class="language-django" data-lang="django"><span class="nt">&lt;form</span> <span class="na">method=</span><span class="s">"post"</span> <span class="na">action=</span><span class="s">"</span><span class="cp">{%</span> <span class="nv">url</span> <span class="s1">'book_delete'</span> <span class="nv">book.id</span> <span class="cp">%}</span><span class="s">"</span> <span class="na">class=</span><span class="s">"js-book-delete-form"</span><span class="nt">&gt;</span>
  <span class="cp">{%</span> <span class="nv">csrf_token</span> <span class="cp">%}</span>
  <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"modal-header"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;button</span> <span class="na">type=</span><span class="s">"button"</span> <span class="na">class=</span><span class="s">"close"</span> <span class="na">data-dismiss=</span><span class="s">"modal"</span> <span class="na">aria-label=</span><span class="s">"Close"</span><span class="nt">&gt;</span>
      <span class="nt">&lt;span</span> <span class="na">aria-hidden=</span><span class="s">"true"</span><span class="nt">&gt;</span><span class="ni">&amp;times;</span><span class="nt">&lt;/span&gt;</span>
    <span class="nt">&lt;/button&gt;</span>
    <span class="nt">&lt;h4</span> <span class="na">class=</span><span class="s">"modal-title"</span><span class="nt">&gt;</span>Confirm book deletion<span class="nt">&lt;/h4&gt;</span>
  <span class="nt">&lt;/div&gt;</span>
  <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"modal-body"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;p</span> <span class="na">class=</span><span class="s">"lead"</span><span class="nt">&gt;</span>Are you sure you want to delete the book <span class="nt">&lt;strong&gt;</span><span class="cp">{{</span> <span class="nv">book.title</span> <span class="cp">}}</span><span class="nt">&lt;/strong&gt;</span>?<span class="nt">&lt;/p&gt;</span>
  <span class="nt">&lt;/div&gt;</span>
  <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"modal-footer"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;button</span> <span class="na">type=</span><span class="s">"button"</span> <span class="na">class=</span><span class="s">"btn btn-default"</span> <span class="na">data-dismiss=</span><span class="s">"modal"</span><span class="nt">&gt;</span>Close<span class="nt">&lt;/button&gt;</span>
    <span class="nt">&lt;button</span> <span class="na">type=</span><span class="s">"submit"</span> <span class="na">class=</span><span class="s">"btn btn-danger"</span><span class="nt">&gt;</span>Delete book<span class="nt">&lt;/button&gt;</span>
  <span class="nt">&lt;/div&gt;</span>
<span class="nt">&lt;/form&gt;</span></code></pre></figure>

<p><strong>partial_book_list.html</strong></p>

<figure class="highlight"><pre><code class="language-django" data-lang="django"><span class="cp">{%</span> <span class="k">for</span> <span class="nv">book</span> <span class="ow">in</span> <span class="nv">books</span> <span class="cp">%}</span>
  <span class="nt">&lt;tr&gt;</span>
    <span class="nt">&lt;td&gt;</span><span class="cp">{{</span> <span class="nv">book.id</span> <span class="cp">}}</span><span class="nt">&lt;/td&gt;</span>
    <span class="nt">&lt;td&gt;</span><span class="cp">{{</span> <span class="nv">book.title</span> <span class="cp">}}</span><span class="nt">&lt;/td&gt;</span>
    <span class="nt">&lt;td&gt;</span><span class="cp">{{</span> <span class="nv">book.author</span> <span class="cp">}}</span><span class="nt">&lt;/td&gt;</span>
    <span class="nt">&lt;td&gt;</span><span class="cp">{{</span> <span class="nv">book.get_book_type_display</span> <span class="cp">}}</span><span class="nt">&lt;/td&gt;</span>
    <span class="nt">&lt;td&gt;</span><span class="cp">{{</span> <span class="nv">book.publication_date</span> <span class="cp">}}</span><span class="nt">&lt;/td&gt;</span>
    <span class="nt">&lt;td&gt;</span><span class="cp">{{</span> <span class="nv">book.pages</span> <span class="cp">}}</span><span class="nt">&lt;/td&gt;</span>
    <span class="nt">&lt;td&gt;</span><span class="cp">{{</span> <span class="nv">book.price</span> <span class="cp">}}</span><span class="nt">&lt;/td&gt;</span>
    <span class="nt">&lt;td&gt;</span>
      <span class="nt">&lt;button</span> <span class="na">type=</span><span class="s">"button"</span>
              <span class="na">class=</span><span class="s">"btn btn-warning btn-sm js-update-book"</span>
              <span class="na">data-url=</span><span class="s">"</span><span class="cp">{%</span> <span class="nv">url</span> <span class="s1">'book_update'</span> <span class="nv">book.id</span> <span class="cp">%}</span><span class="s">"</span><span class="nt">&gt;</span>
        <span class="nt">&lt;span</span> <span class="na">class=</span><span class="s">"glyphicon glyphicon-pencil"</span><span class="nt">&gt;&lt;/span&gt;</span> Edit
      <span class="nt">&lt;/button&gt;</span>
      <span class="nt">&lt;button</span> <span class="na">type=</span><span class="s">"button"</span>
              <span class="na">class=</span><span class="s">"btn btn-danger btn-sm js-delete-book"</span>
              <span class="na">data-url=</span><span class="s">"</span><span class="cp">{%</span> <span class="nv">url</span> <span class="s1">'book_delete'</span> <span class="nv">book.id</span> <span class="cp">%}</span><span class="s">"</span><span class="nt">&gt;</span>
        <span class="nt">&lt;span</span> <span class="na">class=</span><span class="s">"glyphicon glyphicon-trash"</span><span class="nt">&gt;&lt;/span&gt;</span> Delete
      <span class="nt">&lt;/button&gt;</span>
    <span class="nt">&lt;/td&gt;</span>
  <span class="nt">&lt;/tr&gt;</span>
<span class="cp">{%</span> <span class="nv">empty</span> <span class="cp">%}</span>
  <span class="nt">&lt;tr&gt;</span>
    <span class="nt">&lt;td</span> <span class="na">colspan=</span><span class="s">"8"</span> <span class="na">class=</span><span class="s">"text-center bg-warning"</span><span class="nt">&gt;</span>No book<span class="nt">&lt;/td&gt;</span>
  <span class="nt">&lt;/tr&gt;</span>
<span class="cp">{%</span> <span class="k">endfor</span> <span class="cp">%}</span></code></pre></figure>

<p><strong>books.js</strong></p>

<figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="c1">// Delete book</span>
<span class="nx">$</span><span class="p">(</span><span class="s2">"#book-table"</span><span class="p">).</span><span class="nx">on</span><span class="p">(</span><span class="s2">"click"</span><span class="p">,</span> <span class="s2">".js-delete-book"</span><span class="p">,</span> <span class="nx">loadForm</span><span class="p">);</span>
<span class="nx">$</span><span class="p">(</span><span class="s2">"#modal-book"</span><span class="p">).</span><span class="nx">on</span><span class="p">(</span><span class="s2">"submit"</span><span class="p">,</span> <span class="s2">".js-book-delete-form"</span><span class="p">,</span> <span class="nx">saveForm</span><span class="p">);</span></code></pre></figure>

<p>And the result will be:</p>

<p><img src="../../../../media/2016/11/books11.png" alt="Book Delete" /></p>

<p>The user clicks in a Delete button:</p>

<p><img src="../../../../media/2016/11/books12.png" alt="Book Delete" /></p>

<p>The user confirm the deletion, and the table in the background is refreshed:</p>

<p><img src="../../../../media/2016/11/books13.png" alt="Book Delete" /></p>

<hr />

<h4 id="conclusions">Conclusions</h4>

<p>I decided to use function-based views in this example because they are easier to read and use less configuration-magic
that could distract those who are learning Django.</p>

<p>I tried to bring as much detail as I could and discuss about some of the code design decisions. If anything is not
clear to you, or you want to suggest some improvements, feel free to leave a comment! I would love to hear your
thoughts.</p>

<p>The code is available on GitHub: <a href="https://github.com/sibtc/simple-ajax-crud" target="_blank">github.com/sibtc/simple-ajax-crud</a>,
so you can try it locally. It’s very straightforward to get it running.</p>

            </article>
            
            <hr>
            <div class="popular-posts related-posts">
  <h4>Related Posts</h4>
    <div class="row">
      <div class="four columns">
<a href="../../../2018/04/03/how-to-integrate-highcharts-js-with-django.html">
<img src="../../../../media/2018/04/featured-highcharts.jpg" alt="How to Integrate Highcharts.js with Django" title="How to Integrate Highcharts.js with Django">
How to Integrate Highcharts.js with Django
</a>
</div>
<div class="four columns">
<a href="../../../2018/01/29/how-to-implement-dependent-or-chained-dropdown-list-with-django.html">
<img src="../../../../media/2018/01/featured-dropdown.jpg" alt="How to Implement Dependent/Chained Dropdown List with Django" title="How to Implement Dependent/Chained Dropdown List with Django">
How to Implement Dependent/Chained Dropdown List with Django
</a>
</div>
<div class="four columns">
<a href="../../../2017/03/13/how-to-create-infinite-scroll-with-django.html">
<img src="../../../../media/2017/03/featured-infinite-scroll.jpg" alt="How to Create Infinite Scroll With Django" title="How to Create Infinite Scroll With Django">
How to Create Infinite Scroll With Django
</a>
</div>
    </div>
</div>


            <hr class="dashed">
<div class="row">
  <div class="six columns post-tags" style="padding-top: 4px">
    
      <a href="../../../../tag/django/index.html"><span class="tag">django</span></a>
    
      <a href="../../../../tag/ajax/index.html"><span class="tag">ajax</span></a>
    
      <a href="../../../../tag/crud/index.html"><span class="tag">crud</span></a>
    
      <a href="../../../../tag/jquery/index.html"><span class="tag">jquery</span></a>
    
  </div>
  <div class="six columns post-share">
    <div class="social">
  Share this post
  <a href="http://vk.com/share.php?url=http://sibt.co/2mIlBOk"
     rel="nofollow"
     target="_blank"
     title="Share on VK">
    <i class="fa fa-vk"></i>
  </a>
  <a href="https://twitter.com/intent/tweet?text=How%20to%20Implement%20CRUD%20Using%20Ajax%20and%20Json&amp;url=http://sibt.co/2mrGZqi&amp;via=vitorfs&amp;related=vitorfs"
     rel="nofollow"
     target="_blank"
     title="Share on Twitter">
    <i class="fa fa-twitter"></i>
  </a>
  <a href="https://www.facebook.com/sharer/sharer.php?app_id=1645747765697865&amp;u=http://sibt.co/2nE0lIX"
     rel="nofollow"
     target="_blank"
     title="Share on Facebook">
    <i class="fa fa-facebook"></i>
  </a>
  <a href="http://www.linkedin.com/shareArticle?mini=true&amp;url=http://sibt.co/2nroGT7&amp;title=How%20to%20Implement%20CRUD%20Using%20Ajax%20and%20Json&amp;summary=Using%20Ajax%20to%20create%20asynchronous%20request%20to%20manipulate%20Django%20models%20is%20a%20very%20common%20use%20case.%20It%20can%20be%20used%20toprovide%20an%20in%20line%20edit%20in%20a%20table,%20or%20create%20a%20new%20model%20instance%20without%20going%20ba...&amp;source=https://simpleisbetterthancomplex.com"
     rel="nofollow"
     target="_blank"
     title="Share on LinkedIn">
    <i class="fa fa-linkedin"></i>
  </a>
</div>

  </div>
</div>

          </div>
          <!--div style="text-align:center;margin-bottom:20px">

            <a href="//namecheap.pxf.io/c/477033/408288/5618" target="_blank" rel="noopener nofollow">
              <img src="//a.impactradius-go.com/display-ad/5618-408288" border="0" alt="Search and buy domains from Namecheap. Lowest prices!" width="728" height="90" style="max-width:100%!important" />
            </a>
            <img height="0" width="0" src="//namecheap.pxf.io/i/477033/408288/5618" alt="Impact Radius" style="position:absolute;visibility:hidden;" border="0" />


            <a href="https://click.linksynergy.com/fs-bin/click?id=phY4769lVwA&offerid=467035.415&subid=0&type=4" target="_blank" rel="noopener nofollow">
              <img border="0" alt="Deep Learning Specialization on Coursera" src="https://ad.linksynergy.com/fs-bin/show?id=phY4769lVwA&bids=467035.415&subid=0&type=4&gridnum=16" style="max-width:100%!important">
            </a>

          </div-->

          <div class="card">
            
  <div id="comments">
    <div id="disqus_thread"></div>
    <script>
      var disqus_config = function () {
        this.page.url = 'how-to-implement-a-crud-using-ajax-and-json.html';
        this.page.identifier = '/tutorial/2016/11/15/how-to-implement-a-crud-using-ajax-and-json';
      };
      (function() {
      var d = document, s = d.createElement('script');
      s.src = 'http://simpleisbetterthancomplex.disqus.com/embed.js';
      s.setAttribute('data-timestamp', +new Date());
      (d.head || d.body).appendChild(s);
      })();
    </script>
    <script id="dsq-count-scr" src="http://simpleisbetterthancomplex.disqus.com/count.js" async></script>
    <noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript>
  </div>


          </div>
          <div class="card subscribe">
  <form action="https://colossus.simpleisbetterthancomplex.com/subscribe/d2320a41-0378-4aa8-8f4e-5bb1ffcd521d/" method="post" target="_blank" novalidate>
    <h4>
      <span class="fa fa-send" style="margin-right: 5px"></span> Subscribe to our Mailing List
    </h4>
    <h5>Receive updates from the Blog!</h5>
    <div class="row">
      <div class="eight columns">
        <input class="u-full-width" placeholder="Your email address" type="email" name="email">
      </div>
      <div class="four columns">
        <button type="submit" class="u-full-width">Subscribe</button>
      </div>
    </div>
  </form>
</div>

          <div class="card popular-posts">
  <h4>Popular Posts</h4>
  <div class="row">
    
      <div class="four columns">
        <a href="../../07/22/how-to-extend-django-user-model.html">
          <img src="../../../../media/2016-07-22-how-to-extend-django-user-model/featured-post-image.jpg" alt="How to Extend Django User Model" title="How to Extend Django User Model">
          How to Extend Django User Model
        </a>
      </div>
    
      <div class="four columns">
        <a href="../../05/11/how-to-setup-ssl-certificate-on-nginx-for-django-application.html">
          <img src="../../../../media/2016-05-11-how-to-setup-ssl-certificate-on-nginx-for-django-application/featured-post-image.jpg" alt="How to Setup a SSL Certificate on Nginx for a Django Application" title="How to Setup a SSL Certificate on Nginx for a Django Application">
          How to Setup a SSL Certificate on Nginx for a Django Application
        </a>
      </div>
    
      <div class="four columns">
        <a href="../../10/14/how-to-deploy-to-digital-ocean.html">
          <img src="../../../../media/2016/10/featured-do.jpg" alt="How to Deploy a Django Application to Digital Ocean" title="How to Deploy a Django Application to Digital Ocean">
          How to Deploy a Django Application to Digital Ocean
        </a>
      </div>
    
  </div>
</div>

        </div>
      </div>
    </div>
  </main>
  <footer>
  <div class="container">
    <ul>
      <li>© 2015-2021 simple complex</li>
      <li><a rel="license noopener" href="https://creativecommons.org/licenses/by-nc-sa/3.0/" target="_blank">cc by-nc-sa 3.0</a></li>
      <li>//</li>
      <li><a href="../../../../about/index.html" rel="author">about</a></li>
      <li><a href="../../../../contact/index.html">contact</a></li>
      <li><a href="../../../../faq/index.html">faq</a></li>
      <li><a href="../../../../cookies/index.html">cookies</a></li>
      <li><a href="../../../../privacy/index.html">privacy policy</a></li>
    </ul>
  </div>
</footer>
<div class="overlay"></div>

  
  <script id="ga-page-views" src="../../../../js/page-views.js" async></script>
  <script src="http://z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=1d8c6a0f-2136-49ad-b0b3-0b09662b7e28"></script>


<style>
.related-posts .row {
  display: grid;
  grid-gap: 20px;
  grid-template-columns: repeat(3, 1fr);
}

.related-posts .four.columns {
  width: 100%;
}
</style>

<script>
_bsa.init('recommended', 'CK7I4KJJ', 'placement:simpleisbetterthancomplexcom',
    {
      target: '.related-posts .columns',
      template: `
<div class="four columns">
<a href="##link##" rel="noopener nofollow">
<img src="##smallImage##" alt="##title##" title="##title##">[Sponsored] ##title##</a>
</div>
      `
    }
  );
</script>

<script type="application/ld+json">
{
  "@context": "http://schema.org",
  "@type": "BlogPosting",
  "mainEntityOfPage": "https://simpleisbetterthancomplex.com/tutorial/2016/11/15/how-to-implement-a-crud-using-ajax-and-json.html",
  "headline": "How to Implement CRUD Using Ajax and Json",
  "image": {
    "@type": "ImageObject",
    "url": "https://simpleisbetterthancomplex.com/media/2016/11/featured-ajax.jpg",
    "height": 370,
    "width": 960
  },
  "datePublished": "2016-11-15T13:42:00+02:00",
  "dateModified": "2016-11-15T13:42:00+02:00",
  "author": {
    "@type": "Person",
    "name": "Vitor Freitas"
  },
   "publisher": {
    "@type": "Organization",
    "name": "Simple is Better Than Complex",
    "logo": {
      "@type": "ImageObject",
      "url": "https://simpleisbetterthancomplex.com/img/gplus_logo.png",
      "height": 60,
      "width": 600
    }
  },
  "description": "Using Ajax to create asynchronous request to manipulate Django models is a very common use case. It can be used toprovide an in line edit in a table, or create a new model instance without going ba..."
}
</script>

</body>

<!-- Mirrored from simpleisbetterthancomplex.com/tutorial/2016/11/15/how-to-implement-a-crud-using-ajax-and-json.html by HTTrack Website Copier/3.x [XR&CO'2014], Fri, 03 Sep 2021 12:46:31 GMT -->
</html>

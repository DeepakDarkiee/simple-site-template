<!DOCTYPE html>
<html lang="en">

<!-- Mirrored from simpleisbetterthancomplex.com/tutorial/2018/01/18/how-to-implement-multiple-user-types-with-django.html by HTTrack Website Copier/3.x [XR&CO'2014], Fri, 03 Sep 2021 12:44:34 GMT -->
<head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta name="ir-site-verification-token" value="-233745807">
<title>How to Implement Multiple User Types with Django</title>
<meta name="description" content="This is a very common problem many developers face in the early stages of the development of a new project, and it’salso a question I get asked a lot. So, I ...">
<link href="https://fonts.googleapis.com/css?family=Raleway:400,300,500,600,700" rel="stylesheet" type="text/css">
<link rel="stylesheet" href="../../../../css/main71de.css?v=34">
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">
<link rel="canonical" href="how-to-implement-multiple-user-types-with-django.html">
<link rel="alternate" type="application/rss+xml" title="Simple is Better Than Complex" href="../../../../feed.xml" />
<link rel="icon" type="image/png" href="../../../../favicon.png">
<link rel="mask-icon" href="../../../../safari-pinned-tab.svg" color="#5bbad5">
<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.2/jquery.min.js"></script>
<script src="../../../../js/site7b30.js?v=4"></script>

  <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','http://www.google-analytics.com/analytics.js','ga');
    ga('create', 'UA-42049022-10', 'auto');
    ga('send', 'pageview');
  </script>
  <script>
    $(function () {
      $("#ad").on("click", "#carbonads .carbon-wrap a", function () {
        var page_id = 'how-to-implement-multiple-user-types-with-django.html';
        ga('send', 'event', 'carbonads', 'click', page_id, {
          'transport': 'beacon'
        });
      });
    });
  </script>
  <script>
  !function(f,b,e,v,n,t,s){if(f.fbq)return;n=f.fbq=function(){n.callMethod?
  n.callMethod.apply(n,arguments):n.queue.push(arguments)};if(!f._fbq)f._fbq=n;
  n.push=n;n.loaded=!0;n.version='2.0';n.queue=[];t=b.createElement(e);t.async=!0;
  t.src=v;s=b.getElementsByTagName(e)[0];s.parentNode.insertBefore(t,s)}(window,
  document,'script','https://connect.facebook.net/en_US/fbevents.js');
  fbq('init', '1689711451348257');
  fbq('track', 'PageView');
  </script>
  <noscript><img height="1" width="1" style="display:none" alt="PageView"
  src="https://www.facebook.com/tr?id=1689711451348257&amp;ev=PageView&amp;noscript=1"
  /></noscript>
  <script data-ad-client="ca-pub-5430683801108011" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>


  <meta property="og:title" content="How to Implement Multiple User Types with Django">
<meta property="og:url" content="https://simpleisbetterthancomplex.com/tutorial/2018/01/18/how-to-implement-multiple-user-types-with-django.html">
<meta property="og:image" content="https://simpleisbetterthancomplex.com/media/2018/01/thumbnail-user-types.jpg">
<meta property="og:description" content="This is a very common problem many developers face in the early stages of the development of a new project, and it’salso a question I get asked a lot. So, I ...">
<meta property="og:site_name" content="Simple is Better Than Complex">
<meta property="og:locale" content="en_US">

  <meta property="article:published_time" content="2018-01-18T14:00:00+02:00">
  <meta property="article:author" content="https://facebook.com/vitorfs">

<meta property="fb:admins" content="100000024295617">
<meta property="fb:app_id" content="1645747765697865">

<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:site" content="vitorfs">
<meta name="twitter:creator" content="vitorfs">
<meta name="twitter:title" content="How to Implement Multiple User Types with Django">
<meta name="twitter:description" content="This is a very common problem many developers face in the early stages of the development of a new project, and it’salso a question I get asked a lot. So, I thought about sharing my experience with...">
<meta name="twitter:image" content="https://simpleisbetterthancomplex.com/media/2018/01/thumbnail-user-types.jpg">
<meta name="p:domain_verify" content="e262845cb18e4c68b0cff535a0eaea5d">
  <meta property="og:type" content="article">
  
    <meta property="article:tag" content="django">
  
    <meta property="article:tag" content="user">
  
    <meta property="article:tag" content="auth">
  
  <style type="text/css">
    @media (min-width: 750px) {
      body {
        /*padding-top:50px!important;*/
      }
    }
  </style>
  <script src="http://m.servedby-buysellads.com/monetization.js"></script>
</head>
<body>
  <div id="top" style="visibility: hidden"></div>
<header>
  <div class="container">
    <ul class="menu menu-right">
      <li class="menu-item">
        <a href="../../../../search/index.html">
          <span class="fa fa-search"></span>
        </a>
      </li>
      <li class="toggle-menu">
        <a href="javascript:void(0);">
          <span class="fa fa-bars"></span>
        </a>
      </li>
    </ul>
    <ul class="menu menu-left">
      <li class="logo">
        <a href="../../../../index.html" style="font-weight: 900">simple<span class="brand">is</span>better<span class="brand">than</span>complex</a>
      </li>
      <li class="menu-item">
        <a href="../../../../index.html">
          <span class="fa fa-home" style="margin-right: 3px"></span>
          Home
        </a>
      </li>
      <li class="menu-item">
        <a href="../../../../archive/index.html">
          <span class="fa fa-archive" style="margin-right: 3px"></span>
          Articles
        </a>
      </li>
      <li class="menu-item">
        <a href="../../../../videos/index.html">
          <span class="fa fa-video-camera" style="margin-right: 3px"></span>
          Videos
        </a>
      </li>
      <li class="menu-item">
        <a href="../../../../series/index.html">
          <span class="fa fa-book" style="margin-right: 3px"></span>
          Series
        </a>
      </li>
      <li class="menu-item">
        <a href="../../../../snippets/index.html">
          <span class="fa fa-code" style="margin-right: 3px"></span>
          Snippets
        </a>
      </li>
      <li class="menu-item">
        <a href="../../../../sponsor/index.html">
          <span class="fa fa-bullhorn" style="margin-right: 3px"></span>
          Sponsor
        </a>
      </li>
      <li class="menu-item">
        <a href="../../../../feed.xml" target="_blank">
          <span class="fa fa-rss" style="margin-right: 3px"></span>
          RSS
        </a>
      </li>
      <li class="menu-item">
        <a href="https://colossus.simpleisbetterthancomplex.com/subscribe/d2320a41-0378-4aa8-8f4e-5bb1ffcd521d/" class="brand" target="_blank">
          <span class="fa fa-send" style="margin-right: 3px"></span> Subscribe
        </a>
      </li>
      <li class="menu-item hidden-mobile">
        <a href="../../../../search/index.html">
          <span class="fa fa-search"></span> Search
        </a>
      </li>
    </ul>
  </div>
</header>

  <!--p style="text-align:center;font-size:1.4rem;margin-top:2rem;margin-bottom:2rem;">
    <span style="background-color:#1eaedb;color:#fff;border-radius:3px;padding:3px 5px;font-size:1.2rem;margin-right:5px;">Sponsored</span>
    <a href="/sponsor/" rel="noopener nofollow">
      By You? Learn more about sponsorship of the blog.
    </a>
  </p-->

  <main>
    <div class="container">
      <div class="row">
        <div class="ten offset-by-one columns content post">
          <div class="card post-author">
  <div class="author-picture">
    <img src="../../../../img/picture.jpg" alt="Vitor Freitas">
  </div>
  <div class="author-info">
    <p class="name">By <strong>Vitor Freitas</strong></p>
    <a href="https://www.digitalocean.com/?refcode=074832454ff1&amp;utm_campaign=Referral_Invite&amp;utm_medium=Referral_Program&amp;utm_source=badge" class="powered-by-do">
      <img src="https://web-platforms.sfo2.cdn.digitaloceanspaces.com/WWW/Badge 1.svg" alt="DigitalOcean Referral Badge">
    </a>
    <p class="bio">
      I'm a passionate software developer and researcher. I write about Python, Django and Web Development on a weekly basis. <a href="../../../../about/index.html" rel="author">Read more</a>.
    </p>
    <p class="contact">
      <a href="https://www.youtube.com/VitorFreitas" rel="me noopener" target="_blank" title="YouTube"><i class="fa fa-youtube-play"></i></a>
      <a href="https://github.com/vitorfs" rel="me noopener" target="_blank" title="GitHub"><i class="fa fa-github"></i></a>
      <a href="https://twitter.com/vitorfs" rel="me noopener" target="_blank" title="Twitter"><i class="fa fa-twitter"></i></a>
      <a href="https://facebook.com/vitorfs" rel="me noopener" target="_blank" title="Facebook"><i class="fa fa-facebook-official"></i></a>
      <a href="https://linkedin.com/in/vitorfs" rel="me noopener" target="_blank" title="LinkedIn"><i class="fa fa-linkedin-square"></i></a>
      <a href="https://instagram.com/vitorfs" rel="me noopener" target="_blank" title="Instagram"><i class="fa fa-instagram"></i></a>
      <a href="../../../../contact/index.html" title="Contact"><i class="fa fa-envelope"></i></a>
    </p>
  </div>
  
  
  <div class="row">
    <div class="six columns">
      <div id="ad">
        <script async type="text/javascript" src="http://cdn.carbonads.com/carbon.js?serve=CKYIEKQM&amp;placement=simpleisbetterthancomplexcom" id="_carbonads_js"></script>
      </div>
    </div>


    <!--div class="six columns">
      <div id="ad2">
        <div id="sponsored">
          <a href="/sponsor/">
            <img src="/media/sponsored/ad.png" alt="Advertise Here">
            <span>Reach 90k+ Django developers every month. Learn more about sponsorship of the blog.</span>
          </a>
          <small>
            <a href="/sponsor/">Sponsored</a>
          </small>
        </div>

        <div id="sponsored">
          <a href="https://click.linksynergy.com/link?id=phY4769lVwA&offerid=507388.567828&type=2&murl=https%3A%2F%2Fwww.udemy.com%2Fcomplete-python-bootcamp%2F" target="_blank" rel="noopener nofollow">
            <img border="0" src="https://udemy-images.udemy.com/course/480x270/567828_67d0.jpg" alt="Complete Python Bootcamp: Go from zero to hero in Python 3">
            <span>Complete Python Bootcamp: Go from zero to hero in Python 3</span>
          </a>
          <small>
            <a href="/sponsor/">Sponsored</a>
          </small>
          <img border="0" width="1" height="1" src="https://ad.linksynergy.com/fs-bin/show?id=phY4769lVwA&bids=507388.567828&type=2&subid=0" alt="LinkSynergy">
        </div>

      </div>
    </div-->


  </div>
  
</div>


          <p style="text-align:center;font-size:1.4rem;margin-bottom:4rem;">
            <i class="fa fa-youtube-play" style="color:#ff0000!important;"></i> <a href="https://www.youtube.com/VitorFreitas?sub_confirmation=1" target="_blank">Subscribe to our YouTube Channel!</a>
            <br>
            <a href="https://youtu.be/Udf4VbtM92Y" target="_blank">[Jul 12, 2021] New Video: How to Use Django Rest Framework Permissions (DRF Tutorial - Part 7)</a>
          </p>

          <div class="card">
            
  <h5 class="post-category">
    
      tutorial
    
  </h5>
  <hr class="dashed">

<h3 class="post-title">How to Implement Multiple User Types with Django</h3>
<ul class="post-meta">
  <li>
    <i class="fa fa-calendar"></i> Jan 18, 2018
  </li>
  <li>
    <i class="fa fa-clock-o"></i>
    22 minutes read
  </li>
  <li>
    <i class="fa fa-comments"></i>
    <a href="#disqus_thread" data-disqus-identifier="/tutorial/2018/01/18/how-to-implement-multiple-user-types-with-django">comments</a>
  </li>
  <li>
    <i class="fa fa-eye"></i>
    <span class="ga-page-views" data-ga-identifier="how-to-implement-multiple-user-types-with-django.html"></span> views
  </li>
  
  
</ul>

  <div class="post-featured-image">
    <img src="../../../../media/2018/01/featured-user-types.jpg" alt="How to Implement Multiple User Types with Django" class="featured-image">
    
      <small>(Picture: <a href="https://www.pexels.com/photo/adult-casual-collection-fashion-296881/" target="_blank">https://www.pexels.com/photo/adult-casual-collection-fashion-296881/</a>)</small>
    
  </div>


            <article>
              <p>This is a very common problem many developers face in the early stages of the development of a new project, and it’s
also a question I get asked a lot. So, I thought about sharing my experience with previous Django projects on how to
handle multiple user types.</p>

<p>I’ve tried many different strategies. In this tutorial I will share my thoughts on this particular topic and share with
you the strategies that worked best for me, depending on the requirements of the project.</p>

<p>Many of the design decisions depends on the requirements and business model of the application you are developing. I
will try to cover as many different scenarios as possible. Read carefully and pick the best option for you.</p>

<p>If you learn better with examples or you are in a hurry right now, <a href="#practical-example">jump to the practical example</a>.
Otherwise, keep reading.</p>

<hr />

<h4 id="rules-of-thumb">Rules of Thumb</h4>

<p>What you are going to read next is not written in a stone. It’s just some general recommendations that fits most cases.
If you have a good reason, or if not following those recommendations will result in a better application design, go
ahead and break the “rules”!</p>

<h5 id="no-matter-what-strategy-you-pick-or-what-is-your-business-model-always-use-one-and-only-one-django-model-to-handle-the-authentication">1. No matter what strategy you pick, or what is your business model, always use one, and only one Django model to handle the authentication.</h5>

<p>You can still have multiple user types, but generally speaking it’s a bad idea to store authentication information
across multiple models/tables. Treat this model as an <em>account</em> rather than a <em>user</em>. Meaning, all <em>users</em> need an
<em>account</em> to log in.</p>

<p>The business logic will be implemented in a different way, so no need to have username/password spread across multiple
tables. After all, all accounts should share many common resources such as login, logout, password resets, password
change.</p>

<h5 id="never-user-the-built-in-django-user-model-directly-even-if-the-built-in-django-user-implementation-fulfill-all-the-requirements-of-your-application">2. Never user the built-in Django User model directly, even if the built-in Django User implementation fulfill all the requirements of your application.</h5>

<p>At least extend the <code class="highlighter-rouge">AbstractUser</code> model and switch the <code class="highlighter-rouge">AUTH_USER_MODEL</code> on your settings.</p>

<p>Requirements <em>always</em> change. You may need to customize the User model in the future, and switching the
<code class="highlighter-rouge">AUTH_USER_MODEL</code> after your application is in production will be very painful. Mainly because you will need to update
<em>all</em> the foreign keys to the User model. It can be done, but this simple measure (which, honestly, is effortless in
the beginning of the project) can save you from headaches in the future.</p>

<p>This will give you freedom to add custom methods to the User model without having to rely on a OneToOne model or
having to implement an Abstract model.</p>

<p>Also, the built-in Django model have some old design decisions (which are kept that way because of backwards
compatibility) that are not compatible with many application requirements such as a nullable email field, the email
field is not unique, the username field is case sensitive, which means you can have a user with username <strong>ana</strong> and
another one with <strong>Ana</strong>, first name and last name fields which are not “internationally friendly” (some applications
are better off having “full name” and “screen name” for example).</p>

<hr />

<h4 id="strategies">Strategies</h4>

<p>How you are going to implement multiple user types depends on the requirements of your application. Below, a few
questions you have to ask yourself:</p>

<ul>
  <li>How much information specific to each type of user you need to maintain?</li>
  <li>Can the users have more than one role in the application? E.g. can a User be a Student and Teacher at the same time?</li>
  <li>How many different types of users the application will need to manage?</li>
</ul>

<p>A very common case is to have a regular user and an admin user. For that case, you can use the built-in <code class="highlighter-rouge">is_staff</code> flag
to differentiate normal users from admin users. Actually the built-in User model has two similar fields, <code class="highlighter-rouge">is_staff</code> and
<code class="highlighter-rouge">is_superuser</code>. Those flags are used in the Django Admin app, the <code class="highlighter-rouge">is_staff</code> flag designates if the user can log in
the Django Admin pages. Now, what this user can or cannot do, is defined by the permissions framework (where you can
add specific permissions to a given user, e.g. can create/update users but cannot delete users). The <code class="highlighter-rouge">is_superuser</code>
flag is an additional flag to assign <em>all</em> permissions without having to add one by one. So here as you can see, the
permissions are managed at two different levels.</p>

<p>If you need to maintain extra information related to the users, you have to ask yourself if this particular information
is relevant to all users or if it is relevant to only some type of users. For example, a “student number” may only be
relevant to Student users. In such cases, you are better off adding a profile model via one-to-one relationship. Now,
if the extra info is relevant to all users (e.g., avatar image), the best thing to do is add an extra field directly to
the User model.</p>

<p>If the users on your application can assume multiple roles at the same time (e.g. be a Student and Teacher), or your
application will have only a few user types, you can control that information in the central User model and create
flags like <code class="highlighter-rouge">is_student</code> and <code class="highlighter-rouge">is_teacher</code>:</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="k">class</span> <span class="nc">User</span><span class="p">(</span><span class="n">AbstractUser</span><span class="p">):</span>
    <span class="n">is_student</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">BooleanField</span><span class="p">(</span><span class="s">'student status'</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
    <span class="n">is_teacher</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">BooleanField</span><span class="p">(</span><span class="s">'teacher status'</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span></code></pre></figure>

<p>This is perhaps the easiest way to handle multiple user types.</p>

<p>Another option is, if the users can assume only one role, you could have a choices field like the example below:</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="k">class</span> <span class="nc">User</span><span class="p">(</span><span class="n">AbstractUser</span><span class="p">):</span>
  <span class="n">USER_TYPE_CHOICES</span> <span class="o">=</span> <span class="p">(</span>
      <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="s">'student'</span><span class="p">),</span>
      <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="s">'teacher'</span><span class="p">),</span>
      <span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="s">'secretary'</span><span class="p">),</span>
      <span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="s">'supervisor'</span><span class="p">),</span>
      <span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="s">'admin'</span><span class="p">),</span>
  <span class="p">)</span>

  <span class="n">user_type</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">PositiveSmallIntegerField</span><span class="p">(</span><span class="n">choices</span><span class="o">=</span><span class="n">USER_TYPE_CHOICES</span><span class="p">)</span></code></pre></figure>

<p>This way you have a central point to check what is the type of the user. Usually using boolean flags works better!</p>

<p>If your application handle many user types, and users can assume multiple roles, an option is to create an extra table
and create a many to many relationship:</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="k">class</span> <span class="nc">Role</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
  <span class="s">'''
  The Role entries are managed by the system,
  automatically created via a Django data migration.
  '''</span>
  <span class="n">STUDENT</span> <span class="o">=</span> <span class="mi">1</span>
  <span class="n">TEACHER</span> <span class="o">=</span> <span class="mi">2</span>
  <span class="n">SECRETARY</span> <span class="o">=</span> <span class="mi">3</span>
  <span class="n">SUPERVISOR</span> <span class="o">=</span> <span class="mi">4</span>
  <span class="n">ADMIN</span> <span class="o">=</span> <span class="mi">5</span>
  <span class="n">ROLE_CHOICES</span> <span class="o">=</span> <span class="p">(</span>
      <span class="p">(</span><span class="n">STUDENT</span><span class="p">,</span> <span class="s">'student'</span><span class="p">),</span>
      <span class="p">(</span><span class="n">TEACHER</span><span class="p">,</span> <span class="s">'teacher'</span><span class="p">),</span>
      <span class="p">(</span><span class="n">SECRETARY</span><span class="p">,</span> <span class="s">'secretary'</span><span class="p">),</span>
      <span class="p">(</span><span class="n">SUPERVISOR</span><span class="p">,</span> <span class="s">'supervisor'</span><span class="p">),</span>
      <span class="p">(</span><span class="n">ADMIN</span><span class="p">,</span> <span class="s">'admin'</span><span class="p">),</span>
  <span class="p">)</span>

  <span class="nb">id</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">PositiveSmallIntegerField</span><span class="p">(</span><span class="n">choices</span><span class="o">=</span><span class="n">ROLE_CHOICES</span><span class="p">,</span> <span class="n">primary_key</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>

  <span class="k">def</span> <span class="nf">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
      <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_id_display</span><span class="p">()</span>


<span class="k">class</span> <span class="nc">User</span><span class="p">(</span><span class="n">AbstractUser</span><span class="p">):</span>
  <span class="n">roles</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">ManyToManyField</span><span class="p">(</span><span class="n">Role</span><span class="p">)</span></code></pre></figure>

<p>It wouldn’t make much sense to create roles programatically because they are very tied to the business logic. If you
need a flexible permission management, it’s a better idea to use Django’s permission framework, where you can create
groups and define specific permissions.</p>

<p>In this case I created some constants inside the Role model, so you can define behavior in the application using those
constant values like <code class="highlighter-rouge">if role == Role.ADMIN:</code>.</p>

<p>It’s worth mentioning that this strategy is not very common. Evaluate first if creating custom permission groups
wouldn’t be better, because Django already provides several tolling for this kind of thing.</p>

<hr />

<h4 id="picking-the-right-strategy">Picking the Right Strategy</h4>

<p>I created the flowchart below to help you decide what’s the right strategy for you. The orange diamonds are decision
points; questions that you need to answer so to define the most suitable option. The blue rectangles are actions you
will need to perform based on your decisions.</p>

<p><img src="../../../../media/2018/01/django-multiple-user-types.png" alt="User Types Flowchart" /></p>

<p>This flowchart is also a nice tool to remind you of what is important to take into account when designing your
application.</p>

<hr />

<h4 id="authentication-and-authorization">Authentication and Authorization</h4>

<p>Managing multiple user types or roles in a Web application boils down to permission management. Boolean flags like
<code class="highlighter-rouge">is_student</code> or <code class="highlighter-rouge">is_staff</code> usually work as a fixed and pre-defined permission rules, that are incorporated in the
source code of your application.</p>

<p>Before we jump into the implementation, it is important to highlight those two concepts:</p>

<ul>
  <li>Authentication (Login)</li>
  <li>Authorization (Permission)</li>
</ul>

<p><strong>Authentication</strong> is the process of verifying if the person is who they claims to be. In practical terms, it’s the
process of verifying username and password (login).</p>

<p><strong>Authorization</strong> is the process of verifying what this particular person is allowed to do in the application.
This can be achieved using view decorators, Django’s built-in permissions framework, or some third-party app like
<a href="https://github.com/django-guardian/django-guardian" target="_blank" rel="noopener">django-guardian</a> or
<a href="https://github.com/dfunckt/django-rules" target="_blank" rel="noopener">django-rules</a>.</p>

<p>Handling authentication with Django is fairly simple, as it’s more standardized. Also, regardless of what the user can
do in the application, the process of verifying their credentials should be pretty much the same, right? That’s usually
the case in most Django applications. The thing is, most Django authentication forms encompasses aspects related to
both authentication and authorization. That being said, authorization always comes <em>after</em> authentication.</p>

<p>Depending on your application needs, just one authentication form and view might be enough for all user types. But in
some cases you will still need to implement different forms to authorize certain users to access certain modules or
pages of your application.</p>

<p>Now, handling the authorization, i.e., what the users can or cannot do is the main challenge of implementing multiple
user types. It’s a little bit more complicated because this can be done at different levels:</p>

<ul>
  <li>It can be done at module or app level like Django Admin; only staff members can access the pages under <code class="highlighter-rouge">/admin/</code>.</li>
  <li>Within the same module or app, only a certain type of users can see and interact with some specific pages.</li>
  <li>Permission management within the same module where some users can only do certain actions (such as create or update
objects) where other users can also delete objects.</li>
  <li>There’s also object-level permissions, where only the user who created it can interact with it. For example on
Facebook, only you can edit your own posts (probably some super user / staff member can also interact with it, but
from the business logic point of view, posts belongs to the users who posted it).</li>
</ul>

<p>In the next section we are going to explore some real use cases. You will also find the complete source code so you can
explore further or even use the code as the starting point for your implementation.</p>

<hr />

<h4 id="practical-example">Practical Example</h4>

<p>I was planning to create a simple example just to illustrate one case, but I ended up enjoying way too much the
implementation. So I created something more elaborated (which I might use in future examples). The good thing is that
now you have a working example that you can study or re-use some parts of the implementation.</p>

<p>Anyway, this example is using Python 3.6, Django 2.0 and Bootstrap 4.</p>

<p>I named the project “Django School”, and it’s an application where teachers can create quizzes and students can sign
up and select their interests. The application will show the students quizzes related to their interests.</p>

<p>So, in short: teachers create quiz and view results of the taken quizzes.</p>

<p><img src="../../../../media/2018/01/teacher-quiz.png" alt="Teacher Quiz" /></p>

<p>Students can answer to quizzes.</p>

<p><img src="../../../../media/2018/01/student-home.png" alt="Student Home" /></p>

<p>You can explore the views live using this URL: <a href="https://django-school.vitorfs.com/" target="_blank">django-school.vitorfs.com</a>.</p>

<h5 id="models">Models</h5>

<p>Here is how I represented the models related to the user types:</p>

<p><strong>models.py</strong></p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="kn">from</span> <span class="nn">django.contrib.auth.models</span> <span class="kn">import</span> <span class="n">AbstractUser</span>
<span class="kn">from</span> <span class="nn">django.db</span> <span class="kn">import</span> <span class="n">models</span>

<span class="k">class</span> <span class="nc">User</span><span class="p">(</span><span class="n">AbstractUser</span><span class="p">):</span>
    <span class="n">is_student</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">BooleanField</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
    <span class="n">is_teacher</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">BooleanField</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>

<span class="k">class</span> <span class="nc">Student</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">user</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">OneToOneField</span><span class="p">(</span><span class="n">User</span><span class="p">,</span> <span class="n">on_delete</span><span class="o">=</span><span class="n">models</span><span class="o">.</span><span class="n">CASCADE</span><span class="p">,</span> <span class="n">primary_key</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="n">quizzes</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">ManyToManyField</span><span class="p">(</span><span class="n">Quiz</span><span class="p">,</span> <span class="n">through</span><span class="o">=</span><span class="s">'TakenQuiz'</span><span class="p">)</span>
    <span class="n">interests</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">ManyToManyField</span><span class="p">(</span><span class="n">Subject</span><span class="p">,</span> <span class="n">related_name</span><span class="o">=</span><span class="s">'interested_students'</span><span class="p">)</span></code></pre></figure>

<p>Note that I didn’t create a model named <code class="highlighter-rouge">Teacher</code>. For now, there is no need for that. Because the <code class="highlighter-rouge">Student</code> class
for example, is just used to store information related to students.</p>

<p>The way we differentiate the users, and to know if a given user is a student or not, is by checking the <code class="highlighter-rouge">is_student</code>
flag.</p>

<p>For now you can ignore the <code class="highlighter-rouge">quizzes</code> and <code class="highlighter-rouge">interests</code> fields. Those are information related to the business logic of
the application.</p>

<h5 id="sign-up--user-creation">Sign Up / User Creation</h5>

<p>In this case, I created one sign up view and form for each case.</p>

<p><strong>urls.py</strong></p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="kn">from</span> <span class="nn">django.urls</span> <span class="kn">import</span> <span class="n">include</span><span class="p">,</span> <span class="n">path</span>

<span class="kn">from</span> <span class="nn">classroom.views</span> <span class="kn">import</span> <span class="n">classroom</span><span class="p">,</span> <span class="n">students</span><span class="p">,</span> <span class="n">teachers</span>

<span class="n">urlpatterns</span> <span class="o">=</span> <span class="p">[</span>
    <span class="n">path</span><span class="p">(</span><span class="s">''</span><span class="p">,</span> <span class="n">include</span><span class="p">(</span><span class="s">'classroom.urls'</span><span class="p">)),</span>
    <span class="n">path</span><span class="p">(</span><span class="s">'accounts/'</span><span class="p">,</span> <span class="n">include</span><span class="p">(</span><span class="s">'django.contrib.auth.urls'</span><span class="p">)),</span>
    <span class="n">path</span><span class="p">(</span><span class="s">'accounts/signup/'</span><span class="p">,</span> <span class="n">classroom</span><span class="o">.</span><span class="n">SignUpView</span><span class="o">.</span><span class="n">as_view</span><span class="p">(),</span> <span class="n">name</span><span class="o">=</span><span class="s">'signup'</span><span class="p">),</span>
    <span class="n">path</span><span class="p">(</span><span class="s">'accounts/signup/student/'</span><span class="p">,</span> <span class="n">students</span><span class="o">.</span><span class="n">StudentSignUpView</span><span class="o">.</span><span class="n">as_view</span><span class="p">(),</span> <span class="n">name</span><span class="o">=</span><span class="s">'student_signup'</span><span class="p">),</span>
    <span class="n">path</span><span class="p">(</span><span class="s">'accounts/signup/teacher/'</span><span class="p">,</span> <span class="n">teachers</span><span class="o">.</span><span class="n">TeacherSignUpView</span><span class="o">.</span><span class="n">as_view</span><span class="p">(),</span> <span class="n">name</span><span class="o">=</span><span class="s">'teacher_signup'</span><span class="p">),</span>
<span class="p">]</span></code></pre></figure>

<p>In the <strong>urls.py</strong> module you can see I have three sign up urls. The first one, asks the user if they want to sign up
as a student or as a teacher:</p>

<p><img src="../../../../media/2018/01/signup.png" alt="Django School Sign Up" /></p>

<p>Those buttons are just links that take the user either to the <code class="highlighter-rouge">StudentSignUpView</code> or to the <code class="highlighter-rouge">TeacherSignUpView</code>.</p>

<h5 id="student-sign-up">Student Sign Up</h5>

<p>Below, just a basic view processing using the generic class-based view <code class="highlighter-rouge">CreateView</code> and the most important piece:
the <code class="highlighter-rouge">StudentSignUpForm</code>.</p>

<p><strong>views/students.py</strong></p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="kn">from</span> <span class="nn">django.contrib.auth</span> <span class="kn">import</span> <span class="n">login</span>
<span class="kn">from</span> <span class="nn">django.shortcuts</span> <span class="kn">import</span> <span class="n">redirect</span>
<span class="kn">from</span> <span class="nn">django.views.generic</span> <span class="kn">import</span> <span class="n">CreateView</span>

<span class="kn">from</span> <span class="nn">..forms</span> <span class="kn">import</span> <span class="n">StudentSignUpForm</span>
<span class="kn">from</span> <span class="nn">..models</span> <span class="kn">import</span> <span class="n">User</span>

<span class="k">class</span> <span class="nc">StudentSignUpView</span><span class="p">(</span><span class="n">CreateView</span><span class="p">):</span>
    <span class="n">model</span> <span class="o">=</span> <span class="n">User</span>
    <span class="n">form_class</span> <span class="o">=</span> <span class="n">StudentSignUpForm</span>
    <span class="n">template_name</span> <span class="o">=</span> <span class="s">'registration/signup_form.html'</span>

    <span class="k">def</span> <span class="nf">get_context_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">kwargs</span><span class="p">[</span><span class="s">'user_type'</span><span class="p">]</span> <span class="o">=</span> <span class="s">'student'</span>
        <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">get_context_data</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">form_valid</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">form</span><span class="p">):</span>
        <span class="n">user</span> <span class="o">=</span> <span class="n">form</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
        <span class="n">login</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">request</span><span class="p">,</span> <span class="n">user</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">redirect</span><span class="p">(</span><span class="s">'students:quiz_list'</span><span class="p">)</span></code></pre></figure>

<p>Now the form definition, which is responsible for the hard work:</p>

<p><strong>forms.py</strong></p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="kn">from</span> <span class="nn">django</span> <span class="kn">import</span> <span class="n">forms</span>
<span class="kn">from</span> <span class="nn">django.contrib.auth.forms</span> <span class="kn">import</span> <span class="n">UserCreationForm</span>
<span class="kn">from</span> <span class="nn">django.db</span> <span class="kn">import</span> <span class="n">transaction</span>

<span class="kn">from</span> <span class="nn">classroom.models</span> <span class="kn">import</span> <span class="n">Student</span><span class="p">,</span> <span class="n">Subject</span><span class="p">,</span> <span class="n">User</span>

<span class="k">class</span> <span class="nc">StudentSignUpForm</span><span class="p">(</span><span class="n">UserCreationForm</span><span class="p">):</span>
    <span class="n">interests</span> <span class="o">=</span> <span class="n">forms</span><span class="o">.</span><span class="n">ModelMultipleChoiceField</span><span class="p">(</span>
        <span class="n">queryset</span><span class="o">=</span><span class="n">Subject</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="nb">all</span><span class="p">(),</span>
        <span class="n">widget</span><span class="o">=</span><span class="n">forms</span><span class="o">.</span><span class="n">CheckboxSelectMultiple</span><span class="p">,</span>
        <span class="n">required</span><span class="o">=</span><span class="bp">True</span>
    <span class="p">)</span>

    <span class="k">class</span> <span class="nc">Meta</span><span class="p">(</span><span class="n">UserCreationForm</span><span class="o">.</span><span class="n">Meta</span><span class="p">):</span>
        <span class="n">model</span> <span class="o">=</span> <span class="n">User</span>

    <span class="nd">@transaction.atomic</span>
    <span class="k">def</span> <span class="nf">save</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">user</span> <span class="o">=</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">commit</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
        <span class="n">user</span><span class="o">.</span><span class="n">is_student</span> <span class="o">=</span> <span class="bp">True</span>
        <span class="n">user</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
        <span class="n">student</span> <span class="o">=</span> <span class="n">Student</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">user</span><span class="o">=</span><span class="n">user</span><span class="p">)</span>
        <span class="n">student</span><span class="o">.</span><span class="n">interests</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">cleaned_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">'interests'</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">user</span></code></pre></figure>

<p>As the base I used the built-in <code class="highlighter-rouge">UserCreationForm</code>, which defines the <code class="highlighter-rouge">username</code> and <code class="highlighter-rouge">password</code> fields. Inside the save
method, I’m setting the <code class="highlighter-rouge">is_student</code> flag to <code class="highlighter-rouge">True</code>. And then after that I create a <code class="highlighter-rouge">Student</code> profile to store the
extra information. Finally, the student interests ad saved into the profile model. Note that the save method is
decorated with the <code class="highlighter-rouge">transaction.atomic</code>, to make sure those three operations are done in a single database transaction
and avoid data inconsistencies in case of error.</p>

<p><img src="../../../../media/2018/01/student-signup.png" alt="Student Sign Up" /></p>

<h5 id="teacher-sign-up">Teacher Sign Up</h5>

<p>The teacher sign up is very similar but more simple:</p>

<p><strong>views/teachers.py</strong></p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="kn">from</span> <span class="nn">django.contrib.auth</span> <span class="kn">import</span> <span class="n">login</span>
<span class="kn">from</span> <span class="nn">django.shortcuts</span> <span class="kn">import</span> <span class="n">redirect</span>
<span class="kn">from</span> <span class="nn">django.views.generic</span> <span class="kn">import</span> <span class="n">CreateView</span>

<span class="k">class</span> <span class="nc">TeacherSignUpView</span><span class="p">(</span><span class="n">CreateView</span><span class="p">):</span>
    <span class="n">model</span> <span class="o">=</span> <span class="n">User</span>
    <span class="n">form_class</span> <span class="o">=</span> <span class="n">TeacherSignUpForm</span>
    <span class="n">template_name</span> <span class="o">=</span> <span class="s">'registration/signup_form.html'</span>

    <span class="k">def</span> <span class="nf">get_context_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">kwargs</span><span class="p">[</span><span class="s">'user_type'</span><span class="p">]</span> <span class="o">=</span> <span class="s">'teacher'</span>
        <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">get_context_data</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">form_valid</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">form</span><span class="p">):</span>
        <span class="n">user</span> <span class="o">=</span> <span class="n">form</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
        <span class="n">login</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">request</span><span class="p">,</span> <span class="n">user</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">redirect</span><span class="p">(</span><span class="s">'teachers:quiz_change_list'</span><span class="p">)</span></code></pre></figure>

<p><strong>forms.py</strong></p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="kn">from</span> <span class="nn">django.contrib.auth.forms</span> <span class="kn">import</span> <span class="n">UserCreationForm</span>
<span class="kn">from</span> <span class="nn">classroom.models</span> <span class="kn">import</span> <span class="n">User</span>

<span class="k">class</span> <span class="nc">TeacherSignUpForm</span><span class="p">(</span><span class="n">UserCreationForm</span><span class="p">):</span>
    <span class="k">class</span> <span class="nc">Meta</span><span class="p">(</span><span class="n">UserCreationForm</span><span class="o">.</span><span class="n">Meta</span><span class="p">):</span>
        <span class="n">model</span> <span class="o">=</span> <span class="n">User</span>

    <span class="k">def</span> <span class="nf">save</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">commit</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>
        <span class="n">user</span> <span class="o">=</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">commit</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
        <span class="n">user</span><span class="o">.</span><span class="n">is_teacher</span> <span class="o">=</span> <span class="bp">True</span>
        <span class="k">if</span> <span class="n">commit</span><span class="p">:</span>
            <span class="n">user</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">user</span></code></pre></figure>

<p>Here is just a matter of switching the <code class="highlighter-rouge">is_teacher</code> flag to <code class="highlighter-rouge">True</code>. The template looks like this:</p>

<p><img src="../../../../media/2018/01/teacher-signup.png" alt="Teacher Sign Up" /></p>

<h5 id="protecting-the-views">Protecting the Views</h5>

<p>A simple way to protect your views is to create view decorators and apply them to specific views.</p>

<p>In the examples below I used the built-in <code class="highlighter-rouge">user_passes_test</code> to create two custom decorators. One to test if the
user is a student and the other one to test if the user is a teacher.</p>

<p><strong>decorators.py</strong></p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="kn">from</span> <span class="nn">django.contrib.auth</span> <span class="kn">import</span> <span class="n">REDIRECT_FIELD_NAME</span>
<span class="kn">from</span> <span class="nn">django.contrib.auth.decorators</span> <span class="kn">import</span> <span class="n">user_passes_test</span>


<span class="k">def</span> <span class="nf">student_required</span><span class="p">(</span><span class="n">function</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">redirect_field_name</span><span class="o">=</span><span class="n">REDIRECT_FIELD_NAME</span><span class="p">,</span> <span class="n">login_url</span><span class="o">=</span><span class="s">'login'</span><span class="p">):</span>
    <span class="s">'''
    Decorator for views that checks that the logged in user is a student,
    redirects to the log-in page if necessary.
    '''</span>
    <span class="n">actual_decorator</span> <span class="o">=</span> <span class="n">user_passes_test</span><span class="p">(</span>
        <span class="k">lambda</span> <span class="n">u</span><span class="p">:</span> <span class="n">u</span><span class="o">.</span><span class="n">is_active</span> <span class="ow">and</span> <span class="n">u</span><span class="o">.</span><span class="n">is_student</span><span class="p">,</span>
        <span class="n">login_url</span><span class="o">=</span><span class="n">login_url</span><span class="p">,</span>
        <span class="n">redirect_field_name</span><span class="o">=</span><span class="n">redirect_field_name</span>
    <span class="p">)</span>
    <span class="k">if</span> <span class="n">function</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">actual_decorator</span><span class="p">(</span><span class="n">function</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">actual_decorator</span>


<span class="k">def</span> <span class="nf">teacher_required</span><span class="p">(</span><span class="n">function</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">redirect_field_name</span><span class="o">=</span><span class="n">REDIRECT_FIELD_NAME</span><span class="p">,</span> <span class="n">login_url</span><span class="o">=</span><span class="s">'login'</span><span class="p">):</span>
    <span class="s">'''
    Decorator for views that checks that the logged in user is a teacher,
    redirects to the log-in page if necessary.
    '''</span>
    <span class="n">actual_decorator</span> <span class="o">=</span> <span class="n">user_passes_test</span><span class="p">(</span>
        <span class="k">lambda</span> <span class="n">u</span><span class="p">:</span> <span class="n">u</span><span class="o">.</span><span class="n">is_active</span> <span class="ow">and</span> <span class="n">u</span><span class="o">.</span><span class="n">is_teacher</span><span class="p">,</span>
        <span class="n">login_url</span><span class="o">=</span><span class="n">login_url</span><span class="p">,</span>
        <span class="n">redirect_field_name</span><span class="o">=</span><span class="n">redirect_field_name</span>
    <span class="p">)</span>
    <span class="k">if</span> <span class="n">function</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">actual_decorator</span><span class="p">(</span><span class="n">function</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">actual_decorator</span></code></pre></figure>

<p>Basically those functions <code class="highlighter-rouge">student_required</code> and <code class="highlighter-rouge">teacher_required</code> are pieces of code that will be executed every time
the view is executed.</p>

<p>If we want a view to be accessible only students, here is how we should use it:</p>

<p><strong>views/students.py</strong></p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="kn">from</span> <span class="nn">django.contrib.auth.decorators</span> <span class="kn">import</span> <span class="n">login_required</span>
<span class="kn">from</span> <span class="nn">django.shortcuts</span> <span class="kn">import</span> <span class="n">get_object_or_404</span><span class="p">,</span> <span class="n">render</span>
<span class="kn">from</span> <span class="nn">..decorators</span> <span class="kn">import</span> <span class="n">student_required</span>
<span class="kn">from</span> <span class="nn">..models</span> <span class="kn">import</span> <span class="n">Quiz</span>

<span class="nd">@login_required</span>
<span class="nd">@student_required</span>  <span class="c"># &lt;-- here!</span>
<span class="k">def</span> <span class="nf">take_quiz</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">pk</span><span class="p">):</span>
    <span class="n">quiz</span> <span class="o">=</span> <span class="n">get_object_or_404</span><span class="p">(</span><span class="n">Quiz</span><span class="p">,</span> <span class="n">pk</span><span class="o">=</span><span class="n">pk</span><span class="p">)</span>
    <span class="n">student</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">user</span><span class="o">.</span><span class="n">student</span>

    <span class="c"># body of the view...</span>

    <span class="k">return</span> <span class="n">render</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s">'classroom/students/take_quiz_form.html'</span><span class="p">,</span> <span class="p">{</span>
        <span class="s">'quiz'</span><span class="p">:</span> <span class="n">quiz</span><span class="p">,</span>
        <span class="s">'question'</span><span class="p">:</span> <span class="n">question</span><span class="p">,</span>
        <span class="s">'form'</span><span class="p">:</span> <span class="n">form</span><span class="p">,</span>
        <span class="s">'progress'</span><span class="p">:</span> <span class="n">progress</span>
    <span class="p">})</span></code></pre></figure>

<p>The example above is showing the usage of two decorators in a function based view. In this example the <code class="highlighter-rouge">take_quiz</code> view
is protected against users that are not logged in and from users who are not students.</p>

<p>Now if you are using class-based views, here is how we use it:</p>

<p><strong>views/students.py</strong></p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="kn">from</span> <span class="nn">django.utils.decorators</span> <span class="kn">import</span> <span class="n">method_decorator</span>
<span class="kn">from</span> <span class="nn">django.contrib.auth.decorators</span> <span class="kn">import</span> <span class="n">login_required</span>
<span class="kn">from</span> <span class="nn">..decorators</span> <span class="kn">import</span> <span class="n">student_required</span>

<span class="nd">@method_decorator</span><span class="p">([</span><span class="n">login_required</span><span class="p">,</span> <span class="n">student_required</span><span class="p">],</span> <span class="n">name</span><span class="o">=</span><span class="s">'dispatch'</span><span class="p">)</span>
<span class="k">class</span> <span class="nc">StudentInterestsView</span><span class="p">(</span><span class="n">UpdateView</span><span class="p">):</span>
    <span class="n">model</span> <span class="o">=</span> <span class="n">Student</span>
    <span class="n">form_class</span> <span class="o">=</span> <span class="n">StudentInterestsForm</span>
    <span class="n">template_name</span> <span class="o">=</span> <span class="s">'classroom/students/interests_form.html'</span>
    <span class="n">success_url</span> <span class="o">=</span> <span class="n">reverse_lazy</span><span class="p">(</span><span class="s">'students:quiz_list'</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">get_object</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">user</span><span class="o">.</span><span class="n">student</span>

    <span class="k">def</span> <span class="nf">form_valid</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">form</span><span class="p">):</span>
        <span class="n">messages</span><span class="o">.</span><span class="n">success</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">request</span><span class="p">,</span> <span class="s">'Interests updated with success!'</span><span class="p">)</span>
        <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">form_valid</span><span class="p">(</span><span class="n">form</span><span class="p">)</span></code></pre></figure>

<p>We need this extra import <code class="highlighter-rouge">method_decorator</code>. Then we pass a list of view decorators. It’s pretty much the same thing.</p>

<p>What happens here is, if the user is not authorized, they are taken to the login page.</p>

<h5 id="verifying-user-type">Verifying User Type</h5>

<p>To check the type of the user to add a custom behavior in a template or anywhere else it’s just a matter of performing
a simple <code class="highlighter-rouge">if</code>.</p>

<p>For example, in the two first screen shots you can see that the background color of the student area is green, and the
background color for the teacher is purple. To do that, I have two sets of CSS, then I apply them to the HTML template
dynamically:</p>

<p><strong>templates/base.html</strong></p>

<figure class="highlight"><pre><code class="language-django" data-lang="django">  <span class="nt">&lt;head&gt;</span>
    <span class="cp">{%</span> <span class="k">if</span> <span class="nv">user.is_authenticated</span> <span class="ow">and</span> <span class="nv">user.is_teacher</span> <span class="cp">%}</span>
      <span class="nt">&lt;link</span> <span class="na">rel=</span><span class="s">"stylesheet"</span> <span class="na">type=</span><span class="s">"text/css"</span> <span class="na">href=</span><span class="s">"</span><span class="cp">{%</span> <span class="nv">static</span> <span class="s1">'css/teachers.css'</span> <span class="cp">%}</span><span class="s">"</span><span class="nt">&gt;</span>
    <span class="cp">{%</span> <span class="k">else</span> <span class="cp">%}</span>
      <span class="nt">&lt;link</span> <span class="na">rel=</span><span class="s">"stylesheet"</span> <span class="na">type=</span><span class="s">"text/css"</span> <span class="na">href=</span><span class="s">"</span><span class="cp">{%</span> <span class="nv">static</span> <span class="s1">'css/students.css'</span> <span class="cp">%}</span><span class="s">"</span><span class="nt">&gt;</span>
    <span class="cp">{%</span> <span class="k">endif</span> <span class="cp">%}</span>
  <span class="nt">&lt;/head&gt;</span></code></pre></figure>

<p>You can apply the same logic for views that both students and teachers can access, but they can see different
resources. For example a menu is different, or teachers can see a specific button. Then you can build this logic in
the template. Just don’t forget to protect the view itself using the decorators! Otherwise a use could forge the URL
and access resources that they are not supposed to have access to.</p>

<hr />

<h4 id="conclusions">Conclusions</h4>

<p>In short, you will always have one User model to handle authentication. Do not spread username and passwords across
multiple models. Usually extending the default User model and adding boolean flags such as <code class="highlighter-rouge">is_student</code> and <code class="highlighter-rouge">is_staff</code>
work for most cases. Permissions can be managed at a higher level using view decorators. If you need flexible
permission management (no clear roles between the users or many specific roles), you will need to use Django’s
permissions framework or a third-party library.</p>

<p>If you want to see this sample project live go to <a href="https://django-school.vitorfs.com/" target="_blank">django-school.vitorfs.com</a>.
For the source code, visit the <a href="https://github.com/sibtc/django-multiple-user-types-example" target="_blank">repository on GitHub</a>.</p>

<p>I spent some time in this example to make it look good. If you are interested in learning more about Django, this
project is a good opportunity to dive deeper. Particularly you can get some insights about how to write custom forms
and formsets, how to work with the generic class based-views and how to use some Bootstrap 4 components to compose
Django templates.</p>

<p>If you have any questions, feel free to ask in the comments below!</p>

            </article>
            
            <hr>
            <div class="popular-posts related-posts">
  <h4>Related Posts</h4>
    <div class="row">
      <div class="four columns">
<a href="../../../../article/2021/07/08/what-you-should-know-about-the-django-user-model.html">
<img src="../../../../media/2021/07/featured-user.jpg" alt="What You Should Know About The Django User Model" title="What You Should Know About The Django User Model">
What You Should Know About The Django User Model
</a>
</div>
<div class="four columns">
<a href="../../12/19/how-to-use-jwt-authentication-with-django-rest-framework.html">
<img src="../../../../media/2018/12/featured-jwt.jpg" alt="How to Use JWT Authentication with Django REST Framework" title="How to Use JWT Authentication with Django REST Framework">
How to Use JWT Authentication with Django REST Framework
</a>
</div>
<div class="four columns">
<a href="../../11/22/how-to-implement-token-authentication-using-django-rest-framework.html">
<img src="../../../../media/2018/11/featured-rest.jpg" alt="How to Implement Token Authentication using Django REST Framework" title="How to Implement Token Authentication using Django REST Framework">
How to Implement Token Authentication using Django REST Framework
</a>
</div>
    </div>
</div>


            <hr class="dashed">
<div class="row">
  <div class="six columns post-tags" style="padding-top: 4px">
    
      <a href="../../../../tag/django/index.html"><span class="tag">django</span></a>
    
      <a href="../../../../tag/user/index.html"><span class="tag">user</span></a>
    
      <a href="../../../../tag/auth/index.html"><span class="tag">auth</span></a>
    
  </div>
  <div class="six columns post-share">
    <div class="social">
  Share this post
  <a href="http://vk.com/share.php?url=http://sibt.co/2Bd8pqn"
     rel="nofollow"
     target="_blank"
     title="Share on VK">
    <i class="fa fa-vk"></i>
  </a>
  <a href="https://twitter.com/intent/tweet?text=How%20to%20Implement%20Multiple%20User%20Types%20with%20Django&amp;url=http://sibt.co/2BdQ5xB&amp;via=vitorfs&amp;related=vitorfs"
     rel="nofollow"
     target="_blank"
     title="Share on Twitter">
    <i class="fa fa-twitter"></i>
  </a>
  <a href="https://www.facebook.com/sharer/sharer.php?app_id=1645747765697865&amp;u=http://sibt.co/2BgiF1m"
     rel="nofollow"
     target="_blank"
     title="Share on Facebook">
    <i class="fa fa-facebook"></i>
  </a>
  <a href="http://www.linkedin.com/shareArticle?mini=true&amp;url=http://sibt.co/2BeO4B3&amp;title=How%20to%20Implement%20Multiple%20User%20Types%20with%20Django&amp;summary=This%20is%20a%20very%20common%20problem%20many%20developers%20face%20in%20the%20early%20stages%20of%20the%20development%20of%20a%20new%20project,%20and%20it%E2%80%99salso%20a%20question%20I%20get%20asked%20a%20lot.%20So,%20I%20thought%20about%20sharing%20my%20experience%20with...&amp;source=https://simpleisbetterthancomplex.com"
     rel="nofollow"
     target="_blank"
     title="Share on LinkedIn">
    <i class="fa fa-linkedin"></i>
  </a>
</div>

  </div>
</div>

          </div>
          <!--div style="text-align:center;margin-bottom:20px">

            <a href="//namecheap.pxf.io/c/477033/408288/5618" target="_blank" rel="noopener nofollow">
              <img src="//a.impactradius-go.com/display-ad/5618-408288" border="0" alt="Search and buy domains from Namecheap. Lowest prices!" width="728" height="90" style="max-width:100%!important" />
            </a>
            <img height="0" width="0" src="//namecheap.pxf.io/i/477033/408288/5618" alt="Impact Radius" style="position:absolute;visibility:hidden;" border="0" />


            <a href="https://click.linksynergy.com/fs-bin/click?id=phY4769lVwA&offerid=467035.415&subid=0&type=4" target="_blank" rel="noopener nofollow">
              <img border="0" alt="Deep Learning Specialization on Coursera" src="https://ad.linksynergy.com/fs-bin/show?id=phY4769lVwA&bids=467035.415&subid=0&type=4&gridnum=16" style="max-width:100%!important">
            </a>

          </div-->

          <div class="card">
            
  <div id="comments">
    <div id="disqus_thread"></div>
    <script>
      var disqus_config = function () {
        this.page.url = 'how-to-implement-multiple-user-types-with-django.html';
        this.page.identifier = '/tutorial/2018/01/18/how-to-implement-multiple-user-types-with-django';
      };
      (function() {
      var d = document, s = d.createElement('script');
      s.src = 'http://simpleisbetterthancomplex.disqus.com/embed.js';
      s.setAttribute('data-timestamp', +new Date());
      (d.head || d.body).appendChild(s);
      })();
    </script>
    <script id="dsq-count-scr" src="http://simpleisbetterthancomplex.disqus.com/count.js" async></script>
    <noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript>
  </div>


          </div>
          <div class="card subscribe">
  <form action="https://colossus.simpleisbetterthancomplex.com/subscribe/d2320a41-0378-4aa8-8f4e-5bb1ffcd521d/" method="post" target="_blank" novalidate>
    <h4>
      <span class="fa fa-send" style="margin-right: 5px"></span> Subscribe to our Mailing List
    </h4>
    <h5>Receive updates from the Blog!</h5>
    <div class="row">
      <div class="eight columns">
        <input class="u-full-width" placeholder="Your email address" type="email" name="email">
      </div>
      <div class="four columns">
        <button type="submit" class="u-full-width">Subscribe</button>
      </div>
    </div>
  </form>
</div>

          <div class="card popular-posts">
  <h4>Popular Posts</h4>
  <div class="row">
    
      <div class="four columns">
        <a href="../../../2016/07/22/how-to-extend-django-user-model.html">
          <img src="../../../../media/2016-07-22-how-to-extend-django-user-model/featured-post-image.jpg" alt="How to Extend Django User Model" title="How to Extend Django User Model">
          How to Extend Django User Model
        </a>
      </div>
    
      <div class="four columns">
        <a href="../../../2016/05/11/how-to-setup-ssl-certificate-on-nginx-for-django-application.html">
          <img src="../../../../media/2016-05-11-how-to-setup-ssl-certificate-on-nginx-for-django-application/featured-post-image.jpg" alt="How to Setup a SSL Certificate on Nginx for a Django Application" title="How to Setup a SSL Certificate on Nginx for a Django Application">
          How to Setup a SSL Certificate on Nginx for a Django Application
        </a>
      </div>
    
      <div class="four columns">
        <a href="../../../2016/10/14/how-to-deploy-to-digital-ocean.html">
          <img src="../../../../media/2016/10/featured-do.jpg" alt="How to Deploy a Django Application to Digital Ocean" title="How to Deploy a Django Application to Digital Ocean">
          How to Deploy a Django Application to Digital Ocean
        </a>
      </div>
    
  </div>
</div>

        </div>
      </div>
    </div>
  </main>
  <footer>
  <div class="container">
    <ul>
      <li>© 2015-2021 simple complex</li>
      <li><a rel="license noopener" href="https://creativecommons.org/licenses/by-nc-sa/3.0/" target="_blank">cc by-nc-sa 3.0</a></li>
      <li>//</li>
      <li><a href="../../../../about/index.html" rel="author">about</a></li>
      <li><a href="../../../../contact/index.html">contact</a></li>
      <li><a href="../../../../faq/index.html">faq</a></li>
      <li><a href="../../../../cookies/index.html">cookies</a></li>
      <li><a href="../../../../privacy/index.html">privacy policy</a></li>
    </ul>
  </div>
</footer>
<div class="overlay"></div>

  
  <script id="ga-page-views" src="../../../../js/page-views.js" async></script>
  <script src="http://z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=1d8c6a0f-2136-49ad-b0b3-0b09662b7e28"></script>


<style>
.related-posts .row {
  display: grid;
  grid-gap: 20px;
  grid-template-columns: repeat(3, 1fr);
}

.related-posts .four.columns {
  width: 100%;
}
</style>

<script>
_bsa.init('recommended', 'CK7I4KJJ', 'placement:simpleisbetterthancomplexcom',
    {
      target: '.related-posts .columns',
      template: `
<div class="four columns">
<a href="##link##" rel="noopener nofollow">
<img src="##smallImage##" alt="##title##" title="##title##">[Sponsored] ##title##</a>
</div>
      `
    }
  );
</script>

<script type="application/ld+json">
{
  "@context": "http://schema.org",
  "@type": "BlogPosting",
  "mainEntityOfPage": "https://simpleisbetterthancomplex.com/tutorial/2018/01/18/how-to-implement-multiple-user-types-with-django.html",
  "headline": "How to Implement Multiple User Types with Django",
  "image": {
    "@type": "ImageObject",
    "url": "https://simpleisbetterthancomplex.com/media/2018/01/featured-user-types.jpg",
    "height": 370,
    "width": 960
  },
  "datePublished": "2018-01-18T14:00:00+02:00",
  "dateModified": "2018-01-18T14:00:00+02:00",
  "author": {
    "@type": "Person",
    "name": "Vitor Freitas"
  },
   "publisher": {
    "@type": "Organization",
    "name": "Simple is Better Than Complex",
    "logo": {
      "@type": "ImageObject",
      "url": "https://simpleisbetterthancomplex.com/img/gplus_logo.png",
      "height": 60,
      "width": 600
    }
  },
  "description": "This is a very common problem many developers face in the early stages of the development of a new project, and it’salso a question I get asked a lot. So, I thought about sharing my experience with..."
}
</script>

</body>

<!-- Mirrored from simpleisbetterthancomplex.com/tutorial/2018/01/18/how-to-implement-multiple-user-types-with-django.html by HTTrack Website Copier/3.x [XR&CO'2014], Fri, 03 Sep 2021 12:44:40 GMT -->
</html>
